import{j as e}from"./date-vendor-D9pAgX5F.js";import{u as t,i as n,r as a}from"./react-vendor-DF7UJAlN.js";import{u as s,a as r}from"./redux-vendor-BzdbewH4.js";import{h as i,C as o,b as m,d as c,u as l,e as d,a as p,U as y,V as u,c as x}from"./ui-vendor-DjmSPU99.js";import{P as h,r as j}from"./DefaultLayout-BUcG_pV2.js";import{u as g,ab as f,ac as b,ad as w}from"./index-DW-yAxzW.js";import{m as v}from"./index-BmyYYes_.js";import{S as N}from"./utils-vendor-Nl-sF5xe.js";import{c as P}from"./cil-check-circle-BlU9eaow.js";import{c as C}from"./cil-arrow-left-D66Kb3Zq.js";import"./form-vendor-CKNVq0c_.js";import"./icons-vendor-D82TZqJV.js";const S=()=>{const{t:S}=g(),I=s(),k=t(),{id:D}=n(),{currentPayment:L,publicPaymentConfig:T,loading:E}=r(e=>e.payments),[B,U]=a.useState(!1),[$,_]=a.useState(!1);a.useEffect(()=>{D&&(I(f(D)),I(b()))},[I,D]);const z=()=>{k(-1)},A=async e=>{try{_(!0),await I(w({id:L.id,status:"completed",transactionId:e.transactionId,gatewayResponse:e})).unwrap(),N.fire({title:S("payment.success.title","Payment Successful!"),text:S("payment.success.message","Your payment has been processed successfully."),icon:"success",confirmButtonText:S("payment.success.continue","Continue")}).then(()=>{k("/payments")})}catch(t){N.fire(S("common.error","Error"),S("payment.error.statusUpdate","Payment was successful but there was an error updating the status. Please contact support."),"warning")}finally{_(!1)}},G=e=>{N.fire(S("payment.error.title","Payment Failed"),e.message||S("payment.error.generic","There was an error processing your payment. Please try again."),"error")};return E||!L?e.jsxs(i,{fluid:!0,className:"payment-page",children:[e.jsx("style",{children:"\n          .payment-page .btn { min-height: 44px; }\n          .payment-embed-container { overflow-x: hidden; }\n          .payment-embed-container iframe { width: 100% !important; max-width: 100%; min-height: 420px; border: 0; }\n        "}),e.jsxs("div",{className:"text-center py-5",role:"status","aria-live":"polite",children:[e.jsx(o,{size:"lg","aria-label":S("common.loading","Loading...")}),e.jsx("p",{className:"mt-3",children:S("common.loading","Loading...")})]})]}):"completed"===L.status?e.jsxs(i,{fluid:!0,className:"payment-page",children:[e.jsx("style",{children:"\n          .payment-page .btn { min-height: 44px; }\n          .payment-embed-container { overflow-x: hidden; }\n          .payment-embed-container iframe { width: 100% !important; max-width: 100%; min-height: 420px; border: 0; }\n        "}),e.jsx(h,{title:S("payment.completed.title","Payment Completed"),subtitle:S("payment.completed.subtitle","This payment has already been processed"),icon:v}),e.jsx(m,{children:e.jsxs(c,{className:"text-center py-5",children:[e.jsx(l,{icon:P,size:"4xl",className:"text-success mb-4"}),e.jsx("h4",{className:"text-success",children:S("payment.completed.message","Payment Successfully Completed")}),e.jsxs("p",{className:"text-muted mb-4",children:[S("payment.completed.details","This payment was completed on")," ",new Date(L.paidAt).toLocaleDateString()]}),L.transactionId&&e.jsxs("p",{className:"text-muted",children:[S("payment.transactionId","Transaction ID"),": ",e.jsx("code",{children:L.transactionId})]}),e.jsxs(d,{color:"primary",onClick:z,children:[e.jsx(l,{icon:C,className:"me-2"}),S("common.goBack","Go Back")]})]})})]}):"pending"!==L.status?e.jsxs(i,{fluid:!0,className:"payment-page",children:[e.jsx("style",{children:"\n          .payment-page .btn { min-height: 44px; }\n          .payment-embed-container { overflow-x: hidden; }\n          .payment-embed-container iframe { width: 100% !important; max-width: 100%; min-height: 420px; border: 0; }\n        "}),e.jsx(h,{title:S("payment.unavailable.title","Payment Unavailable"),subtitle:S("payment.unavailable.subtitle","This payment cannot be processed at this time"),icon:v}),e.jsx(m,{children:e.jsxs(c,{className:"text-center py-5",children:[e.jsxs(p,{color:"warning",children:[S("payment.unavailable.message","This payment is not available for processing. Status:")," ",e.jsx("strong",{children:L.status})]}),e.jsxs(d,{color:"primary",onClick:z,children:[e.jsx(l,{icon:C,className:"me-2"}),S("common.goBack","Go Back")]})]})})]}):("undefined"!=typeof window&&(window.handlePaymentSuccess=A,window.handlePaymentError=G),e.jsxs(i,{fluid:!0,className:"payment-page",children:[e.jsx("style",{children:"\n        .payment-page .btn { min-height: 44px; }\n        .payment-embed-container { overflow-x: hidden; }\n        .payment-embed-container iframe { width: 100% !important; max-width: 100%; min-height: 420px; border: 0; }\n      "}),e.jsx(h,{title:S("payment.title","Make Payment"),subtitle:S("payment.subtitle","Complete your payment securely"),icon:v}),e.jsx(y,{children:e.jsxs(u,{lg:8,className:"mx-auto",children:[e.jsxs(m,{children:[e.jsxs(x,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"mb-0",children:S("payment.details.title","Payment Details")}),e.jsxs("small",{className:"text-muted",children:[S("payment.order","Order")," #",L.orderId]})]}),e.jsx("div",{className:"text-end",children:e.jsx("h4",{className:"mb-0 text-primary",children:new Intl.NumberFormat("en-US",{style:"currency",currency:L.currency||"USD"}).format(L.amount)})})]}),e.jsxs(c,{children:[$&&e.jsxs(p,{color:"info",role:"status","aria-live":"polite",children:[e.jsx(o,{size:"sm",className:"me-2","aria-hidden":!0}),S("payment.processing","Processing payment...")]}),L.order&&e.jsxs("div",{className:"mb-4 p-3 bg-light rounded",children:[e.jsx("h6",{children:S("payment.customer.title","Customer Information")}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("strong",{children:[S("payment.customer.name","Name"),":"]}),e.jsx("br",{}),L.order.customer?.name||L.order.proposal?.customerName||S("common.na")]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("strong",{children:[S("payment.customer.order","Order Date"),":"]}),e.jsx("br",{}),new Date(L.order.createdAt||L.createdAt).toLocaleDateString()]})]})]}),e.jsx("div",{className:"payment-form-container",role:"region","aria-label":S("payment.formRegion","Payment form"),children:T?.embedCode?(()=>{if(!T?.embedCode)return e.jsx(p,{color:"warning",children:S("payment.embed.notConfigured","Embedded payment form is not configured. Please contact support.")});const t=`\n      ${T.embedCode}\n\n      // Add event listeners for payment completion\n      window.addEventListener('paymentSuccess', (event) => {\n        window.handlePaymentSuccess(event.detail);\n      });\n\n      window.addEventListener('paymentError', (event) => {\n        window.handlePaymentError(event.detail);\n      });\n    `;return e.jsxs("div",{className:"payment-embed-container",children:[e.jsx("div",{id:"payment-form-container",dangerouslySetInnerHTML:{__html:T.embedCode}}),e.jsx("script",{dangerouslySetInnerHTML:{__html:t}})]})})():(()=>{if(!T?.gatewayUrl)return e.jsx(p,{color:"warning",children:S("payment.gateway.notConfigured","Payment gateway is not configured. Please contact support.")});const t=`${T.gatewayUrl}?orderId=${L.orderId}&amount=${L.amount}&currency=${L.currency}&paymentId=${L.id}`;return e.jsxs("div",{className:"text-center",children:[e.jsx(l,{icon:j,size:"4xl",className:"text-primary mb-4"}),e.jsx("h4",{children:S("payment.external.title","Secure Payment")}),e.jsx("p",{className:"text-muted mb-4",children:S("payment.external.description","You will be redirected to our secure payment gateway to complete your transaction.")}),e.jsxs(d,{color:"primary",size:"lg",href:t,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(l,{icon:j,className:"me-2"}),S("payment.external.button","Pay Now")]}),e.jsx("div",{className:"mt-3",children:e.jsx("small",{className:"text-muted",children:S("payment.external.security","Your payment is processed securely through our certified payment partner.")})})]})})()})]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs(d,{color:"secondary",variant:"outline",onClick:z,children:[e.jsx(l,{icon:C,className:"me-2"}),S("common.goBack","Go Back")]})})]})})]}))};export{S as default};
