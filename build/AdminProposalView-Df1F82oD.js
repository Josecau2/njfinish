import{j as e}from"./date-vendor-D9pAgX5F.js";import{i as s,u as t,r as a}from"./react-vendor-DF7UJAlN.js";import{u as n,a as r}from"./index-DW-yAxzW.js";import{d as c,c as i,a as o}from"./DefaultLayout-BUcG_pV2.js";import{u as l}from"./redux-vendor-BzdbewH4.js";import{h as d,C as m,a as u,u as p,e as x,U as j,V as h,v as y,b as f,c as N,d as b,Z as g,_ as v,$ as A,a0 as w,a1 as Q,a2 as C,a3 as D,a4 as H}from"./ui-vendor-DjmSPU99.js";import{c as V}from"./cil-info-CmGCY32x.js";import{c as S}from"./cil-arrow-left-D66Kb3Zq.js";import{c as _}from"./cil-briefcase-Bw71BDXV.js";import{c as T}from"./cil-cloud-download-CPU_poQw.js";import{c as k}from"./cil-check-circle-BlU9eaow.js";import{c as I}from"./cil-clock-0brlqJOZ.js";import{c as P}from"./cil-paper-plane-haInf9fd.js";import"./form-vendor-CKNVq0c_.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-D82TZqJV.js";var Z=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M432,56H376V88h48V464H88V88h48V56H80A24.028,24.028,0,0,0,56,80V472a24.028,24.028,0,0,0,24,24H432a24.028,24.028,0,0,0,24-24V80A24.028,24.028,0,0,0,432,56Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M192,140H320a24.028,24.028,0,0,0,24-24V16H168V116A24.028,24.028,0,0,0,192,140Zm8-92H312v60H200Z' class='ci-primary'/>"],F=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M256.25,16A240,240,0,0,0,88,84.977V16H56V144H184V112H106.287A208,208,0,0,1,256.25,48C370.8,48,464,141.2,464,255.75S370.8,463.5,256.25,463.5,48.5,370.3,48.5,255.75h-32A239.75,239.75,0,0,0,425.779,425.279,239.75,239.75,0,0,0,256.25,16Z' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='240 111.951 239.465 288 368 288 368 256 271.563 256 272 112.049 240 111.951' class='ci-primary'/>"],M=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M420,128.1V16H92V128.1A80.1,80.1,0,0,0,16,208V400H84V368H48V208a48.054,48.054,0,0,1,48-48H416a48.054,48.054,0,0,1,48,48V368H420v32h76V208A80.1,80.1,0,0,0,420,128.1Zm-32-.1H124V48H388Z' class='ci-primary'/><rect width='32' height='32' x='396' y='200' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M116,264H76v32h40V496H388V296h40V264H116ZM356,464H148V296H356Z' class='ci-primary'/>"],U=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='348.071 141.302 260.308 229.065 172.545 141.302 149.917 163.929 237.681 251.692 149.917 339.456 172.545 362.083 260.308 274.32 348.071 362.083 370.699 339.456 282.935 251.692 370.699 163.929 348.071 141.302' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M425.706,86.294A240,240,0,0,0,86.294,425.706,240,240,0,0,0,425.706,86.294ZM256,464C141.309,464,48,370.691,48,256S141.309,48,256,48s208,93.309,208,208S370.691,464,256,464Z' class='ci-primary'/>"];const z=()=>{const{proposalId:z}=s(),q=c(z),E=t();l();const[G,L]=a.useState(null),[$,B]=a.useState(!0),[O,R]=a.useState(null),{t:J}=n(),W={draft:{label:"Draft",color:"secondary",icon:Z},sent:{label:"Sent",color:"info",icon:P},pending:{label:"Pending",color:"warning",icon:I},approved:{label:"Approved",color:"success",icon:k},accepted:{label:"Accepted",color:"success",icon:k},rejected:{label:"Rejected",color:"danger",icon:U},expired:{label:"Expired",color:"dark",icon:I},in_progress:{label:"In Progress",color:"info",icon:I},completed:{label:"Completed",color:"success",icon:k}},K=e=>({draft:J("proposals.status.draft","Draft"),sent:J("proposals.status.sent","Sent"),pending:J("adminQuote.status.pending","Pending"),approved:J("adminQuote.status.approved","Approved"),accepted:J("proposals.status.accepted","Accepted"),rejected:J("proposals.status.rejected","Rejected"),expired:J("proposals.status.expired","Expired"),in_progress:J("adminQuote.status.in_progress","In Progress"),completed:J("adminQuote.status.completed","Completed")}[e]||e||J("proposals.status.draft","Draft"));a.useEffect(()=>{q&&X()},[q]);const X=async()=>{try{if(B(!0),!q)throw new Error(J("adminQuote.noId","No quote ID provided"));const{data:e}=await r.get(`/api/quotes/proposalByID/${q}`);L(e),R(null)}catch(e){R(e.message)}finally{B(!1)}},Y=e=>W[e]?.color||"secondary",ee=e=>W[e]?.icon||Z,se=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e||0),te=G?(e=>{if(!e||!e.manufacturersData)return{items:[],totalAmount:0,summary:{}};try{const s=JSON.parse(e.manufacturersData);let t=[],a={cabinets:0,assemblyFee:0,modificationsCost:0,styleTotal:0,discountAmount:0,taxAmount:0,grandTotal:0};return s.forEach(e=>{e.items&&(t=t.concat(e.items)),e.summary&&(a.cabinets+=e.summary.cabinets||0,a.assemblyFee+=e.summary.assemblyFee||0,a.modificationsCost+=e.summary.modificationsCost||0,a.styleTotal+=e.summary.styleTotal||0,a.discountAmount+=e.summary.discountAmount||0,a.taxAmount+=e.summary.taxAmount||0,a.grandTotal+=e.summary.grandTotal||0)}),{items:t,totalAmount:a.grandTotal,summary:a}}catch(s){return{items:[],totalAmount:0,summary:{}}}})(G):{items:[],totalAmount:0,summary:{}},ae=e=>{if(!e)return J("common.na","N/A");try{const s=new Date(e);return isNaN(s.getTime())?J("common.na","N/A"):s.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(s){return J("common.na","N/A")}};return $?e.jsx(d,{className:"py-4",children:e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[e.jsx(m,{color:"primary",size:"lg"}),e.jsx("span",{className:"ms-3",children:J("adminQuote.loading","Loading proposal details...")})]})}):O?e.jsxs(d,{className:"py-4",children:[e.jsxs(u,{color:"danger",children:[e.jsx(p,{icon:V,className:"me-2"}),O]}),e.jsxs(x,{color:"secondary",onClick:()=>E(-1),children:[e.jsx(p,{icon:S,className:"me-1"}),J("common.back","Back")]})]}):G?e.jsxs(d,{fluid:!0,className:"py-4",children:[e.jsx(j,{className:"mb-4",children:e.jsx(h,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(x,{color:"ghost",size:"sm",onClick:()=>E(-1),className:"me-3",children:e.jsx(p,{icon:S})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-1",children:[e.jsx(p,{icon:_,className:"me-2"}),G.title||J("publicQuote.titleNumber",{id:G.id})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3 text-muted",children:[e.jsxs("span",{children:[e.jsx(p,{icon:i,className:"me-1"}),G.customer?.name||"N/A"]}),e.jsxs("span",{children:[e.jsx(p,{icon:o,className:"me-1"}),G.UserGroup?.name||"N/A"]}),e.jsxs(y,{color:Y(G.status),size:"lg",children:[e.jsx(p,{icon:ee(G.status),className:"me-1"}),K(G.status)]})]})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(x,{color:"outline-secondary",size:"sm",onClick:()=>{window.print()},children:[e.jsx(p,{icon:M,className:"me-1"}),J("adminQuote.ui.print","Print")]}),e.jsxs(x,{color:"outline-primary",size:"sm",onClick:()=>{},children:[e.jsx(p,{icon:T,className:"me-1"}),J("proposalCommon.downloadPdf","Download PDF")]})]})]})})}),e.jsxs(j,{children:[e.jsxs(h,{lg:8,children:[e.jsxs(f,{className:"mb-4",children:[e.jsx(N,{children:e.jsx("strong",{children:J("adminQuote.ui.overview","Quote Overview")})}),e.jsxs(b,{children:[e.jsxs(j,{className:"mb-4",children:[e.jsxs(h,{md:6,children:[e.jsx("h4",{className:"text-success mb-3",children:se(te.totalAmount)}),e.jsxs(g,{flush:!0,children:[e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[e.jsx("span",{className:"text-muted",children:J("adminQuote.ui.proposalId","Quote ID")}),e.jsxs("strong",{children:["#",G.id]})]}),e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[e.jsx("span",{className:"text-muted",children:J("adminQuote.ui.customer","Customer")}),e.jsx("span",{children:G.customer?.name||J("common.na","N/A")})]}),e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[e.jsx("span",{className:"text-muted",children:J("adminQuote.ui.contractorGroup","Contractor Group")}),e.jsx("span",{children:G.UserGroup?.name||J("common.na","N/A")})]})]})]}),e.jsx(h,{md:6,children:e.jsxs(g,{flush:!0,children:[e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[e.jsx("span",{className:"text-muted",children:J("adminQuote.ui.createdDate","Created Date")}),e.jsx("span",{children:ae(G.created_at)})]}),e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[e.jsx("span",{className:"text-muted",children:J("adminQuote.ui.updatedDate","Last Updated")}),e.jsx("span",{children:ae(G.updated_at)})]}),G.sent_at&&e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[e.jsx("span",{className:"text-muted",children:J("adminQuote.ui.sentDate","Sent Date")}),e.jsx("span",{className:"text-info",children:ae(G.sent_at)})]}),G.accepted_at&&e.jsxs(v,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[e.jsx("span",{className:"text-muted",children:J("adminQuote.ui.acceptedDate","Accepted Date")}),e.jsx("span",{className:"text-success",children:ae(G.accepted_at)})]})]})})]}),G.description&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h6",{className:"text-muted mb-2",children:J("common.description","Description")}),e.jsx("div",{className:"bg-light p-3 rounded",children:e.jsx("p",{className:"mb-0",children:G.description})})]})]})]}),te.items&&te.items.length>0&&e.jsxs(f,{className:"mb-4",children:[e.jsx(N,{children:e.jsxs("strong",{children:[e.jsx(p,{icon:Z,className:"me-2"}),J("adminQuote.ui.itemsHeader","Quote Items ({{count}})",{count:te.items.length})]})}),e.jsxs(b,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(A,{hover:!0,children:[e.jsx(w,{children:e.jsxs(Q,{children:[e.jsx(C,{children:J("proposalColumns.item","Item")}),e.jsx(C,{children:J("common.description","Description")}),e.jsx(C,{className:"text-center",children:J("proposalColumns.qty","Qty")}),e.jsx(C,{className:"text-end",children:J("proposalDoc.catalog.unitPrice","Unit Price")}),e.jsx(C,{className:"text-end",children:J("proposalColumns.total","Total")})]})}),e.jsx(D,{children:te.items.map((s,t)=>e.jsxs(Q,{children:[e.jsx(H,{children:e.jsx("strong",{children:s.code||J("adminQuote.ui.itemNumber","Item {{n}}",{n:t+1})})}),e.jsx(H,{children:s.description||J("common.na","N/A")}),e.jsx(H,{className:"text-center",children:s.qty||1}),e.jsx(H,{className:"text-end",children:se(parseFloat(s.price)||0)}),e.jsx(H,{className:"text-end",children:e.jsx("strong",{children:se(parseFloat(s.total)||0)})})]},t))})]})}),e.jsx("div",{className:"border-top pt-3 mt-3",children:e.jsxs(j,{children:[e.jsx(h,{md:6}),e.jsxs(h,{md:6,children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:J("proposalDoc.priceSummary.cabinets","Cabinets & Parts:")}),e.jsx("span",{children:se(te.summary.cabinets||0)})]}),te.summary.assemblyFee>0&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:J("proposalDoc.priceSummary.assembly","Assembly fee:")}),e.jsx("span",{children:se(te.summary.assemblyFee)})]}),te.summary.modificationsCost>0&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:J("proposalDoc.priceSummary.modifications","Modifications:")}),e.jsx("span",{children:se(te.summary.modificationsCost)})]}),te.summary.discountAmount>0&&e.jsxs("div",{className:"d-flex justify-content-between mb-2 text-danger",children:[e.jsx("span",{children:J("orders.details.discount","Discount")}),e.jsxs("span",{children:["-",se(te.summary.discountAmount)]})]}),te.summary.taxAmount>0&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:J("proposalDoc.priceSummary.tax","Tax:")}),e.jsx("span",{children:se(te.summary.taxAmount)})]}),e.jsxs("div",{className:"d-flex justify-content-between border-top pt-2",children:[e.jsx("strong",{children:J("proposalDoc.priceSummary.total","Total:")}),e.jsx("strong",{className:"text-success fs-5",children:se(te.summary.grandTotal||te.totalAmount)})]})]})]})})]})]})]}),e.jsx(h,{lg:4,children:e.jsxs(f,{children:[e.jsx(N,{children:e.jsxs("strong",{children:[e.jsx(p,{icon:F,className:"me-2"}),J("adminQuote.ui.statusTimeline","Status Timeline")]})}),e.jsx(b,{children:e.jsx("div",{className:"timeline",children:(e=>{const s=[];return s.push({status:"created",label:J("adminQuote.labels.created","Created"),date:e.created_at,icon:Z,color:"secondary",description:J("adminQuote.timeline.created","Quote was created and added to the system")}),e.sent_at&&s.push({status:"sent",label:J("adminQuote.labels.sentToCustomer","Sent to Customer"),date:e.sent_at,icon:P,color:"info",description:J("adminQuote.timeline.sent","Quote was sent to the customer for review")}),e.accepted_at&&s.push({status:"accepted",label:J("adminQuote.labels.accepted","Accepted"),date:e.accepted_at,icon:k,color:"success",description:J("adminQuote.timeline.accepted","Quote was formally accepted")}),e.status&&!["draft","sent","accepted"].includes(e.status)&&s.push({status:e.status,label:K(e.status),date:e.updated_at,icon:ee(e.status),color:Y(e.status),description:"rejected"===e.status?J("adminQuote.timeline.rejected","Quote was rejected"):"expired"===e.status?J("adminQuote.timeline.expired","Quote has expired"):J("adminQuote.timeline.changed","Proposal status changed to {{status}}",{status:e.status})}),s})(G).map((s,t)=>e.jsxs("div",{className:"d-flex mb-4",children:[e.jsx("div",{className:`timeline-icon bg-${s.color} text-white rounded-circle d-flex align-items-center justify-content-center me-3`,style:{width:"40px",height:"40px",minWidth:"40px"},children:e.jsx(p,{icon:s.icon,size:"sm"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsx("strong",{children:s.label}),e.jsx("small",{className:"text-muted",children:ae(s.date)})]}),e.jsx("small",{className:"text-muted",children:s.description})]})]},t))})})]})})]})]}):e.jsxs(d,{className:"py-4",children:[e.jsxs(u,{color:"warning",children:[e.jsx(p,{icon:V,className:"me-2"}),J("adminQuote.ui.notFound","Proposal not found.")]}),e.jsxs(x,{color:"secondary",onClick:()=>E(-1),children:[e.jsx(p,{icon:S,className:"me-1"}),J("common.back","Back")]})]})};export{z as default};
