import{j as e}from"./date-vendor-D9pAgX5F.js";import{i as s,h as r,u as t,r as a}from"./react-vendor-DF7UJAlN.js";import{a as i,u as n}from"./redux-vendor-BzdbewH4.js";import{P as d}from"./DefaultLayout-BUcG_pV2.js";import{l}from"./index-BmyYYes_.js";import{h as c,C as o,a as m,u,U as h,V as x,b as j,c as f,d as y,v as b,$ as g,a0 as p,a1 as N,a2 as v,a3 as S,a4 as A,ad as $,i as T,j as F,k as w,l as C}from"./ui-vendor-DjmSPU99.js";import{u as k,a3 as _,y as M,a4 as I}from"./index-DW-yAxzW.js";import{c as D}from"./cil-arrow-left-D66Kb3Zq.js";import"./form-vendor-CKNVq0c_.js";import"./icons-vendor-D82TZqJV.js";import"./utils-vendor-Nl-sF5xe.js";const P=(e,s)=>s?P(s,e%s):e,q=(e,s=16)=>{if(null==e||isNaN(e))return"";const r=e<0?"-":"";let t=Math.abs(Number(e)),a=Math.floor(t),i=t-a,n=Math.round(i*s);if(n===s&&(a+=1,n=0),0===n)return`${r}${a}`;const d=P(n,s);return`${r}${a?a+" ":""}${n/d}/${s/d}`},z=e=>{if(!e||"object"!=typeof e)return"";const s=[],r=Object.entries(e).filter(([e,s])=>"number"==typeof s&&isFinite(s));if(1===r.length){const[,e]=r[0],t=q(e);t&&s.push(`${t}"`)}else r.length>1&&r.forEach(([e,r])=>{const t=q(r);var a;t&&s.push(`${a=e,String(a||"").replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim()} ${t}"`)});var t;return"string"==typeof e.sideSelector&&e.sideSelector&&s.push(`Side: ${t=e.sideSelector,"L"===t?"Left":"R"===t?"Right":"B"===t?"Both":t}`),s.join(" • ")},R=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Number(e||0)),U=()=>{const{t:P}=k(),{id:q}=s(),U=r(),E=t(),B=i(e=>e.customization),{current:L,loading:O,error:W}=i(e=>e.orders),{list:H,byId:G}=i(e=>e.manufacturers),Q=n(),[J,V]=a.useState(null),Z=(e=>{try{if("string"==typeof e){return e.trim()||"#ffffff"}if(e&&"object"==typeof e){if("string"==typeof e.hex&&e.hex.trim())return e.hex.trim();if("string"==typeof e.value&&e.value.trim())return e.value.trim()}}catch(s){}return"#ffffff"})(B?.headerBg),K=(e=>{if(!e)return"#ffffff";const s=e.replace("#","");return(.299*parseInt(s.substr(0,2),16)+.587*parseInt(s.substr(2,2),16)+.114*parseInt(s.substr(4,2),16))/255>.5?"#2d3748":"#ffffff"})(Z),X=a.useMemo(()=>U?.pathname?.startsWith("/my-orders")?"/my-orders":"/orders",[U?.pathname]);a.useEffect(()=>(q&&Q(_(q)),Q(M()),()=>{Q(I())}),[Q,q]);const Y=a.useMemo(()=>(e=>{const s=e?.snapshot;if(!s)return{manufacturers:[],items:[],summary:{grandTotal:0}};try{const e="string"==typeof s?JSON.parse(s):s,r=Array.isArray(e?.manufacturers)?e.manufacturers:Array.isArray(e)?e:[],t=Array.isArray(e?.items)?e.items:r.flatMap(e=>Array.isArray(e.items)?e.items:[]),a=e?.summary||r.reduce((e,s)=>{const r=s?.summary||{};return{styleTotal:(e.styleTotal||0)+Number(r.styleTotal||0),assemblyFee:(e.assemblyFee||0)+Number(r.assemblyFee||0),modificationsCost:(e.modificationsCost||0)+Number(r.modificationsCost||0),deliveryFee:(e.deliveryFee||0)+Number(r.deliveryFee||0),discountAmount:(e.discountAmount||0)+Number(r.discountAmount||0),taxAmount:(e.taxAmount||0)+Number(r.taxAmount||0),grandTotal:(e.grandTotal||0)+Number(r.grandTotal||0)}},{});return{manufacturers:r,items:t,summary:a||{grandTotal:0}}}catch(r){return{manufacturers:[],items:[],summary:{grandTotal:0}}}})(L),[L]),ee=e=>{const s=(()=>{if(L?.manufacturer?.name)return L.manufacturer.name;if(Y?.manufacturers?.[0]?.manufacturer){const e=Y.manufacturers[0].manufacturer,s=G?.[e]||G?.[String(e)];if(s?.name)return s.name;const r=H?.find?.(s=>Number(s?.id)===Number(e));if(r?.name)return r.name}return e.manufacturerName||L?.manufacturer_name||Y.manufacturers?.[0]?.manufacturerName||Y.manufacturers?.[0]?.name||"-"})(),r=Number(e.qty||e.quantity||1),t=Number(e.snapshotUnitPrice??e.finalUnitPrice??e.calculatedUnitPrice??e.unitPrice??e.price??0),a=Number(e.snapshotTotal??e.finalTotal??e.total??t*r),i=Array.isArray(e.modifications)?e.modifications.reduce((e,s)=>e+Number(s.price||0)*Number(s.qty||1),0):Number(e.modificationsTotal||0),n=(()=>{const r=e.styleName||Y.manufacturers?.[0]?.styleName||Y.manufacturers?.[0]?.style;return r&&r===s?L?.style_name&&L.style_name!==s?L.style_name:"-":r||L?.style_name||"-"})(),d=e.image||e.thumb||Y.manufacturers?.[0]?.styleImage||null,l=[n,s].filter(Boolean).join(" — ");return{manuName:s,qty:r,unit:t,total:a,modsTotal:i,styleName:n,thumb:d,thumbTitle:l}},se=Y.summary||{grandTotal:0};return O?e.jsx(c,{className:"py-5 text-center",children:e.jsx(o,{})}):W?e.jsx(c,{className:"py-4",children:e.jsx(m,{color:"danger",children:W})}):e.jsxs(c,{fluid:!0,children:[e.jsx("style",{children:`\n          .modal-header-custom {\n            background: ${Z} !important;\n            background-color: ${Z} !important;\n            background-image: none !important;\n            color: ${K} !important;\n          }\n          .modal-header-custom .modal-title {\n            color: ${K} !important;\n          }\n          .modal-header-custom .btn-close {\n            filter: ${"#ffffff"===K?"invert(1)":"invert(0)"};\n          }\n        `}),e.jsx(d,{title:P("orders.details.title","Order Details"),subtitle:L?.customer?.name?`${P("orders.details.customerLabel","Customer")}: ${L.customer.name}`:P("orders.details.subtitle","Accepted order overview"),icon:l,rightContent:e.jsxs("button",{type:"button",className:"btn btn-light btn-sm",onClick:()=>{E(X)},children:[e.jsx(u,{icon:D,className:"me-2"}),P("common.back","Back")]})}),Y.manufacturers?.length>0&&e.jsx(h,{className:"mb-3",children:e.jsx(x,{md:12,children:e.jsxs(j,{children:[e.jsx(f,{children:P("orders.details.manufacturerDetails","Manufacturer Details")}),e.jsx(y,{className:"d-flex align-items-center",style:{gap:16,flexWrap:"wrap"},children:(()=>{const s=Y.manufacturers[0],r=(()=>{if(L?.manufacturer?.name)return L.manufacturer.name;if(s?.manufacturer){const e=s.manufacturer,r=G?.[e]||G?.[String(e)];if(r?.name)return r.name;const t=H?.find?.(s=>Number(s?.id)===Number(e));if(t?.name)return t.name}return s.manufacturerName||s.name||L?.manufacturer_name||P("orders.common.manufacturer","Manufacturer")})(),t=(()=>{const e=s?.styleName||s?.style;return e&&e===r?L?.style_name&&L.style_name!==r?L.style_name:P("common.na"):e||L?.style_name||P("common.na")})(),a=s.styleImage;return e.jsxs(e.Fragment,{children:[a&&e.jsx("img",{src:a,alt:t||P("common.style","Style"),style:{width:72,height:72,objectFit:"cover",borderRadius:8,cursor:"pointer"},onClick:()=>V(a)}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-1",children:[e.jsxs("strong",{children:[P("orders.common.manufacturer","Manufacturer"),":"]})," ",r]}),e.jsxs("div",{className:"mb-0",children:[e.jsxs("strong",{children:[P("orders.details.styleColor","Style (Color)"),":"]})," ",t]})]})]})})()})]})})}),e.jsxs(h,{className:"mb-3",children:[e.jsx(x,{md:4,children:e.jsxs(j,{children:[e.jsx(f,{children:P("orders.details.order","Order")}),e.jsxs(y,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.id","ID"),":"]})," ",L?.id]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.date","Date"),":"]})," ",new Date(L?.accepted_at||L?.date||L?.createdAt).toLocaleDateString()]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.status","Status"),":"]})," ",e.jsx(b,{color:"success",children:L?.status||"accepted"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.acceptedAt","Accepted at"),":"]})," ",L?.accepted_at?new Date(L.accepted_at).toLocaleString():P("common.na")]})]})]})}),e.jsx(x,{md:4,children:e.jsxs(j,{children:[e.jsx(f,{children:P("orders.details.customer","Customer")}),e.jsxs(y,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.name","Name"),":"]})," ",L?.customer?.name||L?.customer_name||P("common.na")]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.email","Email"),":"]})," ",L?.customer?.email||L?.customer_email||P("common.na")]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.phone","Phone"),":"]})," ",L?.customer?.mobile||L?.customer?.phone||L?.customer_phone||P("common.na")]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.address","Address"),":"]})," ",L?.customer?.address||L?.customer_address||P("common.na")]})]})]})}),e.jsx(x,{md:4,children:e.jsxs(j,{children:[e.jsx(f,{children:P("orders.details.totals","Totals")}),e.jsxs(y,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.subtotalStyles","Subtotal (Styles)"),":"]})," ",R(se.styleTotal)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.assemblyFee","Assembly Fee"),":"]})," ",R(se.assemblyFee)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.modifications","Modifications"),":"]})," ",R(se.modificationsCost)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.deliveryFee","Delivery Fee"),":"]})," ",R(se.deliveryFee)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.discount","Discount"),":"]})," ",R(se.discountAmount)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.tax","Tax"),":"]})," ",R(se.taxAmount)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.grandTotal","Grand Total"),":"]})," ",R(se.grandTotal)]})]})]})})]}),e.jsxs(j,{className:"mb-4",children:[e.jsx(f,{children:P("orders.details.items","Items")}),e.jsxs(y,{children:[e.jsx("div",{className:"d-none d-md-block",children:e.jsx("div",{className:"table-wrap",children:e.jsxs(g,{hover:!0,className:"table-modern",role:"table",children:[e.jsx(p,{children:e.jsxs(N,{children:[e.jsx(v,{scope:"col",children:P("orders.details.item","Item")}),e.jsx(v,{scope:"col",children:P("orders.details.specs","Specs")}),e.jsx(v,{scope:"col",className:"text-center",children:P("orders.details.hingeSide","Hinge Side")}),e.jsx(v,{scope:"col",className:"text-center",children:P("orders.details.exposedSide","Exposed Side")}),e.jsx(v,{scope:"col",className:"text-end",children:P("orders.details.qty","Qty")}),e.jsx(v,{scope:"col",className:"text-end",children:P("orders.details.unitPrice","Unit Price")}),e.jsx(v,{scope:"col",className:"text-end",children:P("orders.details.modifications","Modifications")}),e.jsx(v,{scope:"col",className:"text-end",children:P("orders.details.total","Total")})]})}),e.jsx(S,{children:0===Y.items.length?e.jsx(N,{children:e.jsx(A,{colSpan:8,className:"text-center text-muted py-4",children:P("orders.details.noItems","No items")})}):Y.items.map((s,r)=>{const{manuName:t,qty:a,unit:i,total:n,modsTotal:d,styleName:l,thumb:c,thumbTitle:o}=ee(s);return e.jsxs(N,{children:[e.jsxs(A,{children:[e.jsx("div",{children:s.name||s.description||s.item||"-"}),Array.isArray(s.modifications)&&s.modifications.length>0&&e.jsx("div",{className:"text-muted small mt-1",children:s.modifications.map((s,t)=>{const a=z(s?.selectedOptions),i=s?.name||s?.templateName||"Modification";return e.jsxs("div",{children:["• ",i,a?` — ${a}`:""]},`mod-${r}-${t}`)})}),(()=>{const t=[];try{Array.isArray(s.modifications)&&s.modifications.forEach(e=>{Array.isArray(e.attachments)&&e.attachments.forEach(e=>{String(e.mimeType||"").startsWith("image/")&&t.push(e.url)})})}catch(a){}return t.length?e.jsx("div",{className:"mt-2 d-flex flex-wrap gap-2",children:t.map((s,t)=>e.jsx("img",{src:s,alt:`Attachment ${t+1}`,style:{width:120,height:120,objectFit:"cover",borderRadius:6,border:"1px solid #e9ecef",cursor:"pointer"},onClick:e=>{e.stopPropagation(),V(s)}},`att-${r}-${t}`))}):null})()]}),e.jsx(A,{children:c?e.jsx("img",{src:c,alt:l||t,title:o,style:{width:40,height:40,objectFit:"cover",borderRadius:6,cursor:"pointer"},onClick:e=>{e.stopPropagation(),V(c)}}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx(A,{className:"text-center",children:e.jsx("span",{className:"badge "+(s.hingeSide?"bg-primary":"bg-secondary"),children:s.hingeSide||"-"})}),e.jsx(A,{className:"text-center",children:e.jsx("span",{className:"badge "+(s.exposedSide?"bg-primary":"bg-secondary"),children:s.exposedSide||"-"})}),e.jsx(A,{className:"text-end",children:a}),e.jsx(A,{className:"text-end",children:R(i)}),e.jsx(A,{className:"text-end",children:R(d)}),e.jsx(A,{className:"text-end",children:R(n)})]},r)})})]})})}),e.jsx("div",{className:"d-block d-md-none",children:0===Y.items.length?e.jsx("div",{className:"text-center text-muted py-4",children:P("orders.details.noItems","No items")}):e.jsx("div",{className:"d-flex flex-column gap-2",children:Y.items.map((s,r)=>{const{manuName:t,qty:a,unit:i,total:n,modsTotal:d,styleName:l,thumb:c,thumbTitle:o}=ee(s),m=s.name||s.description||s.item||"-";return e.jsxs("div",{className:"d-flex p-2 border rounded align-items-center",style:{gap:12},children:[e.jsx("div",{children:c?e.jsx("img",{src:c,alt:l||t,title:o,style:{width:48,height:48,objectFit:"cover",borderRadius:6},onClick:()=>V(c)}):e.jsx("div",{className:"bg-light d-flex align-items-center justify-content-center",style:{width:48,height:48,borderRadius:6},children:"–"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{style:{fontWeight:600},children:m}),Array.isArray(s.modifications)&&s.modifications.length>0&&e.jsx("div",{className:"text-muted",style:{fontSize:12},children:s.modifications.map((s,t)=>{const a=z(s?.selectedOptions),i=s?.name||s?.templateName||"Modification";return e.jsxs("div",{children:["• ",i,a?` — ${a}`:""]},`mod-m-${r}-${t}`)})}),e.jsxs("div",{className:"text-muted",style:{fontSize:12},children:[P("orders.details.modifications","Modifications"),": ",R(d)]}),(s.hingeSide||s.exposedSide)&&e.jsxs("div",{className:"text-muted",style:{fontSize:12},children:[s.hingeSide&&e.jsxs("span",{className:"badge bg-primary me-2",children:[P("orders.details.hingeSide","Hinge Side"),": ",s.hingeSide]}),s.exposedSide&&e.jsxs("span",{className:"badge bg-primary",children:[P("orders.details.exposedSide","Exposed Side"),": ",s.exposedSide]})]}),e.jsxs("div",{className:"d-flex justify-content-between mt-1",style:{fontSize:14},children:[e.jsxs("div",{children:[P("orders.details.qty","Qty"),": ",e.jsx("strong",{children:a})]}),e.jsxs("div",{children:[P("orders.details.unitPrice","Unit Price"),": ",e.jsx("strong",{children:R(i)})]}),e.jsxs("div",{children:[P("orders.details.total","Total"),": ",e.jsx("strong",{children:R(n)})]})]})]})]},r)})})})]})]}),e.jsxs(j,{children:[e.jsx(f,{children:P("orders.details.manufacturers","Manufacturers")}),e.jsx(y,{children:0===Y.manufacturers.length?e.jsx("div",{className:"text-muted",children:P("orders.details.noManufacturers","No manufacturers found")}):e.jsx(h,{className:"g-3",children:Y.manufacturers.map((s,r)=>e.jsx(x,{md:6,children:e.jsxs(j,{children:[e.jsx(f,{children:s.manufacturerName||s.name||`${P("orders.common.manufacturer","Manufacturer")} ${r+1}`}),e.jsxs(y,{children:[s?.styleName||s?.style||s?.styleImage?e.jsxs("div",{className:"d-flex align-items-center mb-3",style:{gap:12},children:[s.styleImage&&e.jsx($,{src:s.styleImage,style:{width:64,height:64,objectFit:"cover",borderRadius:6,cursor:"pointer"},onClick:()=>V(s.styleImage)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted",style:{fontSize:12},children:P("orders.details.selectedStyle","Selected Style")}),e.jsx("div",{children:e.jsx("strong",{children:s.styleName||s.style})})]})]}):null,(()=>{const r=s?.summary||{},t=Number(r.styleTotal||0),a=Number(r.assemblyFee||0),i=Number(r.modificationsCost||0),n=Number(r.deliveryFee||0),d=Number(r.discountAmount||0),l=Number(r.taxAmount||0),c=Number(r.grandTotal||0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.styleTotal","Style Total"),":"]})," ",R(t)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.assemblyFee","Assembly Fee"),":"]})," ",R(a)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.modifications","Modifications"),":"]})," ",R(i)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.deliveryFee","Delivery Fee"),":"]})," ",R(n)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.discount","Discount"),":"]})," ",R(d)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.tax","Tax"),":"]})," ",R(l)]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("strong",{children:[P("orders.details.grandTotal","Grand Total"),":"]})," ",R(c)]})]})})()]})]})},r))})})]}),e.jsxs(T,{visible:!!J,onClose:()=>V(null),alignment:"center",backdrop:!0,keyboard:!0,size:"lg",children:[e.jsx(F,{className:"modal-header-custom",style:{backgroundColor:`${Z} !important`,color:`${K} !important`,borderBottom:"1px solid "+("#ffffff"===K?"rgba(255, 255, 255, 0.2)":"rgba(45, 55, 72, 0.2)"),background:`${Z} !important`},children:e.jsx(w,{style:{color:`${K} !important`,fontWeight:"bold"},children:P("orders.details.preview","Preview")})}),e.jsx(C,{className:"p-0 text-center",children:J&&e.jsx("img",{src:J,alt:P("orders.details.preview","Preview"),style:{width:"100%",height:"auto",maxHeight:"80vh",objectFit:"contain"},onClick:()=>V(null),role:"button"})})]})]})};export{U as default};
