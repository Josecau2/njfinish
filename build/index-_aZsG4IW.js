import{j as e}from"./date-vendor-D9pAgX5F.js";import{r as a}from"./react-vendor-DF7UJAlN.js";import{u as s,a as r}from"./redux-vendor-BzdbewH4.js";import{u as o,b as i,a as n,Q as l,x as t,R as d}from"./index-DW-yAxzW.js";import{S as c}from"./utils-vendor-Nl-sF5xe.js";import{b as m,d as p,C as f,c as u,H as h,U as x,V as j,I as w,J as v,a7 as g,w as y,e as P}from"./ui-vendor-DjmSPU99.js";import"./form-vendor-CKNVq0c_.js";import"./icons-vendor-D82TZqJV.js";const b=()=>{const{t:b}=o(),N=s(),S=JSON.parse(localStorage.getItem("user")),C=S?.userId,F="contractor"===S?.group?.group_type,{selected:k,loading:q}=r(e=>e.users),{list:B,loading:E}=r(e=>e.locations),R=r(e=>e.customization),[z,I]=a.useState({name:"",email:"",password:"",confirmPassword:"",location:""}),[L,H]=a.useState({}),[J,O]=a.useState(!1),D=a.useRef(z),G=q||E;a.useEffect(()=>{(async()=>{if(F)try{const e=(await n.get("/api/me")).data,a={name:e.name||"",email:e.email||"",password:"",confirmPassword:"",location:""};I(a),D.current=a}catch(e){C&&await N(l(C))}else C&&N(l(C)),N(t())})()},[N,C,F]),a.useEffect(()=>{if(!F&&k){const e={name:k.name||"",email:k.email||"",password:"",confirmPassword:"",location:k.location||""};I(e),D.current=e}},[k,F]);const M=e=>{const{name:a,value:s}=e.target;I(e=>({...e,[a]:s}))};return G?e.jsx("div",{className:"profile-container",role:"status","aria-live":"polite",children:e.jsx(m,{className:"profile-card",children:e.jsx(p,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx(f,{color:"primary",size:"lg"})})})}):e.jsxs("div",{className:"profile-container",children:[e.jsx("style",{children:"\n        .profile-form input, .profile-form select, .profile-form button { min-height:44px; }\n        @media (max-width: 576px) {\n          .profile-card { margin: 0 .5rem; }\n        }\n      "}),e.jsxs(m,{className:"profile-card",children:[e.jsx(u,{children:e.jsx("h4",{className:"mb-0",children:b("profile.header")})}),e.jsx(p,{children:e.jsxs(h,{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return z.name.trim()||(e.name=b("profile.validation.nameRequired")),z.password!==z.confirmPassword&&(e.confirmPassword=b("profile.validation.passwordMismatch")),F||z.location.trim()||(e.location=b("profile.validation.locationRequired")),H(e),0===Object.keys(e).length})()){O(!0);try{if(F){const e={name:z.name};z.password&&""!==z.password.trim()&&(e.password=z.password);const a=await n.put("/api/me",e);if(200!==a?.data?.status&&200!==a?.status)throw new Error(a?.data?.message||b("profile.updateFailed"));c.fire(b("common.success"),b("profile.updateSuccess"),"success")}else{const e={...z};delete e.confirmPassword;const a=await N(d({id:C,data:e}));if(200!==a?.payload?.status)throw new Error(a?.payload?.message||b("profile.updateFailed"));c.fire(b("common.success"),b("profile.updateSuccess"),"success")}}catch(a){c.fire(b("common.error"),a.message||b("profile.errorGeneric"),"error")}finally{O(!1)}}},className:"profile-form",children:[e.jsxs(x,{className:"gy-4",children:[e.jsxs(j,{xs:12,md:6,children:[e.jsxs(w,{htmlFor:"name",children:[b("profile.fullName"),e.jsx("span",{style:{color:"red",marginLeft:"4px"},children:"*"})]}),e.jsx(v,{id:"name",name:"name",value:z.name,onChange:M,invalid:!!L.name,"aria-required":"true","aria-invalid":!!L.name,placeholder:b("profile.enterName")}),e.jsx(g,{invalid:!0,children:L.name})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(w,{htmlFor:"email",children:b("auth.email")}),e.jsx(v,{id:"email",name:"email",value:z.email,disabled:!0,style:{backgroundColor:"#e9ecef",cursor:"not-allowed"},"aria-readonly":"true"})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(w,{htmlFor:"password",children:b("profile.newPassword")}),e.jsx(v,{id:"password",name:"password",type:"password",value:z.password,onChange:M,placeholder:b("profile.leaveBlank")})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(w,{htmlFor:"confirmPassword",children:b("profile.confirmPassword")}),e.jsx(v,{id:"confirmPassword",name:"confirmPassword",type:"password",value:z.confirmPassword,onChange:M,invalid:!!L.confirmPassword,"aria-invalid":!!L.confirmPassword,placeholder:b("profile.reenterPassword")}),e.jsx(g,{invalid:!0,children:L.confirmPassword})]}),!F&&e.jsxs(j,{xs:12,md:6,children:[e.jsxs(w,{htmlFor:"location",children:[b("profile.location"),e.jsx("span",{style:{color:"red",marginLeft:"4px"},children:"*"})]}),e.jsxs(y,{id:"location",name:"location",value:z.location,onChange:M,invalid:!!L.location,"aria-required":"true",children:[e.jsxs("option",{value:"",children:["-- ",b("profile.selectLocation")," --"]}),B.map(a=>e.jsx("option",{value:a.id,children:a.locationName},a.id))]}),e.jsx(g,{invalid:!0,children:L.location})]})]}),e.jsx("div",{className:"d-flex justify-content-center justify-content-md-end mt-4",children:e.jsx(P,{type:"submit",className:"px-4",disabled:J,style:{backgroundColor:R?.headerBg||"#321fdb",borderColor:R?.headerBg||"#321fdb",color:i(R?.headerBg||"#321fdb"),border:"none"},children:J?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:"sm",className:"me-2"})," ",b("profile.saving")]}):b("profile.updateProfile")})})]})})]})]})};export{b as default};
