import{j as e}from"./date-vendor-DfW9khhA.js";import{u as s,r as t,R as a,h as i}from"./react-vendor-Dhx0OYb2.js";import{a as l,u as n}from"./redux-vendor-B0DAdCYB.js";import{u as r,b as c,a as o,d,C as m}from"./index-CRxBN8Fj.js";import{h as p,b as h,c as u,e as g,d as x,a as y,a3 as j,R as f,S as b,a4 as v,V as N,aa as C,a6 as w,a5 as S,T as k,U as F,w as M,Z as T,_ as z,$ as I,a2 as P,a1 as D,o as $,p as A,s as E,u as H,a0 as B,r as L,i as O,l as R,m as W,C as U,v as V,N as q,B as _,E as Y,O as K,Q as G}from"./ui-vendor-pFEG3kEv.js";import{P as Q}from"./PaginationControls-pwghxmUp.js";import{P as Z}from"./PageHeader-UABCfWk-.js";import{S as J}from"./utils-vendor-Nl-sF5xe.js";import{C as X}from"./react-select-creatable.esm-UYqWrhwU.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";import"./cil-chevron-right-DSvcss7_.js";var ee=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='43.314 130.51 95.196 78.627 95.196 496.196 127.196 496.196 127.196 78.627 179.079 130.51 201.706 107.883 111.196 17.372 20.686 107.883 43.314 130.51' class='ci-primary'/><rect width='120' height='32' x='184' y='160' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='184' height='32' x='184' y='232' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='248' height='32' x='184' y='304' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='312' height='32' x='184' y='376' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/>"],se=["512 512","<rect width='120' height='32' x='184' y='288' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='184' height='32' x='184' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='248' height='32' x='184' y='144' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='312' height='32' x='184' y='72' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='95.196 16 95.196 433.568 43.313 381.686 20.687 404.313 111.196 494.823 201.705 404.313 179.078 381.687 127.196 433.568 127.196 16 95.196 16' class='ci-primary'/>"];const te=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},ae=({manufacturer:a,id:i})=>{const{t:n}=r(),d=s(),m=l(e=>e.customization).headerBg||"#667eea",k=c(m),[F,M]=t.useState({name:"",email:"",phone:"",address:"",website:"",isPriceMSRP:!0,costMultiplier:"",instructions:"",assembledEtaDays:"",unassembledEtaDays:""}),[T,z]=t.useState([]),[I,P]=t.useState(null),[D,$]=t.useState({text:"",type:""}),[A,E]=t.useState(!1);t.useEffect(()=>{a&&M({name:a.name||"",email:a.email||"",phone:a.phone||"",address:a.address||"",website:a.website||"",isPriceMSRP:a.isPriceMSRP??!0,costMultiplier:a.costMultiplier||"",instructions:a.instructions||"",assembledEtaDays:a.assembledEtaDays||"",unassembledEtaDays:a.unassembledEtaDays||""})},[a]);const H=e=>{const{name:s,value:t,type:a,checked:i}=e.target;M(e=>({...e,[s]:"checkbox"===a?i:t}))},B=e=>M(s=>({...s,isPriceMSRP:e}));return e.jsx(p,{className:"mt-4 mb-4",children:e.jsxs(h,{children:[e.jsxs(u,{className:"d-flex justify-content-between align-items-center bg-body border-bottom",children:[e.jsx("h5",{className:"mb-0",children:n("settings.manufacturers.edit.title")}),e.jsx(g,{color:"light",onClick:()=>d(-1),children:n("settings.manufacturers.edit.back")})]}),e.jsxs(x,{children:[D.text&&e.jsx(y,{color:D.type,dismissible:!0,onClose:()=>$({text:"",type:""}),children:D.text}),e.jsxs(j,{onSubmit:async e=>{e.preventDefault(),E(!0);try{const e=new FormData;Object.keys(F).forEach(s=>{const t=F[s]||"";e.append(s,t)}),I&&e.append("manufacturerImage",I),T.forEach(s=>e.append("catalogFiles",s));const s=await o.put(`/api/manufacturers/${i}/update`,e,{headers:{"Content-Type":"multipart/form-data",...te()}});window.scrollTo({top:0,behavior:"smooth"}),200===s.data.status?($({text:n("settings.manufacturers.edit.updated"),type:"success"}),setTimeout(()=>d("/settings/manufacturers"),2e3)):$({text:s.data.message||n("settings.manufacturers.edit.updateFailed"),type:"danger"})}catch(s){$({text:`Error: ${s.response?.data?.message||n("settings.manufacturers.edit.updateFailed")}`,type:"danger"})}finally{E(!1)}},children:[e.jsx(h,{className:"mb-4",children:e.jsxs(x,{children:[e.jsxs(f,{children:[e.jsx(b,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(v,{htmlFor:"name",children:[n("settings.manufacturers.fields.manufacturerName")," *"]}),e.jsx(N,{id:"name",name:"name",value:F.name,onChange:H,required:!0})]})}),e.jsx(b,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(v,{htmlFor:"email",children:[n("settings.manufacturers.fields.orderEmail")," *"]}),e.jsx(N,{type:"email",id:"email",name:"email",value:F.email,onChange:H,required:!0})]})})]}),e.jsxs(f,{children:[e.jsx(b,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(v,{htmlFor:"phone",children:[n("settings.manufacturers.fields.phone")," *"]}),e.jsx(N,{id:"phone",name:"phone",value:F.phone,onChange:H,required:!0})]})}),e.jsx(b,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(v,{htmlFor:"website",children:[n("settings.manufacturers.fields.website")," *"]}),e.jsx(N,{id:"website",name:"website",value:F.website,onChange:H,required:!0})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs(v,{htmlFor:"address",children:[n("settings.manufacturers.fields.address")," *"]}),e.jsx(N,{id:"address",name:"address",value:F.address,onChange:H,required:!0})]}),e.jsxs(f,{children:[e.jsx(b,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"assembledEtaDays",children:n("settings.manufacturers.fields.assembledEtaDays","Assembled Items ETA")}),e.jsx(N,{type:"text",id:"assembledEtaDays",name:"assembledEtaDays",value:F.assembledEtaDays,onChange:H,placeholder:"e.g., 7-14 days"}),e.jsx(C,{className:"text-muted",children:n("settings.manufacturers.help.assembledEta","Estimated delivery time for assembled cabinets")})]})}),e.jsx(b,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"unassembledEtaDays",children:n("settings.manufacturers.fields.unassembledEtaDays","Unassembled Items ETA")}),e.jsx(N,{type:"text",id:"unassembledEtaDays",name:"unassembledEtaDays",value:F.unassembledEtaDays,onChange:H,placeholder:"e.g., 3-7 days"}),e.jsx(C,{className:"text-muted",children:n("settings.manufacturers.help.unassembledEta","Estimated delivery time for unassembled cabinets")})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"manufacturerImage",children:n("settings.manufacturers.edit.updateImage")}),a?.image&&!I&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{className:"text-muted",children:[n("settings.manufacturers.edit.currentImage"),":"]}),e.jsx("img",{src:`https://app.nj.contractors/uploads/images/${a.image}`,alt:a.name,style:{maxWidth:"200px",maxHeight:"150px",objectFit:"contain"},className:"border rounded"})]}),e.jsx(N,{type:"file",id:"manufacturerImage",accept:"image/*",onChange:e=>P(e.target.files[0])}),I&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-success",children:n("settings.manufacturers.edit.newImageSelected",{name:I.name})}),e.jsx("img",{src:URL.createObjectURL(I),alt:"Preview",style:{maxWidth:"200px",maxHeight:"150px",objectFit:"contain"},className:"border rounded mt-2"})]})]})]})}),e.jsx(h,{className:"mb-4",children:e.jsxs(x,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:n("settings.manufacturers.edit.priceInfo")}),e.jsx(w,{type:"radio",id:"msrpPrices",label:n("settings.manufacturers.fields.msrpOption"),checked:F.isPriceMSRP,onChange:()=>B(!0),className:"mb-2"}),e.jsx(w,{type:"radio",id:"costPrices",label:n("settings.manufacturers.fields.costOption"),checked:!F.isPriceMSRP,onChange:()=>B(!1)})]}),e.jsx(f,{children:e.jsx(b,{md:4,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(v,{htmlFor:"costMultiplier",children:[n("settings.manufacturers.edit.costMultiplier")," *"]}),e.jsx(N,{type:"number",step:"0.1",id:"costMultiplier",name:"costMultiplier",value:F.costMultiplier,onChange:H,required:!0}),(()=>{if(!F.costMultiplier)return null;const s=parseFloat(F.costMultiplier);return e.jsx(C,{className:"text-muted",children:n("settings.manufacturers.example.multiplier",{msrp:200..toFixed(2),cost:100..toFixed(2),multiplier:s.toFixed(1)})})})()]})})})]})}),e.jsx(h,{className:"mb-4",children:e.jsx(x,{children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"instructions",children:n("settings.manufacturers.fields.instructions")}),e.jsx(S,{id:"instructions",rows:4,name:"instructions",value:F.instructions,onChange:H})]})})}),e.jsx(h,{className:"mb-4",children:e.jsx(x,{children:e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"catalogFiles",children:n("settings.manufacturers.edit.uploadNewCatalog")}),e.jsx(N,{type:"file",id:"catalogFiles",multiple:!0,onChange:e=>z([...e.target.files])}),e.jsx(C,{className:"text-muted",children:n("settings.manufacturers.edit.supported")})]})})}),e.jsx("div",{className:"text-end",children:e.jsx(g,{type:"submit",disabled:A,style:{background:m,color:k,border:"none"},children:n(A?"settings.manufacturers.edit.saving":"settings.manufacturers.edit.saveChanges")})})]})]})]})})},ie=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},le=({manufacturer:s})=>{const{t:a}=r(),[i,l]=t.useState([]),[n,c]=t.useState([]),[d,m]=t.useState(!1),[p,u]=t.useState(""),[g,y]=t.useState(1),[j,f]=t.useState(5),[b,v]=t.useState(""),[C,S]=t.useState([]),[B,L]=t.useState(""),[O,R]=t.useState(""),[W,U]=t.useState(1),[V,q]=t.useState(5),[_,Y]=t.useState(""),[K,G]=t.useState([]),[Z,J]=t.useState(""),X=t.useMemo(()=>["code",...Array.isArray(i)?i.slice(0,5).map(e=>e?.style).filter(e=>"string"==typeof e&&""!==e.trim()):[]],[i]);t.useEffect(()=>{if(X.length>0){const e=X.slice(0,5);S(e),G(e)}},[X,n]),t.useEffect(()=>{(async()=>{if(s?.id){m(!0);try{const e=await o.get(`/api/manufacturers/${s.id}/catalog`,{headers:ie(),params:{page:1,limit:1e3,sortBy:"code",sortOrder:"ASC"}});e.data&&Array.isArray(e.data.catalogData)?c(e.data.catalogData):c([])}catch(e){c([])}finally{m(!1)}}else c([])})()},[s?.id]),t.useEffect(()=>{(async()=>{if(s?.id)try{const e=await o.get(`/api/manufacturers/${s.id}/styles`,{headers:ie()});l(e.data)}catch(e){}})()},[s?.id]),t.useEffect(()=>{s?.costMultiplier&&(v(s.costMultiplier),Y(s.costMultiplier))},[s]);const ee=(e,s,t)=>{"string"==typeof e&&""!==e.trim()&&s(s=>{let t;if(s.includes(e))t=s.filter(s=>s!==e);else if(s.length>=6){const a=["code","description"],i=s.filter(e=>!a.includes(e));t=i.length>0?[...a,...i.slice(0,-1),e]:s}else t=[...s,e];return["code",...t.filter(e=>"code"!==e&&"description"!==e)]})},se=e=>{const s=(n?.filter(s=>"string"==typeof s.code&&s.code.toLowerCase().includes(e.toLowerCase()))||[]).reduce((e,s)=>(e[s.code]||(e[s.code]=s),e),{});return Object.values(s)},te=se(p),ae=Math.ceil(te.length/j),le=te.slice((g-1)*j,g*j),ne=se(O),re=Math.ceil(ne.length/V),ce=ne.slice((W-1)*V,W*V);t.useEffect(()=>{y(1)},[p,j,C]),t.useEffect(()=>{U(1)},[O,V,K]);const oe=(s,t,i)=>e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs($,{className:"ms-2",children:[e.jsxs(A,{color:"secondary",variant:"outline",size:"sm",children:[s.length>0?s.slice(0,3).map(e=>"string"==typeof e&&e?e.toUpperCase():a("common.na","N/A")).join(", "):a("common.displayedColumns","Displayed Columns"),s.length>3&&"..."]}),e.jsxs(E,{style:{maxHeight:"300px",overflowY:"auto"},children:[e.jsx(H,{component:"div",className:"small text-muted px-3 py-1",children:"CODE is always shown. Select styles to see multiplied prices. Max 6 columns total."}),e.jsx("hr",{className:"dropdown-divider"}),X.map(l=>{const n=["code"].includes(l);return e.jsx(H,{component:"div",className:"form-check",children:e.jsx(w,{type:"checkbox",id:`checkbox-${i}-${l}`,checked:s.includes(l),onChange:()=>t(l),disabled:n,label:e.jsxs("span",{className:n?"text-muted":"",children:["string"==typeof l&&l?l.toUpperCase():a("common.na","N/A")," ",n?"(always shown)":""]})})},l)})]})]})}),de=(s,t,i)=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 small text-muted",children:["Showing ",Math.min(s.length,5)," sample items with code and multiplied prices for selected styles"]}),e.jsxs(T,{striped:!0,hover:!0,responsive:!0,children:[e.jsx(z,{children:e.jsx(I,{children:t.map((s,t)=>e.jsx(P,{style:{backgroundColor:"#e9ecef",fontWeight:"bold"},children:"code"===s?"CODE":"string"==typeof s&&s?`${s.toUpperCase()} PRICE`:a("common.na","N/A")},`header-${t}`))})}),e.jsx(D,{children:d?e.jsx(I,{children:e.jsx(P,{colSpan:t.length,className:"text-center",children:a("common.loading","Loading...")})}):s.length>0?s.map(a=>e.jsx(I,{children:t.map((t,l)=>e.jsx(P,{children:"code"===t?a[t]:(()=>{const e=s.find(e=>e.code===a.code&&e.style?.toLowerCase()===t.toLowerCase());return e?.price?`$${i(e.price)}`:"--"})()},`${a.id}-${l}`))},a.id)):e.jsx(I,{children:e.jsx(P,{colSpan:t.length,className:"text-center",children:a("common.noData","No data found.")})})})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(h,{children:e.jsxs(x,{children:[e.jsx("p",{children:e.jsx("strong",{children:a("settings.manufacturers.settings.costMultiplierTitle","Your cost multiplier")})}),e.jsx("div",{className:"border rounded p-2 mb-3 small",style:{borderColor:"#0d6efd",backgroundColor:"#f0f8ff"},children:a("settings.manufacturers.settings.costMultiplierHelp","Cost multiplier controls the price you pay to manufacturer. You can see your cost in Quote when you turn off Customer multiplier.")}),e.jsx(N,{value:b,onChange:e=>{const s=e.target.value;v(s),L(""===s.trim()?a("settings.users.form.validation.required"):"")},placeholder:a("settings.manufacturers.placeholders.costMultiplier","1.000"),style:{width:"100px"},className:"mb-2"}),B&&e.jsx("div",{className:"text-danger mt-1 mb-2",children:B}),e.jsxs(k,{className:"mb-3",children:[e.jsx(N,{value:p,onChange:e=>u(e.target.value),placeholder:a("common.search")+"..."}),e.jsx(F,{children:e.jsx("i",{className:"bi bi-search"})}),oe(C,e=>ee(e,S),"1")]}),de(le,C,e=>(parseFloat(e)*parseFloat(b||1)).toFixed(2)),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("div",{children:a("common.pageOf",{page:g,total:ae,defaultValue:"Page {{page}} of {{total}}"})}),e.jsxs("div",{children:[a("common.itemsPerPage","Items per page:"),e.jsxs(M,{size:"sm",className:"d-inline w-auto ms-2",value:j,onChange:e=>f(Number(e.target.value)),children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),e.jsx(Q,{page:g,totalPages:ae,goPrev:()=>y(e=>Math.max(1,e-1)),goNext:()=>y(e=>Math.min(ae,e+1))})]})]})}),e.jsx(h,{className:"mt-4",children:e.jsxs(x,{children:[e.jsx("p",{children:e.jsx("strong",{children:a("settings.manufacturers.settings.customerMultiplierTitle","Customer price multiplier")})}),e.jsx("div",{className:"border rounded p-2 mb-3 small",style:{borderColor:"#198754",backgroundColor:"#e9fbe5"},children:a("settings.manufacturers.settings.customerMultiplierHelp","Customer price multiplier controls the price at which you sell to your customers. This is what determines your profit.")}),e.jsx(N,{value:_,onChange:e=>{const s=e.target.value;Y(s),J(""===s.trim()?a("settings.users.form.validation.required"):"")},placeholder:a("settings.manufacturers.placeholders.costMultiplier","1.000"),style:{width:"100px"},className:"mb-2"}),Z&&e.jsx("div",{className:"text-danger mt-1 mb-2",children:Z}),e.jsxs(k,{className:"mb-3",children:[e.jsx(N,{value:O,onChange:e=>R(e.target.value),placeholder:a("common.search")+"..."}),e.jsx(F,{children:e.jsx("i",{className:"bi bi-search"})}),oe(K,e=>ee(e,G),"2")]}),de(ce,K,e=>(parseFloat(e)*parseFloat(b||1)*parseFloat(_||1)).toFixed(2)),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("div",{children:a("common.pageOf",{page:W,total:re,defaultValue:"Page {{page}} of {{total}}"})}),e.jsxs("div",{children:[a("common.itemsPerPage","Items per page:"),e.jsxs(M,{size:"sm",className:"d-inline w-auto ms-2",value:V,onChange:e=>q(Number(e.target.value)),children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]}),e.jsx(Q,{page:W,totalPages:re,goPrev:()=>U(e=>Math.max(1,e-1)),goNext:()=>U(e=>Math.min(re,e+1))})]})]})})]})},ne=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},re=({manufacturer:s,id:i})=>{const{t:c}=r(),d="https://app.nj.contractors",m=l(e=>e.customization),p=m?.headerBg||"#321fdb",h=m?.headerTextColor||"#ffffff",[u,x]=t.useState([]),[y,f]=t.useState({total:0,page:1,limit:50,totalPages:0}),[b,C]=t.useState({uniqueTypes:[],uniqueStyles:[]}),[w,k]=t.useState(!1),[F,$]=t.useState(null),[A,E]=t.useState("code"),[H,U]=t.useState("ASC"),[V,q]=t.useState(""),[_,Y]=t.useState(""),[K,G]=t.useState(""),Q=b.uniqueTypes||[];Q.map(e=>({value:e,label:e}));const[te,ae]=t.useState(!1),[ie,le]=t.useState(!1),[re,ce]=t.useState(1),[oe,de]=t.useState((()=>{const e=localStorage.getItem("catalogItemsPerPage");return e?parseInt(e,10):50})()),[me,pe]=t.useState(!1),[he,ue]=t.useState(!1),ge=u;y.totalPages||Math.ceil(ge.length/oe);const xe=ge,[ye,je]=t.useState(!1),[fe,be]=t.useState(!1),[ve,Ne]=t.useState(!1),[Ce,we]=t.useState({type:"",amount:"",applyTo:"one"}),[Se,ke]=t.useState({leftHingePrice:"",rightHingePrice:"",bothHingePrice:"",exposedSidePrice:""}),[Fe,Me]=t.useState({modificationName:"",price:"",notes:"",description:""}),[Te,ze]=t.useState(null),[Ie,Pe]=t.useState([]),De=[...b.uniqueStyles||[]],$e=De.map(e=>({value:e,label:e})),Ae={style:"",type:"",code:"",description:"",price:""},[Ee,He]=t.useState(Ae),Be=async(e=re,s=oe,t=V,a=_,l=A,n=H)=>{if(i){k(!0),$(null);try{const r={page:String(e),limit:String(s),sortBy:l,sortOrder:n,...t?{typeFilter:t}:{},...a?{styleFilter:a}:{}},{data:c}=await o.get(`/api/manufacturers/${i}/catalog`,{params:r,headers:ne()});x(Array.isArray(c.catalogData)?c.catalogData:[]),f(c.pagination||{total:0,page:e,limit:s,totalPages:0}),1===e&&c.filters&&C(c.filters),c.sorting&&(E(c.sorting.sortBy),U(c.sorting.sortOrder)),ce(e),de(s)}catch(r){$(r.message),x([])}finally{k(!1)}}};t.useEffect(()=>{Be(1,oe,V,_,A,H)},[V,_,i,A,H]),t.useEffect(()=>{i&&Be(1,oe,V,_,A,H)},[i]),t.useEffect(()=>{localStorage.setItem("catalogItemsPerPage",String(oe))},[oe]);const[Le,Oe]=t.useState(!1),[Re,We]=t.useState({id:null,style:"",type:"",code:"",description:"",price:""}),[Ue,Ve]=t.useState(!1),[qe,_e]=t.useState(""),[Ye,Ke]=t.useState(""),[Ge,Qe]=t.useState(!1),[Ze,Je]=t.useState([]),[Xe,es]=t.useState(!1),[ss,ts]=t.useState(!1),[as,is]=t.useState(!1),[ls,ns]=t.useState(!1),[rs,cs]=t.useState(null),[os,ds]=t.useState(!1),[ms,ps]=t.useState(!1),[hs,us]=t.useState(!1),[gs,xs]=t.useState([]),[ys,js]=t.useState(""),[fs,bs]=t.useState(!1),[vs,Ns]=t.useState(!1),[Cs,ws]=t.useState(!1),[Ss,ks]=t.useState(!1),[Fs,Ms]=t.useState({style:"",type:"",description:"",price:""}),[Ts,zs]=t.useState(!1),[Is,Ps]=t.useState(!1),[Ds,$s]=t.useState({oldStyleName:"",newStyleName:""}),[As,Es]=t.useState(null);n();const[Hs,Bs]=t.useState({}),Ls=e=>{He({...Ee,[e.target.name]:e.target.value})},Os=e=>{We({id:e.id,style:e.style||"",type:e.type||"",code:e.code||"",description:e.description||"",price:e.price||""}),Oe(!0)},Rs=e=>{es(e),Je(e?xe.map(e=>e.id):[])},Ws=(e,s)=>{if(s){const s=[...Ze,e];Je(s);const t=xe.map(e=>e.id).every(e=>s.includes(e));es(t)}else Je(s=>s.filter(s=>s!==e)),es(!1)};a.useEffect(()=>{const e=xe.map(e=>e.id),s=e.length>0&&e.every(e=>Ze.includes(e));es(s)},[xe,Ze]);const[Us,Vs]=t.useState(!1),[qs,_s]=t.useState(""),[Ys,Ks]=t.useState({name:"",shortName:"",description:"",image:"",catalogId:"",manufacturerId:"",code:""}),Gs=async e=>{const{id:s,manufacturerId:t,style:a,code:i}=e;try{const e=(await o.get(`/api/manufacturers/style/${s}`,{headers:ne()})).data;e?(_s(e.name||a||""),Ks({name:e.name||"",shortName:e.shortName||"",description:e.description||"",image:e.image||"",catalogId:s,manufacturerId:t,code:i}),ze(null)):(_s(a||""),Ks({name:a||"",shortName:"",description:"",image:"",catalogId:s,manufacturerId:t,code:i}),ze(null)),Vs(!0)}catch(l){_s(a||""),Ks({name:a||"",shortName:"",description:"",image:"",catalogId:s,manufacturerId:t,code:i}),ze(null),Vs(!0)}},Qs=e=>{const{name:s,value:t}=e.target;Ks(e=>({...e,[s]:t}))},[Zs,Js]=t.useState(!1),[Xs,et]=t.useState(null),st=async e=>{Pe(e),Me({modificationName:"",description:"",notes:"",price:""}),Ne(!0)};return e.jsxs("div",{children:[e.jsx("style",{children:"\n          .form-check-input:not(:checked) {\n            background-color: white !important;\n            border-color: #6c757d !important;\n            border-width: 2px !important;\n            opacity: 1 !important;\n          }\n          .form-check-input:checked {\n            background-color: #198754 !important;\n            border-color: #198754 !important;\n          }\n          .form-check-input:focus {\n            border-color: #198754 !important;\n            box-shadow: 0 0 0 0.25rem rgba(25, 135, 84, 0.25) !important;\n          }\n          \n          /* Mobile responsive styles */\n          @media (max-width: 768px) {\n            .table-responsive {\n              border: none;\n            }\n            .table td {\n              padding: 8px 4px !important;\n              font-size: 12px;\n            }\n            .table th {\n              padding: 8px 4px !important;\n              font-size: 11px;\n              font-weight: 600;\n            }\n            .btn-sm {\n              padding: 1px 4px !important;\n              font-size: 10px !important;\n            }\n            .mobile-stack {\n              display: flex;\n              flex-direction: column;\n              gap: 4px;\n            }\n          }\n          \n          @media (max-width: 576px) {\n            .table td, .table th {\n              padding: 6px 2px !important;\n            }\n            .actions-column {\n              min-width: 120px;\n            }\n          }\n        "}),e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.title"),mobileLayout:"compact",rightContent:e.jsxs("div",{className:"d-flex flex-wrap gap-2 catalog-actions",children:[e.jsxs(g,{style:{backgroundColor:p,color:h,borderColor:p},size:"sm",className:"flex-shrink-0",onClick:()=>ae(!0),children:[e.jsx("span",{className:"d-none d-sm-inline",children:c("settings.manufacturers.catalogMapping.buttons.uploadCsv")}),e.jsx("span",{className:"d-sm-none",children:"📁 CSV"})]}),e.jsxs(g,{style:{backgroundColor:p,color:h,borderColor:p},size:"sm",className:"flex-shrink-0",onClick:()=>le(!0),children:[e.jsx("span",{className:"d-none d-sm-inline",children:c("settings.manufacturers.catalogMapping.buttons.addItem")}),e.jsx("span",{className:"d-sm-none",children:"➕ Add"})]}),e.jsx(g,{color:"warning",size:"sm",className:"flex-shrink-0",onClick:async()=>{if(!ms){ps(!0);try{const{data:e}=await o.post(`/api/manufacturers/${i}/cleanup-duplicates`,null,{headers:ne()});J.fire({toast:!0,position:"top",icon:e.duplicatesRemoved>0?"success":"info",title:e.message,showConfirmButton:!1,timer:3e3,width:"450px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),e.duplicatesRemoved>0&&(Be(1,oe,V,_,A,H),ce(1))}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to cleanup duplicates",showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{ps(!1)}}},disabled:ms,title:c("settings.manufacturers.catalogMapping.cleanupDuplicates.tooltip"),children:ms?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status"}),e.jsx("span",{className:"d-none d-sm-inline",children:c("settings.manufacturers.catalogMapping.cleanupDuplicates.cleaning")}),e.jsx("span",{className:"d-sm-none",children:"..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"d-none d-sm-inline",children:c("settings.manufacturers.catalogMapping.cleanupDuplicates.buttonText")}),e.jsx("span",{className:"d-sm-none",children:"🧹"})]})}),e.jsxs(g,{style:{backgroundColor:p,color:h,borderColor:p},size:"sm",className:"flex-shrink-0",onClick:async()=>{bs(!0),us(!0);try{const{data:e}=await o.get(`/api/manufacturers/${i}/catalog/backups`,{headers:ne()});xs(e.backups||[])}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to load backup history",showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{bs(!1)}},disabled:0===(y.total||0),title:"Rollback recent catalog upload",children:[e.jsx("span",{className:"d-none d-sm-inline",children:c("settings.manufacturers.catalogMapping.rollback.buttonText")}),e.jsx("span",{className:"d-sm-none",children:"↶"})]})]})}),e.jsx("style",{children:"\n        .catalog-actions {\n          width: 100%;\n        }\n        \n        /* Mobile card styles */\n        .mobile-catalog-card {\n          border: 1px solid #dee2e6;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n          transition: box-shadow 0.2s ease;\n        }\n        \n        .mobile-catalog-card:hover {\n          box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n        }\n        \n        .mobile-cards-container {\n          max-height: 70vh;\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n        }\n        \n        /* Improved touch targets for mobile */\n        .mobile-catalog-card .btn {\n          min-height: 36px;\n          font-size: 12px;\n          white-space: nowrap;\n        }\n        \n        .mobile-catalog-card .form-check-input {\n          width: 18px;\n          height: 18px;\n        }\n        \n        @media (max-width: 767px) {\n          .catalog-actions {\n            justify-content: stretch;\n          }\n          \n          .catalog-actions .btn {\n            flex: 1;\n            min-width: 0;\n            min-height: 32px; /* Reduced from 44px */\n            font-size: 0.75rem !important;\n            padding: 0.25rem 0.5rem !important;\n          }\n          \n          /* Better mobile table */\n          .table-responsive {\n            -webkit-overflow-scrolling: touch;\n          }\n          \n          .table td, .table th {\n            min-width: 100px;\n            white-space: nowrap;\n          }\n          \n          /* Mobile-optimized filters */\n          .form-select, .form-control {\n            min-height: 36px; /* Reduced from 44px */\n            font-size: 0.875rem;\n          }\n          \n          /* Mobile card specific improvements */\n          .mobile-catalog-card .card-body {\n            padding: 0.75rem !important; /* Reduced padding */\n          }\n          \n          .mobile-catalog-card .btn {\n            padding: 6px 10px;\n            font-size: 11px;\n          }\n          \n          .mobile-catalog-card .row.g-2 > .col-6 {\n            margin-bottom: 0.5rem;\n          }\n          \n          /* Compact header for mobile */\n          .page-header-dynamic {\n            margin-bottom: 0.75rem !important;\n          }\n        }\n        \n        @media (max-width: 575px) {\n          .catalog-actions {\n            flex-direction: row; /* Keep inline on small screens */\n            gap: 0.25rem;\n          }\n          \n          .catalog-actions .btn {\n            flex: 1;\n            min-width: 0;\n            font-size: 0.7rem !important;\n            padding: 0.2rem 0.3rem !important;\n            min-height: 28px;\n          }\n          \n          /* Stack filters vertically on very small screens */\n          .row.g-2 > .col-12 {\n            margin-bottom: 0.5rem; /* Reduced spacing */\n          }\n          \n          .row.g-2 > .col-12:last-child {\n            margin-bottom: 0;\n          }\n          \n          /* Mobile card actions more compact */\n          .mobile-catalog-card .d-flex.flex-wrap .btn {\n            padding: 4px 8px;\n            font-size: 10px;\n            margin-bottom: 0.15rem;\n          }\n          \n          .mobile-catalog-card .card-body {\n            padding: 0.5rem !important;\n          }\n          \n          .mobile-catalog-card .card-title {\n            font-size: 0.9rem;\n            margin-bottom: 0.25rem;\n          }\n          \n          .mobile-catalog-card small {\n            font-size: 0.75rem;\n          }\n        }\n        \n        /* Better touch scrolling for table */\n        .table-container {\n          -webkit-overflow-scrolling: touch;\n          overflow-x: auto;\n        }\n        \n        /* Better mobile pagination */\n        @media (max-width: 767px) {\n          .pagination {\n            flex-wrap: wrap;\n            justify-content: center;\n          }\n          \n          .page-item .page-link {\n            min-width: 36px; /* Reduced from 44px */\n            min-height: 36px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 0.875rem;\n          }\n        }\n        \n        /* Hide unnecessary elements on mobile */\n        @media (max-width: 576px) {\n          .mobile-catalog-card .card-title {\n            font-size: 14px;\n          }\n          \n          .mobile-catalog-card small {\n            font-size: 11px;\n          }\n        }\n  "}),e.jsxs("div",{className:"row g-2 mb-3",children:[e.jsx("div",{className:"col-12 col-sm-6 col-lg-auto",children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("select",{className:"form-select form-select-sm",style:{width:"auto",minWidth:"60px"},value:oe,onChange:e=>{const s=Number(e.target.value);de(s),localStorage.setItem("catalogItemsPerPage",s),ce(1),Be(1,s,V,_,A,H)},children:[10,25,50,100,200].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("span",{className:"text-muted small d-none d-sm-inline",children:c("settings.manufacturers.catalogMapping.pagination.perPage")}),e.jsx("span",{className:"text-muted small d-sm-none",children:"per page"})]})}),e.jsx("div",{className:"col-12 col-sm-12 col-lg-4 order-first order-lg-3",children:e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",placeholder:"🔍 Search styles...",value:K,onChange:e=>G(e.target.value),style:{paddingRight:K?"35px":"12px"}}),K&&e.jsx("button",{type:"button",className:"btn btn-sm btn-link position-absolute top-0 end-0 p-1",onClick:()=>G(""),style:{color:"#6c757d",textDecoration:"none",zIndex:5},children:"×"})]})}),e.jsx("div",{className:"col-6 col-sm-6 col-lg-auto",children:e.jsxs("select",{className:"form-select form-select-sm",value:V,onChange:e=>{ce(1),q(e.target.value)},children:[e.jsx("option",{value:"",children:"All Types"}),Q.map((s,t)=>e.jsx("option",{value:s,children:s},t))]})}),e.jsx("div",{className:"col-6 col-sm-6 col-lg-auto",children:e.jsxs("select",{className:"form-select form-select-sm",value:_,onChange:e=>{ce(1),Y(e.target.value)},children:[e.jsx("option",{value:"",children:"All Styles"}),De.map((s,t)=>e.jsx("option",{value:s,children:s},t))]})})]}),e.jsxs(e.Fragment,{children:[!1,_&&e.jsx("div",{className:"mb-3 p-3 border rounded bg-light",children:e.jsxs("div",{className:"d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:['Managing Style: "',_,'"']}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[u.filter(e=>e.style===_).length," items with this style"]})]}),e.jsxs("div",{className:"d-flex gap-2 flex-shrink-0",children:[e.jsx(g,{color:"info",size:"sm",onClick:()=>($s({oldStyleName:_,newStyleName:""}),void zs(!0)),disabled:Is,children:Is?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Saving..."]}):e.jsx(e.Fragment,{children:"✏️ Rename Style"})}),e.jsx(g,{color:"warning",size:"sm",onClick:()=>(_e(_),Ke(""),void Ve(!0)),disabled:Ge,children:Ge?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Processing..."]}):e.jsx(e.Fragment,{children:"🗑️ Delete/Merge Style"})})]})]})}),Ze.length>0&&e.jsxs("div",{className:"d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-3 p-3 bg-light rounded gap-2",children:[e.jsx("span",{className:"fw-bold",children:c("settings.manufacturers.catalogMapping.pagination.itemsSelected",{count:Ze.length})}),e.jsxs("div",{className:"d-flex gap-2 flex-shrink-0",children:[e.jsx(g,{color:"primary",size:"sm",onClick:()=>{0!==Ze.length&&(Ms({style:"",type:"",description:"",price:""}),ws(!0))},disabled:Ss,children:Ss?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Editing..."]}):e.jsx(e.Fragment,{children:"✏️ Edit Selected"})}),e.jsx(g,{color:"danger",size:"sm",onClick:()=>{0!==Ze.length&&ts(!0)},disabled:as,children:as?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),c("settings.manufacturers.catalogMapping.bulk.deleting")]}):e.jsx(e.Fragment,{children:c("settings.manufacturers.catalogMapping.buttons.deleteSelected")})})]})]})]}),0===u.length?e.jsx("p",{children:c("settings.manufacturers.catalogMapping.empty")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive table-container d-none d-md-block",children:e.jsxs(T,{hover:!0,responsive:!0,className:"mb-0",children:[e.jsx(z,{children:e.jsxs(I,{children:[e.jsx(B,{style:{width:"35px",minWidth:"35px"},children:e.jsx("input",{type:"checkbox",checked:Xe,onChange:e=>Rs(e.target.checked),className:"form-check-input",style:{borderColor:"#6c757d",borderWidth:"2px",transform:"scale(1.1)"}})}),e.jsxs(B,{style:{minWidth:"80px",cursor:"pointer",userSelect:"none"},onClick:()=>(e=>{let s="ASC";A===e&&"ASC"===H&&(s="DESC"),E(e),U(s),Be(1,oe,V,_,e,s),ce(1)})("code"),className:"d-flex align-items-center",children:[c("settings.manufacturers.catalogMapping.table.code"),"code"===A&&e.jsx(L,{icon:"ASC"===H?ee:se,size:"sm",className:"ms-1"})]}),e.jsx(B,{style:{minWidth:"120px",maxWidth:"180px"},children:c("settings.manufacturers.catalogMapping.table.description")}),e.jsx(B,{style:{minWidth:"80px"},children:c("settings.manufacturers.catalogMapping.table.style")}),e.jsx(B,{style:{minWidth:"70px"},children:c("settings.manufacturers.catalogMapping.table.price")}),e.jsx(B,{style:{minWidth:"70px"},children:c("settings.manufacturers.catalogMapping.table.type")}),e.jsx(B,{style:{minWidth:"120px"},className:"actions-column",children:c("settings.manufacturers.catalogMapping.table.actions")})]})}),e.jsx(D,{children:xe.map((s,t)=>e.jsxs(I,{children:[e.jsx(P,{children:e.jsx("input",{type:"checkbox",checked:Ze.includes(s.id),onChange:e=>Ws(s.id,e.target.checked),className:"form-check-input",style:{borderColor:"#6c757d",borderWidth:"2px",transform:"scale(1.1)"}})}),e.jsx(P,{children:s.code}),e.jsx(P,{style:{maxWidth:"200px",wordWrap:"break-word",whiteSpace:"normal"},children:s.description?s.description:c("common.na")}),e.jsx(P,{style:{cursor:"pointer"},children:e.jsx(g,{size:"sm",color:"dark",onClick:()=>(async e=>{try{const{id:s}=e,t=await o.get(`/api/manufacturers/style/${s}`,{headers:ne()});t.data&&(et(t.data),Js(!0))}catch(s){et(null)}finally{Js(!0)}})(s),className:"me-2",style:{backgroundColor:"#6c757d",borderColor:"#6c757d",color:"white",fontSize:"12px",padding:"4px 8px"},children:s.style})}),e.jsx(P,{children:s.price}),e.jsx(P,{children:s.type?s.type:"N/A"}),e.jsx(P,{children:e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[e.jsx(g,{size:"sm",color:"secondary",onClick:()=>Os(s),style:{fontSize:"11px",padding:"2px 6px",minWidth:"auto"},children:"✏️"}),e.jsx(g,{size:"sm",onClick:()=>Gs(s),style:{fontSize:"11px",padding:"2px 6px",backgroundColor:p,borderColor:p,color:h,minWidth:"auto"},title:c("settings.manufacturers.catalogMapping.actions.manageStyle"),children:"🎨"}),e.jsx(g,{size:"sm",onClick:()=>(async e=>{try{const{id:s}=e,t=await o.get(`/api/manufacturers/assemblycost/${s}`,{headers:ne()}),{type:a,price:i}=t.data||{};Pe(e),we({type:a||"",price:i||""})}catch(s){}finally{je(!0)}})(s),style:{fontSize:"11px",padding:"2px 6px",backgroundColor:p,borderColor:p,color:h,minWidth:"auto"},title:c("settings.manufacturers.catalogMapping.actions.assemblyCost"),children:"🔧"}),e.jsx(g,{size:"sm",onClick:()=>st(s),style:{fontSize:"11px",padding:"2px 6px",backgroundColor:p,borderColor:p,color:h,minWidth:"auto"},title:c("settings.manufacturers.catalogMapping.actions.modification"),children:"⚙️"}),e.jsx(g,{size:"sm",color:"danger",onClick:()=>(e=>{cs(e),ns(!0)})(s),style:{fontSize:"11px",padding:"2px 6px",minWidth:"auto"},title:`Delete item: ${s.code}`,children:"🗑️"})]})})]},t))})]})}),e.jsxs("div",{className:"d-block d-md-none",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3 p-3 bg-light rounded",children:[e.jsx("input",{type:"checkbox",checked:Xe,onChange:e=>Rs(e.target.checked),className:"form-check-input me-2",id:"mobile-select-all"}),e.jsxs("label",{htmlFor:"mobile-select-all",className:"form-check-label mb-0",children:["Select All (",xe.length," items)"]})]}),e.jsx("div",{className:"mobile-cards-container",children:xe.map((s,t)=>e.jsx("div",{className:"card mb-3 mobile-catalog-card",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("input",{type:"checkbox",checked:Ze.includes(s.id),onChange:e=>Ws(s.id,e.target.checked),className:"form-check-input me-2"}),e.jsxs("div",{children:[e.jsx("h6",{className:"card-title mb-1 fw-bold",children:s.code}),e.jsx("small",{className:"text-muted",children:s.description})]})]}),e.jsx(g,{size:"sm",style:{backgroundColor:"#6c757d",borderColor:"#6c757d",color:"white",fontSize:"11px",padding:"2px 8px"},children:s.style})]}),e.jsxs("div",{className:"row g-2 mb-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Price"}),e.jsxs("span",{className:"fw-bold",children:["$",s.price]})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted d-block",children:"Type"}),e.jsx("span",{children:s.type||"N/A"})]})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsx(g,{size:"sm",color:"secondary",onClick:()=>Os(s),className:"flex-fill",children:"✏️ Edit"}),e.jsx(g,{size:"sm",onClick:()=>Gs(s),style:{backgroundColor:p,borderColor:p,color:h},className:"flex-fill",title:c("settings.manufacturers.catalogMapping.actions.manageStyle"),children:"🎨 Style"}),e.jsx(g,{size:"sm",onClick:()=>st(s),style:{backgroundColor:p,borderColor:p,color:h},className:"flex-fill",title:c("settings.manufacturers.catalogMapping.actions.modificationDetails"),children:"🔧 Modify"}),e.jsx(g,{size:"sm",color:"danger",onClick:()=>handleDeleteClick(s.id),style:{fontSize:"11px",padding:"4px 8px"},children:"🗑️"})]})]})},t))})]})]}),u.length>0?e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsx("div",{children:w?"Loading…":c("pagination.pageInfo",{current:y.page||1,total:y.totalPages||1})}),e.jsxs("div",{children:[e.jsx(g,{size:"sm",color:"secondary",disabled:w||1===(y.page||1),onClick:()=>Be((y.page||1)-1,oe,V,_,A,H),className:"me-2",children:c("pagination.prevPageTitle")}),e.jsx(g,{size:"sm",color:"secondary",disabled:w||(y.page||1)>=(y.totalPages||1),onClick:()=>Be((y.page||1)+1,oe,V,_,A,H),children:c("pagination.nextPageTitle")})]})]}):"",e.jsxs(O,{visible:te,onClose:()=>ae(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.file.modalTitle")}),e.jsx(R,{children:e.jsx(j,{children:e.jsx(N,{type:"file",name:"catalogFiles",label:c("settings.manufacturers.catalogMapping.file.selectLabel"),onChange:e=>{const s=e.target.files[0];if(s){if(!["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(s.type))return void J.fire("Unsupported file type","Please upload a CSV or Excel file.","error");Es(s)}}})})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>ae(!1),children:c("common.cancel")}),e.jsx(g,{style:{backgroundColor:p,color:h,borderColor:p},onClick:async()=>{if(!As)return;const e=As.size/1048576,s=e>10;if(e>50)return void J.fire({title:c("common.error"),text:`File too large (${e.toFixed(2)}MB). Maximum size is 50MB. Please split your file into smaller chunks.`,icon:"error"});if(s){if(!(await J.fire({title:"Large File Detected",text:`This file is ${e.toFixed(2)}MB. Large files may take several minutes to process. Continue?`,icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, upload",cancelButtonText:"Cancel"})).isConfirmed)return}const t=new FormData;let a;t.append("catalogFiles",As),s&&(a=J.fire({title:"Processing Large File",html:`\n          <div class="mb-3">\n            <div class="progress">\n              <div class="progress-bar progress-bar-striped progress-bar-animated" \n                   role="progressbar" style="width: 0%" id="upload-progress"></div>\n            </div>\n          </div>\n          <p class="text-muted">Processing ${e.toFixed(2)}MB file in chunks...</p>\n          <p class="text-sm">This may take a few minutes. Please don't close this window.</p>\n        `,allowOutsideClick:!1,showConfirmButton:!1,willOpen:()=>{J.showLoading()}}));try{const s=Date.now(),{data:l}=await o.post(`/api/manufacturers/${i}/catalog/upload`,t,{headers:ne()}),n=((Date.now()-s)/1e3).toFixed(1);a&&J.close();let r=c("settings.manufacturers.catalogMapping.file.uploadSuccess");l.stats&&(r+=`\n\nFile: ${e.toFixed(2)}MB`,r+=`\nProcessing: ${l.stats.processingMethod||"regular"}`,r+=`\nTime: ${n}s`,r+=`\n\nItems processed: ${l.stats.totalProcessed}`,r+=`\nCreated: ${l.stats.created} | Updated: ${l.stats.updated}`,l.stats.backupCreated&&(r+="\n\n✅ Backup created - you can rollback this upload if needed.")),J.fire({title:c("common.success"),text:r,icon:"success",confirmButtonText:"OK"}),ae(!1),Es(null),Be(1,oe,V,_,A,H)}catch(l){a&&J.close();let e=l.message||c("settings.manufacturers.catalogMapping.file.uploadFailed");J.fire({title:c("common.error"),text:e,icon:"error",footer:s?"Tip: For very large files (>10,000 rows), consider splitting them into smaller files.":void 0})}},children:c("settings.manufacturers.catalogMapping.file.uploadBtn")})]})]}),e.jsxs(O,{visible:ie,onClose:()=>le(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.manual.modalTitle")}),e.jsx(R,{children:e.jsxs(j,{children:[e.jsx(X,{isClearable:!0,className:"mb-2",placeholder:c("settings.manufacturers.catalogMapping.stylePlaceholder"),options:$e,value:Ee.style?{label:Ee.style,value:Ee.style}:null,onChange:e=>He({...Ee,style:e?e.value:""})}),e.jsx(N,{className:"mb-2",label:c("settings.manufacturers.catalogMapping.fields.code"),name:"code",value:Ee.code,onChange:Ls,invalid:!!Hs.code,feedback:Hs.code}),e.jsx(N,{className:"mb-2",label:c("settings.manufacturers.catalogMapping.fields.description"),name:"description",value:Ee.description,onChange:Ls,invalid:!!Hs.description,feedback:Hs.description}),e.jsx(N,{className:"mb-2",type:"number",label:c("settings.manufacturers.catalogMapping.fields.price"),name:"price",value:Ee.price,onChange:Ls,invalid:!!Hs.price,feedback:Hs.price}),e.jsx(N,{className:"mb-2",label:c("settings.manufacturers.catalogMapping.fields.type"),name:"type",value:Ee.type,onChange:Ls,invalid:!!Hs.type,feedback:Hs.type})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>le(!1),children:c("common.cancel")}),e.jsx(g,{style:{backgroundColor:p,color:h,borderColor:p},onClick:async()=>{if(!he&&(()=>{const e={};return Object.entries(Ee).forEach(([s,t])=>{t&&t.toString().trim()||(e[s]=`${s.charAt(0).toUpperCase()+s.slice(1)} is required`)}),Bs(e),0===Object.keys(e).length})()){ue(!0);try{await o.post(`/api/manufacturers/catalog/${s.id}`,Ee,{headers:ne()}),J.fire({toast:!0,position:"top",icon:"success",title:"Catalog added successfully",showConfirmButton:!1,timer:1500,width:"360px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),He({style:"",color:"",code:"",type:"",description:"",price:""}),Be(1,oe,V,_,A,H),Bs({}),He(Ae),Bs({}),le(!1)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to save catalog",showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{ue(!1)}}},children:c("common.save")})]})]}),e.jsxs(O,{visible:Le,onClose:()=>Oe(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.edit.modalTitle")}),e.jsx(R,{children:e.jsxs(j,{children:[e.jsx(X,{isClearable:!0,placeholder:c("settings.manufacturers.catalogMapping.stylePlaceholder"),options:$e,value:Re.style?{label:Re.style,value:Re.style}:null,onChange:e=>We({...Re,style:e?e.value:""}),styles:{control:e=>({...e,borderColor:"#d8dbe0",minHeight:"38px",boxShadow:"none","&:hover":{borderColor:"#a6a9b0"}})}}),["code","description","type"].map(s=>e.jsx(N,{className:"mb-2",label:c("code"===s?"settings.manufacturers.catalogMapping.fields.code":"description"===s?"settings.manufacturers.catalogMapping.fields.description":"settings.manufacturers.catalogMapping.fields.type"),name:s,value:Re[s],onChange:e=>We({...Re,[s]:e.target.value})},s)),e.jsx(N,{className:"mb-2",type:"number",step:"0.01",min:"0",label:c("settings.manufacturers.catalogMapping.fields.price"),name:"price",value:Re.price,onChange:e=>{const s=e.target.value;We({...Re,price:s})}})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>Oe(!1),children:c("common.cancel")}),e.jsx(g,{style:{backgroundColor:p,color:h,borderColor:p},onClick:async()=>{pe(!0);try{await o.put(`/api/manufacturers/catalog/edit/${Re.id}`,Re,{headers:ne()}),J.fire({toast:!0,position:"top",icon:"success",title:"Catalog updated successfully",showConfirmButton:!1,timer:1500,width:"360px"}),Oe(!1),Be(re,oe,V,_,A,H)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to update catalog",showConfirmButton:!1,timer:1500})}finally{pe(!1)}},disabled:me,children:c(me?"settings.manufacturers.catalogMapping.edit.updating":"settings.manufacturers.catalogMapping.edit.update")})]})]}),e.jsxs(O,{visible:Us,onClose:()=>Vs(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.style.manageTitle",{style:qs})}),e.jsx(R,{children:e.jsxs(j,{children:[e.jsx(N,{label:c("settings.manufacturers.catalogMapping.style.shortName"),name:"shortName",value:Ys.shortName,onChange:Qs,className:"mb-3"}),e.jsx(S,{label:c("settings.manufacturers.catalogMapping.fields.description"),name:"description",value:Ys.description,onChange:Qs,className:"mb-3",rows:4}),e.jsx(N,{type:"file",label:c("settings.manufacturers.catalogMapping.style.uploadImage"),accept:"image/*",id:"styleImage",onChange:e=>ze(e.target.files[0])}),Te?e.jsx("div",{className:"mt-2 text-success",children:c("settings.manufacturers.catalogMapping.style.imageSelected",{name:Te.name})}):Ys.image?e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:c("settings.manufacturers.catalogMapping.style.currentImage")})}),e.jsx("img",{src:Ys.image?`${d}/uploads/images/${Ys.image}`:"/images/nologo.png",alt:"Style Preview",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",display:"block",margin:"0 auto"},onError:e=>{Ys.image&&!e.target.dataset.fallbackTried?(e.target.dataset.fallbackTried="1",e.target.src=`${d}/uploads/manufacturer_catalogs/${Ys.image}`):e.target.src="/images/nologo.png"}})]}):null]})}),e.jsxs(W,{children:[e.jsx(g,{style:{backgroundColor:p,color:h,borderColor:p},onClick:async e=>{e.preventDefault();try{const e=new FormData;Object.keys(Ys).forEach(s=>{e.append(s,Ys[s])}),Te&&e.append("styleImage",Te);200==(await o.post("/api/manufacturers/style/create",e,{headers:{"Content-Type":"multipart/form-data",...ne()}})).data.status&&(Ks({name:"",shortName:"",description:"",image:""}),J.fire({toast:!0,position:"top",icon:"success",title:"Catalog Style Updated successfully",showConfirmButton:!1,timer:1500,width:"360px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}))}catch(s){}finally{ze(""),Vs(!1)}},children:c("common.save")}),e.jsx(g,{color:"secondary",onClick:()=>Vs(!1),children:c("common.cancel")})]})]}),e.jsxs(O,{visible:Zs,onClose:()=>Js(!1),size:"lg",children:[e.jsx(Z,{title:`📝 ${c("settings.manufacturers.catalogMapping.style.detailsTitle")}`}),e.jsx(R,{children:Xs?e.jsxs("div",{style:{padding:"10px 5px"},children:[e.jsx("div",{style:{marginBottom:"1rem",display:"flex",flexWrap:"wrap"},children:e.jsxs("div",{style:{flex:"1 1 100%",paddingRight:"10px"},children:[e.jsxs("p",{children:[e.jsxs("strong",{children:["🏷️ ",c("settings.manufacturers.catalogMapping.style.shortName"),":"]})," ",Xs.shortName?Xs.shortName:c("common.na")]}),e.jsxs("p",{children:[e.jsxs("strong",{children:["📝 ",c("settings.manufacturers.catalogMapping.fields.description"),":"]})," ",Xs.description?Xs.description:c("common.na")]})]})}),Xs.image?e.jsx("div",{style:{marginTop:"20px"},children:e.jsx("img",{src:Xs.image?`${d}/uploads/images/${Xs.image}`:"/images/nologo.png",alt:"Style",style:{maxWidth:"100%",maxHeight:"300px",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},onError:e=>{Xs.image&&!e.target.dataset.fallbackTried?(e.target.dataset.fallbackTried="1",e.target.src=`${d}/uploads/manufacturer_catalogs/${Xs.image}`):e.target.src="/images/nologo.png"}})}):e.jsx("p",{style:{textAlign:"center",color:"#888"},children:c("settings.manufacturers.catalogMapping.style.noImage")})]}):e.jsx("p",{children:c("settings.manufacturers.catalogMapping.style.noData")})}),e.jsx(W,{children:e.jsx(g,{color:"secondary",onClick:()=>Js(!1),children:c("common.cancel")})})]}),e.jsxs(O,{visible:ye,onClose:()=>je(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.assembly.modalTitle")}),e.jsxs(R,{children:[e.jsx(v,{children:c("settings.manufacturers.catalogMapping.assembly.type")}),e.jsxs(M,{value:Ce.type,onChange:e=>we({...Ce,type:e.target.value}),children:[e.jsx("option",{value:"",children:c("settings.manufacturers.catalogMapping.assembly.selectType")}),e.jsx("option",{value:"percentage",children:c("settings.manufacturers.catalogMapping.assembly.percentage")}),e.jsx("option",{value:"fixed",children:c("settings.manufacturers.catalogMapping.assembly.fixed")})]}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.fields.price")}),e.jsx(N,{type:"number",value:Ce.price,onChange:e=>we({...Ce,price:e.target.value}),placeholder:c("settings.manufacturers.catalogMapping.placeholders.price")}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.assembly.applyTo")}),e.jsxs(M,{value:Ce.applyTo,onChange:e=>we({...Ce,applyTo:e.target.value}),children:[e.jsx("option",{value:"all",children:c("settings.manufacturers.catalogMapping.assembly.applyAll")}),e.jsx("option",{value:"one",children:c("settings.manufacturers.catalogMapping.assembly.applyOne")})]})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>je(!1),children:c("common.cancel")}),e.jsx(g,{style:{backgroundColor:p,color:h,borderColor:p},onClick:async()=>{try{const e={catalogDataId:Ie.id,type:Ce.type,price:parseFloat(Ce.price)||0,applyTo:Ce.applyTo||"item",manufacturerId:Ie.manufacturerId};await o.post("/api/manufacturers/items/assembly-cost",e,{headers:ne()}),je(!1)}catch(e){}},children:c("common.save")})]})]}),e.jsxs(O,{visible:fe,onClose:()=>be(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.hinges.modalTitle")}),e.jsxs(R,{children:[e.jsx(v,{children:c("settings.manufacturers.catalogMapping.hinges.left")}),e.jsx(N,{type:"number",value:Se.leftHingePrice,onChange:e=>ke({...Se,leftHingePrice:e.target.value}),placeholder:c("settings.manufacturers.catalogMapping.hinges.placeholderLeft")}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.hinges.right")}),e.jsx(N,{type:"number",value:Se.rightHingePrice,onChange:e=>ke({...Se,rightHingePrice:e.target.value}),placeholder:c("settings.manufacturers.catalogMapping.hinges.placeholderRight")}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.hinges.both")}),e.jsx(N,{type:"number",value:Se.bothHingePrice,onChange:e=>ke({...Se,bothHingePrice:e.target.value}),placeholder:c("settings.manufacturers.catalogMapping.hinges.placeholderBoth")}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.hinges.exposedSide")}),e.jsx(N,{type:"number",value:Se.exposedSidePrice,onChange:e=>ke({...Se,exposedSidePrice:e.target.value}),placeholder:c("settings.manufacturers.catalogMapping.hinges.placeholderExposed")})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>be(!1),children:c("common.cancel")}),e.jsx(g,{style:{backgroundColor:p,color:h,borderColor:p},onClick:async()=>{try{const e={catalogDataId:Ie.id,leftHingePrice:parseFloat(Se.leftHingePrice)||0,rightHingePrice:parseFloat(Se.rightHingePrice)||0,bothHingesPrice:parseFloat(Se.bothHingePrice)||0,exposedSidePrice:parseFloat(Se.exposedSidePrice)||0};await o.post("/api/manufacturers/items/hinges",e,{headers:ne()}),be(!1)}catch(e){}},children:c("common.save")})]})]}),e.jsxs(O,{visible:ve,onClose:()=>Ne(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.mod.modalTitle")}),e.jsxs(R,{children:[e.jsx(v,{children:c("settings.manufacturers.catalogMapping.mod.name")}),e.jsx(N,{value:Fe.modificationName,onChange:e=>Me({...Fe,modificationName:e.target.value})}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.fields.description")}),e.jsx(S,{value:Fe.description,onChange:e=>Me({...Fe,description:e.target.value}),rows:3}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.mod.notes")}),e.jsx(S,{value:Fe.notes,onChange:e=>Me({...Fe,notes:e.target.value}),rows:2}),e.jsx(v,{className:"mt-2",children:c("settings.manufacturers.catalogMapping.fields.price")}),e.jsx(N,{type:"number",value:Fe.price,onChange:e=>Me({...Fe,price:e.target.value})})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>Ne(!1),children:c("common.cancel")}),e.jsx(g,{style:{backgroundColor:p,color:h,borderColor:p},onClick:async()=>{try{const e={catalogDataId:Ie.id,modificationName:Fe.modificationName,description:Fe.description,notes:Fe.notes,price:parseFloat(Fe.price)||0};await o.post("/api/manufacturers/items/modifications",e,{headers:ne()}),Ne(!1)}catch(e){}},children:c("common.save")})]})]}),e.jsxs(O,{visible:Ue,onClose:()=>Ve(!1),children:[e.jsx(Z,{title:`Delete Style: "${qe}"`}),e.jsx(R,{children:e.jsxs("div",{className:"mb-3",children:[e.jsxs("p",{children:['You are about to delete the style "',e.jsx("strong",{children:qe}),'". This will affect ',e.jsx("strong",{children:u.filter(e=>e.style===qe).length})," catalog items."]}),e.jsx("p",{children:"What would you like to do with the items that currently have this style?"}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"form-check mb-2",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"deleteOption",id:"deleteItems",checked:!Ye,onChange:()=>Ke("")}),e.jsxs("label",{className:"form-check-label text-danger",htmlFor:"deleteItems",children:[e.jsx("strong",{children:"Delete all items"})," with this style permanently"]})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"deleteOption",id:"mergeItems",checked:!!Ye,onChange:()=>Ke(De.find(e=>e!==qe)||"")}),e.jsxs("label",{className:"form-check-label text-primary",htmlFor:"mergeItems",children:[e.jsx("strong",{children:"Merge items"})," to another style"]})]})]}),""!==Ye&&e.jsxs("div",{className:"mt-3",children:[e.jsx(v,{children:"Select target style:"}),e.jsxs(M,{value:Ye,onChange:e=>Ke(e.target.value),children:[e.jsx("option",{value:"",children:"Select a style..."}),De.filter(e=>e!==qe).map((s,t)=>e.jsx("option",{value:s,children:s},t))]})]}),e.jsx("div",{className:"mt-3 p-3 bg-light rounded",children:e.jsx("small",{className:"text-muted",children:Ye?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Smart Merge Action:"})," All ",u.filter(e=>e.style===qe).length,' items with style "',qe,'" will be processed:',e.jsxs("ul",{className:"mt-1 mb-0",children:[e.jsxs("li",{children:['Items with unique codes will be merged to style "',Ye,'"']}),e.jsx("li",{children:"Duplicate items (same code + style) will be automatically removed"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Delete Action:"})," All ",u.filter(e=>e.style===qe).length,' items with style "',qe,'" will be permanently deleted. This action cannot be undone.']})})})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>Ve(!1),disabled:Ge,children:c("common.cancel")}),e.jsx(g,{color:Ye?"primary":"danger",onClick:async()=>{if(qe&&!Ge){Qe(!0);try{const e=Ye?{mergeToStyle:Ye}:{},{data:s}=await o.delete(`/api/manufacturers/${i}/style/${encodeURIComponent(qe)}`,{headers:ne(),data:e});J.fire({toast:!0,position:"top",icon:"success",title:s.message||"Style operation completed successfully",showConfirmButton:!1,timer:2500,width:"450px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),Ve(!1),_e(""),Ke(""),Be(1,oe,V,_,A,H),ce(1)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to delete/merge style",showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{Qe(!1)}}},disabled:Ge||""!==Ye&&!Ye,children:Ge?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Processing..."]}):Ye?`Merge to "${Ye}"`:"Delete Permanently"})]})]}),e.jsxs(O,{visible:ls,onClose:()=>ns(!1),children:[e.jsx(Z,{title:"Delete Catalog Item"}),e.jsx(R,{children:rs&&e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete this catalog item?"}),e.jsxs("div",{className:"p-3 bg-light rounded",children:[e.jsx("strong",{children:"Code:"})," ",rs.code,e.jsx("br",{}),e.jsx("strong",{children:"Description:"})," ",rs.description||"N/A",e.jsx("br",{}),e.jsx("strong",{children:"Style:"})," ",rs.style||"N/A",e.jsx("br",{}),e.jsx("strong",{children:"Price:"})," $",rs.price||"0.00"]}),e.jsx("p",{className:"text-danger mt-3",children:e.jsx("small",{children:"⚠️ This action cannot be undone."})})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>ns(!1),disabled:os,children:c("common.cancel")}),e.jsx(g,{color:"danger",onClick:async()=>{if(rs&&!os){ds(!0);try{await o.delete(`/api/manufacturers/catalog/edit/${rs.id}`,{headers:ne()}),J.fire({toast:!0,position:"top",icon:"success",title:"Item deleted successfully",showConfirmButton:!1,timer:1500,width:"350px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),ns(!1),cs(null),Be(re,oe,V,_,A,H)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to delete item",showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{ds(!1)}}},disabled:os,children:os?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Deleting..."]}):"Delete Item"})]})]}),e.jsxs(O,{visible:ss,onClose:()=>ts(!1),children:[e.jsx(Z,{title:"Delete Multiple Items"}),e.jsx(R,{children:e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:Ze.length})," selected catalog items?"]}),e.jsxs("div",{className:"p-3 bg-light rounded",children:[e.jsx("strong",{children:"Items to be deleted:"}),e.jsxs("ul",{className:"mt-2 mb-0",children:[xe.filter(e=>Ze.includes(e.id)).slice(0,10).map(s=>e.jsxs("li",{children:[s.code," - ",s.description||"N/A"]},s.id)),Ze.length>10&&e.jsx("li",{children:e.jsxs("em",{children:["... and ",Ze.length-10," more items"]})})]})]}),e.jsx("p",{className:"text-danger mt-3",children:e.jsx("small",{children:"⚠️ This action cannot be undone. All selected items will be permanently deleted."})})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>ts(!1),disabled:as,children:c("common.cancel")}),e.jsx(g,{color:"danger",onClick:async()=>{if(0!==Ze.length&&!as){is(!0);try{const e=Ze.map(e=>o.delete(`/api/manufacturers/catalog/edit/${e}`,{headers:ne()}));await Promise.all(e),J.fire({toast:!0,position:"top",icon:"success",title:`Successfully deleted ${Ze.length} items`,showConfirmButton:!1,timer:2e3,width:"350px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),ts(!1),Je([]),es(!1),Be(re,oe,V,_,A,H)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to delete some items",showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{is(!1)}}},disabled:as,children:as?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Deleting ",Ze.length," items..."]}):`Delete ${Ze.length} Items`})]})]}),e.jsxs(O,{visible:hs,onClose:()=>us(!1),children:[e.jsx(Z,{title:c("settings.manufacturers.catalogMapping.rollback.modalTitle")}),e.jsxs(R,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{children:c("settings.manufacturers.catalogMapping.rollback.selectBackup")}),fs?e.jsxs("div",{className:"text-center py-3",children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Loading backups..."]}):0===gs.length?e.jsx("div",{className:"alert alert-info",children:c("settings.manufacturers.catalogMapping.rollback.noBackups")}):e.jsx("div",{children:gs.map(s=>e.jsxs("div",{className:"form-check mb-2",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"backupSelection",id:`backup-${s.uploadSessionId}`,value:s.uploadSessionId,checked:ys===s.uploadSessionId,onChange:e=>js(e.target.value)}),e.jsx("label",{className:"form-check-label",htmlFor:`backup-${s.uploadSessionId}`,children:e.jsxs("div",{children:[e.jsx("strong",{children:s.originalName}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[new Date(s.uploadedAt).toLocaleString()," - ",s.itemsCount," items"]})]})})]},s.uploadSessionId))})]}),ys&&e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:c("settings.manufacturers.catalogMapping.rollback.warning")}),e.jsx("br",{}),c("settings.manufacturers.catalogMapping.rollback.confirmText")]})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>{us(!1),js(""),xs([])},children:c("common.cancel")}),e.jsx(g,{color:"warning",onClick:async()=>{if(ys&&!vs){Ns(!0);try{const{data:e}=await o.post(`/api/manufacturers/${i}/catalog/rollback`,{uploadSessionId:ys},{headers:ne()});J.fire({toast:!0,position:"top",icon:"success",title:e.message||c("settings.manufacturers.catalogMapping.rollback.success"),showConfirmButton:!1,timer:2500,width:"450px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),us(!1),js(""),xs([]),Be(1,oe,V,_,A,H),ce(1)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:c("settings.manufacturers.catalogMapping.rollback.failed"),showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{Ns(!1)}}},disabled:!ys||vs,children:vs?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),c("settings.manufacturers.catalogMapping.rollback.rolling")]}):c("settings.manufacturers.catalogMapping.rollback.rollbackButton")})]})]}),e.jsxs(O,{visible:Cs,onClose:()=>ws(!1),size:"lg",children:[e.jsx(Z,{title:`Bulk Edit ${Ze.length} Items`}),e.jsx(R,{children:e.jsxs("div",{children:[e.jsxs("p",{children:["Edit the following fields for the selected ",Ze.length," catalog items. Leave fields empty to keep existing values."]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:"Style"}),e.jsx(N,{type:"text",value:Fs.style,onChange:e=>Ms({...Fs,style:e.target.value}),placeholder:"Leave empty to keep existing"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:"Type"}),e.jsx(N,{type:"text",value:Fs.type,onChange:e=>Ms({...Fs,type:e.target.value}),placeholder:"Leave empty to keep existing"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx(v,{children:"Description"}),e.jsx(S,{value:Fs.description,onChange:e=>Ms({...Fs,description:e.target.value}),placeholder:"Leave empty to keep existing",rows:3})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:"Price"}),e.jsx(N,{type:"number",step:"0.01",value:Fs.price,onChange:e=>Ms({...Fs,price:e.target.value}),placeholder:"Leave empty to keep existing"})]})]}),e.jsx("div",{className:"mt-3 p-3 bg-light rounded",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Note:"})," Only the fields you fill will be updated. Empty fields will preserve the existing values for each item."]})})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>ws(!1),disabled:Ss,children:"Cancel"}),e.jsx(g,{color:"primary",onClick:async()=>{if(0===Ze.length||Ss)return;if(Object.values(Fs).some(e=>e&&""!==e.trim())){ks(!0);try{const e={};Object.keys(Fs).forEach(s=>{Fs[s]&&""!==Fs[s].trim()&&(e[s]=Fs[s].trim())});const{data:s}=await o.put("/api/manufacturers/catalog/bulk-edit",{itemIds:Ze,updates:e},{headers:ne()});J.fire({toast:!0,position:"top",icon:"success",title:s.message||`Successfully updated ${Ze.length} items`,showConfirmButton:!1,timer:2e3,width:"350px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),ws(!1),Je([]),es(!1),Ms({style:"",type:"",description:"",price:""}),Be(re,oe,V,_,A,H)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:"Failed to bulk edit items",showConfirmButton:!1,timer:1500,width:"330px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{ks(!1)}}else J.fire({toast:!0,position:"top",icon:"warning",title:"Please fill at least one field to update",showConfirmButton:!1,timer:2e3,width:"350px"})},disabled:Ss,children:Ss?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Updating ",Ze.length," Items..."]}):`Update ${Ze.length} Items`})]})]}),e.jsxs(O,{visible:Ts,onClose:()=>zs(!1),children:[e.jsx(Z,{title:"Edit Style Name"}),e.jsx(R,{children:e.jsxs("div",{children:[e.jsx("p",{children:"Rename the style for all items of this manufacturer. This will affect all catalog items currently using this style."}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:"Current Style Name"}),e.jsx(N,{type:"text",value:Ds.oldStyleName,disabled:!0,className:"bg-light"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:"New Style Name"}),e.jsx(N,{type:"text",value:Ds.newStyleName,onChange:e=>$s({...Ds,newStyleName:e.target.value}),placeholder:"Enter new style name",autoFocus:!0})]}),e.jsx("div",{className:"p-3 bg-warning bg-opacity-10 rounded",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Warning:"}),' This will rename the style for all items currently using "',Ds.oldStyleName,'". The change applies to all ',u.filter(e=>e.style===Ds.oldStyleName).length," items with this style."]})})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>zs(!1),disabled:Is,children:"Cancel"}),e.jsx(g,{color:"primary",onClick:async()=>{if(Ds.oldStyleName&&Ds.newStyleName&&!Is)if(Ds.oldStyleName.trim()!==Ds.newStyleName.trim()){Ps(!0);try{const{data:e}=await o.put(`/api/manufacturers/${i}/style-name`,{oldStyleName:Ds.oldStyleName.trim(),newStyleName:Ds.newStyleName.trim()},{headers:ne()});J.fire({toast:!0,position:"top",icon:"success",title:e.message||"Style name updated successfully",showConfirmButton:!1,timer:2500,width:"450px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}}),zs(!1),$s({oldStyleName:"",newStyleName:""}),Be(re,oe,V,_,A,H)}catch(e){J.fire({toast:!0,position:"top",icon:"error",title:e.message||"Failed to edit style name",showConfirmButton:!1,timer:2e3,width:"350px",didOpen:e=>{e.style.padding="8px 12px",e.style.fontSize="14px",e.style.minHeight="auto"}})}finally{Ps(!1)}}else J.fire({toast:!0,position:"top",icon:"warning",title:"New style name must be different from the old one",showConfirmButton:!1,timer:2e3,width:"350px"})},disabled:Is||!Ds.newStyleName.trim(),children:Is?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Renaming Style..."]}):"Rename Style"})]})]})]})},ce=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},oe=({manufacturer:s})=>{const{t:i}=r(),l="https://app.nj.contractors",[n,c]=t.useState([]),[d,m]=t.useState(!1),[p,j]=t.useState(null),[f,b]=t.useState(""),[C,w]=t.useState(null),[S,M]=t.useState(!1),[T,z]=t.useState(null),[I,P]=t.useState(!1),[D,$]=t.useState(null),[A,E]=t.useState(!1),[H,B]=t.useState({name:"",shortName:"",description:"",code:"",imageFile:null}),[L,q]=t.useState(!1),[_,Y]=t.useState({open:!1,styleName:""}),[K,G]=t.useState(""),Q=t.useCallback((e,s)=>{const t=s?.styleVariants?.[0]?.image;t&&!e.target.dataset.fallbackTried&&-1===e.target.src.indexOf("/uploads/manufacturer_catalogs/")?(e.target.dataset.fallbackTried="1",e.target.src=`${l}/uploads/manufacturer_catalogs/${t}`):-1===e.target.src.indexOf("/images/nologo.png")&&(e.target.src="/images/nologo.png")},[l]);a.useEffect(()=>{const e=document.createElement("style");return e.innerHTML="\n      .collection-hover {\n        transition: all 0.3s ease;\n      }\n      \n      .collection-hover:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      }\n      \n      @media (max-width: 576px) {\n        .collection-hover {\n          margin-bottom: 1rem;\n        }\n        \n        .collection-hover:hover {\n          transform: none;\n        }\n        \n        .collection-hover:active {\n          transform: scale(0.98);\n        }\n      }\n      \n      @media (hover: none) and (pointer: coarse) {\n        .collection-hover:hover {\n          transform: none;\n          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n        }\n      }\n    ",document.head.appendChild(e),()=>{document.head.removeChild(e)}},[]),t.useEffect(()=>{s?.id&&J()},[s?.id]);const J=async()=>{if(s?.id){m(!0),j(null);try{const e=await o.get(`/api/manufacturers/${s.id}/styles-meta`,{headers:ce()});e.data&&e.data.styles&&Array.isArray(e.data.styles)?c(e.data.styles):Array.isArray(e.data)?c(e.data):c([])}catch(e){j("Failed to load style pictures. Please try again."),c([])}finally{m(!1)}}},X=n.filter(e=>e.style?.toLowerCase().includes(f.toLowerCase())||e.styleVariants?.[0]?.shortName?.toLowerCase().includes(f.toLowerCase()));return d?e.jsx(h,{children:e.jsxs(x,{className:"text-center p-5",children:[e.jsx(U,{color:"primary"}),e.jsx("div",{className:"mt-3",children:i("styles.loading","Loading style pictures...")})]})}):p?e.jsx(h,{children:e.jsx(x,{children:e.jsx(y,{color:"danger",children:i("styles.loadFailed","Failed to load style pictures. Please try again.")})})}):s?.id?0===n.length?e.jsx(h,{children:e.jsx(x,{children:e.jsx(y,{color:"info",children:i("styles.noStylesInfo","No styles with pictures found for this manufacturer. Upload style images in the catalog mapping section to see them here.")})})}):e.jsxs("div",{children:[e.jsxs(h,{children:[e.jsx(u,{children:e.jsxs("div",{className:"d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-3",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"mb-1",children:[i("styles.header","Style Pictures for {{name}}",{name:s.name}),e.jsxs(V,{color:"primary",className:"ms-2",children:[i("styles.count","{{count}} Styles",{count:X.length})," ",f?i("styles.filtered","(filtered from {{total}})",{total:n.length}):""]})]}),e.jsxs("div",{className:"d-flex gap-2 align-items-center",style:{minWidth:"250px"},children:[e.jsx(g,{color:"success",size:"sm",onClick:()=>E(!0),children:i("styles.create","Add Style")}),e.jsx("div",{style:{minWidth:"250px"},children:e.jsxs(k,{size:"sm",children:[e.jsx(F,{children:e.jsx("i",{className:"bi bi-search"})}),e.jsx(N,{placeholder:i("styles.searchPlaceholder","Search styles..."),value:f,onChange:e=>b(e.target.value)})]})})]}),e.jsx("small",{className:"text-muted",children:i("styles.helperText","View all styles with their associated pictures. Images are used in quote creation to help customers visualize their selections.")})]}),e.jsx("div",{style:{minWidth:"250px"},children:e.jsxs(k,{size:"sm",children:[e.jsx(F,{children:e.jsx("i",{className:"bi bi-search"})}),e.jsx(N,{placeholder:i("styles.searchPlaceholder","Search styles..."),value:f,onChange:e=>b(e.target.value)})]})})]})}),e.jsx(x,{children:0===X.length?e.jsx(y,{color:"info",className:"text-center",children:f?e.jsxs(e.Fragment,{children:[i("styles.noneMatch",'No styles found matching "{{term}}".',{term:f}),e.jsx("br",{}),e.jsx("small",{children:i("styles.tryAdjust","Try adjusting your search terms or clear the search to see all styles.")})]}):i("styles.noneAvailable","No styles with pictures found for this manufacturer.")}):e.jsx("div",{className:"d-flex flex-wrap justify-content-start gap-3",children:X.map((t,a)=>e.jsx("div",{className:"text-center",style:{minWidth:"80px",maxWidth:"120px"},children:e.jsxs("div",{className:"position-relative",style:{cursor:"pointer"},onMouseEnter:()=>w(t.id),onMouseLeave:()=>w(null),children:[e.jsxs("div",{className:"collection-hover border rounded shadow-sm position-relative d-inline-block",style:{overflow:"hidden",borderRadius:"8px",transition:"transform 0.3s ease",backgroundColor:"#f8f9fa",maxWidth:"100%"},children:[e.jsx("img",{src:t.styleVariants?.[0]?.image?`${l}/uploads/images/${t.styleVariants[0].image}`:"/images/nologo.png",alt:t.styleVariants?.[0]?.shortName||t.style,style:{maxWidth:"120px",maxHeight:"150px",height:"auto",width:"auto",borderRadius:"8px",transition:"transform 0.3s ease",transform:C===t.id?"scale(1.02)":"scale(1)",display:"block"},className:"img-fluid",onError:e=>Q(e,t)}),e.jsxs("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"#fff",opacity:C===t.id?1:0,transition:"opacity 0.3s ease",fontSize:"0.85rem",fontWeight:"500",borderRadius:"8px"},children:[e.jsxs(g,{color:"light",size:"sm",onClick:e=>{e.stopPropagation(),(e=>{z(e),$(null),M(!0)})(t)},style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"bi bi-pencil"})," ",i("types.ui.uploadImage","Upload Image")]}),e.jsx(g,{color:"danger",size:"sm",className:"ms-2",onClick:e=>{e.stopPropagation(),Y({open:!0,styleName:t.style}),G("")},style:{fontSize:"0.75rem"},children:e.jsx("i",{className:"bi bi-trash"})})]})]}),e.jsxs(O,{visible:A,onClose:()=>E(!1),className:"no-gradient-modal",children:[e.jsx(Z,{title:i("styles.createHeader","Add Style")}),e.jsx(R,{children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:i("styles.name","Style Name")}),e.jsx(N,{value:H.name,onChange:e=>B(s=>({...s,name:e.target.value}))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:i("styles.short","Short Name")}),e.jsx(N,{value:H.shortName,onChange:e=>B(s=>({...s,shortName:e.target.value}))})]}),e.jsxs("div",{className:"col-12",children:[e.jsx(v,{children:i("common.description","Description")}),e.jsx(N,{value:H.description,onChange:e=>B(s=>({...s,description:e.target.value}))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:i("common.code","Code")}),e.jsx(N,{value:H.code,onChange:e=>B(s=>({...s,code:e.target.value}))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:i("common.image","Image")}),e.jsx("input",{className:"form-control",type:"file",accept:"image/*",onChange:e=>B(s=>({...s,imageFile:e.target.files?.[0]||null}))})]})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>E(!1),disabled:L,children:"Cancel"}),e.jsx(g,{color:"primary",disabled:L||!H.name.trim(),onClick:async()=>{q(!0);try{const e=new FormData;H.imageFile&&e.append("styleImage",H.imageFile),e.append("manufacturerId",s.id),e.append("name",H.name.trim()),e.append("shortName",H.shortName||""),e.append("description",H.description||""),e.append("code",H.code||""),await o.post(`/api/manufacturers/${s.id}/styles`,e,{headers:{"Content-Type":"multipart/form-data",...ce()}}),await J(),E(!1)}catch(e){}finally{q(!1)}},children:L?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),"Saving..."]}):"Save"})]})]}),e.jsxs(O,{visible:_.open,onClose:()=>Y({open:!1,styleName:""}),className:"no-gradient-modal",children:[e.jsx(Z,{title:i("styles.deleteHeader","Delete Style")}),e.jsxs(R,{children:[e.jsxs("p",{children:[i("styles.deleteConfirm","Delete style")," ",e.jsx("strong",{children:_.styleName}),"?"]}),e.jsx(v,{children:i("styles.reassign","Reassign items to (leave empty to clear)")}),e.jsx(N,{value:K,onChange:e=>G(e.target.value),placeholder:i("styles.reassignPh","New style name or blank")})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>Y({open:!1,styleName:""}),children:"Cancel"}),e.jsx(g,{color:"danger",onClick:async()=>{try{await o.delete(`/api/manufacturers/${s.id}/styles/${encodeURIComponent(_.styleName)}`,{data:{reassignTo:K},headers:ce()}),await J()}catch(e){}finally{Y({open:!1,styleName:""}),G("")}},children:i("common.delete","Delete")})]})]}),e.jsxs("div",{className:"mt-2",style:{maxWidth:"120px"},children:[e.jsx("div",{className:"text-muted fw-semibold text-truncate",title:t.styleVariants?.[0]?.shortName||t.style,style:{fontSize:"0.8rem",lineHeight:"1.2"},children:t.styleVariants?.[0]?.shortName||t.style}),t.styleVariants?.length>0&&e.jsx("div",{className:"text-center mt-1",children:e.jsxs(V,{color:"secondary",style:{fontSize:"0.6rem"},children:[t.styleVariants.length," ",i("styles.variants","variants")]})})]})]})},t.id||a))})})]}),e.jsx("style",{children:"\n        .no-gradient-modal .modal-header {\n          background: #fff !important;\n          border-bottom: 1px solid #dee2e6 !important;\n          color: #212529 !important;\n        }\n        .no-gradient-modal .modal-title {\n          color: #212529 !important;\n        }\n      "}),e.jsxs(O,{visible:S,onClose:()=>{M(!1),z(null),$(null)},size:"lg",className:"no-gradient-modal",children:[e.jsx(Z,{title:i("styles.editImage","Edit Style Image")}),e.jsx(R,{children:T&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("strong",{children:[i("common.style","Style"),":"]})," ",T.style]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:i("types.ui.currentImage","Current Image:")}),e.jsx("div",{className:"d-flex justify-content-center p-3 border rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsx("img",{src:T.styleVariants?.[0]?.image?`${l}/uploads/images/${T.styleVariants[0].image}`:"/default-image.png",alt:T.style,style:{maxWidth:"200px",maxHeight:"200px",objectFit:"contain",border:"1px solid #dee2e6",borderRadius:"4px"},onError:e=>Q(e,T)})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{htmlFor:"imageUpload",children:i("styles.uploadNewImage","Upload New Image:")}),e.jsx("input",{type:"file",id:"imageUpload",className:"form-control",accept:"image/*",onChange:e=>{const s=e.target.files[0];$(s)}}),e.jsx("div",{className:"mt-2 text-muted",children:D?e.jsxs(e.Fragment,{children:[i("styles.selected","Selected"),": ",D.name]}):T.styleVariants?.[0]?.image?e.jsxs(e.Fragment,{children:[i("types.ui.current","Current"),": ",T.styleVariants[0].image]}):e.jsx(e.Fragment,{children:i("types.ui.noImage","No image uploaded")})})]}),D&&e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{children:i("styles.previewNewImage","New Image Preview:")}),e.jsx("div",{className:"d-flex justify-content-center p-3 border rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsx("img",{src:URL.createObjectURL(D),alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",objectFit:"contain",border:"1px solid #dee2e6",borderRadius:"4px"}})})]})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>{M(!1),z(null),$(null)},children:i("common.cancel","Cancel")}),e.jsx(g,{color:"primary",onClick:async()=>{if(T&&D){P(!0);try{const e=new FormData;e.append("styleImage",D),e.append("name",T.style),e.append("shortName",T.styleVariants?.[0]?.shortName||""),e.append("description",T.styleVariants?.[0]?.description||""),e.append("manufacturerId",s.id),e.append("catalogId",T.id),e.append("code",T.styleVariants?.[0]?.code||"");(await o.post("/api/manufacturers/style/create",e,{headers:{"Content-Type":"multipart/form-data",...ce()}})).data.success&&(await J(),M(!1),z(null),$(null))}catch(e){}finally{P(!1)}}},disabled:!D||I,children:I?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),i("common.uploading","Uploading...")]}):i("types.ui.uploadImage","Upload Image")})]})]})]}):e.jsx(h,{children:e.jsx(x,{children:e.jsx(y,{color:"info",children:i("styles.selectManufacturerInfo","Please select a manufacturer to view style pictures.")})})})},de=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},me=({manufacturer:s})=>{const{t:a}=r(),i="https://app.nj.contractors",[l,n]=t.useState([]),[c,d]=t.useState(!1),[m,p]=t.useState(null),[j,C]=t.useState(""),[M,L]=t.useState(null),[q,_]=t.useState([]),[Y,K]=t.useState("grid"),[G,Q]=t.useState(!1),[J,X]=t.useState(!1),[ee,se]=t.useState(null),[te,ae]=t.useState({typeName:"",longDescription:"",imageFile:null}),[ie,le]=t.useState(""),[ne,re]=t.useState(""),[ce,oe]=t.useState([]),[me,pe]=t.useState(!1),[he,ue]=t.useState(""),[ge,xe]=t.useState(!1),[ye,je]=t.useState(!1),[fe,be]=t.useState(null),[ve,Ne]=t.useState(!1),[Ce,we]=t.useState(null),[Se,ke]=t.useState([]),[Fe,Me]=t.useState(!1),[Te,ze]=t.useState(""),[Ie,Pe]=t.useState([]),[De,$e]=t.useState(""),[Ae,Ee]=t.useState(null),[He,Be]=t.useState(1),[Le,Oe]=t.useState(50),[Re,We]=t.useState(!0),[Ue,Ve]=t.useState(!1),[qe,_e]=t.useState(!1),[Ye,Ke]=t.useState({type:"",description:""}),[Ge,Qe]=t.useState(!1),[Ze,Je]=t.useState(!1),[Xe,es]=t.useState({oldTypeName:"",newTypeName:""}),[ss,ts]=t.useState(!1),[as,is]=t.useState({open:!1,typeName:""}),[ls,ns]=t.useState(""),rs=t.useCallback(e=>{-1===e.target.src.indexOf("/images/nologo.png")&&-1===e.target.src.indexOf("/default-image.png")&&(e.target.src="/images/nologo.png")},[]),cs=t.useCallback(e=>e?.image?`${i}/uploads/types/${e.image}`:"/images/nologo.png",[i]),os=t.useCallback(async()=>{if(s?.id){d(!0),p(null);try{const e=await o.get(`/api/manufacturers/${s.id}/types-meta`,{headers:de()});e.data&&Array.isArray(e.data)?n(e.data):n([])}catch(e){p("Failed to load types"),n([])}finally{d(!1)}}},[s?.id]),ds=t.useCallback(async()=>{if(s?.id)try{const e=await o.get(`/api/manufacturers/${s.id}/catalog`,{headers:de()});e.data&&Array.isArray(e.data)?oe(e.data):oe([])}catch(e){oe([])}},[s?.id]);t.useEffect(()=>{os(),ds()},[os,ds]);const ms=t.useMemo(()=>l.filter(e=>{const s=e.type?.toLowerCase().includes(j.toLowerCase())||e.description?.toLowerCase().includes(j.toLowerCase()),t=!ie||ce.some(s=>s.type===e.type&&s.style?.toLowerCase().includes(ie.toLowerCase())),a=!ne||e.type?.toLowerCase().includes(ne.toLowerCase());return s&&t&&a}),[l,j,ie,ne,ce]),ps=t.useMemo(()=>ms.reduce((e,s)=>{const t=s.type||"Unnamed";return e[t]||(e[t]=[]),e[t].push(s),e},{}),[ms]),hs=t.useCallback((e,s)=>{_(s?s=>[...s,e]:s=>s.filter(s=>s!==e))},[]),us=t.useCallback(e=>{_(e?ms.map(e=>e.id):[])},[ms]),gs=t.useCallback(async({reset:e=!1}={})=>{if(!s?.id)return;const t=e?1:He;e?Me(!0):Ve(!0);try{const a=(await o.get(`/api/manufacturers/${s.id}/catalog`,{headers:de(),params:{page:t,limit:Le,search:De||void 0,typeFilter:Te||void 0,excludeType:fe?.type||void 0,sortBy:"code",sortOrder:"ASC"}})).data;if(a&&Array.isArray(a.catalogData)){!e&&Se&&Array.isArray(Se.catalogData)?ke(e=>({...a,catalogData:[...e?.catalogData||[],...a.catalogData]})):ke(a);const s=a.pagination||{};We(s.page<s.totalPages),Be(s.page+1)}else Array.isArray(a)?(ke(a),We(!1)):a&&Array.isArray(a.data)?(ke({catalogData:a.data}),We(!1)):(ke([]),We(!1))}catch(a){ke([]),We(!1)}finally{e?Me(!1):Ve(!1)}},[s?.id,He,Le,De,Te,fe?.type,Se]),xs=t.useCallback(e=>{be(e),je(!0),Pe([]),$e(""),ze(""),Be(1),We(!0),setTimeout(()=>{gs({reset:!0})},100)},[gs]);t.useEffect(()=>{if(!ye)return;const e=setTimeout(()=>{Be(1),gs({reset:!0})},300);return()=>clearTimeout(e)},[De,Te,fe?.type,ye]);const ys=t.useCallback(()=>{Fe||Ue||!Re||gs({reset:!1})},[Fe,Ue,Re,gs]),js=t.useCallback(e=>{const s=e.target.files[0];we(s)},[]),fs=t.useCallback(async()=>{if(fe&&Ce&&s?.id){Ne(!0);try{const e=new FormData;e.append("typeImage",Ce),e.append("type",fe.type),e.append("description",fe.description||""),e.append("longDescription",Is[fe.type]??fe.longDescription??""),e.append("manufacturerId",s.id),e.append("catalogId",fe.id);(await o.post("/api/manufacturers/type/create",e,{headers:{"Content-Type":"multipart/form-data",...de()}})).data.success?(await os(),je(!1),be(null),we(null)):p("Failed to upload image")}catch(e){p("Failed to upload image")}finally{Ne(!1)}}},[fe,Ce,s?.id,os]),bs=t.useCallback(async()=>{if(0!==q.length&&s?.id){Qe(!0);try{(await o.post("/api/manufacturers/bulk-edit-types",{manufacturerId:s.id,itemIds:q,updates:Ye},{headers:de()})).data.success?(await os(),_e(!1),_([]),Ke({type:"",description:""})):p("Failed to update types")}catch(e){p("Failed to update types")}finally{Qe(!1)}}},[q,s?.id,Ye,os]),vs=t.useCallback(async()=>{if(Xe.oldTypeName&&Xe.newTypeName&&s?.id){ts(!0);try{(await o.post("/api/manufacturers/edit-type-name",{manufacturerId:s.id,oldTypeName:Xe.oldTypeName,newTypeName:Xe.newTypeName},{headers:de()})).data.success?(await os(),Je(!1),es({oldTypeName:"",newTypeName:""})):p("Failed to rename type")}catch(e){p("Failed to rename type")}finally{ts(!1)}}},[Xe.oldTypeName,Xe.newTypeName,s?.id,os]),Ns=t.useCallback(async()=>{if(0!==q.length&&s?.id&&he){xe(!0);try{(await o.post("/api/manufacturers/bulk-change-type",{manufacturerId:s.id,itemIds:q,newType:he},{headers:de()})).data.success?(await os(),await ds(),pe(!1),_([]),ue("")):p("Failed to change type category")}catch(e){p("Failed to change type category")}finally{xe(!1)}}},[q,s?.id,he,os,ds]),Cs=t.useCallback((e,s)=>{Pe(t=>s?[...t,e]:t.filter(s=>s!==e))},[]);t.useCallback(e=>{Pe(e?Ss.map(e=>e.id):[])},[]);const ws=t.useCallback(async()=>{if(fe&&0!==Ie.length&&s?.id){Me(!0);try{(await o.post("/api/manufacturers/assign-items-to-type",{manufacturerId:s.id,itemIds:Ie,newType:fe.type},{headers:de()})).data.success?(await os(),await ds(),await gs(),Pe([]),Ee({count:Ie.length,type:fe.type}),setTimeout(()=>Ee(null),3e3)):p("Failed to assign items to type")}catch(e){p("Failed to assign items to type")}finally{Me(!1)}}},[fe,Ie,s?.id,os,ds,gs]),Ss=t.useMemo(()=>{const e=Se&&Array.isArray(Se.catalogData)?Se.catalogData:Array.isArray(Se)?Se:[];if(!Array.isArray(e))return[];if(!De&&!Te)return[];return e.filter(e=>{const s=e.type!==fe?.type,t=!De||e.description?.toLowerCase().includes(De.toLowerCase())||e.code?.toLowerCase().includes(De.toLowerCase())||e.style?.toLowerCase().includes(De.toLowerCase()),a=!Te||e.type===Te;return s&&t&&a})},[Se,De,Te,fe]),ks=t.useCallback(e=>{Pe(e?Ss.map(e=>e.id):[])},[Ss]),Fs=t.useMemo(()=>[...new Set(ce.map(e=>e.style).filter(Boolean))].sort(),[ce]),Ms=t.useMemo(()=>[...new Set(ce.map(e=>e.type).filter(Boolean))].sort(),[ce]),[Ts,zs]=t.useState(null),[Is,Ps]=t.useState({}),Ds=t.useCallback(async e=>{if(!s?.id)return;const t=Is[e]??"";zs(e);try{const a=await o.post("/api/manufacturers/type/update-meta",{manufacturerId:s.id,type:e,longDescription:t},{headers:de()});a.data?.success&&await os()}catch(i){p(a("types.meta.saveFailed","Failed to save description"))}finally{zs(null)}},[s?.id,Is,os,a]);return s?c?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx(U,{color:"primary"})}):e.jsxs("div",{children:[e.jsxs(h,{children:[e.jsx(u,{className:"bg-light border-bottom",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0 fw-bold text-primary",children:a("types.ui.header","Type Pictures & Management")}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(g,{color:"success",size:"sm",onClick:()=>{ae({typeName:"",longDescription:"",imageFile:null}),se(null),Q(!0)},children:a("types.ui.createType","Create Type")}),e.jsx(g,{color:"primary",size:"sm",onClick:()=>K("grid"===Y?"table":"grid"),children:"grid"===Y?a("types.ui.tableView","Table View"):a("types.ui.gridView","Grid View")}),q.length>0&&e.jsxs($,{children:[e.jsxs(A,{color:"secondary",size:"sm",children:[a("types.ui.actions","Actions")," (",q.length,")"]}),e.jsxs(E,{children:[e.jsx(H,{onClick:()=>_e(!0),children:"Bulk Edit"}),e.jsx(H,{onClick:()=>{const e=l.find(e=>q.includes(e.id));e&&(es({oldTypeName:e.type,newTypeName:""}),Je(!0))},children:"Rename Type Globally"})]})]})]})]})}),e.jsxs(x,{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(v,{className:"fw-semibold text-dark mb-2",children:a("types.ui.searchLabel","Search Types")}),e.jsxs(k,{size:"lg",children:[e.jsx(F,{className:"bg-primary text-white",children:e.jsx("i",{className:"bi bi-search"})}),e.jsx(N,{placeholder:a("types.ui.searchPlaceholder","Search types..."),value:j,onChange:e=>C(e.target.value),className:"form-control-lg"})]})]}),e.jsx("div",{className:"mb-4 p-3 bg-light rounded",children:e.jsxs(f,{className:"g-3",children:[e.jsxs(b,{md:5,children:[e.jsx(v,{className:"fw-semibold text-primary",children:a("types.ui.filterByStyle","Filter by Style")}),e.jsx(N,{placeholder:"Filter by style...",value:ie,onChange:e=>le(e.target.value),list:"stylesList",size:"sm",className:"border-primary"}),e.jsx("datalist",{id:"stylesList",children:Fs.map(s=>e.jsx("option",{value:s},s))})]}),e.jsxs(b,{md:5,children:[e.jsx(v,{className:"fw-semibold text-primary",children:a("types.ui.filterByType","Filter by Type")}),e.jsx(N,{placeholder:"Filter by type...",value:ne,onChange:e=>re(e.target.value),list:"typesList",size:"sm",className:"border-primary"}),e.jsx("datalist",{id:"typesList",children:Ms.map(s=>e.jsx("option",{value:s},s))})]}),e.jsx(b,{md:2,className:"d-flex align-items-end justify-content-center",children:e.jsx(g,{color:"outline-primary",size:"sm",onClick:()=>{le(""),re(""),C("")},className:"w-100 fw-semibold",children:a("types.ui.clearFilters","Clear Filters")})})]})}),q.length>0&&e.jsx(f,{className:"mb-3",children:e.jsx(b,{children:e.jsxs(y,{color:"info",children:[q.length," item(s) selected",e.jsxs("div",{className:"mt-2",children:[e.jsx(g,{color:"primary",size:"sm",onClick:()=>pe(!0),className:"me-2",children:"Change Type Category"}),e.jsx(g,{color:"warning",size:"sm",onClick:()=>_e(!0),className:"me-2",children:"Bulk Edit"}),e.jsx(g,{color:"secondary",size:"sm",onClick:()=>_([]),children:"Clear Selection"})]})]})})}),m&&e.jsx(y,{color:"danger",dismissible:!0,onClose:()=>p(null),children:m}),"grid"===Y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 p-3 bg-primary bg-opacity-10 rounded border border-primary border-opacity-25",children:e.jsx(w,{id:"selectAll",label:`Select All (${ms.length} types)`,checked:q.length===ms.length&&ms.length>0,onChange:e=>us(e.target.checked),className:"fw-semibold text-primary",style:{fontSize:"1.1rem"}})}),0===Object.keys(ps).length?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-images",style:{fontSize:"3rem",color:"#6c757d"}}),e.jsx("h5",{className:"mt-3 text-muted",children:a("types.ui.noTypesFound","No types found")}),e.jsx("p",{className:"text-muted",children:j?a("types.ui.tryAdjust","Try adjusting your search criteria"):a("types.ui.typesWillAppear","Types will appear here when available")})]}):e.jsx("div",{className:"row g-2",children:Object.entries(ps).map(([s,t])=>e.jsxs("div",{className:"col-12 col-md-6 col-lg-4 col-xl-3 mb-3",children:[e.jsx("div",{className:"mb-2",children:e.jsx("h6",{className:"fw-bold text-primary mb-2",style:{fontSize:"0.95rem"},children:s})}),e.jsx("div",{className:"row g-2",children:t.map(s=>e.jsx("div",{className:"col-4 col-md-3 col-lg-2 col-xl-2",children:e.jsxs("div",{className:"card h-100 border-0",style:{backgroundColor:"#f8f9fa",aspectRatio:"1",minHeight:"220px"},children:[e.jsxs("div",{className:"position-relative flex-grow-1 d-flex align-items-center justify-content-center p-2",style:{cursor:"pointer"},onMouseEnter:()=>L(s.id),onMouseLeave:()=>L(null),children:[e.jsx("img",{src:cs(s),alt:s.type,style:{width:"100%",height:"120px",objectFit:"contain",backgroundColor:"#ffffff",borderRadius:"4px"},onError:rs}),e.jsxs("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center",style:{backgroundColor:"rgba(0, 0, 0, 0.6)",color:"#fff",opacity:M===s.id?1:0,transition:"opacity 0.3s ease",fontSize:"0.75rem",fontWeight:"500",borderRadius:"8px"},children:[e.jsxs(g,{color:"light",size:"sm",onClick:e=>{e.stopPropagation(),xs(s)},style:{fontSize:"0.75rem"},children:[e.jsx("i",{className:"bi bi-pencil"})," ",a("types.meta.editType","Edit Type")]}),e.jsx(g,{color:"danger",size:"sm",className:"ms-2",onClick:e=>{e.stopPropagation(),is({open:!0,typeName:s.type}),ns("")},style:{fontSize:"0.75rem"},children:e.jsx("i",{className:"bi bi-trash"})})]})]}),e.jsxs("div",{className:"px-2 pt-2",children:[e.jsx("div",{className:"small text-muted",style:{minHeight:"2.5em"},children:s.longDescription||a("types.meta.descriptionPlaceholder","Add a description for this type")}),e.jsx("div",{className:"d-flex justify-content-end align-items-center mt-2",children:e.jsx(w,{id:`type-${s.id}`,checked:q.includes(s.id),onChange:e=>hs(s.id,e.target.checked),style:{transform:"scale(1.2)"}})})]})]})},s.id))})]},s))})]}):e.jsxs(T,{hover:!0,responsive:!0,children:[e.jsx(z,{children:e.jsxs(I,{children:[e.jsx(B,{children:e.jsx(w,{id:"selectAllTable",checked:q.length===ms.length&&ms.length>0,onChange:e=>us(e.target.checked)})}),e.jsx(B,{children:"Image"}),e.jsx(B,{children:"Type"}),e.jsx(B,{children:"Description"}),e.jsx(B,{children:"Actions"})]})}),e.jsx(D,{children:ms.map(s=>e.jsxs(I,{children:[e.jsx(P,{children:e.jsx(w,{id:`table-type-${s.id}`,checked:q.includes(s.id),onChange:e=>hs(s.id,e.target.checked)})}),e.jsx(P,{children:e.jsx("img",{src:cs(s),alt:s.type,style:{width:"40px",height:"40px",objectFit:"contain",backgroundColor:"#f8f9fa",borderRadius:"4px"},onError:rs})}),e.jsx(P,{children:e.jsx(V,{color:"secondary",children:s.type})}),e.jsx(P,{children:s.description||"No description"}),e.jsx(P,{children:e.jsx(g,{color:"primary",size:"sm",onClick:()=>xs(s),children:e.jsx("i",{className:"bi bi-pencil"})})})]},s.id))})]})]})]}),e.jsx("style",{children:"\n        .no-gradient-modal .modal-header {\n          background: #fff !important;\n          border-bottom: 1px solid #dee2e6 !important;\n          color: #212529 !important;\n        }\n        .no-gradient-modal .modal-title {\n          color: #212529 !important;\n        }\n      "}),e.jsxs(O,{visible:ye,onClose:()=>{je(!1),be(null),we(null)},size:"xl",className:"no-gradient-modal",children:[e.jsx(Z,{title:"Edit Type"}),e.jsx(R,{children:fe&&e.jsxs(f,{children:[e.jsxs(b,{md:6,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("strong",{children:[a("types.meta.type","Type"),":"]})," ",fe.type]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{children:[a("types.meta.currentImage","Current Image"),":"]}),e.jsx("div",{className:"d-flex justify-content-center p-3 border rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsx("img",{src:cs(fe),alt:fe.type,style:{maxWidth:"200px",maxHeight:"200px",objectFit:"contain",border:"1px solid #dee2e6",borderRadius:"4px"},onError:rs})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs(v,{htmlFor:"imageUpload",children:[a("types.meta.uploadNewImage","Upload New Image"),":"]}),e.jsx("input",{type:"file",id:"imageUpload",className:"form-control",accept:"image/*",onChange:js}),e.jsx("div",{className:"mt-2 text-muted",children:Ce?e.jsxs(e.Fragment,{children:[a("types.ui.selected","Selected"),": ",Ce.name]}):fe.image?e.jsxs(e.Fragment,{children:["Current: ",fe.image]}):e.jsx(e.Fragment,{children:a("types.ui.noImage","No image uploaded")})})]}),Ce&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("h6",{children:[a("types.meta.newImagePreview","New Image Preview"),":"]}),e.jsx("div",{className:"d-flex justify-content-center p-3 border rounded",style:{backgroundColor:"#f8f9fa"},children:e.jsx("img",{src:URL.createObjectURL(Ce),alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",objectFit:"contain",border:"1px solid #dee2e6",borderRadius:"4px"}})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx(v,{children:a("types.meta.descriptionLabel","Type Description")}),e.jsx(S,{rows:3,placeholder:a("types.meta.descriptionPlaceholder","Add a description for this type"),value:Is[fe.type]??fe.longDescription??"",onChange:e=>Ps(s=>({...s,[fe.type]:e.target.value}))}),e.jsx("div",{className:"mt-2 d-flex gap-2",children:e.jsx(g,{size:"sm",color:"primary",disabled:Ts===fe.type,onClick:()=>Ds(fe.type),children:Ts===fe.type?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),a("common.saving","Saving...")]}):a("common.save","Save")})})]})]}),e.jsx(b,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"fw-bold text-primary",children:a("types.assign.header","Assign Catalog Items to This Type")}),e.jsx("p",{className:"text-muted small mb-3",children:a("types.assign.help",'Select catalog items from this manufacturer to assign them to the "{{type}}" type.',{type:fe.type})}),e.jsxs(k,{className:"mb-3",size:"sm",children:[e.jsx(F,{children:e.jsx("i",{className:"bi bi-search"})}),e.jsx(N,{placeholder:a("common.searchItems","Search items..."),value:De,onChange:e=>$e(e.target.value)})]}),e.jsx(N,{placeholder:a("types.assign.filterByCurrentType","Filter by current type..."),value:Te,onChange:e=>ze(e.target.value),size:"sm",className:"mb-3"}),Se?.filters?.uniqueTypes?.length&&e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted",children:a("types.assign.filterByType","Filter by type:")}),e.jsx("div",{className:"d-flex flex-wrap gap-1 mt-1",children:Se.filters.uniqueTypes.filter(e=>e&&e!==fe?.type).slice(0,40).map((s,t)=>e.jsx("span",{className:"badge bg-secondary",style:{cursor:"pointer"},onClick:()=>ze(s),children:s},t))})]}),e.jsx("div",{className:"mb-3 p-2 bg-light rounded",children:e.jsx(w,{id:"selectAllModal",label:`${a("common.selectAll","Select All")} (${Ss.length} ${a("common.items","items")})`,checked:Ie.length===Ss.length&&Ss.length>0,onChange:e=>ks(e.target.checked),className:"fw-semibold"})}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:Fe?e.jsxs("div",{className:"text-center py-3",children:[e.jsx(U,{size:"sm",className:"me-2"}),a("types.assign.loading","Loading catalog items...")]}):De||Te?0===Ss.length?e.jsx("div",{className:"text-center py-3 text-muted",children:Se?.catalogData?.length>0?De||Te?a("types.assign.noMatch","No items match your search criteria"):a("types.assign.noneAvailable",'No items available to assign (all items already belong to "{{type}}" or other types)',{type:fe?.type}):a("types.assign.noCatalog","No catalog items found for this manufacturer")}):e.jsxs(e.Fragment,{children:[Ss.map(s=>e.jsx("div",{className:"border rounded p-2 mb-2 bg-white",role:"button",tabIndex:0,style:{cursor:"pointer"},onClick:()=>Cs(s.id,!Ie.includes(s.id)),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),Cs(s.id,!Ie.includes(s.id)))},children:e.jsx(w,{id:`modal-item-${s.id}`,checked:Ie.includes(s.id),onChange:e=>Cs(s.id,e.target.checked),onClick:e=>e.stopPropagation(),label:e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.description}),e.jsxs("div",{className:"text-muted small",children:[a("types.assign.currentType","Current Type"),": ",s.type||a("common.none","None")," | ",a("common.style","Style"),": ",s.style||a("common.none","None")]})]})})},s.id)),Re&&(De||Te)&&e.jsx("div",{className:"text-center py-2",children:e.jsx(g,{size:"sm",color:"light",disabled:Ue,onClick:ys,children:Ue?a("common.loading","Loading…"):a("common.loadMore","Load more")})})]}):e.jsx("div",{className:"text-center py-3 text-muted",children:a("types.assign.startHint","Type a search term or click a type badge to load items.")})}),Ie.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx(g,{color:"success",size:"sm",onClick:ws,disabled:Fe,className:"w-100",children:a("types.assign.assignCTA",'Assign {{count}} item(s) to "{{type}}"',{count:Ie.length,type:fe.type})})})]})})]})}),Ae&&e.jsx(y,{color:"success",className:"mb-3",children:a("types.assign.assignedSuccess","Successfully assigned {{count}} items to {{type}}",{count:Ae.count,type:Ae.type})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>{je(!1),be(null),we(null),Pe([]),$e(""),ze("")},children:a("common.cancel","Cancel")}),e.jsx(g,{color:"primary",onClick:fs,disabled:!Ce||ve,children:ve?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),a("common.uploading","Uploading...")]}):a("types.assign.uploadImage","Upload Image")})]})]}),e.jsxs(O,{visible:as.open,onClose:()=>is({open:!1,typeName:""}),className:"no-gradient-modal",children:[e.jsx(Z,{title:a("types.delete.header","Delete Type")}),e.jsxs(R,{children:[e.jsxs("p",{children:[a("types.delete.confirm","Delete type")," ",e.jsx("strong",{children:as.typeName}),"?"]}),e.jsx(v,{children:a("types.delete.reassign","Reassign items to (leave empty to clear)")}),e.jsx(N,{value:ls,onChange:e=>ns(e.target.value),placeholder:a("types.delete.reassignPh","New type name or blank")})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>is({open:!1,typeName:""}),children:a("common.cancel","Cancel")}),e.jsx(g,{color:"danger",onClick:async()=>{try{await o.delete(`/api/manufacturers/${s.id}/type/${encodeURIComponent(as.typeName)}`,{data:{reassignTo:ls},headers:de()}),await os(),await ds()}catch(e){}finally{is({open:!1,typeName:""}),ns("")}},children:a("common.delete","Delete")})]})]}),e.jsxs(O,{visible:G,onClose:()=>Q(!1),className:"no-gradient-modal",children:[e.jsx(Z,{title:a("types.create.header","Create New Type")}),e.jsxs(R,{children:[ee&&e.jsx(y,{color:"danger",dismissible:!0,onClose:()=>se(null),children:ee}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:a("types.create.typeName","Type Name")}),e.jsx(N,{value:te.typeName,onChange:e=>ae(s=>({...s,typeName:e.target.value})),placeholder:a("types.create.typeNamePh","e.g., Base Drawer Cabinet")})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:a("types.create.description","Description")}),e.jsx(S,{rows:3,value:te.longDescription,onChange:e=>ae(s=>({...s,longDescription:e.target.value})),placeholder:a("types.meta.descriptionPlaceholder","Add a description for this type")})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:a("types.create.image","Image (optional)")}),e.jsx("input",{type:"file",accept:"image/*",className:"form-control",onChange:e=>ae(s=>({...s,imageFile:e.target.files?.[0]||null}))}),te.imageFile&&e.jsxs("div",{className:"small text-muted mt-1",children:[a("types.ui.selected","Selected"),": ",te.imageFile.name]})]}),e.jsx("div",{className:"alert alert-info small",children:a("types.create.note","Note: If this manufacturer has no catalog items yet, you will need to upload a catalog before creating type metadata.")})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>Q(!1),disabled:J,children:a("common.cancel","Cancel")}),e.jsx(g,{color:"primary",disabled:J||!te.typeName.trim(),onClick:async()=>{if(s?.id){X(!0),se(null);try{const e=await o.post("/api/manufacturers/type/update-meta",{manufacturerId:s.id,type:te.typeName.trim(),longDescription:te.longDescription||""},{headers:de()});if(!e.data?.success)throw new Error(e.data?.message||"Failed to save type metadata");if(te.imageFile){const e=new FormData;e.append("typeImage",te.imageFile),e.append("type",te.typeName.trim()),e.append("manufacturerId",s.id),e.append("longDescription",te.longDescription||""),await o.post("/api/manufacturers/type/create",e,{headers:{"Content-Type":"multipart/form-data",...de()}})}await os(),Q(!1)}catch(e){se(e?.response?.data?.message||e?.message||"Failed to create type")}finally{X(!1)}}},children:J?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),a("common.saving","Saving...")]}):a("types.create.createCta","Create Type")})]})]}),e.jsxs(O,{visible:qe,onClose:()=>_e(!1),size:"lg",className:"no-gradient-modal",children:[e.jsx(Z,{title:`Bulk Edit ${q.length} Types`}),e.jsx(R,{children:e.jsxs("div",{children:[e.jsxs("p",{children:["Edit the following fields for the selected ",q.length," types. Leave fields empty to keep existing values."]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx(v,{children:"Type"}),e.jsx(N,{type:"text",value:Ye.type,onChange:e=>Ke({...Ye,type:e.target.value}),placeholder:"Leave empty to keep existing"})]}),e.jsxs("div",{className:"col-12",children:[e.jsx(v,{children:"Description"}),e.jsx(S,{value:Ye.description,onChange:e=>Ke({...Ye,description:e.target.value}),placeholder:"Leave empty to keep existing",rows:3})]})]}),e.jsx("div",{className:"mt-3 p-3 bg-light rounded",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Note:"})," Only the fields you fill will be updated. Empty fields will preserve the existing values for each item."]})})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>_e(!1),disabled:Ge,children:"Cancel"}),e.jsx(g,{color:"primary",onClick:bs,disabled:Ge,children:Ge?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),"Updating ",q.length," Types..."]}):`Update ${q.length} Types`})]})]}),e.jsxs(O,{visible:Ze,onClose:()=>Je(!1),className:"no-gradient-modal",children:[e.jsx(Z,{title:"Rename Type Globally"}),e.jsx(R,{children:e.jsxs("div",{children:[e.jsx("p",{children:"Rename the type for all items of this manufacturer. This will affect all catalog items currently using this type."}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:"Current Type Name"}),e.jsx(N,{type:"text",value:Xe.oldTypeName,disabled:!0,className:"bg-light"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(v,{children:"New Type Name"}),e.jsx(N,{type:"text",value:Xe.newTypeName,onChange:e=>es({...Xe,newTypeName:e.target.value}),placeholder:"Enter new type name"})]}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"Warning:"})," This will rename the type globally for all items in this manufacturer's catalog."]})]})}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>Je(!1),disabled:ss,children:"Cancel"}),e.jsx(g,{color:"primary",onClick:vs,disabled:ss||!Xe.newTypeName.trim(),children:ss?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),"Renaming..."]}):"Rename Type"})]})]}),e.jsxs(O,{visible:me,onClose:()=>{pe(!1),ue("")},className:"no-gradient-modal",children:[e.jsx(Z,{title:"Change Type Category"}),e.jsxs(R,{children:[e.jsxs("p",{children:["Change the type category for ",q.length," selected item(s)."]}),e.jsx(v,{children:"New Type Category"}),e.jsx(N,{placeholder:"Enter new type category...",value:he,onChange:e=>ue(e.target.value),list:"existingTypesList"}),e.jsx("datalist",{id:"existingTypesList",children:Ms.map(s=>e.jsx("option",{value:s},s))}),e.jsx("small",{className:"text-muted",children:"You can enter a new type category or select from existing ones."})]}),e.jsxs(W,{children:[e.jsx(g,{color:"secondary",onClick:()=>{pe(!1),ue("")},disabled:ge,children:"Cancel"}),e.jsx(g,{color:"primary",onClick:Ns,disabled:ge||!he.trim(),children:ge?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:"sm",className:"me-2"}),"Changing..."]}):"Change Type Category"})]})]})]}):e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx(y,{color:"warning",children:"Please select a manufacturer to view types."})})},pe=({manufacturer:s})=>{const{t:t}=r(),a=s?.catalogFiles||[];return e.jsxs("div",{children:[e.jsx("h5",{children:t("settings.manufacturers.filesHistory.title")}),0===a.length?e.jsx("p",{children:t("settings.manufacturers.filesHistory.empty")}):e.jsxs(T,{hover:!0,responsive:!0,children:[e.jsx(z,{children:e.jsxs(I,{children:[e.jsx(B,{children:t("settings.manufacturers.filesHistory.table.index")}),e.jsx(B,{children:t("settings.manufacturers.filesHistory.table.originalName")}),e.jsx(B,{children:t("settings.manufacturers.filesHistory.table.filename")}),e.jsx(B,{children:t("settings.manufacturers.filesHistory.table.sizeKb")}),e.jsx(B,{children:t("settings.manufacturers.filesHistory.table.uploadedOn")}),e.jsx(B,{children:t("settings.manufacturers.filesHistory.table.download")})]})}),e.jsx(D,{children:a.map((s,a)=>e.jsxs(I,{children:[e.jsx(P,{children:a+1}),e.jsx(P,{children:s.original_name}),e.jsx(P,{children:s.filename}),e.jsx(P,{children:(s.file_size/1024).toFixed(2)}),e.jsx(P,{children:new Date(s.createdAt).toLocaleString()}),e.jsx(P,{children:e.jsx("a",{href:`https://app.nj.contractors/uploads/manufacturer_catalogs/${s.filename}`,target:"_blank",rel:"noopener noreferrer",children:t("settings.manufacturers.filesHistory.table.download")})})]},s.id))})]})]})},he=()=>{const{id:s}=i(),a=d(s),c=n(),[o,p]=t.useState(0),h=l(e=>e.manufacturers.selected),{t:u}=r();return t.useEffect(()=>{a&&c(m({id:a,includeCatalog:!1}))},[a,c]),e.jsxs("div",{className:"",children:[e.jsxs(q,{variant:"tabs",role:"tablist",className:"border-bottom-0 mb-0",children:[e.jsx(_,{children:e.jsx(Y,{style:{cursor:"pointer",padding:"12px 20px",fontSize:"0.95rem",fontWeight:"500"},active:0===o,onClick:()=>p(0),className:0===o?"bg-primary text-white border-primary":"text-primary border-light",children:u("settings.manufacturers.tabs.editDetails","Edit Manufacturer Details")})}),e.jsx(_,{children:e.jsx(Y,{style:{cursor:"pointer",padding:"12px 20px",fontSize:"0.95rem",fontWeight:"500"},active:1===o,onClick:()=>p(1),className:1===o?"bg-primary text-white border-primary":"text-primary border-light",children:u("settings.manufacturers.tabs.settings","Settings")})}),e.jsx(_,{children:e.jsx(Y,{style:{cursor:"pointer",padding:"12px 20px",fontSize:"0.95rem",fontWeight:"500"},active:2===o,onClick:()=>p(2),className:2===o?"bg-primary text-white border-primary":"text-primary border-light",children:u("settings.manufacturers.tabs.catalogMapping","Catalog Mapping")})}),e.jsx(_,{children:e.jsx(Y,{style:{cursor:"pointer",padding:"12px 20px",fontSize:"0.95rem",fontWeight:"500"},active:3===o,onClick:()=>p(3),className:3===o?"bg-primary text-white border-primary":"text-primary border-light",children:u("settings.manufacturers.tabs.stylePictures","Style Pictures")})}),e.jsx(_,{children:e.jsx(Y,{style:{cursor:"pointer",padding:"12px 20px",fontSize:"0.95rem",fontWeight:"500"},active:4===o,onClick:()=>p(4),className:4===o?"bg-primary text-white border-primary":"text-primary border-light",children:u("settings.manufacturers.tabs.typePictures","Type Pictures")})}),e.jsx(_,{children:e.jsx(Y,{style:{cursor:"pointer",padding:"12px 20px",fontSize:"0.95rem",fontWeight:"500"},active:5===o,onClick:()=>p(5),className:5===o?"bg-primary text-white border-primary":"text-primary border-light",children:u("settings.manufacturers.tabs.filesHistory","Files & History")})})]}),e.jsxs(K,{className:"mt-4",children:[e.jsx(G,{visible:0===o,children:e.jsx(ae,{manufacturer:h,id:a})}),e.jsx(G,{visible:1===o,children:e.jsx(le,{manufacturer:h})}),e.jsx(G,{visible:2===o,children:e.jsx(re,{manufacturer:h,id:a})}),e.jsx(G,{visible:3===o,children:e.jsx(oe,{manufacturer:h})}),e.jsx(G,{visible:4===o,children:e.jsx(me,{manufacturer:h})}),e.jsx(G,{visible:5===o,children:e.jsx(pe,{manufacturer:h})})]})]})};export{he as default};
