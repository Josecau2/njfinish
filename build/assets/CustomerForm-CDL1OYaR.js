import{j as e}from"./date-vendor-DfW9khhA.js";import{u as s,h as o,r}from"./react-vendor-Dhx0OYb2.js";import{u as a,a as t}from"./redux-vendor-B0DAdCYB.js";import{d as l,u as i,k as c,o as m,p as n}from"./index-CRxBN8Fj.js";import{h as d,R as u,S as h,b as x,c as j,e as p,r as f,d as v,a as b,a3 as y,a4 as g,T as C,U as N,V as S,w as F,a5 as k,C as T}from"./ui-vendor-pFEG3kEv.js";import{w}from"./withContractorScope-ddaNi-VC.js";import{S as z}from"./utils-vendor-Nl-sF5xe.js";import{c as D}from"./cil-arrow-left-D66Kb3Zq.js";import{c as O,a as P}from"./DefaultLayout-CNvO87EM.js";import{c as I}from"./cil-envelope-closed-DSbcONbs.js";import{c as R}from"./cil-phone-4mwkG2LD.js";import{c as E}from"./cil-save-CHBg7z_U.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";const G=w(({isContractor:w,contractorGroupId:G,contractorModules:q,contractorGroupName:L})=>{const W=a(),A=s(),{id:B}=o(),M=l(B),U=Boolean(M),{t:V}=i(),{loading:X,error:$}=t(e=>e.customers),_=t(e=>e.customers.list),[H,J]=r.useState({name:"",email:"",homePhone:"",mobile:"",address:"",aptOrSuite:"",city:"",state:"",zipCode:"",companyName:"",customerType:"",leadSource:"",defaultDiscount:0,note:""}),[K,Q]=r.useState({});r.useEffect(()=>{if(U&&_.length>0){const e=_.find(e=>e.id===parseInt(M));e?J({name:e.name||"",email:e.email||"",homePhone:e.homePhone||"",mobile:e.mobile||"",address:e.address||"",aptOrSuite:e.aptOrSuite||"",city:e.city||"",state:e.state||"",zipCode:e.zipCode||"",companyName:e.companyName||"",customerType:e.customerType||"",leadSource:e.leadSource||"",defaultDiscount:e.defaultDiscount||0,note:e.note||""}):_.length>0&&(z.fire(V("common.error"),V("customers.form.alerts.notFound"),"error"),A("/customers"))}},[U,M,_,A]),r.useEffect(()=>{if(U&&0===_.length){W(c({page:1,limit:1e3,groupId:w?G:null}))}},[U,_.length,W,w,G]);const Y=e=>{const{name:s,value:o}=e.target;J(e=>({...e,[s]:o})),K[s]&&Q(e=>({...e,[s]:""}))},Z=()=>{A("/customers")};return e.jsx(d,{fluid:!0,children:e.jsx(u,{children:e.jsx(h,{xs:12,children:e.jsxs(x,{children:[e.jsxs(j,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:V(U?"customers.form.titles.edit":"customers.form.titles.add")}),w&&e.jsx("p",{className:"text-muted mb-0",children:L})]}),e.jsxs(p,{color:"light",onClick:Z,className:"d-flex align-items-center gap-2",children:[e.jsx(f,{icon:D,size:"sm"}),V("customers.form.actions.backToCustomers")]})]}),e.jsxs(v,{children:[$&&e.jsx(b,{color:"danger",className:"mb-3",children:$}),e.jsxs(y,{onSubmit:async e=>{e.preventDefault();const s=(()=>{const e={};return H.name.trim()||(e.name=V("customers.form.validation.nameRequired")),H.email&&!/\S+@\S+\.\S+/.test(H.email)&&(e.email=V("customers.form.validation.invalidEmail")),H.mobile.trim()||H.homePhone.trim()||(e.phone=V("customers.form.validation.phoneAtLeastOne")),e})();if(Object.keys(s).length>0)Q(s);else try{U?(await W(m({id:parseInt(M),customerData:H})).unwrap(),z.fire(V("common.success"),V("customers.form.alerts.updatedText"),"success")):(await W(n(H)).unwrap(),z.fire(V("common.success"),V("customers.form.alerts.createdText"),"success")),A("/customers")}catch(o){z.fire(V("common.error"),o.message||V("customers.form.alerts.saveFailed"),"error")}},children:[e.jsxs(u,{children:[e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(g,{htmlFor:"name",children:[V("customers.form.labels.fullName")," *"]}),e.jsxs(C,{children:[e.jsx(N,{children:e.jsx(f,{icon:O})}),e.jsx(S,{type:"text",id:"name",name:"name",value:H.name,onChange:Y,invalid:!!K.name,required:!0})]}),K.name&&e.jsx("div",{className:"invalid-feedback d-block",children:K.name})]})}),e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"email",children:V("customers.form.labels.email")}),e.jsxs(C,{children:[e.jsx(N,{children:e.jsx(f,{icon:I})}),e.jsx(S,{type:"email",id:"email",name:"email",value:H.email,onChange:Y,invalid:!!K.email})]}),K.email&&e.jsx("div",{className:"invalid-feedback d-block",children:K.email})]})})]}),e.jsxs(u,{children:[e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"mobile",children:V("customers.form.labels.mobile")}),e.jsxs(C,{children:[e.jsx(N,{children:e.jsx(f,{icon:R})}),e.jsx(S,{type:"tel",id:"mobile",name:"mobile",value:H.mobile,onChange:Y,invalid:!!K.phone})]})]})}),e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"homePhone",children:V("customers.form.labels.homePhone")}),e.jsxs(C,{children:[e.jsx(N,{children:e.jsx(f,{icon:R})}),e.jsx(S,{type:"tel",id:"homePhone",name:"homePhone",value:H.homePhone,onChange:Y,invalid:!!K.phone})]}),K.phone&&e.jsx("div",{className:"invalid-feedback d-block",children:K.phone})]})})]}),e.jsx(u,{children:e.jsx(h,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"address",children:V("customers.form.labels.address")}),e.jsxs(C,{children:[e.jsx(N,{children:e.jsx(f,{icon:P})}),e.jsx(S,{type:"text",id:"address",name:"address",value:H.address,onChange:Y})]})]})})}),e.jsxs(u,{children:[e.jsx(h,{md:3,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"aptOrSuite",children:V("customers.form.labels.aptSuite")}),e.jsx(S,{type:"text",id:"aptOrSuite",name:"aptOrSuite",value:H.aptOrSuite,onChange:Y})]})}),e.jsx(h,{md:3,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"city",children:V("customers.form.labels.city")}),e.jsx(S,{type:"text",id:"city",name:"city",value:H.city,onChange:Y})]})}),e.jsx(h,{md:3,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"state",children:V("customers.form.labels.state")}),e.jsx(S,{type:"text",id:"state",name:"state",value:H.state,onChange:Y})]})}),e.jsx(h,{md:3,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"zipCode",children:V("customers.form.labels.zipCode")}),e.jsx(S,{type:"text",id:"zipCode",name:"zipCode",value:H.zipCode,onChange:Y})]})})]}),e.jsxs(u,{children:[e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"companyName",children:V("customers.form.labels.companyName")}),e.jsx(S,{type:"text",id:"companyName",name:"companyName",value:H.companyName,onChange:Y})]})}),e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"customerType",children:V("customers.form.labels.customerType")}),e.jsxs(F,{id:"customerType",name:"customerType",value:H.customerType,onChange:Y,children:[e.jsx("option",{value:"",children:V("customers.form.select.selectType")}),e.jsx("option",{value:"Residential",children:V("customers.form.types.residential")}),e.jsx("option",{value:"Commercial",children:V("customers.form.types.commercial")}),e.jsx("option",{value:"Contractor",children:V("customers.form.types.contractor")}),e.jsx("option",{value:"Sub Contractor",children:V("customers.form.types.subContractor")})]})]})})]}),e.jsxs(u,{children:[e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"leadSource",children:V("customers.form.labels.leadSource")}),e.jsxs(F,{id:"leadSource",name:"leadSource",value:H.leadSource,onChange:Y,children:[e.jsx("option",{value:"",children:V("customers.form.select.selectSource")}),e.jsx("option",{value:"Website",children:V("customers.form.sources.website")}),e.jsx("option",{value:"Referral",children:V("customers.form.sources.referral")}),e.jsx("option",{value:"Google",children:V("customers.form.sources.google")}),e.jsx("option",{value:"Facebook",children:V("customers.form.sources.facebook")}),e.jsx("option",{value:"Phone Call",children:V("customers.form.sources.phoneCall")}),e.jsx("option",{value:"Walk-in",children:V("customers.form.sources.walkIn")}),e.jsx("option",{value:"Other",children:V("customers.form.sources.other")})]})]})}),e.jsx(h,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"defaultDiscount",children:V("customers.form.labels.defaultDiscount")}),e.jsx(S,{type:"number",id:"defaultDiscount",name:"defaultDiscount",value:H.defaultDiscount,onChange:Y,min:"0",max:"100"})]})})]}),e.jsx(u,{children:e.jsx(h,{md:12,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(g,{htmlFor:"note",children:V("customers.form.labels.notes")}),e.jsx(k,{id:"note",name:"note",rows:"3",value:H.note,onChange:Y,placeholder:V("customers.form.placeholders.notes")})]})})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(p,{type:"button",color:"light",onClick:Z,disabled:X,children:V("customers.form.actions.cancel")}),e.jsxs(p,{type:"submit",color:"primary",disabled:X,className:"d-flex align-items-center gap-2",children:[X?e.jsx(T,{size:"sm"}):e.jsx(f,{icon:E,size:"sm"}),V(U?"customers.form.actions.update":"customers.form.actions.create")]})]})]})]})]})})})})},"customers");export{G as default};
