import{j as s}from"./date-vendor-DfW9khhA.js";import{u as e,r as t}from"./react-vendor-Dhx0OYb2.js";import{u as c,a as r}from"./redux-vendor-B0DAdCYB.js";import{u as a,a4 as l,g as n,m as o}from"./index-CRxBN8Fj.js";import{h as i,C as d,R as m,S as x,b as j,c as h,r as u,d as p,a as N,T as b,U as v,V as f,Z as g,_ as y,$ as A,a0 as w,a1 as _,a2 as k,v as S,ac as C,e as z}from"./ui-vendor-pFEG3kEv.js";import{P as D}from"./PaginationComponent-D6Bf1rUy.js";import{l as P}from"./DefaultLayout-CNvO87EM.js";import{c as I}from"./cil-search-CDkY_4k-.js";import{c as U}from"./cil-group-DQU-yEHN.js";import{c as L}from"./cil-chart-ul2n6BfS.js";import"./form-vendor-C_vzjFiG.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-CVrEPnlB.js";const M=()=>{const M=c(),$=e(),{t:R}=a(),{list:T,loading:V,error:E,pagination:H}=r(s=>s.contractors),[O,W]=t.useState(""),[Z,q]=t.useState({key:null,direction:"asc"}),[B,F]=t.useState(10),[G,J]=t.useState(1);t.useEffect(()=>{M(l({page:G,limit:B}))},[M,G,B]);const K=s=>{q(e=>{const t=e.key===s&&"asc"===e.direction?"desc":"asc";return{key:s,direction:t}})},Q=s=>{const e=`/${n(6)}/${n(8)}`+o("/admin/contractors/:id",{id:s.id});$(e)},X=t.useMemo(()=>{if(!T||!Array.isArray(T))return[];let s=T.filter(s=>s.name?.toLowerCase().includes(O.toLowerCase()));return Z.key&&s.sort((s,e)=>{let t=s[Z.key],c=e[Z.key];return"user_count"!==Z.key&&"customer_count"!==Z.key&&"proposal_count"!==Z.key||(t=parseInt(t)||0,c=parseInt(c)||0),t<c?"asc"===Z.direction?-1:1:t>c?"asc"===Z.direction?1:-1:0}),s},[T,O,Z]),Y=e=>{if(!e)return null;const t={dashboard:R("contractorsAdmin.modules.dashboard"),proposals:R("contractorsAdmin.modules.proposals"),customers:R("contractorsAdmin.modules.customers"),resources:R("contractorsAdmin.modules.resources")};return Object.entries(e).filter(([s,e])=>!0===e).map(([e])=>s.jsx(S,{color:"info",className:"me-1",children:t[e]||e},e))},ss=s=>{if(!s)return"N/A";try{const e=new Date(s);return isNaN(e.getTime())?"N/A":e.toLocaleDateString()}catch(e){return"N/A"}},es=H?.totalPages||1;return V&&0===T.length?s.jsx(i,{children:s.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:s.jsx(d,{color:"primary"})})}):s.jsx(i,{className:"px-4",children:s.jsx(m,{children:s.jsx(x,{xs:12,children:s.jsxs(j,{className:"mb-4",children:[s.jsx(h,{children:s.jsxs("strong",{children:[s.jsx(u,{icon:P,className:"me-2"}),R("contractorsAdmin.header")]})}),s.jsxs(p,{children:[E&&s.jsx(N,{color:"danger",className:"mb-3",children:E}),s.jsxs(m,{className:"mb-4",children:[s.jsx(x,{md:6,children:s.jsxs(b,{children:[s.jsx(v,{children:s.jsx(u,{icon:I})}),s.jsx(f,{type:"text",placeholder:R("contractorsAdmin.searchPlaceholder"),value:O,onChange:s=>W(s.target.value)})]})}),s.jsx(x,{md:6,className:"d-flex justify-content-end align-items-center",children:s.jsx("div",{className:"text-muted",children:s.jsx("small",{children:R("contractorsAdmin.showing",{count:X?.length||0,total:H?.total||0})})})})]}),s.jsxs(m,{className:"mb-4",children:[s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-info py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:R("contractorsAdmin.stats.totalContractors")}),s.jsx("div",{className:"fs-5 fw-semibold",children:H?.total||0})]})}),s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-success py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:R("contractorsAdmin.stats.totalUsers")}),s.jsx("div",{className:"fs-5 fw-semibold",children:(T||[]).reduce((s,e)=>s+(parseInt(e.user_count)||0),0)})]})}),s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-warning py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:R("contractorsAdmin.stats.totalCustomers")}),s.jsx("div",{className:"fs-5 fw-semibold",children:(T||[]).reduce((s,e)=>s+(parseInt(e.customer_count)||0),0)})]})}),s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-danger py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:R("contractorsAdmin.stats.totalProposals")}),s.jsx("div",{className:"fs-5 fw-semibold",children:(T||[]).reduce((s,e)=>s+(parseInt(e.proposal_count)||0),0)})]})})]}),s.jsx("div",{className:"table-responsive d-none d-md-block",children:s.jsxs(g,{hover:!0,striped:!0,children:[s.jsx(y,{children:s.jsxs(A,{children:[s.jsxs(w,{scope:"col",className:"cursor-pointer",onClick:()=>K("name"),children:[R("contractorsAdmin.table.contractorName"),"name"===Z.key&&s.jsx(u,{icon:"asc"===Z.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsxs(w,{scope:"col",className:"cursor-pointer text-center",onClick:()=>K("user_count"),children:[R("contractorsAdmin.table.users"),"user_count"===Z.key&&s.jsx(u,{icon:"asc"===Z.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsxs(w,{scope:"col",className:"cursor-pointer text-center",onClick:()=>K("customer_count"),children:[R("contractorsAdmin.table.customers"),"customer_count"===Z.key&&s.jsx(u,{icon:"asc"===Z.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsxs(w,{scope:"col",className:"cursor-pointer text-center",onClick:()=>K("proposal_count"),children:[R("contractorsAdmin.table.proposals"),"proposal_count"===Z.key&&s.jsx(u,{icon:"asc"===Z.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsx(w,{scope:"col",children:R("contractorsAdmin.table.modules")}),s.jsxs(w,{scope:"col",className:"cursor-pointer",onClick:()=>K("created_at"),children:[R("contractorsAdmin.table.created"),"created_at"===Z.key&&s.jsx(u,{icon:"asc"===Z.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsx(w,{scope:"col",className:"text-center",children:R("contractorsAdmin.table.actions")})]})}),s.jsx(_,{children:0===X?.length?s.jsx(A,{children:s.jsxs(k,{colSpan:"7",className:"text-center py-4",children:[s.jsx(u,{icon:I,size:"xl",className:"mb-3 opacity-25"}),s.jsx("p",{className:"text-muted mb-0",children:R("contractorsAdmin.empty.title")}),s.jsx("small",{children:R("contractorsAdmin.empty.tryAdjusting")})]})}):X?.map(e=>s.jsxs(A,{className:"align-middle",children:[s.jsx(k,{children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(u,{icon:U,className:"me-2 text-muted"}),s.jsxs("div",{children:[s.jsx("div",{className:"fw-semibold",children:e.name}),s.jsxs("small",{className:"text-muted",children:["ID: ",e.id]})]})]})}),s.jsx(k,{className:"text-center",children:s.jsx(S,{color:"primary",children:e.user_count||0})}),s.jsx(k,{className:"text-center",children:s.jsx(S,{color:"warning",children:e.customer_count||0})}),s.jsx(k,{className:"text-center",children:s.jsx(S,{color:"success",children:e.proposal_count||0})}),s.jsx(k,{children:s.jsx("div",{className:"d-flex flex-wrap gap-1",children:Y(e.modules)||s.jsx("small",{className:"text-muted",children:R("contractorsAdmin.noModules")})})}),s.jsx(k,{children:s.jsx("small",{className:"text-muted",children:ss(e.created_at)})}),s.jsx(k,{className:"text-center",children:s.jsx(C,{size:"sm",children:s.jsx(z,{color:"outline-primary",size:"sm",onClick:()=>Q(e),title:R("contractorsAdmin.actions.viewDetails"),children:s.jsx(u,{icon:L,size:"sm"})})})})]},e.id))})]})}),s.jsx("div",{className:"d-md-none",children:0===X?.length?s.jsx(j,{children:s.jsxs(p,{className:"text-center py-4",children:[s.jsx(u,{icon:I,size:"xl",className:"mb-3 opacity-25"}),s.jsx("p",{className:"text-muted mb-0",children:R("contractorsAdmin.empty.title")}),s.jsx("small",{children:R("contractorsAdmin.empty.tryAdjusting")})]})}):s.jsx("div",{className:"mobile-contractor-cards",children:X?.map(e=>s.jsx(j,{className:"mb-3 contractor-mobile-card",children:s.jsxs(p,{className:"p-3",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[s.jsxs("div",{className:"d-flex align-items-center flex-grow-1",children:[s.jsx(u,{icon:U,className:"me-2 text-muted",size:"lg"}),s.jsxs("div",{className:"flex-grow-1 min-width-0",children:[s.jsx("div",{className:"fw-semibold text-truncate",title:e.name,children:e.name}),s.jsxs("small",{className:"text-muted",children:["ID: ",e.id]})]})]}),s.jsx(z,{color:"outline-primary",size:"sm",onClick:()=>Q(e),title:"View Details",className:"ms-2 contractor-action-btn",children:s.jsx(u,{icon:L,size:"sm"})})]}),s.jsxs("div",{className:"row g-2 mb-3",children:[s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:R("contractorsAdmin.table.users")}),s.jsx(S,{color:"primary",className:"w-100",children:e.user_count||0})]}),s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:R("contractorsAdmin.table.customers")}),s.jsx(S,{color:"warning",className:"w-100",children:e.customer_count||0})]}),s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:R("contractorsAdmin.table.proposals")}),s.jsx(S,{color:"success",className:"w-100",children:e.proposal_count||0})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"small text-muted mb-1",children:R("contractorsAdmin.table.modules")}),s.jsx("div",{className:"d-flex flex-wrap gap-1",children:Y(e.modules)||s.jsx("small",{className:"text-muted",children:R("contractorsAdmin.noModules")})})]}),s.jsx("div",{className:"text-end",children:s.jsxs("small",{className:"text-muted",children:[R("contractorsAdmin.table.created"),": ",ss(e.created_at)]})})]})},e.id))})}),es>1&&s.jsx("div",{className:"p-3 border-top border-light",children:s.jsx(D,{currentPage:G,totalPages:es,onPageChange:s=>{J(s)},itemsPerPage:B})})]})]})})})})};export{M as default};
