import{j as s}from"./date-vendor-DfW9khhA.js";import{h as e,u as a,r as t}from"./react-vendor-Dhx0OYb2.js";import{d as c,a as r}from"./index-BxG4qwLs.js";import{u as n}from"./redux-vendor-B0DAdCYB.js";import{h as l,C as i,a as o,r as d,e as m,R as x,S as j,v as h,b as u,c as p,d as f,X as y,Y as N,Z as b,_ as g,$ as v,a0 as w,a1 as A,a2 as C}from"./ui-vendor-pFEG3kEv.js";import{c as D}from"./cil-info-CmGCY32x.js";import{c as P}from"./cil-arrow-left-D66Kb3Zq.js";import{c as H}from"./cil-briefcase-Bw71BDXV.js";import{c as _,a as S}from"./DefaultLayout-CDydDzk1.js";import{a as T,c as V}from"./cil-clock-BhwNMOcP.js";import{c as F,a as k,b as I}from"./cil-x-circle-9Y0mC_t9.js";import{c as U}from"./cil-paper-plane-haInf9fd.js";import"./form-vendor-C_vzjFiG.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-CVrEPnlB.js";var z=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='272 434.744 272 209.176 240 209.176 240 434.744 188.118 382.862 165.49 405.489 256 496 346.51 405.489 323.882 382.862 272 434.744' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M400,161.176c0-79.4-64.6-144-144-144s-144,64.6-144,144a96,96,0,0,0,0,192h80v-32H112a64,64,0,0,1,0-128h32v-32a112,112,0,0,1,224,0v32h32a64,64,0,0,1,0,128H320v32h80a96,96,0,0,0,0-192Z' class='ci-primary'/>"],Z=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M420,128.1V16H92V128.1A80.1,80.1,0,0,0,16,208V400H84V368H48V208a48.054,48.054,0,0,1,48-48H416a48.054,48.054,0,0,1,48,48V368H420v32h76V208A80.1,80.1,0,0,0,420,128.1Zm-32-.1H124V48H388Z' class='ci-primary'/><rect width='32' height='32' x='396' y='200' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M116,264H76v32h40V496H388V296h40V264H116ZM356,464H148V296H356Z' class='ci-primary'/>"];const $=()=>{const{proposalId:$}=e(),G=c($),M=a();n();const[E,L]=t.useState(null),[B,q]=t.useState(!0),[O,R]=t.useState(null),Y={draft:{label:"Draft",color:"secondary",icon:k},sent:{label:"Sent",color:"info",icon:U},pending:{label:"Pending",color:"warning",icon:V},approved:{label:"Approved",color:"success",icon:T},accepted:{label:"Accepted",color:"success",icon:T},rejected:{label:"Rejected",color:"danger",icon:F},expired:{label:"Expired",color:"dark",icon:V},in_progress:{label:"In Progress",color:"info",icon:V},completed:{label:"Completed",color:"success",icon:T}};t.useEffect(()=>{G&&J()},[G]);const J=async()=>{try{if(q(!0),!G)throw new Error("No proposal ID provided");const{data:s}=await r.get(`/api/quotes/proposalByID/${G}`);L(s),R(null)}catch(s){R(s.message)}finally{q(!1)}},Q=s=>Y[s]?.color||"secondary",W=s=>Y[s]?.icon||k,X=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s||0),K=E?(s=>{if(!s||!s.manufacturersData)return{items:[],totalAmount:0,summary:{}};try{const e=JSON.parse(s.manufacturersData);let a=[],t={cabinets:0,assemblyFee:0,modificationsCost:0,styleTotal:0,discountAmount:0,taxAmount:0,grandTotal:0};return e.forEach(s=>{s.items&&(a=a.concat(s.items)),s.summary&&(t.cabinets+=s.summary.cabinets||0,t.assemblyFee+=s.summary.assemblyFee||0,t.modificationsCost+=s.summary.modificationsCost||0,t.styleTotal+=s.summary.styleTotal||0,t.discountAmount+=s.summary.discountAmount||0,t.taxAmount+=s.summary.taxAmount||0,t.grandTotal+=s.summary.grandTotal||0)}),{items:a,totalAmount:t.grandTotal,summary:t}}catch(e){return{items:[],totalAmount:0,summary:{}}}})(E):{items:[],totalAmount:0,summary:{}},ss=s=>{if(!s)return"N/A";try{const e=new Date(s);return isNaN(e.getTime())?"N/A":e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(e){return"N/A"}};return B?s.jsx(l,{className:"py-4",children:s.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:[s.jsx(i,{color:"primary",size:"lg"}),s.jsx("span",{className:"ms-3",children:"Loading proposal details..."})]})}):O?s.jsxs(l,{className:"py-4",children:[s.jsxs(o,{color:"danger",children:[s.jsx(d,{icon:D,className:"me-2"}),O]}),s.jsxs(m,{color:"secondary",onClick:()=>M(-1),children:[s.jsx(d,{icon:P,className:"me-1"}),"Go Back"]})]}):E?s.jsxs(l,{fluid:!0,className:"py-4",children:[s.jsx(x,{className:"mb-4",children:s.jsx(j,{children:s.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(m,{color:"ghost",size:"sm",onClick:()=>M(-1),className:"me-3",children:s.jsx(d,{icon:P})}),s.jsxs("div",{children:[s.jsxs("h3",{className:"mb-1",children:[s.jsx(d,{icon:H,className:"me-2"}),E.title||`Proposal #${E.id}`]}),s.jsxs("div",{className:"d-flex align-items-center gap-3 text-muted",children:[s.jsxs("span",{children:[s.jsx(d,{icon:_,className:"me-1"}),E.customer?.name||"N/A"]}),s.jsxs("span",{children:[s.jsx(d,{icon:S,className:"me-1"}),E.UserGroup?.name||"N/A"]}),s.jsxs(h,{color:Q(E.status),size:"lg",children:[s.jsx(d,{icon:W(E.status),className:"me-1"}),Y[E.status]?.label||E.status||"Draft"]})]})]})]}),s.jsxs("div",{className:"d-flex gap-2",children:[s.jsxs(m,{color:"outline-secondary",size:"sm",onClick:()=>{window.print()},children:[s.jsx(d,{icon:Z,className:"me-1"}),"Print"]}),s.jsxs(m,{color:"outline-primary",size:"sm",onClick:()=>{},children:[s.jsx(d,{icon:z,className:"me-1"}),"Download PDF"]})]})]})})}),s.jsxs(x,{children:[s.jsxs(j,{lg:8,children:[s.jsxs(u,{className:"mb-4",children:[s.jsx(p,{children:s.jsx("strong",{children:"Proposal Overview"})}),s.jsxs(f,{children:[s.jsxs(x,{className:"mb-4",children:[s.jsxs(j,{md:6,children:[s.jsx("h4",{className:"text-success mb-3",children:X(K.totalAmount)}),s.jsxs(y,{flush:!0,children:[s.jsxs(N,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[s.jsx("span",{className:"text-muted",children:"Proposal ID"}),s.jsxs("strong",{children:["#",E.id]})]}),s.jsxs(N,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[s.jsx("span",{className:"text-muted",children:"Customer"}),s.jsx("span",{children:E.customer?.name||"N/A"})]}),s.jsxs(N,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[s.jsx("span",{className:"text-muted",children:"Contractor Group"}),s.jsx("span",{children:E.UserGroup?.name||"N/A"})]})]})]}),s.jsx(j,{md:6,children:s.jsxs(y,{flush:!0,children:[s.jsxs(N,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[s.jsx("span",{className:"text-muted",children:"Created Date"}),s.jsx("span",{children:ss(E.created_at)})]}),s.jsxs(N,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[s.jsx("span",{className:"text-muted",children:"Last Updated"}),s.jsx("span",{children:ss(E.updated_at)})]}),E.sent_at&&s.jsxs(N,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[s.jsx("span",{className:"text-muted",children:"Sent Date"}),s.jsx("span",{className:"text-info",children:ss(E.sent_at)})]}),E.accepted_at&&s.jsxs(N,{className:"d-flex justify-content-between align-items-center border-0 px-0",children:[s.jsx("span",{className:"text-muted",children:"Accepted Date"}),s.jsx("span",{className:"text-success",children:ss(E.accepted_at)})]})]})})]}),E.description&&s.jsxs("div",{className:"mt-4",children:[s.jsx("h6",{className:"text-muted mb-2",children:"Description"}),s.jsx("div",{className:"bg-light p-3 rounded",children:s.jsx("p",{className:"mb-0",children:E.description})})]})]})]}),K.items&&K.items.length>0&&s.jsxs(u,{className:"mb-4",children:[s.jsx(p,{children:s.jsxs("strong",{children:[s.jsx(d,{icon:k,className:"me-2"}),"Proposal Items (",K.items.length,")"]})}),s.jsxs(f,{children:[s.jsx("div",{className:"table-responsive",children:s.jsxs(b,{hover:!0,children:[s.jsx(g,{children:s.jsxs(v,{children:[s.jsx(w,{children:"Item"}),s.jsx(w,{children:"Description"}),s.jsx(w,{className:"text-center",children:"Qty"}),s.jsx(w,{className:"text-end",children:"Unit Price"}),s.jsx(w,{className:"text-end",children:"Total"})]})}),s.jsx(A,{children:K.items.map((e,a)=>s.jsxs(v,{children:[s.jsx(C,{children:s.jsx("strong",{children:e.code||`Item ${a+1}`})}),s.jsx(C,{children:e.description||"N/A"}),s.jsx(C,{className:"text-center",children:e.qty||1}),s.jsx(C,{className:"text-end",children:X(parseFloat(e.price)||0)}),s.jsx(C,{className:"text-end",children:s.jsx("strong",{children:X(parseFloat(e.total)||0)})})]},a))})]})}),s.jsx("div",{className:"border-top pt-3 mt-3",children:s.jsxs(x,{children:[s.jsx(j,{md:6}),s.jsxs(j,{md:6,children:[s.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[s.jsx("span",{children:"Cabinets:"}),s.jsx("span",{children:X(K.summary.cabinets||0)})]}),K.summary.assemblyFee>0&&s.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[s.jsx("span",{children:"Assembly Fee:"}),s.jsx("span",{children:X(K.summary.assemblyFee)})]}),K.summary.modificationsCost>0&&s.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[s.jsx("span",{children:"Modifications:"}),s.jsx("span",{children:X(K.summary.modificationsCost)})]}),K.summary.discountAmount>0&&s.jsxs("div",{className:"d-flex justify-content-between mb-2 text-danger",children:[s.jsx("span",{children:"Discount:"}),s.jsxs("span",{children:["-",X(K.summary.discountAmount)]})]}),K.summary.taxAmount>0&&s.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[s.jsx("span",{children:"Tax:"}),s.jsx("span",{children:X(K.summary.taxAmount)})]}),s.jsxs("div",{className:"d-flex justify-content-between border-top pt-2",children:[s.jsx("strong",{children:"Total:"}),s.jsx("strong",{className:"text-success fs-5",children:X(K.summary.grandTotal||K.totalAmount)})]})]})]})})]})]})]}),s.jsx(j,{lg:4,children:s.jsxs(u,{children:[s.jsx(p,{children:s.jsxs("strong",{children:[s.jsx(d,{icon:I,className:"me-2"}),"Status Timeline"]})}),s.jsx(f,{children:s.jsx("div",{className:"timeline",children:(s=>{const e=[];return e.push({status:"created",label:"Created",date:s.created_at,icon:k,color:"secondary",description:"Proposal was created and added to the system"}),s.sent_at&&e.push({status:"sent",label:"Sent to Customer",date:s.sent_at,icon:U,color:"info",description:"Proposal was sent to the customer for review"}),s.accepted_at&&e.push({status:"accepted",label:"Accepted",date:s.accepted_at,icon:T,color:"success",description:"Proposal was formally accepted"}),s.status&&!["draft","sent","accepted"].includes(s.status)&&e.push({status:s.status,label:Y[s.status]?.label||s.status,date:s.updated_at,icon:W(s.status),color:Q(s.status),description:"rejected"===s.status?"Proposal was rejected":"expired"===s.status?"Proposal has expired":`Proposal status changed to ${s.status}`}),e})(E).map((e,a)=>s.jsxs("div",{className:"d-flex mb-4",children:[s.jsx("div",{className:`timeline-icon bg-${e.color} text-white rounded-circle d-flex align-items-center justify-content-center me-3`,style:{width:"40px",height:"40px",minWidth:"40px"},children:s.jsx(d,{icon:e.icon,size:"sm"})}),s.jsxs("div",{className:"flex-grow-1",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[s.jsx("strong",{children:e.label}),s.jsx("small",{className:"text-muted",children:ss(e.date)})]}),s.jsx("small",{className:"text-muted",children:e.description})]})]},a))})})]})})]})]}):s.jsxs(l,{className:"py-4",children:[s.jsxs(o,{color:"warning",children:[s.jsx(d,{icon:D,className:"me-2"}),"Proposal not found."]}),s.jsxs(m,{color:"secondary",onClick:()=>M(-1),children:[s.jsx(d,{icon:P,className:"me-1"}),"Go Back"]})]})};export{$ as default};
