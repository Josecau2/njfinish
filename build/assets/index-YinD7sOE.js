import{j as e}from"./date-vendor-DfW9khhA.js";import{r as s}from"./react-vendor-Dhx0OYb2.js";import{u as a,a as r}from"./redux-vendor-B0DAdCYB.js";import{u as o,b as i,a as n,Q as l,x as t,R as d}from"./index-CRxBN8Fj.js";import{S as c}from"./utils-vendor-Nl-sF5xe.js";import{b as m,d as p,C as f,c as u,a3 as h,R as x,S as j,a4 as w,V as v,a7 as g,w as y,e as P}from"./ui-vendor-pFEG3kEv.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";const b=()=>{const{t:b}=o(),N=a(),S=JSON.parse(localStorage.getItem("user")),C=S?.userId,F="contractor"===S?.group?.group_type,{selected:R,loading:k}=r(e=>e.users),{list:B,loading:E}=r(e=>e.locations),z=r(e=>e.customization),[L,q]=s.useState({name:"",email:"",password:"",confirmPassword:"",location:""}),[I,O]=s.useState({}),[D,G]=s.useState(!1),H=s.useRef(L),J=k||E;s.useEffect(()=>{(async()=>{if(F)try{const e=(await n.get("/api/me")).data,s={name:e.name||"",email:e.email||"",password:"",confirmPassword:"",location:""};q(s),H.current=s}catch(e){C&&await N(l(C))}else C&&N(l(C)),N(t())})()},[N,C,F]),s.useEffect(()=>{if(!F&&R){const e={name:R.name||"",email:R.email||"",password:"",confirmPassword:"",location:R.location||""};q(e),H.current=e}},[R,F]);const M=e=>{const{name:s,value:a}=e.target;q(e=>({...e,[s]:a}))};return J?e.jsx("div",{className:"profile-container",children:e.jsx(m,{className:"profile-card",children:e.jsx(p,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx(f,{color:"primary",size:"lg"})})})}):e.jsx("div",{className:"profile-container",children:e.jsxs(m,{className:"profile-card",children:[e.jsx(u,{children:e.jsx("h4",{className:"mb-0",children:b("profile.header")})}),e.jsx(p,{children:e.jsxs(h,{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return L.name.trim()||(e.name=b("profile.validation.nameRequired")),L.password!==L.confirmPassword&&(e.confirmPassword=b("profile.validation.passwordMismatch")),F||L.location.trim()||(e.location=b("profile.validation.locationRequired")),O(e),0===Object.keys(e).length})()){G(!0);try{if(F){const e={name:L.name};L.password&&""!==L.password.trim()&&(e.password=L.password);const s=await n.put("/api/me",e);if(200!==s?.data?.status&&200!==s?.status)throw new Error(s?.data?.message||b("profile.updateFailed"));c.fire(b("common.success"),b("profile.updateSuccess"),"success")}else{const e={...L};delete e.confirmPassword;const s=await N(d({id:C,data:e}));if(200!==s?.payload?.status)throw new Error(s?.payload?.message||b("profile.updateFailed"));c.fire(b("common.success"),b("profile.updateSuccess"),"success")}}catch(s){c.fire(b("common.error"),s.message||b("profile.errorGeneric"),"error")}finally{G(!1)}}},className:"profile-form",children:[e.jsxs(x,{className:"gy-4",children:[e.jsxs(j,{xs:12,md:6,children:[e.jsxs(w,{htmlFor:"name",children:[b("profile.fullName"),e.jsx("span",{style:{color:"red",marginLeft:"4px"},children:"*"})]}),e.jsx(v,{id:"name",name:"name",value:L.name,onChange:M,invalid:!!I.name,placeholder:b("profile.enterName")}),e.jsx(g,{invalid:!0,children:I.name})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(w,{htmlFor:"email",children:b("auth.email")}),e.jsx(v,{id:"email",name:"email",value:L.email,disabled:!0,style:{backgroundColor:"#e9ecef",cursor:"not-allowed"}})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(w,{htmlFor:"password",children:b("profile.newPassword")}),e.jsx(v,{id:"password",name:"password",type:"password",value:L.password,onChange:M,placeholder:b("profile.leaveBlank")})]}),e.jsxs(j,{xs:12,md:6,children:[e.jsx(w,{htmlFor:"confirmPassword",children:b("profile.confirmPassword")}),e.jsx(v,{id:"confirmPassword",name:"confirmPassword",type:"password",value:L.confirmPassword,onChange:M,invalid:!!I.confirmPassword,placeholder:b("profile.reenterPassword")}),e.jsx(g,{invalid:!0,children:I.confirmPassword})]}),!F&&e.jsxs(j,{xs:12,md:6,children:[e.jsxs(w,{htmlFor:"location",children:[b("profile.location"),e.jsx("span",{style:{color:"red",marginLeft:"4px"},children:"*"})]}),e.jsxs(y,{id:"location",name:"location",value:L.location,onChange:M,invalid:!!I.location,children:[e.jsxs("option",{value:"",children:["-- ",b("profile.selectLocation")," --"]}),B.map(s=>e.jsx("option",{value:s.id,children:s.locationName},s.id))]}),e.jsx(g,{invalid:!0,children:I.location})]})]}),e.jsx("div",{className:"d-flex justify-content-center justify-content-md-end mt-4",children:e.jsx(P,{type:"submit",className:"px-4",disabled:D,style:{backgroundColor:z?.headerBg||"#321fdb",borderColor:z?.headerBg||"#321fdb",color:i(z?.headerBg||"#321fdb"),border:"none"},children:D?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:"sm",className:"me-2"})," ",b("profile.saving")]}):b("profile.updateProfile")})})]})})]})})};export{b as default};
