import{j as e}from"./date-vendor-DfW9khhA.js";import{h as s,u as t,r as n}from"./react-vendor-Dhx0OYb2.js";import{u as i,d as o,U as a,V as l}from"./index-CRxBN8Fj.js";import{S as r}from"./utils-vendor-Nl-sF5xe.js";import{u as c}from"./index-BmZAsEKv.js";import{f as d,g as m}from"./dateHelpers-CEeK98s8.js";import{u}from"./redux-vendor-B0DAdCYB.js";import{h,b as j,c as x,d as g,a3 as f,R as v,S as p,a4 as b,V as y,a7 as N,w,e as z}from"./ui-vendor-pFEG3kEv.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";const C={locationName:"",address:"",website:"",email:"",phone:"",country:"",timezone:""},R=()=>{const{t:R}=i(),{id:S}=s(),q=o(S),O=t(),[B,T]=n.useState(C),E=n.useRef(C),[k,I]=n.useState({}),[A,J]=n.useState(""),[V,D]=n.useState(!1),F=u(),H=Object.values(c.getAllCountries()),P=B.country&&c.getCountry(B.country)?.timezones||[];n.useEffect(()=>{(async()=>{if(q)try{const e=await F(a(q)).unwrap();T(e),E.current=e}catch(e){r.fire(R("common.error"),R("settings.locations.edit.loadFailedOne"),"error")}})()},[q,F]),n.useEffect(()=>{if(B.timezone){const e=setInterval(()=>{J(d(m(),B.timezone))},1e3);return()=>clearInterval(e)}},[B.timezone]);const U=e=>{const{name:s,value:t}=e.target;if("country"===s){const e=(c.getCountry(t)?.timezones||[])[0]||"";return T(s=>({...s,country:t,timezone:e})),void J(e?d(m(),e):"")}T(e=>({...e,[s]:t}))};return e.jsx(h,{className:"mt-4 mb-4",children:e.jsxs(j,{children:[e.jsx(x,{className:"bg-body border-bottom",children:e.jsx("h5",{className:"mb-2 mt-2",children:R("settings.locations.edit.title")})}),e.jsx(g,{children:e.jsxs(f,{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return B.locationName.trim()||(e.locationName=R("settings.locations.form.validation.locationNameRequired")),B.address.trim()||(e.address=R("settings.locations.form.validation.addressRequired")),B.website.trim()||(e.website=R("settings.locations.form.validation.websiteRequired")),B.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(B.email)||(e.email=R("settings.locations.form.validation.invalidEmail")):e.email=R("settings.locations.form.validation.emailRequired"),B.phone.trim()||(e.phone=R("settings.locations.form.validation.phoneRequired")),B.country||(e.country=R("settings.locations.form.validation.countryRequired")),B.timezone||(e.timezone=R("settings.locations.form.validation.timezoneRequired")),I(e),0===Object.keys(e).length})()){D(!0);try{const e=await F(l({id:q,data:B})).unwrap();200==e?.status&&(r.fire(R("settings.locations.alerts.updatedTitle"),R("settings.locations.alerts.updatedText"),"success"),O("/settings/locations"))}catch(s){r.fire(R("common.error"),s.message||R("settings.locations.alerts.genericError"),"error")}finally{D(!1)}}},children:[e.jsxs(v,{className:"mb-3",children:[e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.locationName")}),e.jsx(y,{name:"locationName",value:B.locationName,onChange:U,invalid:!!k.locationName}),e.jsx(N,{invalid:!0,children:k.locationName})]}),e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.address")}),e.jsx(y,{name:"address",value:B.address,onChange:U,invalid:!!k.address}),e.jsx(N,{invalid:!0,children:k.address})]})]}),e.jsxs(v,{className:"mb-3",children:[e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.website")}),e.jsx(y,{name:"website",value:B.website,onChange:U,invalid:!!k.website}),e.jsx(N,{invalid:!0,children:k.website})]}),e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.email")}),e.jsx(y,{name:"email",value:B.email,onChange:U,invalid:!!k.email}),e.jsx(N,{invalid:!0,children:k.email})]})]}),e.jsxs(v,{className:"mb-3",children:[e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.phone")}),e.jsx(y,{name:"phone",value:B.phone,onChange:U,invalid:!!k.phone}),e.jsx(N,{invalid:!0,children:k.phone})]}),e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.country")}),e.jsxs(w,{name:"country",value:B.country,onChange:U,invalid:!!k.country,children:[e.jsx("option",{value:"",children:R("settings.locations.form.select.country")}),H.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(N,{invalid:!0,children:k.country})]})]}),e.jsxs(v,{className:"mb-3",children:[e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.timezone")}),e.jsxs(w,{name:"timezone",value:B.timezone,onChange:U,invalid:!!k.timezone,children:[e.jsx("option",{value:"",children:R("settings.locations.form.select.timezone")}),P.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(N,{invalid:!0,children:k.timezone})]}),e.jsxs(p,{md:6,children:[e.jsx(b,{children:R("settings.locations.form.labels.currentTime")}),e.jsx(y,{value:A,readOnly:!0,tabIndex:-1,style:{backgroundColor:"#e9ecef",cursor:"not-allowed"}})]})]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"d-flex gap-2 mt-4",children:[e.jsx(z,{type:"submit",color:"success",disabled:V,children:R(V?"settings.locations.edit.updating":"settings.locations.edit.update")}),e.jsx(z,{type:"button",color:"secondary",onClick:()=>{JSON.stringify(B)!==JSON.stringify(E.current)?r.fire({title:R("common.confirm"),text:R("settings.locations.alerts.leaveWarning"),icon:"warning",showCancelButton:!0,confirmButtonText:R("settings.locations.alerts.leaveAnyway"),cancelButtonText:R("settings.locations.alerts.stayOnPage"),confirmButtonColor:"#d33",cancelButtonColor:"#6c757d"}).then(e=>{e.isConfirmed&&O("/settings/locations")}):O("/settings/locations")},children:R("common.cancel")})]})]})})]})})};export{R as default};
