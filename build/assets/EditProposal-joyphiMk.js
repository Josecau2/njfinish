import{j as e,D as s}from"./date-vendor-DfW9khhA.js";import{r as a,R as t,h as r,u as i}from"./react-vendor-Dhx0OYb2.js";import{c as l,a as n,u as o}from"./redux-vendor-B0DAdCYB.js";import{b as c,u as d,E as m,A as u,a as p,d as x,C as h,D as b}from"./index-BxG4qwLs.js";import{C as f}from"./react-select-creatable.esm-UYqWrhwU.js";import{h as y,j as g,F as j}from"./form-vendor-C_vzjFiG.js";import{c as N,a as v,b as S,P as C,E as w,d as M}from"./EmailContractModal-CRIkYvMY.js";import{i as D,l as k,a6 as A,w as F,V as I,m as E,e as U,T as $,r as P,Z as T,_ as V,$ as z,a0 as q,a1 as R,a2 as W,a8 as O,h as B,a3 as L,R as G,S as J,a4 as Q,v as H,o as _,p as Y,s as K,u as X,a9 as Z,N as ee,B as se,E as ae,a as te,j as re,k as ie}from"./ui-vendor-pFEG3kEv.js";import{h as le,b as ne,f as oe,g as ce,e as de}from"./index-DK1ZdOBj.js";import{S as me}from"./utils-vendor-Nl-sF5xe.js";import{i as ue,b as pe,d as xe,h as he}from"./DefaultLayout-CDydDzk1.js";import{P as be}from"./PageHeader-UABCfWk-.js";import{c as fe}from"./cil-trash-CBbKHhHb.js";import{c as ye}from"./cil-home-DjIzczOB.js";import{c as ge,a as je}from"./cil-chevron-right-DSvcss7_.js";import{w as Ne}from"./withContractorScope-bbtugTgT.js";import{c as ve}from"./cil-pencil-m516yCOw.js";import"./icons-vendor-CVrEPnlB.js";import"./editor-vendor-RxX6MBW0.js";import"./ckeditor-BRc8bNm1.js";const Se=l({name:"selectVersionNew",initialState:{data:null},reducers:{setSelectVersionNewEdit(e,s){e.data=s.payload},clearSelectVersionNewEdit(e){e.data=null}}}),{setSelectVersionNewEdit:Ce,clearSelectVersionNewEdit:we}=Se.actions,Me=({visible:s,onClose:a,onSave:t,modificationType:r,setModificationType:i,existingModifications:l,selectedExistingMod:o,setSelectedExistingMod:d,existingModQty:m,setExistingModQty:u,existingModNote:p,setExistingModNote:x,customModName:h,setCustomModName:b,customModQty:f,setCustomModQty:y,customModPrice:g,setCustomModPrice:j,customModTaxable:N,setCustomModTaxable:v,customModNote:S,setCustomModNote:C,validationAttempted:w,catalogData:M,itemModificationID:$})=>{const P=n(e=>e.auth?.user),T=ue(P),V=n(e=>e.customization),z=V?.headerBg||"#007bff",q=c(z);return e.jsxs(D,{visible:s,onClose:a,alignment:"center",size:"lg",children:[e.jsx(be,{title:"Modification"}),e.jsxs(k,{style:{padding:"2rem",borderRadius:"0 0 8px 8px"},children:[e.jsxs("div",{className:"mb-4 d-flex gap-4 align-items-center",children:[e.jsx(A,{type:"radio",label:e.jsx("span",{style:{fontSize:"1.1rem"},children:"Select existing modification"}),name:"modType",value:"existing",checked:"existing"===r,onChange:()=>i("existing"),style:{transform:"scale(1.3)"}}),e.jsx(A,{type:"radio",label:e.jsx("span",{style:{fontSize:"1.1rem"},children:"Add custom modification"}),name:"modType",value:"custom",checked:"custom"===r,onChange:()=>i("custom"),style:{transform:"scale(1.3)"}})]}),"existing"===r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsxs(F,{"aria-label":"Select existing modification",value:o||"",onChange:e=>d(e.target.value),required:!0,invalid:w&&!o,feedbackInvalid:"Modification code is required",children:[e.jsx("option",{value:"",disabled:!0,children:"Select modification"}),Array.isArray(M)&&M.length>0?M.map(s=>e.jsx("option",{value:s.id,children:s.modificationName},s.id)):e.jsx("option",{disabled:!0,children:"No modifications available"})]})}),e.jsx(I,{type:"number",value:m,onChange:e=>{const s=Math.max(1,Number(e.target.value));u(s)},placeholder:"Modification Qty",className:"mb-3",min:1,required:!0}),e.jsx(I,{type:"text",value:p,onChange:e=>x(e.target.value),placeholder:"Note (Optional)"}),e.jsx("div",{className:"text-muted mb-1 p-1",children:"If needed, provide custom instructions for applying the modification"})]}),"custom"===r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:e.jsx(I,{type:"text",value:h,onChange:e=>b(e.target.value),placeholder:"Enter Custom Modification",required:!0,invalid:w&&!h,feedbackInvalid:"Modification code is required"})}),e.jsxs("div",{className:"d-flex align-items-center gap-3 mb-3",children:[e.jsx(I,{type:"number",value:f,onChange:e=>{const s=Math.max(1,Number(e.target.value));y(s)},placeholder:"Qty",min:1,style:{width:"100px"}}),e.jsx(I,{type:"number",value:g,onChange:e=>j(Number(e.target.value)),placeholder:"Price",min:0,className:"flex-grow-1",style:{width:"100px"}}),e.jsx("div",{className:"form-check mt-2 d-flex align-items-center",style:{gap:"0.5rem"},children:e.jsx(A,{checked:N,onChange:e=>{T&&v(e.target.checked)},disabled:!T,style:{transform:"scale(1.4)"},label:e.jsx("span",{style:{fontSize:"1.1rem",marginLeft:"0.5rem"},children:"Taxable"})})})]}),e.jsx(I,{type:"text",value:S,onChange:e=>C(e.target.value),placeholder:"Note (Optional)"}),e.jsx("div",{className:"text-muted mb-5 p-1",children:"If needed, provide custom instructions for applying the modification"})]})]}),e.jsxs(E,{children:[e.jsx(U,{color:"secondary",onClick:a,children:"Cancel"}),e.jsx(U,{style:{backgroundColor:z,color:q,borderColor:z},onClick:t,children:"Save"})]})]})},De=["L","R","-"],ke=["L","R","B","-"],Ae=({catalogData:s,handleCatalogSelect:r,addOnTop:i,setAddOnTop:l,handleCopy:o,groupEnabled:m,setGroupEnabled:u,searchTerm:p,setSearchTerm:x,updateQty:h,handleOpenModificationModal:b,handleDelete:f,updateModification:y,setModificationsMap:g,modificationsMap:j,handleDeleteModification:v,formatPrice:S,selectVersion:C,isAssembled:w,selectedStyleData:M,toggleRowAssembly:D,updateHingeSide:k,updateExposedSide:F,readOnly:E=!1})=>{const{t:U}=d(),O=n(e=>e.customization).headerBg||"#667eea",B=c(O),[L,G]=a.useState(""),[J,Q]=a.useState(!1),H=e=>{switch(e){case"L":return U("common.short.left",{defaultValue:"L"});case"R":return U("common.short.right",{defaultValue:"R"});case"B":return U("common.short.both",{defaultValue:"B"});default:return e}},_=a.useMemo(()=>{const e=Array.isArray(s)?s.filter(e=>Array.isArray(e.styleVariants)&&e.styleVariants.length>0&&e.style===M?.style):[],a=(L||"").toLowerCase().trim();return a?e.filter(e=>e.code&&String(e.code).toLowerCase().includes(a)||e.description&&String(e.description).toLowerCase().includes(a)).slice(0,20):[]},[s,M?.style,L]),Y=e=>{e&&(r({target:{value:`${e.code} -- ${e.description}`}}),G(""),Q(!1))};return e.jsxs("div",{className:"mt-5 mb-5",children:[e.jsxs("div",{className:"d-flex flex-wrap gap-3 align-items-center justify-content-between mb-4 catalog-controls-mobile",children:[!E&&e.jsxs("div",{className:"position-relative flex-grow-1",style:{minWidth:"200px",maxWidth:"600px"},children:[e.jsx($,{children:e.jsx(I,{placeholder:U("proposalUI.enterPartCode"),value:L,onChange:e=>{G(e.target.value),Q(!0)},onFocus:()=>Q(!0),onKeyDown:e=>{"Enter"===e.key&&_[0]&&(e.preventDefault(),Y(_[0]))}})}),J&&_.length>0&&e.jsx("div",{className:"dropdown-menu show w-100",style:{maxHeight:"260px",overflowY:"auto"},children:_.map(s=>e.jsxs("button",{type:"button",className:"dropdown-item text-wrap",onMouseDown:e=>e.preventDefault(),onClick:()=>Y(s),children:[e.jsx("strong",{children:s.code})," â€” ",s.description]},s.id))})]}),e.jsx("div",{className:"d-flex flex-wrap align-items-center gap-3 flex-shrink-0",children:!E&&e.jsxs(e.Fragment,{children:[e.jsx(A,{label:e.jsx("span",{style:{fontSize:"1rem"},children:U("proposalUI.addOnTop")}),checked:i,onChange:e=>l(e.target.checked),style:{transform:"scale(1.1)"}}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(P,{icon:N,style:{cursor:"pointer"},onClick:o}),e.jsx("span",{style:{fontWeight:"bold",fontSize:"1rem"},children:U("proposalUI.copy")})]}),e.jsx(A,{label:e.jsx("span",{style:{fontSize:"1rem"},children:U("proposalUI.group")}),checked:m,onChange:e=>u(e.target.checked),style:{transform:"scale(1.1)"}})]})}),!E&&e.jsx("div",{className:"flex-shrink-0",style:{minWidth:"200px",maxWidth:"240px",width:"100%"},children:e.jsx($,{children:e.jsx(I,{placeholder:U("proposalUI.findInCart"),value:p,onChange:e=>x(e.target.value)})})})]}),e.jsx("div",{className:"table-responsive table-responsive-md",children:e.jsxs(T,{children:[e.jsx(V,{children:e.jsxs(z,{children:[e.jsx(q,{children:U("proposalColumns.no")}),e.jsx(q,{children:U("proposalColumns.qty")}),e.jsx(q,{children:U("proposalColumns.item")}),e.jsx(q,{children:U("proposalColumns.hingeSide")}),e.jsx(q,{children:U("proposalColumns.exposedSide")}),e.jsx(q,{children:U("proposalColumns.price")}),e.jsx(q,{children:U("proposalColumns.assemblyCost")}),e.jsx(q,{children:U("proposalColumns.total")}),e.jsx(q,{children:U("proposals.headers.actions")})]})}),e.jsx(R,{children:C?.items?.map((s,a)=>{const r=!!w,i=Number(s.qty||1),l=(r?Number(s.assemblyFee||0):0)*i,n=Number(s.price||0)*i+l,o=s.unavailable?{color:"#b00020",textDecoration:"line-through"}:void 0;return e.jsxs(t.Fragment,{children:[e.jsxs(z,{className:s.unavailable?"table-danger":"",children:[e.jsx(W,{children:a+1}),e.jsx(W,{children:e.jsx(I,{type:"number",min:"1",value:s.qty,onChange:e=>h(a,parseInt(e.target.value)),style:{width:"70px",textAlign:"center"},disabled:E})}),e.jsx(W,{style:o,children:s.code}),e.jsx(W,{children:r?e.jsx("div",{className:"d-flex gap-1",children:De.map(t=>e.jsx("span",{className:"btn btn-sm "+(s.hingeSide,"btn-light"),style:{...s.hingeSide===t?{background:O,color:B,border:`1px solid ${O}`}:{},...E?{pointerEvents:"none",opacity:.6}:{}},onClick:()=>!E&&k(a,t),children:H(t)},t))}):U("common.na")}),e.jsx(W,{children:r?e.jsx("div",{className:"d-flex gap-1",children:ke.map(t=>e.jsx("span",{className:"btn btn-sm "+(s.exposedSide,"btn-light"),style:{...s.exposedSide===t?{background:O,color:B,border:`1px solid ${O}`}:{},...E?{pointerEvents:"none",opacity:.6}:{}},onClick:()=>!E&&F(a,t),children:H(t)},t))}):U("common.na")}),e.jsx(W,{style:o,children:S(s.unavailable?0:s.price)}),e.jsx(W,{children:r?e.jsx("span",{style:o,children:S(s.unavailable?0:l)}):e.jsx("span",{className:"text-muted",children:S(0)})}),e.jsx(W,{style:o,children:S(s.unavailable?0:n)}),e.jsx(W,{children:e.jsx("div",{className:"d-flex align-items-center",children:!E&&e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:pe,style:{cursor:"pointer",color:"black",marginRight:"16px"},onClick:()=>b(a,s.id)}),e.jsx(P,{icon:fe,style:{cursor:"pointer",color:"red"},onClick:()=>f(a)})]})})})]}),Array.isArray(s.modifications)&&s.modifications.length>0&&e.jsx(z,{className:"table-light",children:e.jsx(W,{colSpan:9,className:"fw-bold text-muted",children:U("proposalDoc.modifications")})}),Array.isArray(s.modifications)&&s.modifications.length>0&&s.modifications.map((s,t)=>e.jsxs(z,{className:"table-secondary",children:[e.jsx(W,{children:"-"}),e.jsx(W,{children:s.qty}),e.jsx(W,{colSpan:3,children:s.name||U("proposalUI.mod.unnamed")}),e.jsx(W,{children:S(s.price||0)}),e.jsx(W,{children:"-"}),e.jsx(W,{children:S((s.price||0)*(s.qty||1))}),e.jsx(W,{children:!E&&e.jsx(P,{icon:fe,style:{cursor:"pointer",color:"red"},onClick:()=>v(a,t)})})]},`mod-${a}-${t}`))]},a)})})]})}),e.jsx("div",{className:"mobile-card-view d-none",children:C?.items?.map((s,a)=>{const r=!!w,i=Number(s.qty||1),l=(r?Number(s.assemblyFee||0):0)*i,n=Number(s.price||0)*i+l,o=s.unavailable?{color:"#b00020",textDecoration:"line-through"}:void 0;return e.jsx(t.Fragment,{children:e.jsxs("div",{className:"item-card-mobile",children:[e.jsxs("div",{className:"item-header",children:[e.jsx("div",{className:"item-number",children:a+1}),!E&&e.jsxs("div",{className:"item-actions",children:[e.jsx(P,{icon:pe,style:{cursor:"pointer",color:"var(--cui-primary)",fontSize:"1.2rem"},onClick:()=>b(a,s.id)}),e.jsx(P,{icon:fe,style:{cursor:"pointer",color:"var(--cui-danger)",fontSize:"1.2rem"},onClick:()=>f(a)})]})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:U("proposalColumns.item")}),e.jsx("span",{className:"item-value item-code",style:o,children:s.code})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:U("proposalColumns.qty")}),e.jsx("input",{type:"number",min:"1",value:s.qty,onChange:e=>h(a,parseInt(e.target.value)),className:"qty-input-mobile",disabled:E})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:U("proposalColumns.price")}),e.jsx("span",{className:"item-value",style:o,children:S(s.unavailable?0:s.price)})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:U("proposalColumns.hingeSide")}),e.jsx("div",{className:"btn-group-mobile",children:De.map(t=>e.jsx("button",{className:"btn "+(s.hingeSide,"btn-outline-secondary"),style:s.hingeSide===t?{background:O,color:B,border:`1px solid ${O}`}:{},onClick:()=>!E&&k(a,t),disabled:E,children:H(t)},t))})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:U("proposalColumns.exposedSide")}),e.jsx("div",{className:"btn-group-mobile",children:ke.map(t=>e.jsx("button",{className:"btn "+(s.exposedSide,"btn-outline-secondary"),style:s.exposedSide===t?{background:O,color:B,border:`1px solid ${O}`}:{},onClick:()=>!E&&F(a,t),disabled:E,children:H(t)},t))})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:U("proposalColumns.assemblyCost")}),e.jsx("span",{className:"item-value",style:o,children:S(s.unavailable?0:l)})]})]}),e.jsx("div",{className:"total-highlight",children:e.jsxs("strong",{style:o,children:[U("proposalColumns.total"),": ",S(s.unavailable?0:n)]})})]})},`mobile-${a}`)})})]})},Fe=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},Ie=({selectVersion:s,selectedVersion:t,formData:r,setFormData:i,setSelectedVersion:l,readOnly:c=!1})=>{const{t:x}=d(),h="https://app.nj.contractors",b=o(),[f,y]=a.useState(null),[g,j]=a.useState([]),[N,S]=a.useState([]),[C,w]=a.useState(!1),[M,D]=a.useState(!1),[k,F]=a.useState(""),[I,E]=a.useState(!1),[U,$]=a.useState(!1),[T,V]=a.useState(""),[z,q]=a.useState(""),[R,W]=a.useState(!0),[B,L]=a.useState([]),[G,J]=a.useState(!1),[Q,H]=a.useState(null),[_,Y]=a.useState("existing"),[K,X]=a.useState(1),[Z,ee]=a.useState(""),[se,ae]=a.useState(""),[te,re]=a.useState(1),[ie,le]=a.useState(""),[ne,oe]=a.useState(""),[ce,de]=a.useState(!0),[me,he]=a.useState(!1),[be,fe]=a.useState(""),[Ne,ve]=a.useState({}),[Se,we]=a.useState(!0),[De,ke]=a.useState(0),[Ie,Ee]=a.useState(1),[Ue,$e]=a.useState(1),[Pe,Te]=a.useState(!1),[Ve,ze]=a.useState(!1),[qe,Re]=a.useState(!1),[We,Oe]=a.useState({styleId:null,stylePrice:null}),[Be,Le]=a.useState(0),[Ge,Je]=a.useState(4),[Qe,He]=a.useState(!1),{taxes:_e,loading:Ye}=n(e=>e.taxes),[Ke,Xe]=a.useState(""),[Ze,es]=a.useState(0),ss=n(e=>e.auth?.user);n(e=>e.customization);const as=ue(ss),ts=c&&!as,rs=a.useMemo(()=>Array.isArray(N)?N.filter(e=>e.selectVersion===s?.versionName):[],[N,s?.versionName]),is=a.useMemo(()=>rs,[rs]),[ls,ns]=a.useState([]),[os,cs]=a.useState(!0),[ds,ms]=a.useState(""),[us,ps]=a.useState("");a.useEffect(()=>{const e=()=>{window.innerWidth<=767?Je(2):window.innerWidth<=992?Je(4):window.innerWidth<=1200?Je(5):Je(6)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{Le(0)},[g]);const xs=()=>Be<g.length-Ge,hs=()=>Be>0,bs=e=>{try{const s=Number((null!=We?.stylePrice?We.stylePrice:f?.price)||0),a=Number(e||0)-s,t=a*Number(Ue||1)*Number(Ie||1),r=is.reduce((e,s)=>e+Number(s.comparisonPriceFallback??s.price??0)*Number(s.qty||1),0),i=B.reduce((e,s)=>e+Number(s.price||0),0),l=js,n=r+(Se?is.reduce((e,s)=>e+Number(s?.comparisonAssemblyUnitFallback??(s?.includeAssemblyFee?s?.assemblyFee??0:0))*Number(s?.qty||1),0):0)+i+l+t,o=n-n*Number(De||0)/100,c=o*Number(gs||0)/100;return o+c}catch(s){return 0}};a.useEffect(()=>{if(r&&Array.isArray(r.manufacturersData)&&r.manufacturersData.length>0){const e=r.manufacturersData,a=s?.versionName?e.findIndex(e=>e.versionName===s.versionName):0,t=((-1!==a?e[a]?.items:e[0]?.items)||[]).map(e=>({...e,selectVersion:e.selectVersion||s?.versionName||"",includeAssemblyFee:void 0===e.includeAssemblyFee||e.includeAssemblyFee,isRowAssembled:void 0===e.isRowAssembled||e.isRowAssembled}));S(t),i(e=>{const a=Array.isArray(e?.manufacturersData)?[...e.manufacturersData]:[],r=s?.versionName?a.findIndex(e=>e.versionName===s.versionName):-1;return-1!==r?a[r]={...a[r],items:t}:a.length>0&&(a[0]={...a[0],items:t}),{...e,manufacturersData:a}}),l&&s&&l({...s,items:t})}else S([])},[]),a.useEffect(()=>{if(r&&Array.isArray(r.manufacturersData)&&r.manufacturersData.length>0){const e=r.manufacturersData.find(e=>e.versionName===s?.versionName);if(e&&Array.isArray(e.customItems)){const s=e.customItems;JSON.stringify(s)===JSON.stringify(B)||L(s)}if(e&&Array.isArray(e.items)){const s=e.items.map(e=>void 0!==e.comparisonPriceFallback&&void 0!==e.comparisonAssemblyUnitFallback?e:{...e,comparisonPriceFallback:Number(e.price||0),comparisonAssemblyUnitFallback:e?.includeAssemblyFee?Number(e?.assemblyFee||0):0});S(s)}}},[s?.versionName]),n(e=>e.selectVersionNew?.data);const fs=n(e=>e.selectVersionNew?.data?.versionName||null);a.useEffect(()=>{const e=s?.versionName||null;e&&fs!==e&&b(Ce(s))},[s?.versionName]),a.useEffect(()=>{(async()=>{try{const e=await p.get("/api/user/multiplier",{headers:Fe()});e.data&&e.data.multiplier&&Ee(Number(e.data.multiplier))}catch(e){}finally{Te(!0)}})()},[]),a.useEffect(()=>{as||!0===R||W(!0)},[as]),a.useEffect(()=>{as||!0===ce||de(!0)},[as]),a.useEffect(()=>{if(!Pe||!Ve)return;if(0===N.length)return;if(!N.some(e=>{const s=e.appliedMultiplier||e.appliedUserGroupMultiplier||1,a=e.appliedManufacturerMultiplier||1,t=e.originalPrice||(s>0||a>0?Number(e.price)/(a*s):Number(e.price)),r=Number(t)*Number(Ue||1)*Number(Ie||1),i=Math.abs(Number(e.price)-r)>.01,l=Math.abs(s-Number(Ie||1))>.001||Math.abs(a-Number(Ue||1))>.001;return i||l}))return void Re(!0);const e=N.map(e=>{const s=e.appliedMultiplier||e.appliedUserGroupMultiplier||1,a=e.appliedManufacturerMultiplier||1,t=e.originalPrice||(s>0||a>0?Number(e.price)/(a*s):Number(e.price)),r=Number(t)*Number(Ue||1)*Number(Ie||1),i=e?.includeAssemblyFee?Number(e?.assemblyFee||0):0,l=Number(e?.qty||1);return{...e,originalPrice:Number(t),appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(Ie||1),appliedMultiplier:Number(Ie||1),price:r,total:l*r+i*l}});S(e),b(m(e)),i(a=>{const t=Array.isArray(a?.manufacturersData)?[...a.manufacturersData]:[],r=s?.versionName?t.findIndex(e=>e.versionName===s.versionName):-1;return-1!==r&&(t[r]={...t[r],items:e}),{...a,manufacturersData:t}}),l&&s&&l({...s,items:e}),Re(!0)},[Pe,Ve,Ie,Ue,N,b,s?.versionName,l,i]),a.useEffect(()=>{if(!Pe||!Ve)return;if(0===N.length)return;const e=N.map(e=>{const s=e.appliedMultiplier||e.appliedUserGroupMultiplier||1,a=e.appliedManufacturerMultiplier||1,t=Number(e.price)||0,r=null!=e.originalPrice?Number(e.originalPrice):s>0||a>0?t/(a*s):t,i=Number(Ie||1),l=Number(Ue||1);if(Math.abs(s-i)<=.001&&Math.abs(a-l)<=.001)return e;const n=Number(r)*l*i,o=e?.includeAssemblyFee?Number(e?.assemblyFee||0):0,c=Number(e?.qty||1);return{...e,originalPrice:Number(r),appliedManufacturerMultiplier:l,appliedUserGroupMultiplier:i,appliedMultiplier:i,price:n,total:c*n+o*c}});e.some((e,s)=>Math.abs(Number(e.price)-Number(N[s]?.price||0))>.001||Number(e.appliedManufacturerMultiplier||1)!==Number(N[s]?.appliedManufacturerMultiplier||1)||Number(e.appliedUserGroupMultiplier||1)!==Number(N[s]?.appliedUserGroupMultiplier||1))&&(S(e),b(m(e)),i(a=>{const t=Array.isArray(a?.manufacturersData)?[...a.manufacturersData]:[],r=s?.versionName?t.findIndex(e=>e.versionName===s.versionName):-1;return-1!==r&&(t[r]={...t[r],items:e}),{...a,manufacturersData:t}}),l&&s&&l({...s,items:e})),Re(!0)},[Pe,Ve,Ie,Ue,N,b,s?.versionName,l,i]);const ys=_e.find(e=>e.isDefault),gs=parseFloat(ys?.value||"0"),js=rs.reduce((e,s)=>{if(!s.modifications)return e;return e+s.modifications.reduce((e,s)=>e+parseFloat(s.price||0)*parseFloat(s.qty||1),0)},0),Ns=a.useCallback(()=>{try{const e=rs.reduce((e,s)=>e+s.price*s.qty,0),a=B.reduce((e,s)=>e+s.price*Ie,0),t=js,r=Se?rs.reduce((e,s)=>e+(s?.includeAssemblyFee?Number(s?.assemblyFee||0):0)*Number(s?.qty||1),0):0,n=e+r+a+t,o=B?.reduce((e,s)=>e+s.price*Ie,0)+rs.reduce((e,s)=>e+s.price*s.qty,0),c=n*De/100,d=n-c,m=d*gs/100,u=d+m;i(e=>{const a=Array.isArray(e?.manufacturersData)?e.manufacturersData:[],t=a.map(e=>{if(e.versionName===s?.versionName){const a=B.filter(e=>e.selectVersion===s?.versionName),t=rs,i={...e,selectedStyle:s?.selectedStyle,items:t,customItems:a,summary:{cabinets:parseFloat((Number(o)||0).toFixed(2)),assemblyFee:parseFloat((Number(r)||0).toFixed(2)),modificationsCost:parseFloat((Number(js)||0).toFixed(2)),styleTotal:parseFloat((Number(n)||0).toFixed(2)),discountPercent:Number(De)||0,discountAmount:parseFloat((Number(c)||0).toFixed(2)),total:parseFloat((Number(d)||0).toFixed(2)),taxRate:Number(gs)||0,taxAmount:parseFloat((Number(m)||0).toFixed(2)),grandTotal:parseFloat((Number(u)||0).toFixed(2))}};return l&&s&&l({...s,summary:i.summary}),i}return e});return JSON.stringify(a)===JSON.stringify(t)?e:{...e,manufacturersData:t}})}catch(e){}},[rs,B,js,Se,De,gs,s?.versionName,s?.selectedStyle,Ie]);a.useEffect(()=>{Ns()},[Ns]),a.useEffect(()=>{b(u())},[b]);const vs=r?.manufacturersData?.[0]?.manufacturer;a.useEffect(()=>{(async()=>{if(vs)try{const e=await p.get(`/api/manufacturers/${vs}/styles-meta`,{headers:Fe()});if(void 0!==e?.data?.manufacturerCostMultiplier&&$e(Number(e.data.manufacturerCostMultiplier||1)),e?.data?.styles&&Array.isArray(e.data.styles)){const s=e.data.styles.filter(e=>String(e?.style||"").trim().length>0);j(s)}else if(Array.isArray(e?.data)){const s=e.data.filter(e=>String(e?.style||"").trim().length>0);j(s)}else j([])}catch(e){}finally{ze(!0)}})()},[vs]),a.useEffect(()=>{(async()=>{if(vs){cs(!0);try{const e=(await p.get(`/api/manufacturers/${vs}/styleswithcatalog`,{headers:Fe()})).data||[];JSON.stringify(e)===JSON.stringify(ls)||ns(e)}catch(e){}finally{cs(!1)}}})()},[vs]),a.useEffect(()=>{if(s?.selectedStyle&&g.length>0){const e=g.find(e=>e.id===s.selectedStyle)||null;JSON.stringify(e)===JSON.stringify(f)||y(e),!We.styleId&&e&&Oe({styleId:e.id,stylePrice:Number(e.price||0)})}},[s?.selectedStyle,g]);const Ss=e=>{L(s=>s.filter((s,a)=>a!==e))},Cs=(e,a)=>{ve(s=>({...s,[e]:a}));const t=is.filter(e=>e.selectVersion===s?.versionName)[e],r=N?.findIndex(e=>e?.id===t?.id);if(-1!==r){const e=[...N];e[r]={...e[r],modifications:a},S(e)}},ws=async e=>{try{if(e){const s=await p.get(`${h}/api/manufacturers/catalogs/modificationsItems/${e}`,{headers:Fe()});ms(s.data)}}catch(s){}},Ms=async e=>{const t={...r},n=t.manufacturersData.findIndex(e=>e.versionName===s.versionName);if(-1!==n){t.manufacturersData[n].selectedStyle=e,i(t);const c={...s,selectedStyle:e};l(c);const d=g.find(s=>s.id===e);y(d||null);const u=d?.style,x=s?.versionName,h=Array.isArray(N)?N.filter(e=>e.selectVersion===x):[];let f=ls.filter(e=>e.style===u);if(!f.length)try{const s=r?.manufacturersData?.[0]?.manufacturer;if(s&&e){const a=await p.get(`/api/manufacturers/${s}/styles/${e}/items`,{headers:Fe(),params:{includeDetails:"1",limit:2e3}});f=(a?.data?.catalogData||[]).filter(e=>e.style===u)}}catch(o){}let j=0;const v=h.map(e=>{const s=f.find(s=>s.code===e.code);if(!s)return j+=1,Number(e.qty||1),{...e,unavailable:!0,originalPrice:0,price:0,appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(Ie||1),assemblyFee:0,includeAssemblyFee:!1,isRowAssembled:!1,total:0,comparisonPriceFallback:e.comparisonPriceFallback??Number(e.price||0),comparisonAssemblyUnitFallback:e.comparisonAssemblyUnitFallback??(e?.includeAssemblyFee?Number(e?.assemblyFee||0):0)};const a=Number(s.price)||0,t=a*Number(Ue||1)*Number(Ie||1),r=parseFloat(s?.styleVariantsAssemblyCost?.price)||0,i=Se,l=Number(e.qty||1),n=i?r:0;return{...e,unavailable:!1,originalPrice:a,appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(Ie||1),appliedMultiplier:Number(Ie||1),price:t,assemblyFee:r,includeAssemblyFee:i,isRowAssembled:i,total:l*t+n*l,comparisonPriceFallback:e.comparisonPriceFallback??t,comparisonAssemblyUnitFallback:e.comparisonAssemblyUnitFallback??n}});es(j);const C=[...Array.isArray(N)?N.filter(e=>e.selectVersion!==x):[],...v];a.startTransition(()=>{S(C),b(m(C))}),i(e=>{const s=Array.isArray(e?.manufacturersData)?[...e.manufacturersData]:[],a=x?s.findIndex(e=>e.versionName===x):-1;return-1!==a&&(s[a]={...s[a],items:v}),{...e,manufacturersData:s}}),l&&s&&l({...s,items:v})}};return e.jsxs("div",{children:[!qe&&e.jsx("div",{className:"alert alert-info my-3",role:"status",children:"Applying your pricing... Please wait."}),f&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex gap-5 mb-4 flex-wrap style-selection-mobile",style:{alignItems:"stretch"},children:[e.jsxs("div",{className:"current-style-section",style:{minWidth:"250px",flex:"0 0 auto"},children:[e.jsx("h5",{className:"mb-3",children:x("proposalUI.currentStyle")}),e.jsxs("div",{className:"current-style-content d-flex gap-4 align-items-start",children:[e.jsx("div",{className:"current-style-image",style:{width:"100px"},children:e.jsx("img",{src:f.styleVariants?.[0]?.image?`${h}/uploads/images/${f.styleVariants[0].image}`:"/images/nologo.png",alt:"Selected Style",style:{width:"100%",height:"240px",objectFit:"contain",borderRadius:"10px",backgroundColor:"#f8f9fa"},onError:e=>{const s=f.styleVariants?.[0]?.image;s&&!e.target.dataset.fallbackTried?(e.target.dataset.fallbackTried="1",e.target.src=`${h}/uploads/manufacturer_catalogs/${s}`):e.target.src="/images/nologo.png"}})}),e.jsxs("div",{className:"current-style-info d-flex flex-column",style:{gap:"1.5rem",flex:1},children:[e.jsxs("div",{className:"d-flex align-items-center",style:{fontSize:"1rem"},children:[e.jsx(P,{icon:ye,className:"me-2 text-primary",style:{width:"20px",height:"20px"}}),e.jsx("h5",{className:"mb-0",children:s?.manufacturerData?.name})]}),e.jsxs("div",{className:"d-flex align-items-center text-muted",style:{fontSize:"1rem"},children:[e.jsx(P,{icon:xe,className:"me-2 text-secondary",style:{width:"20px",height:"20px"}}),e.jsx("h5",{className:"mb-0",children:f.style})]}),e.jsxs("div",{className:"d-flex align-items-center",style:{fontSize:"1.1rem"},children:[e.jsx(P,{icon:pe,className:"me-2 text-success",style:{width:"20px",height:"20px"}}),e.jsx("span",{className:"me-2",children:x("proposalColumns.assembled")}),e.jsx(O,{size:"md",shape:"pill",checked:Se,onChange:e=>{c||we(e.target.checked)},disabled:c})]})]})]})]}),!ts&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"style-separator",style:{width:"1px",backgroundColor:"#ccc",marginInline:"16px"}}),e.jsxs("div",{className:"other-styles-section",style:{flex:1},children:[Ze>0&&e.jsxs("div",{className:"alert alert-warning py-2 px-3 mb-3",role:"alert",children:[Ze," item",1!==Ze?"s":""," not available in this style. They remain listed in red with $0 and wonâ€™t affect totals."]}),e.jsxs("div",{className:"other-styles-header d-flex justify-content-between align-items-center mb-3",style:{flexWrap:"nowrap"},children:[e.jsx("h5",{className:"mb-0",children:x("proposalUI.otherStyles")}),e.jsxs("div",{className:"d-flex align-items-center gap-2 flex-nowrap",children:[e.jsx("button",{type:"button",className:"btn btn-sm "+(Qe?"btn-primary":"btn-outline-primary"),onClick:()=>He(!Qe),style:{padding:"0.25rem 0.75rem"},disabled:c,children:Qe?e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:v,size:"sm",className:"me-1"}),e.jsx("span",{className:"d-none d-sm-inline",children:x("proposalUI.expandImages")}),e.jsx("span",{className:"d-sm-none",children:"ðŸ“‹"})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{icon:v,size:"sm",className:"me-1"}),e.jsx("span",{className:"d-none d-sm-inline",children:x("proposalUI.compactView")}),e.jsx("span",{className:"d-sm-none",children:"ðŸ–¼ï¸"})]})}),g.length>Ge&&!Qe&&e.jsxs("div",{className:"btn-group btn-group-sm d-md-none",role:"group","aria-label":"Style navigation",style:{display:"inline-flex",whiteSpace:"nowrap"},children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm "+(hs()?"":"disabled"),onClick:e=>{e&&e.preventDefault(),Le(e=>Math.max(e-1,0))},disabled:!hs()||c,style:{padding:"0.25rem 0.4rem"},"aria-label":"Previous styles",children:e.jsx(P,{icon:ge,size:"sm"})}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm "+(xs()?"":"disabled"),onClick:e=>{e&&e.preventDefault();const s=Math.max(0,g.length-Ge);Le(e=>Math.min(e+1,s))},disabled:!xs()||c,style:{padding:"0.25rem 0.4rem"},"aria-label":"Next styles",children:e.jsx(P,{icon:je,size:"sm"})})]})]})]}),e.jsx("div",{className:"other-styles-carousel-container "+(Qe?"collapsed-view":""),children:os?e.jsx("div",{className:"py-4 text-muted",children:x("proposalUI.loadingStyles")}):0===g.length?e.jsx("div",{className:"py-4 text-muted",children:x("proposalUI.noStyles")}):e.jsx("div",{className:"styles-carousel-container",children:0===is.length?e.jsx("div",{className:"py-4 text-center text-muted",style:{fontSize:"0.9rem"},children:x("proposalUI.styleComparison.selectItemsMessage")}):Qe?e.jsx("div",{className:"styles-compact-list",children:g.map((s,a)=>{const t=bs(s.price),r=s.id===f?.id;return e.jsxs("div",{className:"compact-style-item "+(r?"current-style":""),onClick:()=>!c&&Ms(s.id),style:{cursor:c?"default":"pointer"},children:[e.jsxs("div",{className:"style-info",children:[e.jsx("span",{className:"style-name",children:s.style}),e.jsx("span",{className:"price-label",children:x(r?"proposalUI.styleComparison.currentTotal":"proposalUI.styleComparison.totalIfSelected")})]}),e.jsxs("div",{className:"style-price "+(r?"current":"alternate"),children:["$",t.toFixed(2)]})]},`compact-style-${s.id}-${a}`)})}):e.jsx("div",{className:"styles-carousel-track",style:{display:"flex",gap:"1rem",transform:`translateX(-${Be*(100/Ge)}%)`,transition:"transform 0.3s ease-in-out",width:g.length>Ge?100*Math.ceil(g.length/Ge)+"%":"100%"},children:g.map((s,a)=>{const t=s.styleVariants?.[0];return e.jsxs("div",{className:"style-carousel-item text-center",style:{cursor:c?"default":"pointer",transition:"transform 0.2s ease",flexShrink:0},onClick:()=>!c&&Ms(s.id),onMouseEnter:e=>{c||(e.currentTarget.style.transform="scale(1.02)")},onMouseLeave:e=>{c||(e.currentTarget.style.transform="scale(1)")},children:[e.jsx("img",{src:t?.image?`${h}/uploads/images/${t.image}`:"/images/nologo.png",alt:t?.shortName||s.style,style:{width:"100%",height:"220px",objectFit:"contain",borderRadius:"10px",backgroundColor:"#f8f9fa",borderWidth:s.id===f?.id?"3px":"1px",borderStyle:"solid",borderColor:s.id===f?.id?"#1a73e8":"#e9ecef"},onError:e=>{t?.image&&!e.target.dataset.fallbackTried?(e.target.dataset.fallbackTried="1",e.target.src=`${h}/uploads/manufacturer_catalogs/${t.image}`):e.target.src="/images/nologo.png"}}),e.jsxs("div",{className:"mt-2 p-2 rounded",style:{backgroundColor:s.id===f?.id?"#d0e6ff":"#ffffff",borderWidth:s.id===f?.id?"2px":"1px",borderStyle:"solid",borderColor:s.id===f?.id?"#1a73e8":"#ced4da",fontWeight:s.id===f?.id?"600":"normal"},children:[e.jsx("div",{style:{fontSize:"0.875rem",marginBottom:"0.25rem"},children:s.style}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#666",marginBottom:"0.25rem"},children:s.id===f?.id?x("proposalUI.styleComparison.currentTotal"):x("proposalUI.styleComparison.totalIfSelected")}),e.jsxs("strong",{style:{color:s.id===f?.id?"#1a73e8":"#28a745"},children:["$",bs(s.price).toFixed(2)]})]})]},`style-${s.id}-${a}`)})})})})]})]})]})}),e.jsx("hr",{}),qe&&e.jsx(Ae,{catalogData:ls,handleCatalogSelect:e=>{const a=e.target.value,t=ls.find(e=>`${e.code} -- ${e.description}`===a);if(t){const e=Number(t.price)||0,a=e*Number(Ue||1)*Number(Ie||1),r=t?.styleVariantsAssemblyCost;let l=0;if(r){const e=parseFloat(r.price||0),s=r.type;l="flat"===s||"fixed"===s?e:"percentage"===s?a*e/100:e}const n=Se,o=a+(n?l:0),c={id:t.id,code:t.code,description:t.description,qty:1,originalPrice:e,appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(Ie||1),appliedMultiplier:Number(Ie||1),price:a,assemblyFee:l,includeAssemblyFee:n,isRowAssembled:Se,total:o,selectVersion:s?.versionName};i(e=>{const a=Array.isArray(e.manufacturersData)?[...e.manufacturersData]:[],t=a.findIndex(e=>e.versionName===s.versionName),r=-1!==t&&Array.isArray(a[t].items)?a[t].items:[],i=C?[c,...r]:[...r,c];return-1!==t&&(a[t]={...a[t],items:i}),S(i),b(m(i)),{...e,manufacturersData:a}})}},addOnTop:C,setAddOnTop:c?()=>{}:w,handleCopy:()=>{const e=N.map(e=>`${e.code} x${e.qty}`).join("\n");e?($(!1),navigator.clipboard.writeText(e)):$(!0),E(!0),setTimeout(()=>E(!1),2e3)},groupEnabled:M,setGroupEnabled:c?()=>{}:D,searchTerm:k,setSearchTerm:c?()=>{}:F,updateQty:c?()=>{}:(e,a)=>{a<1||i(t=>{const r=Array.isArray(t.manufacturersData)?[...t.manufacturersData]:[],i=r.findIndex(e=>e.versionName===s.versionName);if(-1!==i){const t=(Array.isArray(r[i].items)?[...r[i].items]:[]).map((s,t)=>{if(t!==e)return s;const r=s.includeAssemblyFee?Number(s.assemblyFee||0):0;return{...s,qty:a,total:a*Number(s.price||0)+r*a}});r[i]={...r[i],items:t},S(t),b(m(t)),l&&s&&l({...s,items:t})}return{...t,manufacturersData:r}})},handleOpenModificationModal:c?()=>{}:(e,s)=>{H(e),J(!0),ps(s),ws(s)},handleDelete:c?()=>{}:e=>{if(s&&s.items){const a=s.items.filter((s,a)=>a!==e);i(e=>{const t=Array.isArray(e.manufacturersData)?[...e.manufacturersData]:[],r=t.findIndex(e=>e.versionName===s.versionName);-1!==r&&(t[r]={...t[r],items:a});return{...e,manufacturersData:t}}),b(Ce(a))}S(s=>s.filter((s,a)=>a!==e))},updateModification:c?()=>{}:Cs,setModificationsMap:ve,modificationsMap:Ne,handleDeleteModification:c?()=>{}:(e,s)=>{const a=[...Ne[e]];a.splice(s,1),Cs(e,a)},formatPrice:e=>{const s=Number(e);return isNaN(s)?"$0.00":`$${s.toFixed(2)}`},selectVersion:s,isAssembled:Se,selectedStyleData:f,toggleRowAssembly:c?()=>{}:(e,t)=>{const r=[...N],n=r[e],o=t?Number(n.assemblyFee||0):0,c=Number(n.qty||1),d=t?"N/A"===n.hingeSide?"":n.hingeSide:"N/A",u=t?"N/A"===n.exposedSide?"":n.exposedSide:"N/A";r[e]={...n,includeAssemblyFee:t,isRowAssembled:t,hingeSide:d,exposedSide:u,total:c*Number(n.price||0)+o*c},a.startTransition(()=>{S(r),b(m(r))}),i(e=>{const a=Array.isArray(e?.manufacturersData)?[...e.manufacturersData]:[],t=s?.versionName?a.findIndex(e=>e.versionName===s.versionName):-1;return-1!==t&&(a[t]={...a[t],items:r}),{...e,manufacturersData:a}}),l&&s&&l({...s,items:r})},updateHingeSide:c?()=>{}:(e,s)=>{S(a=>{const t=a.map((a,t)=>t!==e?a:{...a,hingeSide:s});return b(m(t)),t})},updateExposedSide:c?()=>{}:(e,s)=>{S(a=>{const t=a.map((a,t)=>t!==e?a:{...a,exposedSide:s});return b(m(t)),t})},readOnly:c}),I&&e.jsx("div",{className:"position-fixed bottom-10 start-50 translate-middle-x p-3",style:{zIndex:9999},children:e.jsx("div",{className:"toast show align-items-center text-white bg-success border-0",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"toast-body",children:x(U?"proposalUI.toast.copyEmpty":"proposalUI.toast.copySuccess")}),e.jsx("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:()=>E(!1)})]})})}),!c&&as&&e.jsxs("div",{className:"mt-5 p-0",style:{maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2",style:{rowGap:"0.75rem"},children:[e.jsx("h6",{className:"mb-0 w-100 w-md-auto",children:x("proposalUI.custom.title")}),e.jsx("input",{type:"text",placeholder:x("proposalUI.custom.itemName"),value:T,onChange:e=>{V(e.target.value),Ke&&Xe("")},className:"form-control",style:{flex:1,minWidth:"200px",maxWidth:"100%"}}),e.jsx("input",{type:"number",placeholder:x("proposalUI.custom.price"),value:z,onChange:e=>{q(e.target.value),Ke&&Xe("")},className:"form-control",style:{width:"90px",minWidth:"70px"},min:"0",step:"0.01"}),e.jsx("div",{className:"form-check d-flex align-items-center",children:e.jsx(A,{checked:R,onChange:e=>{as&&W(e.target.checked)},disabled:!as,style:{transform:"scale(1.4)"},label:e.jsx("span",{style:{fontSize:"1.1rem",marginLeft:"0.5rem"},children:x("proposalUI.custom.taxable")})})}),e.jsx("button",{className:"btn btn-primary",style:{minWidth:"80px"},onClick:()=>{if(!T||!z)return void Xe("Please enter both item name and price.");const e={name:T,price:parseFloat(z),taxable:!as||R,selectVersion:s?.versionName};L(s=>[...s,e]),V(""),q(""),W(!0)},children:x("proposalUI.custom.add")})]}),Ke&&e.jsx("div",{style:{color:"red",marginTop:"0.25rem",marginBottom:"1rem"},children:Ke}),e.jsx("div",{className:"table-responsive d-none d-md-block",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:x("proposalUI.custom.table.index")}),e.jsx("th",{children:x("proposalUI.custom.table.itemName")}),e.jsx("th",{children:x("proposalUI.custom.table.price")}),e.jsx("th",{children:x("proposalUI.custom.table.taxable")}),e.jsx("th",{children:x("proposalUI.custom.table.actions")})]})}),e.jsx("tbody",{children:B?.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:s.name}),e.jsxs("td",{children:["$",(Number(s.price)||0).toFixed(2)]}),e.jsx("td",{children:s.taxable?x("common.yes"):x("common.no")}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-danger text-white",onClick:()=>Ss(a),disabled:c,title:c?x("proposals.lockedTooltip"):void 0,children:x("proposalUI.custom.delete")})})]},a))})]})}),e.jsxs("div",{className:"d-block d-md-none",children:[B&&B.length>0&&e.jsxs("div",{className:"row fw-bold text-muted mb-2 px-2",style:{fontSize:"0.85rem"},children:[e.jsx("div",{className:"col-1",children:"#"}),e.jsx("div",{className:"col-4",children:x("proposalUI.custom.table.itemName")}),e.jsx("div",{className:"col-3",children:x("proposalUI.custom.table.price")}),e.jsx("div",{className:"col-2",children:x("proposalUI.custom.table.taxable")}),e.jsx("div",{className:"col-2",children:x("proposalUI.custom.table.actions")})]}),B?.map((s,a)=>e.jsxs("div",{className:"row mb-2 py-2 border-bottom align-items-center",children:[e.jsx("div",{className:"col-1 text-center",children:a+1}),e.jsx("div",{className:"col-4",style:{fontSize:"0.9rem"},children:s.name}),e.jsxs("div",{className:"col-3",style:{fontSize:"0.9rem"},children:["$",(Number(s.price)||0).toFixed(2)]}),e.jsx("div",{className:"col-2 text-center",style:{fontSize:"0.9rem"},children:s.taxable?x("common.yes"):x("common.no")}),e.jsx("div",{className:"col-2",children:e.jsx("button",{className:"btn btn-sm btn-danger text-white",onClick:()=>Ss(a),disabled:c,title:c?x("proposals.lockedTooltip"):void 0,style:{fontSize:"0.75rem",padding:"0.2rem 0.4rem"},children:x("proposalUI.custom.delete")})})]},a)),(!B||0===B.length)&&e.jsx("div",{className:"text-muted text-center py-3",style:{fontSize:"0.9rem"},children:"No custom items added yet"})]})]}),qe&&e.jsx("div",{className:"mt-5 mb-5 d-flex justify-content-center",children:e.jsx("table",{className:"table shadow-lg",style:{maxWidth:"500px"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:x("proposalDoc.priceSummary.cabinets")}),e.jsxs("td",{className:"text-center fw-medium",children:["$",s?.summary?.cabinets||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:x("proposalDoc.priceSummary.assembly")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.assemblyFee||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:x("proposalDoc.priceSummary.modifications")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.modificationsCost||"0"]})]}),e.jsxs("tr",{className:"table-secondary",children:[e.jsx("th",{children:x("proposalDoc.priceSummary.styleTotal")}),e.jsxs("td",{className:"text-center fw-semibold",children:["$",s?.summary?.styleTotal||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:x("proposalUI.summary.discountPct")}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"number",min:"0",max:"100",value:s?.summary?.discountPercent||"0",onChange:e=>{const s=Math.max(0,Math.min(100,parseFloat(e.target.value)||0));ke(s)},style:{border:"none",outline:"none",background:"transparent",width:"60px",textAlign:"right",fontWeight:"500"}})})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:x("proposalDoc.priceSummary.total")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.total||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:x("proposalUI.summary.taxRate")}),e.jsxs("td",{className:"text-center",children:[s?.summary?.taxRate||"0","%"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:x("proposalDoc.priceSummary.tax")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.taxAmount||"0"]})]}),e.jsxs("tr",{className:"table-success fw-bold",children:[e.jsx("th",{children:x("proposalDoc.priceSummary.grandTotal")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.grandTotal||"0"]})]})]})})}),e.jsx(Me,{itemModificationID:us,catalogData:ds,visible:G,onClose:()=>J(!1),onSave:()=>{if(he(!0),"existing"===_){if(!be||!K||K<=0)return}else if("custom"===_&&(!te||te<=0||!se.trim()))return;const e=Ne[Q]||[],s=ds.find(e=>e.id==be),a="existing"===_?{type:"existing",modificationId:be,qty:K,note:Z,name:s?s.modificationName:"",price:s?s.price:0}:{type:"custom",qty:te,price:ie,taxable:!as||ce,note:ne,name:se},t=[...e,a];Cs(Q,t),J(!1),X(1),ee(""),re(1),le(""),oe(""),de(!as),fe(""),he(!1),ae(""),"custom"==_&&(async(e,s)=>{try{const a={catalogId:s,name:e.name,price:e.price,note:e.note,description:e.note};await p.post("/api/manufacturers/catalogs/modificationsItems/add",a,{headers:Fe()})}catch(a){}})(a,us)},modificationType:_,setModificationType:Y,existingModifications:ds,selectedExistingMod:be,setSelectedExistingMod:fe,existingModQty:K,setExistingModQty:X,existingModNote:Z,setExistingModNote:ee,customModName:se,setCustomModName:ae,customModQty:te,setCustomModQty:re,customModPrice:ie,setCustomModPrice:le,customModTaxable:ce,setCustomModTaxable:de,customModNote:ne,setCustomModNote:oe,validationAttempted:me,isUserAdmin:as})]})},Ee=()=>e.jsxs("div",{style:Ue.container,children:[e.jsx("div",{style:Ue.spinner}),e.jsx("p",{children:"Loading..."})]}),Ue={container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh"},spinner:{width:"40px",height:"40px",border:"5px solid #f3f3f3",borderTop:"5px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite"}},$e=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},Pe=[{label:"Draft",value:"Draft"},{label:"Follow up 1",value:"Follow up 1"},{label:"Follow up 2",value:"Follow up 2"},{label:"Follow up 3",value:"Follow up 3"},{label:"Measurement Scheduled",value:"Measurement Scheduled"},{label:"Measurement done",value:"Measurement done"},{label:"Design done",value:"Design done"},{label:"Proposal done",value:"Proposal done"},{label:"Proposal accepted",value:"Proposal accepted"},{label:"Proposal rejected",value:"Proposal rejected"}],Te=Ne(({isContractor:t,contractorGroupId:l,contractorModules:n,contractorGroupName:c})=>{const{id:m}=r(),u=x(m),A=i(),F=o(),[$,T]=a.useState(null),[V,z]=a.useState(!0),[q,R]=a.useState("item"),[W,O]=a.useState(!1),[ue,pe]=a.useState(!1),[xe,ye]=a.useState(null),[ge,je]=a.useState(null),[Ne,Se]=a.useState(""),[we,Me]=a.useState(null),[De,ke]=a.useState(null),[Ae,Fe]=a.useState(!1),[Ue,Te]=a.useState(!1),[Ve,ze]=a.useState(!1),[qe,Re]=a.useState(null),[We,Oe]=a.useState([]),[Be,Le]=a.useState([]),Ge=JSON.parse(localStorage.getItem("user")),Je=a.useRef(!1),{t:Qe}=d(),He=he(Ge,"admin:users"),_e=Ge?.group&&"contractor"===Ge.group.group_type,Ye=!(!Ge?.role||"admin"!==String(Ge.role).toLowerCase()),Ke=y().shape({description:g().required("Description is required"),...He&&{designer:g().required("Designer is required")}}),Xe=()=>es?.manufacturersData||[],Ze={manufacturersData:[],designer:"",description:"",date:null,designDate:null,measurementDate:null,status:"Draft",files:[],customerName:""},[es,ss]=a.useState(Ze),[as,ts]=a.useState(!1),rs="Proposal accepted"===es?.status||"accepted"===es?.status,is=!!es?.is_locked,ls=is||rs&&!Ye,ns=e=>{ts(!0),ss(e)};a.useEffect(()=>{},[es]),a.useEffect(()=>{p.get(`/api/quotes/proposalByID/${u}`,{headers:$e()}).then(e=>{let s=e.data.manufacturersData;if("string"==typeof s)try{s=JSON.parse(s)}catch(t){s=[]}Array.isArray(s)||(s=[]);const a={...e.data,manufacturersData:s};T(a),ss(a||Ze),ts(!1),Le(s||[]),z(!1)}).catch(e=>{z(!1)})},[u]),a.useEffect(()=>{He&&(async()=>{try{const e=(await p.get("/api/designers",{headers:$e()})).data.users.map(e=>({value:e.id,label:e.name}));Oe(e)}catch(e){}})()},[He]),a.useEffect(()=>{$&&!as&&ss($)},[$,as]),a.useEffect(()=>{const e=Xe();e.length>0&&e.forEach(e=>{e.manufacturer&&!Be[e.manufacturer]&&F(h({id:e.manufacturer,includeCatalog:!1}))})},[es?.manufacturersData,F,Be]),a.useEffect(()=>{const e=Xe();if(0===e.length)return;const s=e.map(e=>({...e,manufacturerData:Be[e.manufacturer]}));s.length>0&&null===we&&!Je.current&&(Me(0),ke(s[0]),Je.current=!0,F(Ce(s[0])))},[es.manufacturersData,Be,we,F]),a.useEffect(()=>{De&&F(Ce(De))},[De,F]);const os=e=>{ss(s=>({...s,...e}))},cs=Xe().map(e=>({...e,manufacturerData:Be[e.manufacturer]})),ds=cs[we]||null,ms=()=>xs({...es},"update"),us=()=>xs({...es,status:"Proposal accepted"},"accept"),ps=()=>xs({...es,status:"Proposal rejected"},"reject"),xs=async(e,s="update")=>{try{if(is)return void me.fire(Qe("common.warning","Warning"),Qe("proposals.lockedStatus.description"),"warning");if(!Ye&&rs&&"update"!==s)return void me.fire(Qe("common.warning","Warning"),Qe("proposals.lockedStatus.description"),"info");const a={action:s,formData:e},t=await F(b(a));if(!0===t.payload?.success)me.fire("Success!","Proposal saved successfully!","success"),A("/quotes");else if(t.error){const e=t.error.message||t.payload?.message||"Failed to save proposal";/locked/i.test(e)?me.fire("Cannot Edit",Qe("proposals.lockedStatus.description"),"warning"):me.fire("Error",e,"error")}}catch(a){const e=a?.response?.status,s=a?.response?.data?.message||a?.message||"Failed to save proposal";403===e&&/locked/i.test(s)?me.fire("Cannot Edit",Qe("proposals.lockedStatus.description"),"warning"):me.fire("Error",s,"error")}};return V?e.jsx(Ee,{}):e.jsxs(B,{fluid:!0,className:"dashboard-container",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:[e.jsx(be,{title:Qe("proposals.edit.title","Edit Proposal"),icon:le,badges:[...rs?[{text:Qe("proposals.lockedStatus.title"),variant:"success"}]:[],...is?[{text:"Locked",variant:"dark"}]:[]],rightContent:e.jsxs("div",{className:"d-flex gap-2 flex-wrap justify-content-center justify-content-sm-end",children:[e.jsxs(U,{className:"shadow-sm px-4 fw-semibold d-flex align-items-center mobile-action-btn",style:{backgroundColor:"print"===qe?"#218838":"#28a745",color:"#fff",borderRadius:"8px",borderWidth:0,borderStyle:"none",transition:"all 0.3s ease"},onMouseEnter:()=>Re("print"),onMouseLeave:()=>Re(null),onClick:()=>Fe(!0),children:[e.jsx(oe,{className:"me-2"}),Qe("proposals.create.actions.print")]}),!_e&&e.jsxs(e.Fragment,{children:[e.jsxs(U,{className:"shadow-sm px-4 fw-semibold d-flex align-items-center mobile-action-btn",style:{backgroundColor:"email"===qe?"#138496":"#17a2b8",color:"#fff",borderRadius:"8px",borderWidth:0,borderStyle:"none",transition:"all 0.3s ease"},onMouseEnter:()=>Re("email"),onMouseLeave:()=>Re(null),onClick:()=>Te(!0),children:[e.jsx(ce,{className:"me-2"}),Qe("proposals.create.actions.email")]}),e.jsxs(U,{className:"shadow-sm px-4 fw-semibold d-flex align-items-center mobile-action-btn",style:{backgroundColor:"contract"===qe?"#e0a800":"#ffc107",color:"#212529",borderRadius:"8px",borderWidth:0,borderStyle:"none",transition:"all 0.3s ease"},onMouseEnter:()=>Re("contract"),onMouseLeave:()=>Re(null),onClick:()=>ze(!0),children:[e.jsx(de,{className:"me-2"}),Qe("proposals.create.actions.contract")]})]})]})}),e.jsx("div",{className:"mb-4",children:e.jsx(j,{initialValues:$||Ze,enableReinitialize:!0,validationSchema:Ke,onSubmit:e=>{xs({...es,...e},"update")},children:({values:r,errors:i,touched:l,handleChange:n,handleBlur:o,handleSubmit:c,setFieldValue:d,setValues:m})=>(a.useEffect(()=>{try{const e=JSON.stringify(r);e!==JSON.stringify(es)&&m(es)}catch(e){}},[es]),e.jsxs(L,{onSubmit:c,className:"proposal-summary-form",children:[e.jsx("div",{className:"card border-0 shadow-sm mb-4",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs(G,{className:"g-3",children:[He&&e.jsxs(J,{xs:12,sm:6,lg:4,children:[e.jsx(Q,{htmlFor:"designer",children:"Designer *"}),e.jsx(f,{isClearable:!0,id:"designer",name:"designer",options:We,value:We.find(e=>e.value===r.designer)||null,onChange:e=>{d("designer",e?.value||"")},onBlur:o}),i.designer&&l.designer&&e.jsx("div",{className:"text-danger small mt-1",children:i.designer})]}),e.jsxs(J,{xs:12,sm:6,lg:4,children:[e.jsx(Q,{htmlFor:"description",children:"Description *"}),e.jsx(I,{type:"text",id:"description",name:"description",value:r.description,onChange:n,onBlur:o,placeholder:"Description"}),i.description&&l.description&&e.jsx("div",{className:"text-danger small mt-1",children:i.description})]}),e.jsxs(J,{xs:12,sm:6,lg:4,children:[e.jsx(Q,{htmlFor:"status",children:"Status"}),e.jsx(f,{isClearable:!0,options:Pe,value:Pe.find(e=>e.value===(r.status||"Draft")),onChange:e=>{d("status",e?.value||"Draft")},onBlur:o,inputId:"status"})]}),e.jsx(J,{xs:12,md:6,lg:4,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Q,{htmlFor:"date",children:"Date"}),e.jsx(s,{id:"date",selected:r.date?new Date(r.date):new Date,onChange:e=>d("date",e),className:"form-control",dateFormat:"MM/dd/yyyy",wrapperClassName:"w-100",placeholderText:"Date"}),e.jsx(ne,{style:{position:"absolute",top:"70%",right:"12px",transform:"translateY(-50%)",color:"#6c757d",pointerEvents:"none"}})]})}),e.jsx(J,{xs:12,md:6,lg:4,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Q,{htmlFor:"designDate",children:"Design Date"}),e.jsx(s,{id:"designDate",selected:r.designDate?new Date(r.designDate):null,onChange:e=>d("designDate",e),className:"form-control",dateFormat:"MM/dd/yyyy",wrapperClassName:"w-100",placeholderText:"Design Date"}),e.jsx(ne,{style:{position:"absolute",top:"70%",right:"12px",transform:"translateY(-50%)",color:"#6c757d",pointerEvents:"none"}})]})}),e.jsx(J,{xs:12,md:6,lg:4,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Q,{htmlFor:"measurementDate",children:"Measurement Date"}),e.jsx(s,{id:"measurementDate",selected:r.measurementDate?new Date(r.measurementDate):null,onChange:e=>d("measurementDate",e),className:"form-control",dateFormat:"MM/dd/yyyy",wrapperClassName:"w-100",placeholderText:"Measurement Date"}),e.jsx(ne,{style:{position:"absolute",top:"70%",right:"12px",transform:"translateY(-50%)",color:"#6c757d",pointerEvents:"none"}})]})})]})})}),!_e&&e.jsx("div",{className:"proposal-version-badges",children:cs.map((s,a)=>{const r=a===we;return e.jsxs(H,{className:"proposal-version-badge p-3 d-flex",style:{fontSize:"0.8rem",cursor:"pointer",justifyContent:"space-between",backgroundColor:r?"#084298":"#d0e7ff",color:r?"#d0e7ff":"#084298",boxShadow:r?"0 0 8px 2px rgba(8, 66, 152, 0.6)":"0 1px 3px rgba(0, 0, 0, 0.1)",borderRadius:"8px",transition:"all 0.3s ease"},onClick:()=>{},children:[e.jsxs("div",{children:[!_e&&e.jsx("strong",{style:{display:"block"},children:s.versionName}),e.jsxs("small",{style:{fontSize:"0.7rem",color:r?"#a9c7ff":"#4a6fa5"},children:["$ ",s.manufacturerData?.costMultiplier||"N/A"]})]}),!_e&&e.jsxs(_,{onClick:e=>e.stopPropagation(),children:[e.jsx(Y,{color:"transparent",size:"sm",style:{padding:"0 4px",color:r?"#d0e7ff":"#084298",backgroundColor:"transparent",borderWidth:0,borderStyle:"none",outline:"none",boxShadow:"none",transition:"all 0.2s ease"},children:e.jsx(P,{icon:S})}),e.jsxs(K,{style:{minWidth:"120px",borderWidth:"1px",borderStyle:"solid",borderColor:"#e0e0e0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",borderRadius:"4px",padding:"4px 0"},children:[e.jsxs(X,{onClick:()=>(e=>{t||(ye(e),Se(cs[e].versionName),O(!0))})(a),style:{padding:"6px 12px",fontSize:"0.875rem",color:"#333",transition:"all 0.2s ease"},children:[e.jsx(P,{icon:ve,className:"me-2"})," Edit"]}),e.jsxs(X,{onClick:()=>(e=>{t||(je(e),pe(!0))})(a),style:{padding:"6px 12px",fontSize:"0.875rem",color:"#dc3545",transition:"all 0.2s ease"},children:[e.jsx(P,{icon:fe,className:"me-2"})," Delete"]}),e.jsxs(X,{onClick:()=>(e=>{if(t)return;const s=Xe();if(!s[e])return;const a={...s[e]};a.versionName=`Copy of ${a.versionName}`,os({manufacturersData:[...es.manufacturersData,a]})})(a),style:{padding:"6px 12px",fontSize:"0.875rem",color:"#333",transition:"all 0.2s ease"},children:[e.jsx(P,{icon:N,className:"me-2"})," Duplicate"]})]})]})]},a)})}),e.jsx("hr",{}),e.jsx(Z,{children:e.jsx(ee,{variant:"tabs",className:"proposal-tabs border-0",children:e.jsx(se,{children:e.jsx(ae,{active:"item"===q,onClick:()=>{R("item")},style:{cursor:"pointer",borderWidth:0,borderStyle:"none",padding:"10px 20px",fontWeight:600,color:"item"===q?"#084298":"#6c757d",backgroundColor:"item"===q?"rgba(8, 66, 152, 0.1)":"transparent",borderBottom:"item"===q?"3px solid #084298":"none",transition:"all 0.3s ease",borderRadius:"4px 4px 0 0",marginRight:"4px"},children:e.jsxs("span",{className:"d-flex align-items-center",children:[e.jsx(P,{icon:v,className:"me-2"}),"Items"]})})})})}),"item"===q&&e.jsx("div",{className:"tab-content mt-4",children:e.jsx(Ie,{selectedVersion:De,formData:es,setFormData:ns,setSelectedVersion:ke,selectVersion:ds,readOnly:ls})}),e.jsx("div",{className:"proposal-actions",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-wrap gap-3",children:ls?e.jsx("div",{className:"w-100",children:e.jsxs(te,{color:"success",className:"text-center",children:[e.jsxs("h5",{className:"alert-heading mb-3",children:[e.jsx(le,{className:"me-2"}),Qe("proposals.lockedStatus.title")]}),e.jsx("p",{className:"mb-2",children:Qe("proposals.lockedStatus.description")}),e.jsx("small",{className:"text-muted",children:Qe("proposals.lockedStatus.processingNote")})]})}):e.jsxs(e.Fragment,{children:[e.jsx(U,{color:"secondary",variant:"outline",onClick:ms,className:"btn mobile-form-btn",children:"Save"}),e.jsx(U,{color:"success",onClick:us,className:"btn mobile-form-btn",disabled:rs,title:rs?"Already accepted":void 0,children:"Accept and Order"}),e.jsx(U,{color:"danger",variant:"outline",onClick:ps,className:"btn mobile-form-btn",children:"Reject and Archive"})]})})})]}))})}),e.jsx(C,{show:Ae,onClose:()=>Fe(!1),formData:es}),e.jsx(w,{show:Ue,onClose:()=>Te(!1),formData:es}),e.jsx(M,{show:Ve,onClose:()=>ze(!1)}),e.jsxs(D,{visible:W,onClose:()=>O(!1),alignment:"center",backdrop:"static",className:"modal-lg",children:[e.jsx(re,{closeButton:!0,children:e.jsx(ie,{children:"Edit Version Name"})}),e.jsx(k,{children:e.jsx(I,{className:"mb-3",value:Ne,onChange:e=>Se(e.target.value),placeholder:"Version Name"})}),e.jsxs(E,{children:[e.jsx(U,{color:"secondary",onClick:()=>O(!1),children:"Cancel"}),e.jsx(U,{color:"primary",onClick:()=>{if(Xe().find((e,s)=>e.versionName===Ne&&s!==xe))return void me.fire({icon:"error",title:"Duplicate Version Name",text:`Manufacturer Version "${Ne}" already exists.`});const e=[...Xe()];e[xe]&&(e[xe].versionName=Ne,os({manufacturersData:e})),O(!1)},children:"Save"})]})]}),e.jsxs(D,{visible:ue,onClose:()=>pe(!1),alignment:"center",backdrop:"static",className:"modal-sm",children:[e.jsx(re,{closeButton:!0,children:e.jsx(ie,{children:"Confirm Delete"})}),e.jsx(k,{children:"Are you sure you want to delete this version?"}),e.jsxs(E,{children:[e.jsx(U,{color:"secondary",onClick:()=>pe(!1),children:"Cancel"}),e.jsx(U,{color:"danger",onClick:()=>{if(t)return;const e=Xe().filter((e,s)=>s!==ge);os({manufacturersData:e}),ge===we?(Me(null),ke(null)):ge<we&&Me(we-1),pe(!1)},children:"Delete"})]})]})]})},"proposals");export{Te as default};
