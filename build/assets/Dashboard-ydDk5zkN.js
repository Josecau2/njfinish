import{j as e}from"./date-vendor-DfW9khhA.js";import{u as s,r as a}from"./react-vendor-Dhx0OYb2.js";import{a as r,u as t}from"./redux-vendor-B0DAdCYB.js";import{u as l,a as c,i as d,j as i}from"./index-CRxBN8Fj.js";import{h as n,C as o,R as m,S as u,b as h,c as p,d as x,a as j,r as f,e as g,W as b,X as N,Y as v,v as y}from"./ui-vendor-pFEG3kEv.js";import{c as w}from"./cil-description-MUzg6O3n.js";import{c as k}from"./DefaultLayout-CNvO87EM.js";import{P as S}from"./PageHeader-UABCfWk-.js";import"./form-vendor-C_vzjFiG.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-CVrEPnlB.js";const I=()=>{const r=s(),{t:t}=l(),[d,i]=a.useState({proposals:0,customers:0}),[b,N]=a.useState(!0),[v,y]=a.useState(null),S=a.useMemo(()=>JSON.parse(localStorage.getItem("user")||"{}"),[]),I=S.group?.name||"Unknown Group",P=a.useMemo(()=>S.group?.id??S.group_id??S.groupId??S.group?.group_id??null,[S.group?.id,S.group_id,S.groupId,S.group?.group_id]),A=a.useMemo(()=>{const e=S.group?.modules;try{if(Array.isArray(e))return e;if("string"==typeof e&&e.trim()){const s=JSON.parse(e);return Array.isArray(s)?s:s&&"object"==typeof s?Object.entries(s).filter(([,e])=>!!e).map(([e])=>e):[]}return e&&"object"==typeof e?Object.entries(e).filter(([,e])=>!!e).map(([e])=>e):[]}catch(s){return[]}},[JSON.stringify(S.group?.modules)]);return a.useEffect(()=>{(async()=>{try{N(!0);let s=0,a=0;if(A.includes("proposals"))try{const e=(await c.get("/api/quotes")).data,a=Array.isArray(e)?e:e?.proposals||e?.data||e?.items||[];s=(P?a.filter(e=>(e?.owner_group_id??e?.ownerGroupId??e?.group_id??e?.groupId)===P):a).length}catch(e){}if(A.includes("customers"))try{const e=(await c.get("/api/customers")).data,s=Array.isArray(e)?e:e?.customers||e?.data||e?.items||[];a=(P?s.filter(e=>(e?.owner_group_id??e?.ownerGroupId??e?.group_id??e?.groupId)===P):s).length}catch(e){}i({proposals:s,customers:a})}catch(e){y(t("dashboard.loadError"))}finally{N(!1)}})()},[P]),b?e.jsx(n,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsx(o,{})}):e.jsx(n,{fluid:!0,children:e.jsx(m,{children:e.jsx(u,{xs:12,children:e.jsxs(h,{className:"mb-4",children:[e.jsxs(p,{children:[e.jsx("h4",{className:"mb-0",children:t("dashboard.welcome",{group:I})}),e.jsx("p",{className:"text-muted mb-0",children:t("dashboard.portal")})]}),e.jsxs(x,{children:[v&&e.jsx(j,{color:"danger",className:"mb-3",children:v}),e.jsxs(m,{children:[A.includes("proposals")&&e.jsx(u,{sm:6,lg:4,className:"mb-3",children:e.jsx(h,{className:"text-white bg-primary",children:e.jsxs(x,{className:"pb-0 d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fs-4 fw-semibold",children:d.proposals}),e.jsx("div",{children:t("nav.proposals")})]}),e.jsx("div",{className:"bg-body-secondary bg-opacity-25 rounded p-2",children:e.jsx(f,{icon:w,size:"lg"})})]})})}),A.includes("customers")&&e.jsx(u,{sm:6,lg:4,className:"mb-3",children:e.jsx(h,{className:"text-white bg-success",children:e.jsxs(x,{className:"pb-0 d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fs-4 fw-semibold",children:d.customers}),e.jsx("div",{children:t("nav.customers")})]}),e.jsx("div",{className:"bg-body-secondary bg-opacity-25 rounded p-2",children:e.jsx(f,{icon:k,size:"lg"})})]})})})]}),e.jsx(m,{children:e.jsx(u,{xs:12,children:e.jsxs(h,{children:[e.jsx(p,{children:e.jsx("h6",{className:"mb-0",children:t("dashboard.quickActions")})}),e.jsx(x,{children:e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[A.includes("proposals")&&e.jsx(g,{color:"primary",variant:"outline",onClick:()=>r("/quotes/create"),children:t("dashboard.createProposal")}),A.includes("customers")&&e.jsx(g,{color:"success",variant:"outline",onClick:()=>r("/customers/add"),children:t("nav.addCustomer")}),e.jsx(g,{color:"info",variant:"outline",onClick:()=>r("/profile"),children:t("dashboard.viewProfile")})]})})]})})})]})]})})})})},P=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},A=()=>{const p=a.useMemo(()=>JSON.parse(localStorage.getItem("user")||"{}"),[]);if(p.group&&"contractor"===p.group.group_type)return e.jsx(I,{});const{t:j}=l(),f=r(e=>e.dashboard.activeProposals),w=r(e=>e.dashboard.activeOrders),k=r(e=>e.dashboard.latestProposals),[A,_]=a.useState(0),[z,q]=a.useState(0),[C,D]=a.useState(null),[O,E]=a.useState([]),[U,L]=a.useState([]),B=s(),[J,M]=a.useState("quick-access"),G=t(),H=[];a.useEffect(()=>{G(d()),G(i())},[G]),a.useEffect(()=>{R(),$()},[]);const R=async()=>{try{const e=await c.get("/api/resources/links",{headers:P()});e.data.success&&E(e.data.data)}catch(e){}},$=async()=>{try{const e=await c.get("/api/resources/files",{headers:P()});e.data.success&&L(e.data.data)}catch(e){}};a.useEffect(()=>{let e=null;return f&&f>0&&(e=setInterval(()=>{_(s=>s<f?s+1:(clearInterval(e),s))},50)),()=>clearInterval(e)},[f]),a.useEffect(()=>{let e=null;return w&&w>0&&(e=setInterval(()=>{q(s=>s<w?s+1:(clearInterval(e),s))},50)),()=>clearInterval(e)},[w]);const F=e=>{switch(e){case"active":case"approved":return"success";case"pending":case"in-review":return"warning";case"draft":return"info";case"completed":return"primary";default:return"secondary"}},Q=e=>{if(!e)return"";const s=e.toLowerCase().replace(/\s+/g,"");return j(`status.${{draft:"draft",sent:"sent",accepted:"accepted",rejected:"rejected",expired:"expired",proposaldone:"proposalDone",measurementscheduled:"measurementScheduled",measurementdone:"measurementDone",designdone:"designDone",followup1:"followUp1",followup2:"followUp2",followup3:"followUp3",proposalaccepted:"proposalAccepted",proposalrejected:"proposalRejected"}[s]||s}`,e)},W=e=>{switch(e){case"pdf":default:return"📄";case"excel":return"📊";case"video":return"🎥";case"word":return"📝"}},X=e=>{switch(e){case"external":default:return"🔗";case"internal":return"🏠";case"document":return"📚";case"help":return"❓"}};return e.jsxs(n,{fluid:!0,className:"dashboard-container",children:[e.jsx(S,{title:j("dashboard.title","Dashboard"),rightContent:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(g,{color:"primary",className:"btn-gradient-cyan",onClick:()=>{B("/quotes/create")},children:j("dashboard.newProposal")}),e.jsx(g,{color:"success",className:"btn-gradient-green",onClick:()=>{B("/quotes/create?quick=yes")},children:j("dashboard.quickProposal")})]})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(u,{lg:3,md:6,className:"mb-4",children:e.jsx(h,{className:"stat-card stat-card-proposals",children:e.jsxs(x,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"stat-card-icon",children:"📊"}),e.jsx("div",{children:e.jsx("h6",{className:"stat-card-title",children:j("dashboard.activeProposals")})})]}),e.jsx("h1",{className:"stat-card-number mt-3",children:A||e.jsx(o,{size:"sm"})})]})})}),e.jsx(u,{lg:3,md:6,className:"mb-4",children:e.jsx(h,{className:"stat-card stat-card-orders",children:e.jsxs(x,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"stat-card-icon",children:"📦"}),e.jsx("div",{children:e.jsx("h6",{className:"stat-card-title",children:j("dashboard.activeOrders")})})]}),e.jsx("h1",{className:"stat-card-number mt-3",children:z||e.jsx(o,{size:"sm"})})]})})}),e.jsx(u,{lg:6,className:"mb-4",children:e.jsx(h,{className:"dashboard-card",children:e.jsxs(x,{children:[e.jsxs(b,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"📈"}),j("dashboard.latestProductUpdates")]}),e.jsx(N,{flush:!0,children:H.length>0?H.map(s=>e.jsx(v,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.title}),e.jsx("small",{className:"text-muted",children:s.date})]}),e.jsx(y,{color:F(s.status),shape:"rounded-pill",children:Q(s.status)})]})},s.id)):e.jsx("div",{className:"text-muted text-center py-5",children:j("dashboard.noProductUpdates")})})]})})})]}),e.jsxs(m,{children:[e.jsx(u,{lg:4,className:"mb-4",children:e.jsx(h,{className:"dashboard-card",children:e.jsxs(x,{children:[e.jsxs(b,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"🔗"}),j("dashboard.quickLinks")]}),e.jsx(N,{flush:!0,children:O.map(s=>e.jsx(v,{children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("span",{className:"me-3 fs-5",children:X(s.type)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.title}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-decoration-none text-primary small",style:{wordBreak:"break-all"},children:s.url})]})]})},s.id))})]})})}),e.jsx(u,{lg:4,className:"mb-4",children:e.jsx(h,{className:"dashboard-card",children:e.jsxs(x,{children:[e.jsxs(b,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"📁"}),j("dashboard.recentFiles")]}),e.jsx(N,{flush:!0,children:U.map(s=>e.jsx(v,{style:{cursor:"pointer"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",children:W(s.type)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark small",style:{wordBreak:"break-all"},children:s.name}),e.jsxs("small",{className:"text-muted",children:[s.size," • ",s.date]})]})]})},s.id))})]})})}),e.jsx(u,{lg:4,className:"mb-4",children:e.jsx(h,{className:"dashboard-card",children:e.jsxs(x,{children:[e.jsxs(b,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"📝"}),j("dashboard.myLatestProposals")]}),e.jsx(N,{flush:!0,children:k.slice(0,5).map(s=>e.jsx(v,{style:{cursor:"pointer"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-semibold text-dark small",style:{wordBreak:"break-all"},children:s.description||"No Description"}),e.jsx("small",{className:"text-muted",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx(y,{color:F(s.status),shape:"rounded-pill",className:"ms-2",children:Q(s.status)})]})},s.id))}),e.jsx("div",{className:"text-center mt-3",children:e.jsx(g,{variant:"outline",color:"secondary",size:"sm",className:"btn-view-all",onClick:()=>{B("/quotes")},children:j("dashboard.viewAllProposals")})})]})})})]})]})};export{A as default};
