import{j as e}from"./date-vendor-DfW9khhA.js";import{u as s,r}from"./react-vendor-Dhx0OYb2.js";import{u as t,a as c}from"./redux-vendor-B0DAdCYB.js";import{u as a,k as o,g as i,m as l,n}from"./index-CRxBN8Fj.js";import{S as d}from"./utils-vendor-Nl-sF5xe.js";import{h as m,e as u,r as h,R as x,S as j,b as p,d as N,T as g,U as f,V as v,w as y,C,Z as b,_ as w,$ as P,a0 as k,a1 as S,a2 as T,v as A}from"./ui-vendor-pFEG3kEv.js";import{P as L}from"./PaginationComponent-D6Bf1rUy.js";import{w as z}from"./withContractorScope-ddaNi-VC.js";import{P as E}from"./PermissionGate-CqyDRWQG.js";import{P as M}from"./PageHeader-UABCfWk-.js";import{F as B}from"./index-CN1WxwnF.js";import{c as D}from"./cil-plus-D8mtC-W5.js";import{c as R}from"./cil-search-CDkY_4k-.js";import{c as F,a as G}from"./DefaultLayout-CNvO87EM.js";import{c as H}from"./cil-envelope-closed-DSbcONbs.js";import{c as I}from"./cil-pencil-m516yCOw.js";import{c as O}from"./cil-trash-CBbKHhHb.js";import{c as Y}from"./cil-phone-4mwkG2LD.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";const $=z(({isContractor:z,contractorGroupId:$,contractorModules:_,contractorGroupName:U})=>{const{t:V}=a(),Z=t(),Q=c(e=>e.customers.list),W=c(e=>e.customers.loading),X=c(e=>e.customers.error),q=c(e=>e.customers.totalPages),J=c(e=>e.customers.total),K=s(),[ee,se]=r.useState(""),[re,te]=r.useState({key:null,direction:"asc"}),[ce,ae]=r.useState(10),[oe,ie]=r.useState(1);r.useEffect(()=>{Z(o({page:oe,limit:ce,groupId:z?$:null}))},[Z,oe,ce,z,$]);const le=e=>{const s=[];e.address&&s.push(e.address),e.aptOrSuite&&s.push(e.aptOrSuite);const r=[];return e.city&&r.push(e.city),e.state&&r.push(e.state),e.zipCode&&r.push(e.zipCode),r.length>0&&s.push(r.join(", ")),s.length>0?s.join(", "):null},ne=e=>{te(s=>{const r=s.key===e&&"asc"===s.direction?"desc":"asc";return{key:e,direction:r}})},de=e=>{const s=`/${i(6)}/${i(8)}`+l("/customers/edit/:id",{id:e.id});K(s)},me=async e=>{if((await d.fire({title:V("customers.confirmTitle","Are you sure?"),text:V("customers.confirmText","This action cannot be undone!"),icon:"warning",showCancelButton:!0,confirmButtonText:V("customers.confirmYes","Yes, delete it!"),cancelButtonText:V("customers.confirmNo","No, cancel!"),reverseButtons:!0})).isConfirmed)try{await Z(n(e)).unwrap(),await d.fire(V("customers.deleted","Deleted!"),V("customers.deletedMsg","The customer has been deleted."),"success");Z(o({page:oe,limit:ce,groupId:z?$:null}))}catch(s){d.fire(V("common.error","Error!"),s.message||V("customers.deleteFailed","Failed to delete customer. Please try again."),"error")}else d.fire(V("customers.cancelled","Cancelled"),V("customers.notDeleted","The customer was not deleted."),"info")},ue=r.useMemo(()=>{let e=Q.filter(e=>e.name?.toLowerCase().includes(ee)||e.email?.toLowerCase().includes(ee));return re.key&&e.sort((e,s)=>{const r=e[re.key]?.toLowerCase?.()??"",t=s[re.key]?.toLowerCase?.()??"";return r<t?"asc"===re.direction?-1:1:r>t?"asc"===re.direction?1:-1:0}),e},[Q,ee,re]),he=e=>re.key!==e?"↕️":"asc"===re.direction?"↑":"↓";return e.jsxs(m,{fluid:!0,className:"dashboard-container",children:[e.jsx(M,{title:V("customers.header"),subtitle:V("customers.subtitle"),icon:B,children:e.jsx(E,{permission:"customers:create",children:e.jsxs(u,{color:"light",onClick:()=>{K("/customers/add")},children:[e.jsx(h,{icon:D,className:"me-2"}),V("nav.addCustomer")]})})}),e.jsxs(x,{className:"mb-4 g-3",children:[e.jsx(j,{sm:6,md:3,children:e.jsx(p,{className:"stat-card-sm",style:{borderColor:"var(--cui-primary)"},children:e.jsxs(N,{children:[e.jsx("div",{className:"stat-number text-primary",children:J||0}),e.jsx("div",{className:"stat-label",children:V("customers.total")})]})})}),e.jsx(j,{sm:6,md:3,children:e.jsx(p,{className:"stat-card-sm",style:{borderColor:"var(--cui-success)"},children:e.jsxs(N,{children:[e.jsx("div",{className:"stat-number text-success",children:Q.filter(e=>!e.deleted_at).length}),e.jsx("div",{className:"stat-label",children:V("customers.active")})]})})}),e.jsx(j,{sm:6,md:3,children:e.jsx(p,{className:"stat-card-sm",style:{borderColor:"var(--cui-warning)"},children:e.jsxs(N,{children:[e.jsx("div",{className:"stat-number text-warning",children:Q.filter(e=>e.email).length}),e.jsx("div",{className:"stat-label",children:V("customers.withEmail")})]})})}),e.jsx(j,{sm:6,md:3,children:e.jsx(p,{className:"stat-card-sm",style:{borderColor:"var(--cui-danger)"},children:e.jsxs(N,{children:[e.jsx("div",{className:"stat-number text-danger",children:ue.length}),e.jsx("div",{className:"stat-label",children:V("customers.filtered")})]})})})]}),e.jsx(p,{className:"filter-card",children:e.jsx(N,{children:e.jsxs(x,{className:"align-items-center g-3",children:[e.jsx(j,{md:6,children:e.jsxs(g,{children:[e.jsx(f,{children:e.jsx(h,{icon:R})}),e.jsx(v,{placeholder:V("customers.searchPlaceholder"),value:ee,onChange:e=>se(e.target.value.toLowerCase())})]})}),e.jsx(j,{md:3,children:e.jsxs(y,{value:ce,onChange:e=>ae(Number(e.target.value)),children:[e.jsxs("option",{value:5,children:["5 ",V("customers.perPage","per page")]}),e.jsxs("option",{value:10,children:["10 ",V("customers.perPage","per page")]}),e.jsxs("option",{value:25,children:["25 ",V("customers.perPage","per page")]}),e.jsxs("option",{value:50,children:["50 ",V("customers.perPage","per page")]})]})}),e.jsx(j,{md:3,className:"text-end",children:e.jsxs("small",{className:"text-muted",children:[V("customers.showing","Showing")," ",ue.length," ",V("customers.of","of")," ",J," ",V("customers.customersLower","customers"),z&&e.jsxs("div",{className:"text-primary small",children:["(",U,")"]})]})})]})})}),W&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(C,{color:"primary"}),e.jsx("p",{className:"mt-3 text-muted",children:V("customers.loading","Loading customers...")})]}),X&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsxs("strong",{children:[V("common.error","Error"),":"]})," ",X]}),!W&&!X&&e.jsx("div",{className:"table-responsive-md",children:e.jsx(p,{className:"data-table-card",children:e.jsxs(b,{hover:!0,children:[e.jsx(w,{children:e.jsxs(P,{children:[e.jsx(k,{children:V("customers.location","Location")}),e.jsxs(k,{onClick:()=>ne("name"),style:{cursor:"pointer"},children:[e.jsx(h,{icon:F,className:"me-2"}),V("customers.name","Name")," ",he("name")]}),e.jsxs(k,{onClick:()=>ne("email"),style:{cursor:"pointer"},children:[e.jsx(h,{icon:H,className:"me-2"}),V("customers.email","Email")," ",he("email")]}),e.jsx(k,{children:V("customers.phone","Phone")}),e.jsx(k,{children:V("customers.address","Address")}),e.jsx(k,{children:V("customers.proposalsHeader","Proposals")}),e.jsx(k,{children:V("customers.ordersHeader","Orders")}),e.jsx(k,{className:"text-center",children:V("customers.actions","Actions")})]})}),e.jsx(S,{children:0===ue?.length?e.jsx(P,{children:e.jsxs(T,{colSpan:"8",className:"text-center py-5",children:[e.jsx(h,{icon:R,size:"3xl",className:"text-muted mb-3"}),e.jsx("p",{className:"mb-0",children:V("customers.noResults")}),e.jsx("small",{className:"text-muted",children:V("customers.tryAdjusting")})]})}):ue?.map(s=>e.jsxs(P,{children:[e.jsx(T,{children:e.jsx(A,{color:"secondary",shape:"rounded-pill",children:V("customers.main","Main")})}),e.jsx(T,{className:"fw-medium",children:s.name||"N/A"}),e.jsx(T,{className:"text-muted",children:s.email||"N/A"}),e.jsx(T,{className:"text-muted",children:s.mobile||s.homePhone||"No phone"}),e.jsx(T,{className:"text-muted",children:le(s)||"No address"}),e.jsx(T,{children:e.jsx(A,{color:"info",shape:"rounded-pill",children:V("customers.proposalsCount",{count:s.proposalCount||0})})}),e.jsx(T,{children:e.jsx(A,{color:"success",shape:"rounded-pill",children:V("customers.ordersCount",{count:0})})}),e.jsx(T,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx(E,{action:"update",resource:"customer",item:s,children:e.jsx(u,{color:"primary",variant:"outline",size:"sm",onClick:()=>de(s),title:V("customers.editTooltip","Edit customer"),children:e.jsx(h,{icon:I})})}),e.jsx(E,{action:"delete",resource:"customer",item:s,children:e.jsx(u,{color:"danger",variant:"outline",size:"sm",onClick:()=>me(s.id),title:V("customers.deleteTooltip","Delete customer"),children:e.jsx(h,{icon:O})})})]})})]},s.id))})]})})}),!W&&!X&&e.jsx("div",{className:"mobile-card-view",children:0===ue?.length?e.jsx(p,{children:e.jsxs(N,{className:"text-center py-5",children:[e.jsx(h,{icon:R,size:"3xl",className:"text-muted mb-3"}),e.jsx("p",{className:"mb-0",children:V("customers.noResults")}),e.jsx("small",{className:"text-muted",children:V("customers.tryAdjusting")})]})}):ue?.map(s=>e.jsx(p,{children:e.jsxs(N,{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-start",children:e.jsxs("div",{children:[e.jsx("div",{className:"customer-name",children:s.name||"N/A"}),e.jsx(A,{color:"secondary",shape:"rounded-pill",className:"mt-1",children:V("customers.main","Main")})]})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"contact-info",children:[e.jsx(h,{icon:H}),e.jsx("span",{children:s.email||"N/A"})]}),e.jsxs("div",{className:"contact-info",children:[e.jsx(h,{icon:Y}),e.jsx("span",{children:s.mobile||s.homePhone||"No phone"})]}),e.jsxs("div",{className:"contact-info",children:[e.jsx(h,{icon:G}),e.jsx("span",{children:le(s)||"No address"})]})]}),e.jsxs("div",{className:"stats-pills",children:[e.jsx(A,{color:"info",shape:"rounded-pill",children:V("customers.proposalsCount",{count:s.proposalCount||0})}),e.jsx(A,{color:"success",shape:"rounded-pill",children:V("customers.ordersCount",{count:0})})]}),e.jsxs("div",{className:"actions",children:[e.jsx(E,{action:"update",resource:"customer",item:s,children:e.jsxs(u,{color:"primary",variant:"outline",size:"sm",onClick:()=>de(s),className:"flex-grow-1",children:[e.jsx(h,{icon:I,className:"me-1"}),V("common.edit")]})}),e.jsx(E,{action:"delete",resource:"customer",item:s,children:e.jsxs(u,{color:"danger",variant:"outline",size:"sm",onClick:()=>me(s.id),className:"flex-grow-1",children:[e.jsx(h,{icon:O,className:"me-1"}),V("common.delete")]})})]})]})},s.id))}),!W&&!X&&q>1&&e.jsx(p,{className:"data-table-card mt-4",children:e.jsx(N,{children:e.jsx(L,{currentPage:oe,totalPages:q,onPageChange:e=>{ie(e)},itemsPerPage:ce})})})]})},"customers");export{$ as default};
