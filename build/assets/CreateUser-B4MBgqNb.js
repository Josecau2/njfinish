import{j as s}from"./date-vendor-DfW9khhA.js";import{u as e,r}from"./react-vendor-Dhx0OYb2.js";import{h as a,b as i,d as t,a3 as n,R as l,S as o,r as c,a8 as d,e as m,a4 as u,T as f,U as x,V as p,a7 as g,w as h}from"./ui-vendor-pFEG3kEv.js";import{u as j,a as v}from"./redux-vendor-B0DAdCYB.js";import{u as b,H as N,x as w,N as y}from"./index-CRxBN8Fj.js";import{S as C}from"./utils-vendor-Nl-sF5xe.js";import{P as S}from"./PageHeader-UABCfWk-.js";import{c as k}from"./cil-user-plus-9sfVD_63.js";import{c as P,b as R,f as q,a as B}from"./DefaultLayout-CNvO87EM.js";import{c as G}from"./cil-envelope-closed-DSbcONbs.js";import{c as I}from"./cil-arrow-left-D66Kb3Zq.js";import{c as z}from"./cil-save-CHBg7z_U.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";const T=({title:e,icon:r,children:a,className:n=""})=>s.jsx(i,{className:`settings-section-card ${n}`,children:s.jsxs(t,{className:"p-3 p-md-4",children:[s.jsxs("div",{className:"settings-section-header",children:[s.jsx("div",{className:"settings-section-icon",children:s.jsx(c,{icon:r,size:"sm"})}),s.jsx("h6",{className:"settings-section-title",children:e})]}),a]})}),_=({label:e,name:r,type:a="text",required:i=!1,icon:t=null,placeholder:n="",value:l,onChange:o,isInvalid:d,feedback:m,...h})=>s.jsxs("div",{className:"mb-3",children:[s.jsxs(u,{htmlFor:r,className:"settings-form-label",children:[e,i&&s.jsx("span",{className:"text-danger ms-1",children:"*"})]}),s.jsxs(f,{children:[t&&s.jsx(x,{className:"settings-form-input-group-text",children:s.jsx(c,{icon:t,size:"sm",className:"text-muted"})}),s.jsx(p,{type:a,id:r,name:r,value:l,onChange:o,placeholder:n,invalid:d,className:"settings-form-input "+(t?"border-start-0":""),...h}),m&&s.jsx(g,{children:m})]})]}),D=({label:e,name:r,required:a=!1,icon:i=null,children:t,value:n,onChange:l,isInvalid:o,feedback:d,...m})=>s.jsxs("div",{className:"mb-3",children:[s.jsxs(u,{htmlFor:r,className:"settings-form-label",children:[e,a&&s.jsx("span",{className:"text-danger ms-1",children:"*"})]}),s.jsxs(f,{children:[i&&s.jsx(x,{className:"settings-form-input-group-text",children:s.jsx(c,{icon:i,size:"sm",className:"text-muted"})}),s.jsx(h,{id:r,name:r,value:n,onChange:l,invalid:o,className:"settings-form-input "+(i?"border-start-0":""),...m,children:t}),d&&s.jsx(g,{children:d})]})]}),E={name:"",email:"",password:"",confirmPassword:"",userGroup:"",location:"",isSalesRep:!1},F=()=>{const{t:u}=b(),f=j(),{error:x}=v(s=>s.users),{list:p=[]}=v(s=>s.usersGroup||{}),{list:g=[]}=v(s=>s.locations||{}),h=e(),[F,O]=r.useState(E),$=r.useRef(E),[A,H]=r.useState(!1),[J,L]=r.useState(!1),[M,Q]=r.useState({}),[U,V]=r.useState(!1);r.useEffect(()=>{f(N()),f(w())},[f]);const W=s=>{const{name:e,value:r,type:a,checked:i}=s.target;O(s=>({...s,[e]:"checkbox"===a?i:r})),M[e]&&Q(s=>({...s,[e]:""}))},X=async(s,e=!1)=>{if(s.preventDefault(),(()=>{const s={};return F.name.trim()||(s.name=u("settings.users.form.validation.nameRequired")),F.email.trim()?/^\S+@\S+\.\S+$/.test(F.email)||(s.email=u("settings.users.form.validation.invalidEmail")):s.email=u("settings.users.form.validation.emailRequired"),F.password||(s.password=u("settings.users.form.validation.passwordRequired")),F.confirmPassword?F.password!==F.confirmPassword&&(s.confirmPassword=u("settings.users.form.validation.passwordMismatch")):s.confirmPassword=u("settings.users.form.validation.confirmPasswordRequired"),F.userGroup||(s.userGroup=u("settings.users.form.validation.userGroupRequired")),Q(s),0===Object.keys(s).length})()){V(!0);try{const r=await f(y({...F,force:e}));if(r?.payload?.email_exists_but_deleted){return(await C.fire({title:u("settings.users.alerts.emailDeletedTitle"),text:u("settings.users.alerts.emailDeletedText"),icon:"warning",showCancelButton:!0,confirmButtonText:u("settings.users.alerts.restoreYes"),cancelButtonText:u("common.no")})).isConfirmed?X(s,!0):void 0}200==r?.payload?.status&&(C.fire(u("common.success")+"!",r.payload.message,"success"),h("/settings/users"))}catch(r){C.fire(u("common.error"),r.message||u("settings.users.alerts.genericError"),"error")}finally{V(!1)}}};return s.jsxs(a,{fluid:!0,className:"settings-form-container",children:[s.jsx(S,{title:u("settings.users.create.title"),subtitle:u("settings.users.create.subtitle"),icon:k,showBackButton:!0,onBackClick:()=>h("/settings/users")}),x&&s.jsx(i,{className:"settings-section-card",children:s.jsx(t,{className:"p-3",children:s.jsxs("div",{className:"alert alert-danger mb-0",children:[s.jsxs("strong",{children:[u("common.error"),":"]})," ","string"==typeof x?x:x.message||u("settings.users.alerts.genericError")]})})}),s.jsxs(n,{onSubmit:X,children:[s.jsx(T,{title:u("settings.users.form.titles.basicInfo"),icon:P,children:s.jsxs(l,{children:[s.jsx(o,{xs:12,md:6,children:s.jsx(_,{label:u("settings.users.form.labels.fullName"),name:"name",required:!0,icon:P,placeholder:u("settings.users.form.placeholders.fullName"),value:F.name,onChange:W,isInvalid:!!M.name,feedback:M.name})}),s.jsx(o,{xs:12,md:6,children:s.jsx(_,{label:u("settings.users.form.labels.email"),name:"email",type:"email",required:!0,icon:G,placeholder:u("settings.users.form.placeholders.email"),value:F.email,onChange:W,isInvalid:!!M.email,feedback:M.email})})]})}),s.jsx(T,{title:u("settings.users.form.titles.security"),icon:R,children:s.jsxs(l,{children:[s.jsx(o,{xs:12,md:6,children:s.jsx(_,{label:u("settings.users.form.labels.password"),name:"password",type:A?"text":"password",required:!0,icon:q,placeholder:u("settings.users.form.placeholders.password"),value:F.password,onChange:W,isInvalid:!!M.password,feedback:M.password})}),s.jsx(o,{xs:12,md:6,children:s.jsx(_,{label:u("settings.users.form.labels.confirmPassword"),name:"confirmPassword",type:J?"text":"password",required:!0,icon:q,placeholder:u("settings.users.form.placeholders.confirmPassword"),value:F.confirmPassword,onChange:W,isInvalid:!!M.confirmPassword,feedback:M.confirmPassword})})]})}),s.jsxs(T,{title:u("settings.users.form.titles.roleAccess"),icon:R,children:[s.jsxs(l,{children:[s.jsx(o,{xs:12,md:6,children:s.jsxs(D,{label:u("settings.users.form.labels.userGroup"),name:"userGroup",required:!0,icon:P,value:F.userGroup,onChange:W,isInvalid:!!M.userGroup,feedback:M.userGroup,children:[s.jsx("option",{value:"",children:u("settings.users.form.select.group")}),(p||[]).map(e=>{const r=e?.user_group?.name??e?.name??`Group #${e?.id??""}`,a=e?.user_group?.id??e?.id;return s.jsx("option",{value:a,children:r},a??r)})]})}),s.jsx(o,{xs:12,md:6,children:s.jsxs(D,{label:u("settings.users.form.labels.location"),name:"location",icon:B,value:F.location,onChange:W,isInvalid:!!M.location,feedback:M.location,children:[s.jsx("option",{value:"",children:u("settings.users.form.select.location")}),g.map(e=>s.jsx("option",{value:e.id,children:e.locationName},e.id))]})})]}),s.jsx("div",{className:"mb-3",children:s.jsxs("div",{className:"d-flex align-items-center justify-content-between p-3 rounded-3",style:{backgroundColor:"#f8f9fa",border:"1px solid #e3e6f0"},children:[s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"32px",height:"32px",backgroundColor:F.isSalesRep?"#e6ffed":"#fff3cd",color:F.isSalesRep?"#28a745":"#856404"},children:s.jsx(c,{icon:P,size:"sm"})}),s.jsxs("div",{children:[s.jsx("div",{className:"fw-semibold text-dark small",children:u("settings.users.form.labels.salesRep")}),s.jsx("div",{className:"text-muted",style:{fontSize:"12px"},children:u("settings.users.form.hints.salesRep")})]})]}),s.jsx(d,{id:"isSalesRep",name:"isSalesRep",checked:F.isSalesRep,onChange:W,size:"lg",style:{transform:"scale(1.1)"}})]})})]}),s.jsx(i,{className:"settings-form-actions",children:s.jsx(t,{className:"p-3 p-md-4",children:s.jsxs("div",{className:"d-flex flex-column flex-md-row gap-2 gap-md-3 justify-content-end",children:[s.jsxs(m,{type:"button",color:"light",size:"md",className:"settings-form-cancel-btn order-2 order-md-1",onClick:()=>{JSON.stringify(F)!==JSON.stringify($.current)?C.fire({title:u("common.confirm")||"Are you sure?",text:u("settings.users.form.alerts.leaveWarning"),icon:"warning",showCancelButton:!0,confirmButtonText:u("settings.users.form.alerts.leaveAnyway"),cancelButtonText:u("settings.users.form.alerts.stayOnPage"),confirmButtonColor:"#d33",cancelButtonColor:"#6c757d"}).then(s=>{s.isConfirmed&&h("/settings/users")}):h("/settings/users")},children:[s.jsx(c,{icon:I,className:"me-2"}),u("common.cancel")]}),s.jsx(m,{type:"submit",color:"success",size:"md",disabled:U,className:"settings-form-submit-btn order-1 order-md-2",children:U?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",style:{width:"14px",height:"14px"},children:s.jsx("span",{className:"visually-hidden",children:u("common.loading")})}),u("settings.users.create.submitting")]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{icon:z,className:"me-2"}),u("settings.users.create.submit")]})})]})})})]})]})};export{F as default};
