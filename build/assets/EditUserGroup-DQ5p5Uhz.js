import{j as e}from"./date-vendor-DfW9khhA.js";import{u as s,h as r,r as t}from"./react-vendor-Dhx0OYb2.js";import{h as a,e as o,r as i,a3 as n,R as l,S as d,a4 as c,b as m,d as u,T as p,U as x,V as h,a7 as f}from"./ui-vendor-pFEG3kEv.js";import{u as g,a as j}from"./redux-vendor-B0DAdCYB.js";import{u as b,d as y,a as N}from"./index-CRxBN8Fj.js";import{S as v}from"./utils-vendor-Nl-sF5xe.js";import{P as k}from"./PageHeader-UABCfWk-.js";import{c as w}from"./cil-user-follow-9sfVD_63.js";import{c as G}from"./cil-arrow-left-D66Kb3Zq.js";import{c as C}from"./cil-group-DQU-yEHN.js";import{b as z}from"./DefaultLayout-CNvO87EM.js";import{c as S}from"./cil-save-CHBg7z_U.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";const B=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},R=({title:s,icon:r,children:t,className:a="",customization:o={}})=>e.jsx(m,{className:`border-0 shadow-sm mb-2 mb-md-4 ${a}`,children:e.jsxs(u,{className:"p-3 p-md-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-2 me-md-3",style:{width:"32px",height:"32px",backgroundColor:`${o.headerBg||"#667eea"}20`,color:o.headerBg||"#667eea"},children:e.jsx(i,{icon:r,size:"sm"})}),e.jsx("h6",{className:"mb-0 fw-semibold text-dark small",children:s})]}),t]})}),$=({label:s,name:r,type:t="text",required:a=!1,icon:o=null,placeholder:n="",value:l,onChange:d,isInvalid:m,feedback:u,...g})=>e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{htmlFor:r,className:"fw-medium text-dark mb-2 small",children:[s,a&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsxs(p,{children:[o&&e.jsx(x,{className:"d-none d-md-flex",style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",border:"1px solid #e3e6f0",borderRight:"none"},children:e.jsx(i,{icon:o,size:"sm",style:{color:"#6c757d"}})}),e.jsx(h,{id:r,name:r,type:t,value:l,onChange:d,invalid:m,placeholder:n,style:{border:"1px solid "+(m?"#dc3545":"#e3e6f0"),borderRadius:o?"0 8px 8px 0":"8px",fontSize:"14px",padding:"12px 16px",transition:"all 0.3s ease",borderLeft:o&&window.innerWidth>=768?"none":"1px solid #e3e6f0"},...g})]}),u&&e.jsx(f,{invalid:!0,children:u})]}),I={name:"",group_type:"standard",modules:{dashboard:!1,proposals:!1,customers:!1,resources:!1}},O=()=>{const{t:p}=b();g();const x=s(),{id:h}=r(),f=y(h),[O,D]=t.useState(I),_=t.useRef(I),[A,H]=t.useState({}),[P,q]=t.useState(!1),[F,T]=t.useState(!0),E=j(e=>e.customization),J=e=>{if(!e)return"#ffffff";const s=e.replace("#","");return(.299*parseInt(s.substr(0,2),16)+.587*parseInt(s.substr(2,2),16)+.114*parseInt(s.substr(4,2),16))/255>.5?"#2d3748":"#ffffff"};t.useEffect(()=>{f&&(async()=>{try{const e=await N.get(`/api/usersgroups/${f}`,{headers:B()});if(e.data.user){const s={name:e.data.user.name||"",group_type:e.data.user.group_type||"standard",modules:e.data.user.modules||I.modules};D(s),_.current=s}}catch(e){v.fire(p("common.error"),p("settings.userGroups.edit.loadFailedOne"),"error"),x("/settings/users")}finally{T(!1)}})()},[f,x]);const L=e=>{const{name:s,value:r,type:t,checked:a}=e.target;D(e=>({...e,[s]:"checkbox"===t?a:r})),A[s]&&H(e=>({...e,[s]:""}))};return F?e.jsx(a,{fluid:!0,className:"p-1 p-md-2 m-0 m-md-2",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:p("common.loading")})}),e.jsx("p",{className:"mt-3 text-muted",children:p("settings.userGroups.edit.loadingOne")})]})})}):e.jsxs(a,{fluid:!0,className:"p-1 p-md-2 m-0 m-md-2",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:[e.jsx(k,{title:p("settings.userGroups.edit.title"),subtitle:p("settings.userGroups.edit.subtitle"),icon:w,rightContent:e.jsxs(o,{color:"light",className:"shadow-sm px-3 px-md-4 fw-semibold w-100 w-md-auto",size:"sm",onClick:()=>x("/settings/users"),style:{borderRadius:"25px",border:"none",transition:"all 0.3s ease"},children:[e.jsx(i,{icon:G,className:"me-2"}),p("common.back")]})}),e.jsxs(n,{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return O.name.trim()||(e.name=p("settings.userGroups.form.validation.nameRequired")),H(e),0===Object.keys(e).length})()){q(!0);try{const e=await N.put(`/api/usersgroups/${f}`,O);200===e.data.status&&(v.fire(p("common.success")+"!",e.data.message||p("settings.userGroups.alerts.updated"),"success"),x("/settings/users"))}catch(s){v.fire(p("common.error"),s.message||p("settings.userGroups.alerts.genericError"),"error")}finally{q(!1)}}},children:[e.jsx(R,{title:p("settings.userGroups.form.titles.groupInfo"),icon:C,customization:E,children:e.jsxs(l,{children:[e.jsx(d,{xs:12,md:8,lg:6,children:e.jsx($,{label:p("settings.userGroups.form.labels.name"),name:"name",required:!0,icon:C,placeholder:p("settings.userGroups.form.placeholders.name"),value:O.name,onChange:L,isInvalid:!!A.name,feedback:A.name})}),e.jsx(d,{xs:12,md:4,lg:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{className:"fw-medium text-dark mb-2 small",children:[p("settings.userGroups.form.labels.type"),e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsxs("select",{name:"group_type",value:O.group_type,onChange:L,className:"form-select",style:{border:"1px solid #e3e6f0",borderRadius:"8px",fontSize:"14px",padding:"12px 16px"},children:[e.jsx("option",{value:"standard",children:p("settings.userGroups.types.standard")}),e.jsx("option",{value:"contractor",children:p("settings.userGroups.types.contractor")})]})]})})]})}),"contractor"===O.group_type&&e.jsxs(R,{title:p("settings.userGroups.form.titles.modulePermissions"),icon:z,customization:E,children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"d-flex align-items-start p-3 rounded-3",style:{backgroundColor:"#e7f3ff",border:"1px solid #b3d7ff"},children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-3 flex-shrink-0",style:{width:"32px",height:"32px",backgroundColor:E.headerBg||"#667eea",color:J(E.headerBg||"#667eea")},children:e.jsx(i,{icon:z,size:"sm"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark small mb-1",children:p("settings.userGroups.moduleAccess.title")}),e.jsx("div",{className:"text-muted",style:{fontSize:"12px",lineHeight:"1.4"},children:p("settings.userGroups.moduleAccess.description")})]})]})}),e.jsx(l,{children:Object.entries(O.modules).map(([s,r])=>e.jsxs(d,{xs:12,sm:6,md:3,className:"mb-3",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`module-${s}`,name:`modules.${s}`,checked:r,onChange:e=>{D(r=>({...r,modules:{...r.modules,[s]:e.target.checked}}))},style:{width:"3rem",height:"1.5rem"}}),e.jsx("label",{className:"form-check-label fw-medium",htmlFor:`module-${s}`,children:s.charAt(0).toUpperCase()+s.slice(1)})]}),e.jsxs("small",{className:"text-muted d-block mt-1",children:["dashboard"===s&&p("settings.userGroups.moduleDescriptions.dashboard"),"proposals"===s&&p("settings.userGroups.moduleDescriptions.proposals"),"customers"===s&&p("settings.userGroups.moduleDescriptions.customers"),"resources"===s&&p("settings.userGroups.moduleDescriptions.resources")]})]},s))})]}),e.jsx(m,{className:"border-0 shadow-sm",children:e.jsx(u,{className:"p-3 p-md-4",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row gap-2 gap-md-3 justify-content-end",children:[e.jsxs(o,{type:"button",color:"light",size:"md",className:"px-3 px-md-4 fw-semibold order-2 order-md-1",onClick:()=>{JSON.stringify(O)!==JSON.stringify(_.current)?v.fire({title:p("common.confirm"),text:p("settings.userGroups.alerts.leaveWarning"),icon:"warning",showCancelButton:!0,confirmButtonText:p("settings.userGroups.alerts.leaveAnyway"),cancelButtonText:p("settings.userGroups.alerts.stayOnPage"),confirmButtonColor:"#d33",cancelButtonColor:"#6c757d"}).then(e=>{e.isConfirmed&&x("/settings/users")}):x("/settings/users")},style:{borderRadius:"25px",border:"1px solid #e3e6f0",transition:"all 0.3s ease"},children:[e.jsx(i,{icon:G,className:"me-2"}),p("common.cancel")]}),e.jsxs(o,{type:"submit",color:"primary",size:"md",disabled:P,className:"px-4 px-md-5 fw-semibold order-1 order-md-2",style:{borderRadius:"25px",border:"none",background:E.headerBg||"#667eea",color:J(E.headerBg||"#667eea"),transition:"all 0.3s ease"},children:[e.jsx(i,{icon:S,className:"me-2"}),p(P?"settings.userGroups.edit.updating":"settings.userGroups.edit.update")]})]})})})]})]})};export{O as default};
