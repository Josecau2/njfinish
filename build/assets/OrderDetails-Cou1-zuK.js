import{j as s}from"./date-vendor-DfW9khhA.js";import{h as e,r}from"./react-vendor-Dhx0OYb2.js";import{a}from"./index-CRxBN8Fj.js";import{P as t}from"./PageHeader-UABCfWk-.js";import{l}from"./index-CN1WxwnF.js";import{h as n,C as c,a as i,R as m,S as d,b as o,c as u,d as x,v as h,Z as j,_ as y,$ as p,a0 as N,a1 as g,a2 as f}from"./ui-vendor-pFEG3kEv.js";import"./form-vendor-C_vzjFiG.js";import"./redux-vendor-B0DAdCYB.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-CVrEPnlB.js";const b=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Number(s||0)),v=()=>{const{id:v}=e(),[S,A]=r.useState(!0),[T,M]=r.useState(null),[D,I]=r.useState(null);r.useEffect(()=>{v&&(async()=>{try{A(!0);const{data:s}=await a.get(`/api/quotes/proposalByID/${v}`);I(s),M(null)}catch(s){M(s.response?.data?.message||s.message)}finally{A(!1)}})()},[v]);const C=r.useMemo(()=>{if(D?.order_snapshot){const s="string"==typeof D.order_snapshot?JSON.parse(D.order_snapshot):D.order_snapshot,e=[];for(const a of s.manufacturers||[])Array.isArray(a.items)&&e.push(...a.items),Array.isArray(a.customItems)&&e.push(...a.customItems);const r=s.totals||{grandTotal:0};return{manufacturers:s.manufacturers||[],items:e,summary:r}}return(s=>{if(!s)return{manufacturers:[],items:[],summary:{grandTotal:0}};try{const e="string"==typeof s?JSON.parse(s):s,r=[],a={grandTotal:0,taxAmount:0,discountAmount:0,assemblyFee:0,cabinets:0,modificationsCost:0,styleTotal:0};for(const s of e)Array.isArray(s.items)&&r.push(...s.items),s.summary&&(a.grandTotal+=s.summary.grandTotal||0,a.taxAmount+=s.summary.taxAmount||0,a.discountAmount+=s.summary.discountAmount||0,a.assemblyFee+=s.summary.assemblyFee||0,a.cabinets+=s.summary.cabinets||0,a.modificationsCost+=s.summary.modificationsCost||0,a.styleTotal+=s.summary.styleTotal||0);return{manufacturers:e,items:r,summary:a}}catch(e){return{manufacturers:[],items:[],summary:{grandTotal:0}}}})(D?.manufacturersData)},[D]);return S?s.jsx(n,{className:"py-5 text-center",children:s.jsx(c,{})}):T?s.jsx(n,{className:"py-4",children:s.jsx(i,{color:"danger",children:T})}):s.jsxs(n,{fluid:!0,children:[s.jsx(t,{title:"Order Details",subtitle:D?.customer?.name?`Customer: ${D.customer.name}`:"Accepted order overview",icon:l}),s.jsxs(m,{className:"mb-3",children:[s.jsx(d,{md:4,children:s.jsxs(o,{children:[s.jsx(u,{children:"Order"}),s.jsxs(x,{children:[s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"ID:"})," ",D?.id]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Date:"})," ",new Date(D?.date||D?.createdAt).toLocaleDateString()]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Status:"})," ",s.jsx(h,{color:"success",children:D?.status||"accepted"})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Accepted at:"})," ",D?.accepted_at?new Date(D.accepted_at).toLocaleString():"N/A"]})]})]})}),s.jsx(d,{md:4,children:s.jsxs(o,{children:[s.jsx(u,{children:"Customer"}),s.jsxs(x,{children:[s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Name:"})," ",D?.customer?.name||"N/A"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Email:"})," ",D?.customer?.email||"N/A"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Phone:"})," ",D?.customer?.mobile||D?.customer?.phone||"N/A"]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Address:"})," ",D?.customer?.address||"N/A"]})]})]})}),s.jsx(d,{md:4,children:s.jsxs(o,{children:[s.jsx(u,{children:"Totals"}),s.jsxs(x,{children:[s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Subtotal (Styles):"})," ",b(C.summary.styleTotal)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Assembly Fee:"})," ",b(C.summary.assemblyFee)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Modifications:"})," ",b(C.summary.modificationsCost)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Discount:"})," ",b(C.summary.discountAmount)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Tax:"})," ",b(C.summary.taxAmount)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Grand Total:"})," ",b(C.summary.grandTotal)]})]})]})})]}),s.jsxs(o,{className:"mb-4",children:[s.jsx(u,{children:"Items"}),s.jsx(x,{children:s.jsx("div",{className:"table-responsive",children:s.jsxs(j,{hover:!0,children:[s.jsx(y,{children:s.jsxs(p,{children:[s.jsx(N,{children:"Manufacturer"}),s.jsx(N,{children:"Item"}),s.jsx(N,{className:"text-end",children:"Qty"}),s.jsx(N,{className:"text-end",children:"Price"}),s.jsx(N,{className:"text-end",children:"Total"})]})}),s.jsx(g,{children:0===C.items.length?s.jsx(p,{children:s.jsx(f,{colSpan:5,className:"text-center text-muted py-4",children:"No items"})}):C.items.map((e,r)=>s.jsxs(p,{children:[s.jsx(f,{children:e.manufacturer||e.manufacturerName||"-"}),s.jsx(f,{children:e.name||e.description||e.item||"-"}),s.jsx(f,{className:"text-end",children:e.qty||e.quantity||1}),s.jsx(f,{className:"text-end",children:b(e.price||e.unitPrice||0)}),s.jsx(f,{className:"text-end",children:b((e.qty||e.quantity||1)*(e.price||e.unitPrice||0))})]},r))})]})})})]}),s.jsxs(o,{children:[s.jsx(u,{children:"Manufacturers"}),s.jsx(x,{children:0===C.manufacturers.length?s.jsx("div",{className:"text-muted",children:"No manufacturers found"}):s.jsx(m,{className:"g-3",children:C.manufacturers.map((e,r)=>s.jsx(d,{md:6,children:s.jsxs(o,{children:[s.jsx(u,{children:e.manufacturerName||e.name||e.manufacturer||`Manufacturer ${r+1}`}),s.jsxs(x,{children:[e.selectedStyleImage||e.selectedStyleName||e.selectedStyle||e.style?s.jsxs("div",{className:"d-flex align-items-center gap-3 mb-3",children:[e.selectedStyleImage&&s.jsx("img",{src:`https://app.nj.contractors/uploads/images/${e.selectedStyleImage}`,alt:e.selectedStyleName||e.selectedStyle||"Style",style:{width:96,height:64,objectFit:"cover",borderRadius:4,border:"1px solid #eee"},onError:s=>{s.currentTarget.style.display="none"}}),s.jsxs("div",{children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Style:"})," ",e.selectedStyleName||e.selectedStyle||e.style||"-"]}),e.selectedStyleCode&&s.jsx("div",{className:"text-muted small",children:e.selectedStyleCode})]})]}):null,s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Style Total:"})," ",b(e.summary?.styleTotal)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Assembly Fee:"})," ",b(e.summary?.assemblyFee)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Tax:"})," ",b(e.summary?.taxAmount)]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Grand Total:"})," ",b(e.summary?.grandTotal)]}),(e.appliedManufacturerMultiplier||e.appliedUserGroupMultiplier)&&s.jsx("div",{className:"text-muted small mt-2",children:s.jsxs("div",{children:["Applied multipliers: M×",e.appliedManufacturerMultiplier||1," • U×",e.appliedUserGroupMultiplier||1]})})]})]})},r))})})]})]})};export{v as default};
