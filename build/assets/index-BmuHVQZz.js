import{j as e}from"./date-vendor-DfW9khhA.js";import{r as s}from"./react-vendor-Dhx0OYb2.js";import{u as a,a as r}from"./redux-vendor-B0DAdCYB.js";import{u as o,a as i,Q as n,x as l,R as t}from"./index-BxG4qwLs.js";import{S as c}from"./utils-vendor-Nl-sF5xe.js";import{b as d,d as m,C as p,c as f,a3 as u,R as h,S as x,a4 as j,V as w,a7 as v,w as g,e as y}from"./ui-vendor-pFEG3kEv.js";import"./form-vendor-C_vzjFiG.js";import"./icons-vendor-CVrEPnlB.js";const P=()=>{const{t:P}=o(),N=a(),S=JSON.parse(localStorage.getItem("user")),b=S?.userId,F="contractor"===S?.group?.group_type,{selected:C,loading:R}=r(e=>e.users),{list:E,loading:k}=r(e=>e.locations),[L,q]=s.useState({name:"",email:"",password:"",confirmPassword:"",location:""}),[z,I]=s.useState({}),[O,B]=s.useState(!1),D=s.useRef(L),G=R||k;s.useEffect(()=>{(async()=>{if(F)try{const e=(await i.get("/api/me")).data,s={name:e.name||"",email:e.email||"",password:"",confirmPassword:"",location:""};q(s),D.current=s}catch(e){b&&await N(n(b))}else b&&N(n(b)),N(l())})()},[N,b,F]),s.useEffect(()=>{if(!F&&C){const e={name:C.name||"",email:C.email||"",password:"",confirmPassword:"",location:C.location||""};q(e),D.current=e}},[C,F]);const H=e=>{const{name:s,value:a}=e.target;q(e=>({...e,[s]:a}))};return G?e.jsx("div",{className:"profile-container",children:e.jsx(d,{className:"profile-card",children:e.jsx(m,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx(p,{color:"primary",size:"lg"})})})}):e.jsx("div",{className:"profile-container",children:e.jsxs(d,{className:"profile-card",children:[e.jsx(f,{children:e.jsx("h4",{className:"mb-0",children:P("profile.header")})}),e.jsx(m,{children:e.jsxs(u,{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return L.name.trim()||(e.name=P("profile.validation.nameRequired")),L.password!==L.confirmPassword&&(e.confirmPassword=P("profile.validation.passwordMismatch")),F||L.location.trim()||(e.location=P("profile.validation.locationRequired")),I(e),0===Object.keys(e).length})()){B(!0);try{if(F){const e={name:L.name};L.password&&""!==L.password.trim()&&(e.password=L.password);const s=await i.put("/api/me",e);if(200!==s?.data?.status&&200!==s?.status)throw new Error(s?.data?.message||P("profile.updateFailed"));c.fire(P("common.success"),P("profile.updateSuccess"),"success")}else{const e={...L};delete e.confirmPassword;const s=await N(t({id:b,data:e}));if(200!==s?.payload?.status)throw new Error(s?.payload?.message||P("profile.updateFailed"));c.fire(P("common.success"),P("profile.updateSuccess"),"success")}}catch(s){c.fire(P("common.error"),s.message||P("profile.errorGeneric"),"error")}finally{B(!1)}}},className:"profile-form",children:[e.jsxs(h,{className:"gy-4",children:[e.jsxs(x,{xs:12,md:6,children:[e.jsxs(j,{htmlFor:"name",children:[P("profile.fullName"),e.jsx("span",{style:{color:"red",marginLeft:"4px"},children:"*"})]}),e.jsx(w,{id:"name",name:"name",value:L.name,onChange:H,invalid:!!z.name,placeholder:P("profile.enterName")}),e.jsx(v,{invalid:!0,children:z.name})]}),e.jsxs(x,{xs:12,md:6,children:[e.jsx(j,{htmlFor:"email",children:P("auth.email")}),e.jsx(w,{id:"email",name:"email",value:L.email,disabled:!0,style:{backgroundColor:"#e9ecef",cursor:"not-allowed"}})]}),e.jsxs(x,{xs:12,md:6,children:[e.jsx(j,{htmlFor:"password",children:P("profile.newPassword")}),e.jsx(w,{id:"password",name:"password",type:"password",value:L.password,onChange:H,placeholder:P("profile.leaveBlank")})]}),e.jsxs(x,{xs:12,md:6,children:[e.jsx(j,{htmlFor:"confirmPassword",children:P("profile.confirmPassword")}),e.jsx(w,{id:"confirmPassword",name:"confirmPassword",type:"password",value:L.confirmPassword,onChange:H,invalid:!!z.confirmPassword,placeholder:P("profile.reenterPassword")}),e.jsx(v,{invalid:!0,children:z.confirmPassword})]}),!F&&e.jsxs(x,{xs:12,md:6,children:[e.jsxs(j,{htmlFor:"location",children:[P("profile.location"),e.jsx("span",{style:{color:"red",marginLeft:"4px"},children:"*"})]}),e.jsxs(g,{id:"location",name:"location",value:L.location,onChange:H,invalid:!!z.location,children:[e.jsxs("option",{value:"",children:["-- ",P("profile.selectLocation")," --"]}),E.map(s=>e.jsx("option",{value:s.id,children:s.locationName},s.id))]}),e.jsx(v,{invalid:!0,children:z.location})]})]}),e.jsx("div",{className:"d-flex justify-content-center justify-content-md-end mt-4",children:e.jsx(y,{type:"submit",color:"primary",className:"px-4",disabled:O,children:O?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"sm",className:"me-2"})," ",P("profile.saving")]}):P("profile.updateProfile")})})]})})]})})};export{P as default};
