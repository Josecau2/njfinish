import{j as s}from"./date-vendor-DfW9khhA.js";import{u as e,r as c}from"./react-vendor-Dhx0OYb2.js";import{u as t,a as r}from"./redux-vendor-B0DAdCYB.js";import{u as a,a3 as l,g as n,m as o}from"./index-BxG4qwLs.js";import{h as i,C as d,R as m,S as x,b as j,c as h,r as u,d as p,a as N,T as b,U as v,V as g,Z as f,_ as y,$ as A,a0 as w,a1 as k,a2 as _,v as S,ac as C,e as z}from"./ui-vendor-pFEG3kEv.js";import{P as D}from"./PaginationComponent-Du09fPLe.js";import{l as P}from"./DefaultLayout-CDydDzk1.js";import{c as I}from"./cil-search-CDkY_4k-.js";import{c as U}from"./cil-group-DQU-yEHN.js";import{c as L}from"./cil-chart-ul2n6BfS.js";import"./form-vendor-C_vzjFiG.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-CVrEPnlB.js";const M=()=>{const M=t(),T=e(),{t:$}=a(),{list:O,loading:V,error:E,pagination:H}=r(s=>s.contractors),[R,Z]=c.useState(""),[q,B]=c.useState({key:null,direction:"asc"}),[F,G]=c.useState(10),[J,K]=c.useState(1);c.useEffect(()=>{M(l({page:J,limit:F}))},[M,J,F]);const Q=s=>{B(e=>{const c=e.key===s&&"asc"===e.direction?"desc":"asc";return{key:s,direction:c}})},W=s=>{const e=`/${n(6)}/${n(8)}`+o("/admin/contractors/:id",{id:s.id});T(e)},X=c.useMemo(()=>{if(!O||!Array.isArray(O))return[];let s=O.filter(s=>s.name?.toLowerCase().includes(R.toLowerCase()));return q.key&&s.sort((s,e)=>{let c=s[q.key],t=e[q.key];return"user_count"!==q.key&&"customer_count"!==q.key&&"proposal_count"!==q.key||(c=parseInt(c)||0,t=parseInt(t)||0),c<t?"asc"===q.direction?-1:1:c>t?"asc"===q.direction?1:-1:0}),s},[O,R,q]),Y=e=>{if(!e)return null;const c={dashboard:$("contractorsAdmin.modules.dashboard"),proposals:$("contractorsAdmin.modules.proposals"),customers:$("contractorsAdmin.modules.customers"),resources:$("contractorsAdmin.modules.resources")};return Object.entries(e).filter(([s,e])=>!0===e).map(([e])=>s.jsx(S,{color:"info",className:"me-1",children:c[e]||e},e))},ss=s=>{if(!s)return"N/A";try{const e=new Date(s);return isNaN(e.getTime())?"N/A":e.toLocaleDateString()}catch(e){return"N/A"}},es=H?.totalPages||1;return V&&0===O.length?s.jsx(i,{children:s.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:s.jsx(d,{color:"primary"})})}):s.jsx(i,{className:"px-4",children:s.jsx(m,{children:s.jsx(x,{xs:12,children:s.jsxs(j,{className:"mb-4",children:[s.jsx(h,{children:s.jsxs("strong",{children:[s.jsx(u,{icon:P,className:"me-2"}),$("contractorsAdmin.header")]})}),s.jsxs(p,{children:[E&&s.jsx(N,{color:"danger",className:"mb-3",children:E}),s.jsxs(m,{className:"mb-4",children:[s.jsx(x,{md:6,children:s.jsxs(b,{children:[s.jsx(v,{children:s.jsx(u,{icon:I})}),s.jsx(g,{type:"text",placeholder:$("contractorsAdmin.searchPlaceholder"),value:R,onChange:s=>Z(s.target.value)})]})}),s.jsx(x,{md:6,className:"d-flex justify-content-end align-items-center",children:s.jsx("div",{className:"text-muted",children:s.jsx("small",{children:$("contractorsAdmin.showing",{count:X?.length||0,total:H?.total||0})})})})]}),s.jsxs(m,{className:"mb-4",children:[s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-info py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:$("contractorsAdmin.stats.totalContractors")}),s.jsx("div",{className:"fs-5 fw-semibold",children:H?.total||0})]})}),s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-success py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:$("contractorsAdmin.stats.totalUsers")}),s.jsx("div",{className:"fs-5 fw-semibold",children:(O||[]).reduce((s,e)=>s+(parseInt(e.user_count)||0),0)})]})}),s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-warning py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:$("contractorsAdmin.stats.totalCustomers")}),s.jsx("div",{className:"fs-5 fw-semibold",children:(O||[]).reduce((s,e)=>s+(parseInt(e.customer_count)||0),0)})]})}),s.jsx(x,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-danger py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:$("contractorsAdmin.stats.totalProposals")}),s.jsx("div",{className:"fs-5 fw-semibold",children:(O||[]).reduce((s,e)=>s+(parseInt(e.proposal_count)||0),0)})]})})]}),s.jsx("div",{className:"table-responsive d-none d-md-block",children:s.jsxs(f,{hover:!0,striped:!0,children:[s.jsx(y,{children:s.jsxs(A,{children:[s.jsxs(w,{scope:"col",className:"cursor-pointer",onClick:()=>Q("name"),children:[$("contractorsAdmin.table.contractorName"),"name"===q.key&&s.jsx(u,{icon:"asc"===q.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsxs(w,{scope:"col",className:"cursor-pointer text-center",onClick:()=>Q("user_count"),children:[$("contractorsAdmin.table.users"),"user_count"===q.key&&s.jsx(u,{icon:"asc"===q.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsxs(w,{scope:"col",className:"cursor-pointer text-center",onClick:()=>Q("customer_count"),children:[$("contractorsAdmin.table.customers"),"customer_count"===q.key&&s.jsx(u,{icon:"asc"===q.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsxs(w,{scope:"col",className:"cursor-pointer text-center",onClick:()=>Q("proposal_count"),children:[$("contractorsAdmin.table.proposals"),"proposal_count"===q.key&&s.jsx(u,{icon:"asc"===q.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsx(w,{scope:"col",children:$("contractorsAdmin.table.modules")}),s.jsxs(w,{scope:"col",className:"cursor-pointer",onClick:()=>Q("created_at"),children:[$("contractorsAdmin.table.created"),"created_at"===q.key&&s.jsx(u,{icon:"asc"===q.direction?"cilSortUp":"cilSortDown",className:"ms-1",size:"sm"})]}),s.jsx(w,{scope:"col",className:"text-center",children:$("contractorsAdmin.table.actions")})]})}),s.jsx(k,{children:0===X?.length?s.jsx(A,{children:s.jsxs(_,{colSpan:"7",className:"text-center py-4",children:[s.jsx(u,{icon:I,size:"xl",className:"mb-3 opacity-25"}),s.jsx("p",{className:"text-muted mb-0",children:$("contractorsAdmin.empty.title")}),s.jsx("small",{children:$("contractorsAdmin.empty.tryAdjusting")})]})}):X?.map(e=>s.jsxs(A,{className:"align-middle",children:[s.jsx(_,{children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(u,{icon:U,className:"me-2 text-muted"}),s.jsxs("div",{children:[s.jsx("div",{className:"fw-semibold",children:e.name}),s.jsxs("small",{className:"text-muted",children:["ID: ",e.id]})]})]})}),s.jsx(_,{className:"text-center",children:s.jsx(S,{color:"primary",children:e.user_count||0})}),s.jsx(_,{className:"text-center",children:s.jsx(S,{color:"warning",children:e.customer_count||0})}),s.jsx(_,{className:"text-center",children:s.jsx(S,{color:"success",children:e.proposal_count||0})}),s.jsx(_,{children:s.jsx("div",{className:"d-flex flex-wrap gap-1",children:Y(e.modules)||s.jsx("small",{className:"text-muted",children:$("contractorsAdmin.noModules")})})}),s.jsx(_,{children:s.jsx("small",{className:"text-muted",children:ss(e.created_at)})}),s.jsx(_,{className:"text-center",children:s.jsx(C,{size:"sm",children:s.jsx(z,{color:"outline-primary",size:"sm",onClick:()=>W(e),title:$("contractorsAdmin.actions.viewDetails"),children:s.jsx(u,{icon:L,size:"sm"})})})})]},e.id))})]})}),s.jsx("div",{className:"d-md-none",children:0===X?.length?s.jsx(j,{children:s.jsxs(p,{className:"text-center py-4",children:[s.jsx(u,{icon:I,size:"xl",className:"mb-3 opacity-25"}),s.jsx("p",{className:"text-muted mb-0",children:$("contractorsAdmin.empty.title")}),s.jsx("small",{children:$("contractorsAdmin.empty.tryAdjusting")})]})}):s.jsx("div",{className:"mobile-contractor-cards",children:X?.map(e=>s.jsx(j,{className:"mb-3 contractor-mobile-card",children:s.jsxs(p,{className:"p-3",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[s.jsxs("div",{className:"d-flex align-items-center flex-grow-1",children:[s.jsx(u,{icon:U,className:"me-2 text-muted",size:"lg"}),s.jsxs("div",{className:"flex-grow-1 min-width-0",children:[s.jsx("div",{className:"fw-semibold text-truncate",title:e.name,children:e.name}),s.jsxs("small",{className:"text-muted",children:["ID: ",e.id]})]})]}),s.jsx(z,{color:"outline-primary",size:"sm",onClick:()=>W(e),title:"View Details",className:"ms-2 contractor-action-btn",children:s.jsx(u,{icon:L,size:"sm"})})]}),s.jsxs("div",{className:"row g-2 mb-3",children:[s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:$("contractorsAdmin.table.users")}),s.jsx(S,{color:"primary",className:"w-100",children:e.user_count||0})]}),s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:$("contractorsAdmin.table.customers")}),s.jsx(S,{color:"warning",className:"w-100",children:e.customer_count||0})]}),s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:$("contractorsAdmin.table.proposals")}),s.jsx(S,{color:"success",className:"w-100",children:e.proposal_count||0})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"small text-muted mb-1",children:$("contractorsAdmin.table.modules")}),s.jsx("div",{className:"d-flex flex-wrap gap-1",children:Y(e.modules)||s.jsx("small",{className:"text-muted",children:$("contractorsAdmin.noModules")})})]}),s.jsx("div",{className:"text-end",children:s.jsxs("small",{className:"text-muted",children:[$("contractorsAdmin.table.created"),": ",ss(e.created_at)]})})]})},e.id))})}),es>1&&s.jsx("div",{className:"p-3 border-top border-light",children:s.jsx(D,{currentPage:J,totalPages:es,onPageChange:s=>{K(s)},itemsPerPage:F})})]})]})})})})};export{M as default};
