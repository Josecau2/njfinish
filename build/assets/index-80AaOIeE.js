import{j as e}from"./date-vendor-DfW9khhA.js";import{r as t}from"./react-vendor-Dhx0OYb2.js";import{h as s,r as a,b as r,d as n,R as o,S as c,T as l,U as d,V as i,w as m,ac as p,e as x,c as h,W as u,ad as g,v as b,Z as f,_ as y,$ as j,a0 as N,a1 as w,a2 as v,i as $,j as F,k as S,l as D,m as k}from"./ui-vendor-pFEG3kEv.js";import{u as C,Z as z,a as T}from"./index-BxG4qwLs.js";import{u as P,a as A}from"./redux-vendor-B0DAdCYB.js";import{P as R}from"./PaginationComponent-Du09fPLe.js";import{P as B}from"./PageHeader-UABCfWk-.js";import{c as L}from"./cil-briefcase-Bw71BDXV.js";import{c as U}from"./cil-search-CDkY_4k-.js";import{g as q}from"./DefaultLayout-CDydDzk1.js";import{c as I}from"./cil-pencil-m516yCOw.js";import{c as W}from"./cil-trash-CBbKHhHb.js";import"./form-vendor-C_vzjFiG.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-CVrEPnlB.js";const M=()=>{const{t:M}=C(),H=P(),[E,_]=t.useState(""),[O,V]=t.useState(1),[Y,Z]=t.useState("card"),[X,G]=t.useState(10),[J,K]=t.useState(!1),[Q,ee]=t.useState(null),te=A(e=>e.contracts),{data:se=[],loading:ae,error:re}=te,ne=A(e=>e.customization),oe=e=>{if(!e)return"#ffffff";const t=e.replace("#","");return(.299*parseInt(t.substr(0,2),16)+.587*parseInt(t.substr(2,2),16)+.114*parseInt(t.substr(4,2),16))/255>.5?"#2d3748":"#ffffff"},ce=Array.isArray(se)?se:[],le={manufacturersData:[],designer:"",description:"",date:null,designDate:null,measurementDate:null,status:"Draft",files:[],customerName:""},[de,ie]=t.useState(!0),[me,pe]=t.useState(le);t.useEffect(()=>{H(z())},[H]);const xe=e=>({Draft:"secondary","Measurement Scheduled":"info","Measurement done":"primary","Design done":"success","Follow up 1":"warning","Follow up 2":"warning","Follow up 3":"danger","Proposal accepted":"success"}[e]||"secondary"),he=ce?.filter(e=>{const t=e.customer?.name?.toLowerCase().includes(E.toLowerCase());return t}),ue=he?.slice((O-1)*X,O*X),ge=Math.ceil((he?.length||0)/X),be=e=>{T.get(`/api/quotes/proposalByID/${e}`).then(e=>{pe(e.data||le),ie(!1)}).catch(e=>{ie(!1)}),K(!0)},fe=(e=>{const t="#FFFFFF",s=e?.manufacturersData?.[0]?.items||[],a=M("nav.contracts"),r=M("contracts.pdf.sectionHeader"),n={no:M("contracts.pdf.columns.no"),qty:M("contracts.pdf.columns.qty"),item:M("contracts.pdf.columns.item"),assembled:M("contracts.pdf.columns.assembled"),hingeSide:M("contracts.pdf.columns.hingeSide"),exposedSide:M("contracts.pdf.columns.exposedSide"),price:M("contracts.pdf.columns.price"),assemblyFee:M("contracts.pdf.columns.assemblyFee"),total:M("contracts.pdf.columns.total")},o={items:M("contracts.pdf.categories.items")},c={cabinets:M("contracts.pdf.summary.cabinetsParts"),assemblyFee:M("contracts.pdf.summary.assemblyFee"),modifications:M("contracts.pdf.summary.modifications"),styleTotal:M("contracts.pdf.summary.styleTotal"),total:M("contracts.pdf.summary.total"),tax:M("contracts.pdf.summary.tax"),grandTotal:M("contracts.pdf.summary.grandTotal")},l=M("common.yes"),d=M("common.no"),i=M("common.na"),m=s.map(e=>({qty:e.qty||0,code:e.code||"",assembled:!!e.isRowAssembled,hingeSide:e.hingeSide||null,exposedSide:e.exposedSide||null,price:parseFloat(e.price)||0,assemblyCost:e.includeAssemblyFee&&parseFloat(e.assemblyFee)||0,total:e.includeAssemblyFee?parseFloat(e.total)||0:parseFloat(e.price)||0,modifications:e.modifications||{}})),p=e?.manufacturersData?.[0]?.summary||{},x=e?.manufacturersData?.[0]?.items?.length?{cabinets:p.cabinets||0,assemblyFee:p.assemblyFee||0,modifications:p.modificationsCost||0,styleTotal:p.styleTotal||0,total:p.total||0,tax:p.taxAmount||0,grandTotal:p.grandTotal||0}:{cabinets:0,assemblyFee:0,modifications:0,styleTotal:0,total:0,tax:0,grandTotal:0};return`\n      <!DOCTYPE html>\n      <html>\n      <head>\n          <meta charset="utf-8">\n      <title>${a}</title>\n          <style>\n              @page { margin: 20mm; size: A4; }\n              * { margin: 0; padding: 0; box-sizing: border-box; }\n              body { font-family: 'Arial', sans-serif; font-size: 12px; line-height: 1.4; color: #333; }\n              .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 30px; padding: 20px; border-bottom: 2px solid ${t}; background-color: ${t}; }\n              .logo { max-width: 120px; max-height: 80px; }\n              .company-name { font-size: 24px; font-weight: bold; color: white; }\n              .company-info { text-align: right; line-height: 1.6; color: #000000; }\n              .section-header { font-size: 16px; font-weight: bold; margin: 25px 0 15px 0; text-transform: uppercase; letter-spacing: 0.5px; }\n              .items-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }\n              .items-table th { background-color: #f8f9fa; padding: 10px 8px; border: 1px solid #dee2e6; font-weight: bold; text-align: left; font-size: 11px; }\n              .items-table td { padding: 8px; border: 1px solid #dee2e6; font-size: 10px; }\n              .items-table tr:nth-child(even) { background-color: #f9f9f9; }\n              .category-row { background-color: #e6e6e6 !important; font-weight: bold; }   \n              .text-right { text-align: right; }\n              .text-left { text-align: left; }\n              .price-summary { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 0.5rem; padding: 1rem; margin-top: 1rem; font-family: 'Arial', sans-serif; font-size: 0.95rem; }\n              .price-summary table { width: 100%; border-collapse: collapse; }\n              .price-summary td { padding: 0.25rem 0; }\n              .price-summary .text-left { text-align: left; color: #212529; font-weight: 500; }\n              .price-summary .text-right { text-align: right; color: #212529; font-weight: 500; }\n              .price-summary .total-row { font-weight: bold; border-bottom: 1px solid #ced4da; padding-top: 0.25rem; }\n              .price-summary .grand-total { font-weight: bold; font-size: 1.05rem; color: #1a1a1a; padding-top: 0.75rem; }\n          </style>\n      </head>\n      <body>\n          ${m&&m.length>0?`\n      <div class="section-header">${r}</div>\n          <table class="items-table">\n              <thead>\n                  <tr style="background-color: #f0f0f0;">\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.no}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.qty}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.item}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.assembled}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.hingeSide}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.exposedSide}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.price}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.assemblyFee}</th>\n            <th style="border: 1px solid #ccc; padding: 5px;">${n.total}</th>\n                  </tr>\n              </thead>\n              <tbody>\n                  <tr class="category-row">\n            <td colspan="9" style="padding: 6px;"><strong>${o.items}</strong></td>\n                  </tr>\n                  ${m.map((e,t)=>`\n                      <tr>\n                          <td style="border: 1px solid #ccc; padding: 5px;">${t+1}</td>\n                          <td style="border: 1px solid #ccc; padding: 5px;">${e.qty}</td>\n                          <td style="border: 1px solid #ccc; padding: 5px;">${e.code||""}</td>\n              <td style="border: 1px solid #ccc; padding: 5px;">${e.assembled?l:d}</td>\n              <td style="border: 1px solid #ccc; padding: 5px;">${e.hingeSide||i}</td>\n              <td style="border: 1px solid #ccc; padding: 5px;">${e.exposedSide||i}</td>\n                          <td style="border: 1px solid #ccc; padding: 5px;">$${parseFloat(e.price).toFixed(2)}</td>\n              <td style="border: 1px solid #ccc; padding: 5px;">$${e.includeAssemblyFee?parseFloat(e.assemblyFee).toFixed(2):"0.00"}</td>\n                          <td style="border: 1px solid #ccc; padding: 5px;">$${parseFloat(e.total).toFixed(2)}</td>\n                      </tr>\n                  `).join("")}\n              </tbody>\n          </table>\n          <div class="price-summary">\n              <table>\n                  <tr>\n            <td class="text-left">${c.cabinets}</td>\n                      <td class="text-right">$${x.cabinets.toFixed(2)}</td>\n                  </tr>\n                  <tr>\n            <td class="text-left">${c.assemblyFee}</td>\n                      <td class="text-right">$${x.assemblyFee.toFixed(2)}</td>\n                  </tr>\n                  <tr class="total-row">\n            <td class="text-left">${c.modifications}</td>\n                      <td class="text-right">$${x.modifications.toFixed(2)}</td>\n                  </tr>\n                  <tr>\n            <td class="text-left">${c.styleTotal}</td>\n                      <td class="text-right">$${x.styleTotal.toFixed(2)}</td>\n                  </tr>\n                  <tr>\n            <td class="text-left">${c.total}</td>\n                      <td class="text-right">$${x.total.toFixed(2)}</td>\n                  </tr>\n                  <tr class="total-row">\n            <td class="text-left">${c.tax}</td>\n                      <td class="text-right">$${x.tax.toFixed(2)}</td>\n                  </tr>\n                  <tr class="grand-total">\n            <td class="text-left">${c.grandTotal}</td>\n                      <td class="text-right">$${x.grandTotal.toFixed(2)}</td>\n                  </tr>\n              </table>\n          </div>\n          `:""}\n      </body>\n      </html>\n    `})(me);return e.jsxs(s,{fluid:!0,className:"contracts-container",children:[e.jsx(B,{title:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px",backgroundColor:"rgba(255, 255, 255, 0.2)",borderRadius:"12px"},children:e.jsx(a,{icon:L,style:{fontSize:"24px",color:"white"}})}),M("nav.contracts")]}),subtitle:M("contracts.subtitle")}),e.jsx(r,{className:"contracts-controls-card",children:e.jsx(n,{children:e.jsxs(o,{className:"align-items-center",children:[e.jsx(c,{md:6,lg:4,children:e.jsxs(l,{children:[e.jsx(d,{style:{background:"none",border:"none"},children:e.jsx(a,{icon:U})}),e.jsx(i,{type:"text",placeholder:M("contracts.searchPlaceholder"),value:E,onChange:e=>_(e.target.value),className:"contracts-search-input"})]})}),e.jsx(c,{xs:"auto",className:"ms-auto",children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("small",{className:"text-muted",children:M("common.itemsPerPage")}),e.jsxs(m,{size:"sm",value:X,onChange:e=>{return t=Number(e.target.value),G(t),V(1),void localStorage.setItem("contractsItemsPerPage",t.toString());var t},style:{width:"80px",borderRadius:"8px"},children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:30,children:"30"})]})]}),e.jsxs(p,{size:"sm",children:[e.jsx(x,{color:"card"===Y?"primary":"light",onClick:()=>Z("card"),className:"contracts-view-toggle",style:{borderRadius:"8px 0 0 8px"},children:M("contracts.view.cards")}),e.jsx(x,{color:"table"===Y?"primary":"light",onClick:()=>Z("table"),className:"contracts-view-toggle",style:{borderRadius:"0 8px 8px 0"},children:M("contracts.view.table")})]})]})})]})})}),"card"===Y?e.jsx(o,{className:"g-3 mb-1",children:0===ue?.length?e.jsx(c,{xs:12,children:e.jsx(r,{className:"contracts-empty-state",children:e.jsxs(n,{children:[e.jsx("h5",{className:"text-muted mb-2",children:M("contracts.empty.title")}),e.jsx("p",{className:"text-muted mb-0",children:M("contracts.empty.subtitle")})]})})}):ue?.map(t=>e.jsx(c,{xs:12,sm:6,lg:4,xl:3,children:e.jsxs(r,{className:"contracts-card",children:[e.jsx(h,{className:"contracts-card-header",children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(a,{icon:q,size:"sm",className:"contracts-card-date-icon"}),e.jsx("small",{className:"text-muted fw-medium",children:new Date(t.date||t.createdAt).toLocaleDateString()})]})})}),e.jsxs(n,{className:"pt-0",children:[e.jsxs(u,{className:"contracts-card-title d-flex align-items-center gap-2",children:[e.jsx("div",{className:"d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",backgroundColor:ne.headerBg||"#667eea",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",color:oe(ne.headerBg||"#667eea")},children:(t.customer?.name||"N").charAt(0).toUpperCase()}),e.jsx("span",{className:"text-primary fw-semibold",style:{cursor:"pointer"},children:t.customer?.name||M("common.na")})]}),e.jsx(g,{className:"contracts-card-customer",children:t.description||M("contracts.noDescription")}),e.jsx(g,{className:"contracts-card-customer",children:t.description||M("contracts.noDescription")}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mb-3",children:[e.jsx(a,{icon:L,size:"sm",className:"text-success",style:{backgroundColor:"#e6f7e6",padding:"4px",borderRadius:"4px"}}),e.jsx("small",{className:"text-muted fw-medium",children:t.designerData?.name||M("contracts.noDesigner")})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx(b,{color:xe(t.status||"Draft"),className:"contracts-card-status",children:(()=>{const e={draft:"draft","measurement scheduled":"measurementScheduled","measurement done":"measurementDone","design done":"designDone","follow up 1":"followUp1","follow up 2":"followUp2","follow up 3":"followUp3","proposal accepted":"proposalAccepted"}[(t.status||"Draft").toLowerCase()]||null;return e?M(`contracts.status.${e}`):t.status||M("contracts.status.draft")})()}),e.jsx(x,{color:"primary",variant:"ghost",size:"sm",onClick:()=>be(t.id),className:"px-3",style:{borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:M("contracts.viewDetails")})]})]})]})},t.id))}):e.jsx(r,{className:"contracts-table-card",children:e.jsxs(n,{className:"p-0",children:[e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs(f,{hover:!0,responsive:!0,className:"contracts-table",children:[e.jsx(y,{children:e.jsxs(j,{children:[e.jsx(N,{children:M("contracts.table.date")}),e.jsx(N,{children:M("contracts.table.customer")}),e.jsx(N,{children:M("contracts.table.description")}),e.jsx(N,{children:M("contracts.table.designer")}),e.jsx(N,{children:M("contracts.table.status")}),e.jsx(N,{className:"text-center",children:M("contracts.table.actions")})]})}),e.jsx(w,{children:0===ue?.length?e.jsx(j,{children:e.jsx(v,{colSpan:"6",className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("p",{className:"mb-0",children:M("contracts.empty.title")}),e.jsx("small",{children:M("contracts.empty.subtitle")})]})})}):ue?.map((t,s)=>e.jsxs(j,{style:{transition:"all 0.2s ease"},children:[e.jsx(v,{className:"py-3 border-0 border-bottom border-light",children:e.jsx("span",{className:"fw-medium",children:new Date(t.date||t.createdAt).toLocaleDateString()})}),e.jsx(v,{className:"py-3 border-0 border-bottom border-light",style:{color:ne.headerBg||"#667eea",cursor:"pointer",fontWeight:"500"},children:t.customer?.name||M("common.na")}),e.jsx(v,{className:"py-3 border-0 border-bottom border-light",style:{whiteSpace:"normal",wordBreak:"break-word",maxWidth:"200px"},children:e.jsx("span",{className:"text-muted",children:t.description||M("common.na")})}),e.jsx(v,{className:"py-3 border-0 border-bottom border-light",children:e.jsx("span",{className:"fw-medium",children:t.designerData?.name||M("common.na")})}),e.jsx(v,{className:"py-3 border-0 border-bottom border-light",children:e.jsx(b,{color:xe(t.status||"Draft"),className:"px-3 py-2",style:{borderRadius:"20px",fontSize:"12px",fontWeight:"500"},children:(()=>{const e={draft:"draft","measurement scheduled":"measurementScheduled","measurement done":"measurementDone","design done":"designDone","follow up 1":"followUp1","follow up 2":"followUp2","follow up 3":"followUp3","proposal accepted":"proposalAccepted"}[(t.status||"Draft").toLowerCase()]||null;return e?M(`contracts.status.${e}`):t.status||M("contracts.status.draft")})()})}),e.jsx(v,{className:"py-3 border-0 border-bottom border-light text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx(x,{color:"light",size:"sm",className:"p-2",onClick:()=>be(t.id),style:{borderRadius:"8px",border:"1px solid #e3e6f0",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=`${ne.headerBg||"#667eea"}20`,e.currentTarget.style.borderColor=ne.headerBg||"#667eea"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="",e.currentTarget.style.borderColor="#e3e6f0"},children:e.jsx(a,{icon:I,size:"sm",style:{color:"#28a745"}})}),e.jsx(x,{color:"light",size:"sm",className:"contracts-action-btn",onClick:()=>{t.id},children:e.jsx(a,{icon:W,size:"sm",style:{color:"#dc3545"}})})]})})]},s))})]})}),e.jsx("div",{className:"contracts-pagination",children:e.jsx(R,{currentPage:O,totalPages:ge,onPageChange:e=>{V(e)},itemsPerPage:X})})]})}),e.jsxs($,{visible:J,onClose:()=>K(!1),size:"xl",className:"contract-modal",children:[e.jsx(F,{onClose:()=>K(!1),className:"border-0",style:{background:ne.headerBg||"#667eea",color:oe(ne.headerBg||"#667eea")},children:e.jsx(S,{className:"fw-bold",children:M("contracts.modal.title")})}),e.jsx(D,{className:"p-4",children:de?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:M("common.loading")})}),e.jsx("p",{className:"mt-3 text-muted",children:M("contracts.loadingDetails")})]}):fe?e.jsx("div",{className:"contract-content",style:{maxHeight:"70vh",overflowY:"auto",border:"1px solid #e3e6f0",borderRadius:"8px",padding:"20px",backgroundColor:"var(--cui-body-bg)"},dangerouslySetInnerHTML:{__html:fe}}):e.jsx("div",{className:"text-center py-5",children:e.jsx("p",{className:"text-muted mb-0",children:M("contracts.noData")})})}),e.jsx(k,{className:"border-0 bg-body-secondary",children:e.jsx("div",{className:"d-flex gap-2 w-100 justify-content-end",children:e.jsx(x,{color:"secondary",onClick:()=>K(!1),className:"px-4",style:{borderRadius:"8px"},children:M("common.close")})})})]}),e.jsx("style",{children:"\n        .contract-modal .modal-dialog {\n          max-width: 95%;\n        }\n        \n        .contract-content::-webkit-scrollbar {\n          width: 8px;\n        }\n        \n        .contract-content::-webkit-scrollbar-track {\n          background: #f1f1f1;\n          border-radius: 4px;\n        }\n        \n        .contract-content::-webkit-scrollbar-thumb {\n          background: #c1c1c1;\n          border-radius: 4px;\n        }\n        \n        .contract-content::-webkit-scrollbar-thumb:hover {\n          background: #a1a1a1;\n        }\n      "})]})};export{M as default};
