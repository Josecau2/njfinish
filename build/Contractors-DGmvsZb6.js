import{j as s}from"./date-vendor-D9pAgX5F.js";import{u as e,r as t}from"./react-vendor-DF7UJAlN.js";import{u as r,a}from"./redux-vendor-BzdbewH4.js";import{g as c,b as l}from"./DefaultLayout-BUcG_pV2.js";import{h as n,C as i,U as o,V as d,b as m,c as x,d as j,a as h,W as u,X as p,J as N,$ as b,a0 as v,a1 as g,a2 as f,a3 as A,a4 as y,v as w,e as _}from"./ui-vendor-DjmSPU99.js";import{u as k,ae as C}from"./index-DW-yAxzW.js";import{P as z}from"./PaginationComponent-B2yVAl0f.js";import{j as P,S as D,m as I}from"./icons-vendor-D82TZqJV.js";import"./form-vendor-CKNVq0c_.js";import"./utils-vendor-Nl-sF5xe.js";const S=()=>{const S=r(),L=e(),{t:M}=k(),{list:$,loading:U,error:X,pagination:E}=a(s=>s.contractors),[H,J]=t.useState(""),[O,T]=t.useState({key:null,direction:"asc"}),[V,W]=t.useState(10),[q,B]=t.useState(1);t.useEffect(()=>{S(C({page:q,limit:V}))},[S,q,V]);const F=s=>{T(e=>{const t=e.key===s&&"asc"===e.direction?"desc":"asc";return{key:s,direction:t}})},G=s=>{const e=`/${c(6)}/${c(8)}`+l("/admin/contractors/:id",{id:s.id});L(e)},K=t.useMemo(()=>{if(!$||!Array.isArray($))return[];let s=$.filter(s=>s.name?.toLowerCase().includes(H.toLowerCase()));return O.key&&s.sort((s,e)=>{let t=s[O.key],r=e[O.key];return"user_count"!==O.key&&"customer_count"!==O.key&&"proposal_count"!==O.key||(t=parseInt(t)||0,r=parseInt(r)||0),t<r?"asc"===O.direction?-1:1:t>r?"asc"===O.direction?1:-1:0}),s},[$,H,O]),Q=e=>{if(!e)return null;const t={dashboard:M("contractorsAdmin.modules.dashboard"),proposals:M("contractorsAdmin.modules.proposals"),customers:M("contractorsAdmin.modules.customers"),resources:M("contractorsAdmin.modules.resources")};return Object.entries(e).filter(([s,e])=>!0===e).map(([e])=>s.jsx(w,{color:"info",className:"me-1",children:t[e]||e},e))},R=s=>{if(!s)return"N/A";try{const e=new Date(s);return isNaN(e.getTime())?"N/A":e.toLocaleDateString()}catch(e){return"N/A"}},Y=E?.totalPages||1;return U&&0===$.length?s.jsx(n,{children:s.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:s.jsx(i,{color:"primary"})})}):s.jsx(n,{className:"px-4",children:s.jsx(o,{children:s.jsx(d,{xs:12,children:s.jsxs(m,{className:"mb-4",children:[s.jsx(x,{children:s.jsxs("strong",{children:[s.jsx(P,{className:"me-2",size:18,"aria-hidden":"true"}),M("contractorsAdmin.header")]})}),s.jsxs(j,{children:[X&&s.jsx(h,{color:"danger",className:"mb-3",children:X}),s.jsxs(o,{className:"mb-4",children:[s.jsx(d,{md:6,children:s.jsxs(u,{children:[s.jsx(p,{"aria-hidden":"true",children:s.jsx(D,{size:16})}),s.jsx(N,{type:"text",placeholder:M("contractorsAdmin.searchPlaceholder"),value:H,onChange:s=>J(s.target.value)})]})}),s.jsx(d,{md:6,className:"d-flex justify-content-end align-items-center",children:s.jsx("div",{className:"text-muted",children:s.jsx("small",{children:M("contractorsAdmin.showing",{count:K?.length||0,total:E?.total||0})})})})]}),s.jsxs(o,{className:"mb-4",children:[s.jsx(d,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-info py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:M("contractorsAdmin.stats.totalContractors")}),s.jsx("div",{className:"fs-5 fw-semibold",children:E?.total||0})]})}),s.jsx(d,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-success py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:M("contractorsAdmin.stats.totalUsers")}),s.jsx("div",{className:"fs-5 fw-semibold",children:($||[]).reduce((s,e)=>s+(parseInt(e.user_count)||0),0)})]})}),s.jsx(d,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-warning py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:M("contractorsAdmin.stats.totalCustomers")}),s.jsx("div",{className:"fs-5 fw-semibold",children:($||[]).reduce((s,e)=>s+(parseInt(e.customer_count)||0),0)})]})}),s.jsx(d,{sm:6,lg:3,children:s.jsxs("div",{className:"border-start border-start-4 border-start-danger py-1 px-3",children:[s.jsx("div",{className:"text-muted small",children:M("contractorsAdmin.stats.totalProposals")}),s.jsx("div",{className:"fs-5 fw-semibold",children:($||[]).reduce((s,e)=>s+(parseInt(e.proposal_count)||0),0)})]})})]}),s.jsx("div",{className:"table-wrap d-none d-md-block",children:s.jsxs(b,{hover:!0,className:"table-modern",children:[s.jsx(v,{children:s.jsxs(g,{children:[s.jsx(f,{scope:"col",className:"cursor-pointer",onClick:()=>F("name"),children:M("contractorsAdmin.table.contractorName")}),s.jsx(f,{scope:"col",className:"cursor-pointer text-center",onClick:()=>F("user_count"),children:M("contractorsAdmin.table.users")}),s.jsx(f,{scope:"col",className:"cursor-pointer text-center",onClick:()=>F("customer_count"),children:M("contractorsAdmin.table.customers")}),s.jsx(f,{scope:"col",className:"cursor-pointer text-center",onClick:()=>F("proposal_count"),children:M("contractorsAdmin.table.proposals")}),s.jsx(f,{scope:"col",children:M("contractorsAdmin.table.modules")}),s.jsx(f,{scope:"col",className:"cursor-pointer",onClick:()=>F("created_at"),children:M("contractorsAdmin.table.created")}),s.jsx(f,{scope:"col",className:"text-center",children:M("contractorsAdmin.table.actions")})]})}),s.jsx(A,{children:0===K?.length?s.jsx(g,{children:s.jsxs(y,{colSpan:"7",className:"text-center py-4",children:[s.jsx(D,{size:28,className:"mb-3 opacity-50","aria-hidden":"true"}),s.jsx("p",{className:"text-muted mb-0",children:M("contractorsAdmin.empty.title")}),s.jsx("small",{children:M("contractorsAdmin.empty.tryAdjusting")})]})}):K?.map(e=>s.jsxs(g,{className:"align-middle",children:[s.jsx(y,{children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx(P,{className:"me-2 text-muted",size:18,"aria-hidden":"true"}),s.jsxs("div",{children:[s.jsx("div",{className:"fw-semibold",children:e.name}),s.jsxs("small",{className:"text-muted",children:["ID: ",e.id]})]})]})}),s.jsx(y,{className:"text-center",children:s.jsx(w,{color:"primary",children:e.user_count||0})}),s.jsx(y,{className:"text-center",children:s.jsx(w,{color:"warning",children:e.customer_count||0})}),s.jsx(y,{className:"text-center",children:s.jsx(w,{color:"success",children:e.proposal_count||0})}),s.jsx(y,{children:s.jsx("div",{className:"d-flex flex-wrap gap-1",children:Q(e.modules)||s.jsx("small",{className:"text-muted",children:M("contractorsAdmin.noModules")})})}),s.jsx(y,{children:s.jsx("small",{className:"text-muted",children:R(e.created_at)})}),s.jsx(y,{className:"text-center",children:s.jsx(_,{color:"outline-primary",size:"sm",onClick:()=>G(e),className:"icon-btn","aria-label":M("contractorsAdmin.actions.viewDetails"),title:M("contractorsAdmin.actions.viewDetails"),children:s.jsx(I,{size:16,"aria-hidden":"true"})})})]},e.id))})]})}),s.jsx("div",{className:"d-md-none",children:0===K?.length?s.jsx(m,{children:s.jsxs(j,{className:"text-center py-4",children:[s.jsx(D,{size:28,className:"mb-3 opacity-50","aria-hidden":"true"}),s.jsx("p",{className:"text-muted mb-0",children:M("contractorsAdmin.empty.title")}),s.jsx("small",{children:M("contractorsAdmin.empty.tryAdjusting")})]})}):s.jsx("div",{className:"mobile-contractor-cards",children:K?.map(e=>s.jsx(m,{className:"mb-3 contractor-mobile-card",children:s.jsxs(j,{className:"p-3",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[s.jsxs("div",{className:"d-flex align-items-center flex-grow-1",children:[s.jsx(P,{className:"me-2 text-muted",size:18,"aria-hidden":"true"}),s.jsxs("div",{className:"flex-grow-1 min-width-0",children:[s.jsx("div",{className:"fw-semibold text-truncate",title:e.name,children:e.name}),s.jsxs("small",{className:"text-muted",children:["ID: ",e.id]})]})]}),s.jsx(_,{color:"outline-primary",size:"sm",onClick:()=>G(e),title:M("contractorsAdmin.actions.viewDetails"),"aria-label":M("contractorsAdmin.actions.viewDetails"),className:"ms-2 contractor-action-btn icon-btn",children:s.jsx(I,{size:16,"aria-hidden":"true"})})]}),s.jsxs("div",{className:"row g-2 mb-3",children:[s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:M("contractorsAdmin.table.users")}),s.jsx(w,{color:"primary",className:"w-100",children:e.user_count||0})]}),s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:M("contractorsAdmin.table.customers")}),s.jsx(w,{color:"warning",className:"w-100",children:e.customer_count||0})]}),s.jsxs("div",{className:"col-4 text-center",children:[s.jsx("div",{className:"small text-muted",children:M("contractorsAdmin.table.proposals")}),s.jsx(w,{color:"success",className:"w-100",children:e.proposal_count||0})]})]}),s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"small text-muted mb-1",children:M("contractorsAdmin.table.modules")}),s.jsx("div",{className:"d-flex flex-wrap gap-1",children:Q(e.modules)||s.jsx("small",{className:"text-muted",children:M("contractorsAdmin.noModules")})})]}),s.jsx("div",{className:"text-end",children:s.jsxs("small",{className:"text-muted",children:[M("contractorsAdmin.table.created"),": ",R(e.created_at)]})})]})},e.id))})}),Y>1&&s.jsx("div",{className:"p-3 border-top border-light",children:s.jsx(z,{currentPage:q,totalPages:Y,onPageChange:s=>{B(s)},itemsPerPage:V})})]})]})})})})};export{S as default};
