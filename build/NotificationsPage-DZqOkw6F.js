import{j as e}from"./date-vendor-D9pAgX5F.js";import{r as a}from"./react-vendor-DF7UJAlN.js";import{h as t,U as i,V as s,b as r,c as n,e as l,u as o,d as c,ab as d,a6 as m,C as u,v as p,aj as f,ak as h}from"./ui-vendor-DjmSPU99.js";import{u as x,a as j}from"./redux-vendor-BzdbewH4.js";import{u as y,a as g,al as b,am as v,d as N,an as k,ag as w,ao as _,ap as C}from"./index-DW-yAxzW.js";import{E as S}from"./EmptyState-CAqMnOWD.js";import{c as A}from"./cil-reload-6LI_qKMh.js";import{c as F}from"./cil-check-alt-Bgti_PMs.js";import"./form-vendor-CKNVq0c_.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-D82TZqJV.js";import"./cil-search-CDkY_4k-.js";const R=()=>{const R=x(),{t:E}=y(),{notifications:P,loading:U,error:$}=j(e=>e.notification),z=j(e=>e.auth?.user),M=(()=>{const e=String(z?.role||"").toLowerCase();return"admin"===e||"super_admin"===e})(),[B,D]=a.useState(1),[H,L]=a.useState(1),[T,O]=a.useState("all"),[G,I]=a.useState(""),[K,V]=a.useState(!1);a.useEffect(()=>{Y()},[B,T,G]),a.useEffect(()=>{!M&&P&&P.some(e=>!e.is_read)&&(async()=>{try{await g.post("/api/notifications/mark-all-read"),R(b())}catch(e){}})()},[M,P?.length]);const Y=async(e=!0)=>{e&&R(v(!0));try{const e={page:B,limit:20,..."unread"===T&&{unread_only:"true"},..."read"===T&&{read_only:"true"},...G&&{type:G}},{data:a}=await g.get("/api/notifications",{params:e});R(N(a.data)),L(a?.pagination?.totalPages||1),R(k(null))}catch(a){const e=a?.response?.status;R(k(401===e||403===e?"Not authorized to view notifications.":a.message))}finally{R(v(!1)),V(!1)}};a.useEffect(()=>{$&&w(E("notifications.errors.load","Failed to load notifications"),"string"==typeof $?$:"")},[$]);const q=e=>{switch(e){case"proposal_accepted":return"âœ…";case"proposal_rejected":return"âŒ";case"customer_created":return"ðŸ‘¤";case"system":return"âš™ï¸";default:return"ðŸ“§"}},J=e=>{switch(e){case"high":return"danger";case"medium":return"warning";case"low":return"info";default:return"secondary"}},Q=P.filter(e=>"unread"===T?!e.is_read:"read"!==T||e.is_read),W=P.filter(e=>!e.is_read).length;return e.jsx(t,{fluid:!0,className:"py-4","aria-busy":U,children:e.jsx(i,{children:e.jsx(s,{children:e.jsxs(r,{children:[e.jsxs(n,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:E("notifications.header","Notifications")}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(l,{variant:"outline",color:"primary",size:"sm",onClick:()=>{V(!0),Y(!1)},disabled:K,type:"button","aria-label":K?"Refreshing notifications":"Refresh notifications",style:{minHeight:"44px"},children:[e.jsx(o,{icon:A,className:K?"fa-spin":""}),K?" Refreshing...":" Refresh"]}),W>0&&e.jsxs(l,{color:"success",size:"sm",onClick:async()=>{try{await g.post("/api/notifications/mark-all-read"),R(b()),Y(!1),_(E("notifications.success.allReadTitle","All caught up"),E("notifications.success.allReadText","All notifications marked as read"))}catch(e){w(E("notifications.errors.markAll","Failed to mark all as read"),e.message)}},type:"button","aria-label":`Mark all notifications as read (${W} unread)`,style:{minHeight:"44px"},children:[e.jsx(o,{icon:F}),"Mark All Read (",W,")"]})]})]}),e.jsxs(c,{children:[e.jsxs("div",{className:"mb-3 d-flex flex-wrap gap-2 align-items-center",children:[e.jsxs(d,{role:"group","aria-label":"Filter notifications",children:[e.jsx(m,{type:"radio",button:{color:"outline-primary",variant:"outline"},name:"filter",id:"filter-all",label:"All",checked:"all"===T,onChange:()=>{O("all"),D(1)}}),e.jsx(m,{type:"radio",button:{color:"outline-primary",variant:"outline"},name:"filter",id:"filter-unread",label:`Unread (${W})`,checked:"unread"===T,onChange:()=>{O("unread"),D(1)}}),e.jsx(m,{type:"radio",button:{color:"outline-primary",variant:"outline"},name:"filter",id:"filter-read",label:"Read",checked:"read"===T,onChange:()=>{O("read"),D(1)}})]}),e.jsxs("div",{className:"ms-2 d-flex align-items-center",children:[e.jsx("label",{htmlFor:"type-filter",className:"me-2 mb-0 small text-muted",children:"Type"}),e.jsxs("select",{id:"type-filter",className:"form-select form-select-sm",style:{width:"220px"},value:G,onChange:e=>{I(e.target.value),D(1)},"aria-label":"Filter by type",children:[e.jsx("option",{value:"",children:"All types"}),e.jsx("option",{value:"proposal_accepted",children:"Proposal accepted"}),e.jsx("option",{value:"proposal_rejected",children:"Proposal rejected"}),e.jsx("option",{value:"customer_created",children:"Customer created"}),e.jsx("option",{value:"system",children:"System"})]})]})]}),$&&e.jsx("div",{className:"mb-3",role:"alert","aria-live":"assertive",children:e.jsx(S,{title:"Could not load notifications",subtitle:$})}),U&&e.jsx("div",{className:"text-center py-4",children:e.jsx(u,{})}),!U&&0===Q.length&&e.jsx(S,{title:"unread"===T?"No unread notifications":"read"===T?"No read notifications":"No notifications",subtitle:G?`No notifications for type "${G}"`:"You are all caught up."}),!U&&Q.map(a=>{const t=Boolean(a.action_url);return e.jsx(r,{className:"mb-3 notification-card "+(a.is_read?"":"notification-unread"),style:{borderLeft:a.is_read?"1px solid #dee2e6":"4px solid #007bff",backgroundColor:a.is_read?"white":"#f8f9fa",cursor:t?"pointer":"default"},onClick:()=>{t&&(window.location.href=a.action_url)},role:t?"button":void 0,tabIndex:t?0:void 0,"aria-label":t?`Open notification: ${a.title}`:void 0,onKeyDown:e=>((e,a)=>{a&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),window.location.href=a))})(e,a.action_url),children:e.jsx(c,{className:"py-3",children:e.jsx("div",{className:"d-flex justify-content-between align-items-start",children:e.jsxs("div",{className:"d-flex align-items-start flex-grow-1",children:[e.jsx("div",{className:"me-3 mt-1","aria-hidden":"true",children:e.jsx("span",{style:{fontSize:"1.5rem"},children:q(a.type)})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[e.jsxs("h6",{className:"mb-1",children:[a.title,!a.is_read&&e.jsxs(e.Fragment,{children:[e.jsx(p,{color:"primary",className:"ms-2","aria-label":"Unread",children:"New"}),e.jsx("span",{className:"visually-hidden",children:"Unread"})]})]}),e.jsx(p,{color:J(a.priority),children:a.priority})]}),e.jsx("p",{className:"text-muted mb-2",children:a.message}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",children:[(i=a.createdAt,new Date(i).toLocaleString()),a.createdByUser&&e.jsxs(e.Fragment,{children:[" â€¢ by ",a.createdByUser.name]})]}),e.jsx("div",{children:M&&!a.is_read&&e.jsx(l,{size:"sm",variant:"ghost",color:"primary",onClick:e=>{e.stopPropagation(),(async e=>{try{await g.post(`/api/notifications/${e}/read`),R(C(e))}catch(a){w(E("notifications.errors.markOne","Failed to mark as read"),a.message)}})(a.id)},type:"button","aria-label":"Mark notification as read",style:{minHeight:"44px"},children:"Mark as read"})})]})]})]})})})},a.id);var i}),H>1&&e.jsx("div",{className:"d-flex justify-content-center mt-4",children:e.jsxs(f,{"aria-label":"Notifications pagination",role:"navigation",children:[e.jsx(h,{disabled:1===B,onClick:()=>D(B-1),"aria-label":"Previous page",children:"Previous"}),Array.from({length:H},(e,a)=>a+1).map(a=>e.jsx(h,{active:a===B,onClick:()=>D(a),"aria-current":a===B?"page":void 0,"aria-label":`Go to page ${a}`,children:a},a)),e.jsx(h,{disabled:B===H,onClick:()=>D(B+1),"aria-label":"Next page",children:"Next"})]})})]})]})})})})};export{R as default};
