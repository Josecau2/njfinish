import{j as e}from"./date-vendor-D9pAgX5F.js";import{u as a,r as t}from"./react-vendor-DF7UJAlN.js";import{u as n,a as s}from"./redux-vendor-BzdbewH4.js";import{h as r,u as c,e as o,$ as l,a0 as i,a1 as m,a2 as d,a3 as p,a4 as u,v as y}from"./ui-vendor-DjmSPU99.js";import{m as h}from"./index-BmyYYes_.js";import{S as x}from"./utils-vendor-Nl-sF5xe.js";import{P as b,r as j}from"./DefaultLayout-BUcG_pV2.js";import{P as f}from"./PaginationComponent-B2yVAl0f.js";import{w as g}from"./withContractorScope-CFJqUjZ-.js";import{u as v,a2 as N,a5 as w,a6 as P}from"./index-DW-yAxzW.js";import{c as k}from"./cil-search-CDkY_4k-.js";import{c as C}from"./cil-plus-D8mtC-W5.js";import"./form-vendor-CKNVq0c_.js";import"./icons-vendor-D82TZqJV.js";if("undefined"!=typeof document){const e=document.createElement("style");e.textContent="\n  .payment-tabs {\n    padding: 0.5rem;\n    background: var(--surface);\n    border-radius: var(--radius);\n    margin-bottom: 1rem;\n    box-shadow: var(--elev-1);\n  }\n\n  .payment-tabs__container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));\n    gap: 0.375rem;\n  }\n\n  .payment-tab {\n    position: relative;\n    display: grid;\n    place-items: center;\n    min-height: 44px;\n    padding: 0.5rem 0.75rem;\n    border: 1px solid #e5e7eb;\n    border-radius: 10px;\n    background: #fff;\n    transition: all 0.12s ease;\n    cursor: pointer;\n    text-align: center;\n  }\n\n  .payment-tab__input {\n    position: absolute;\n    opacity: 0;\n    pointer-events: none;\n  }\n\n  .payment-tab__text {\n    font-size: 0.875rem;\n    font-weight: 500;\n    text-transform: capitalize;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .payment-tab--active {\n    background: color-mix(in oklch, var(--brand) 12%, white);\n    border-color: color-mix(in oklch, var(--brand) 40%, #e5e7eb);\n    box-shadow: 0 0 0 2px color-mix(in oklch, var(--brand) 30%, transparent);\n  }\n\n  .payment-tab--active .payment-tab__text {\n    font-weight: 600;\n    color: var(--brand);\n  }\n\n  @media (max-width: 576px) {\n    .payment-tabs__container {\n      grid-template-columns: repeat(3, 1fr);\n      gap: 0.25rem;\n    }\n\n    .payment-tab {\n      min-height: 40px;\n      padding: 0.375rem 0.5rem;\n    }\n\n    .payment-tab__text {\n      font-size: 0.8125rem;\n    }\n  }\n\n  @media (max-width: 480px) {\n    .payment-tabs__container {\n      grid-template-columns: repeat(2, 1fr);\n    }\n  }\n",document.head.querySelector("[data-payment-tabs-styles]")||(e.setAttribute("data-payment-tabs-styles","true"),document.head.appendChild(e))}const _=g(({isContractor:g,contractorGroupId:_,contractorGroupName:S})=>{const{t:I}=v(),D=n(),M=a(),{payments:A,pagination:L,loading:$,error:B}=s(e=>e.payments),E=s(e=>e.auth.user),[T,z]=t.useState(""),[O,F]=t.useState("all"),[R,U]=t.useState(1);t.useEffect(()=>{D(N({page:R,status:"all"!==O?O:void 0}))},[D,R,O]);const V=t.useMemo(()=>{if(!T)return A;const e=T.toLowerCase();return A.filter(a=>{const t=a.order?.customer?.name||a.order?.proposal?.customerName||"",n=a.order?.group?.name||a.order?.creator?.name||"";return t.toLowerCase().includes(e)||n.toLowerCase().includes(e)||a.transactionId?.toLowerCase().includes(e)})},[A,T]),q=e=>{switch(e){case"completed":return"success";case"processing":return"info";case"pending":return"warning";case"failed":return"danger";default:return"secondary"}},Y=e=>{switch(e){case"completed":return I("payments.status.completed","Paid");case"processing":return I("payments.status.processing","Processing");case"pending":return I("payments.status.pending","Payment Required");case"failed":return I("payments.status.failed","Failed");case"cancelled":return I("payments.status.cancelled","Cancelled");case"all":return I("payments.status.all","All");default:return e}},G=e=>{"pending"===e.status?M(`/payments/${e.id}/pay`):M(`/payments/${e.id}`)},W=a=>{const t=a.order?.customer?.name||a.order?.proposal?.customerName||I("common.na");if(!g){const n=a.order?.group?.name||a.order?.creator?.name||I("common.na");return e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:n}),e.jsx("div",{className:"text-muted",style:{fontSize:12},children:t})]})}return t},X=g?I("payments.title.contractor","My Payments"):I("payments.title.admin","All Payments"),H=g?I("payments.subtitle.contractor","View your payment history and make payments"):I("payments.subtitle.admin","Manage all payments and payment configurations");return e.jsxs(r,{fluid:!0,children:[e.jsx(b,{title:X,subtitle:H,icon:h}),e.jsx("div",{className:"payment-tabs",role:"tablist",children:e.jsx("div",{className:"payment-tabs__container",children:["all","pending","processing","completed","failed"].map(a=>e.jsxs("label",{className:"payment-tab "+(O===a?"payment-tab--active":""),children:[e.jsx("input",{type:"radio",name:"paymentStatus",value:a,checked:O===a,onChange:e=>F(e.target.value),"aria-label":I(`payments.status.${a}`,"all"===a?"All":a),className:"payment-tab__input"}),e.jsx("span",{className:"payment-tab__text",children:I(`payments.status.${a}`,"all"===a?I("payments.status.all","All"):a)})]},a))})}),e.jsxs("div",{className:"toolbar",role:"search",children:[e.jsx("div",{className:"toolbar__start",style:{flex:1},children:e.jsxs("div",{className:"search",style:{maxWidth:520},children:[e.jsx(c,{icon:k,className:"search__icon"}),e.jsx("input",{type:"search",className:"search__input",placeholder:I("payments.searchPlaceholder","Search by customer, contractor, or transaction ID"),value:T,onChange:e=>z(e.target.value),"aria-label":I("payments.searchAria","Search payments")})]})}),e.jsxs("div",{className:"toolbar__end",children:[!g&&e.jsxs(o,{color:"primary",onClick:async()=>{const{value:e}=await x.fire({title:I("payments.create.title","Create Payment"),input:"number",inputLabel:I("payments.create.orderIdLabel","Order ID"),inputPlaceholder:I("payments.create.orderIdPlaceholder","Enter order ID"),showCancelButton:!0,confirmButtonText:I("common.create","Create"),cancelButtonText:I("common.cancel","Cancel"),inputValidator:e=>{if(!e||e<=0)return I("payments.create.invalidOrderId","Please enter a valid order ID")}});if(e){const{value:t}=await x.fire({title:I("payments.create.amountTitle","Payment Amount"),input:"number",inputLabel:I("payments.create.amountLabel","Amount"),inputPlaceholder:I("payments.create.amountPlaceholder","Enter amount"),inputAttributes:{step:"0.01",min:"0.01"},showCancelButton:!0,confirmButtonText:I("common.create","Create"),cancelButtonText:I("common.cancel","Cancel"),inputValidator:e=>{if(!e||e<=0)return I("payments.create.invalidAmount","Please enter a valid amount")}});if(t)try{await D(P({orderId:parseInt(e),amount:parseFloat(t),currency:"USD"})).unwrap(),x.fire(I("common.success","Success"),I("payments.create.success","Payment created successfully"),"success"),D(N({page:R,status:"all"!==O?O:void 0}))}catch(a){x.fire(I("common.error","Error"),a.message||I("payments.create.error","Failed to create payment"),"error")}}},className:"icon-btn","aria-label":I("payments.create.button","Create payment"),children:[e.jsx(c,{icon:C}),e.jsx("span",{className:"u-desktop",children:I("payments.create.button","Create Payment")})]}),e.jsx("small",{className:"text-muted ms-3",children:I("payments.showingCount",{count:V.length,total:A.length})})]})]}),e.jsx("div",{className:"u-desktop",children:e.jsx("div",{className:"table-scroll",children:e.jsxs(l,{hover:!0,className:"table-modern",children:[e.jsx(i,{children:e.jsxs(m,{children:[e.jsx(d,{className:"sticky-col",children:I("payments.headers.date","Date")}),e.jsx(d,{children:I("payments.headers.customer","Customer")}),e.jsx(d,{children:I("payments.headers.order","Order")}),e.jsx(d,{children:I("payments.headers.amount","Amount")}),e.jsx(d,{children:I("payments.headers.status","Status")}),e.jsx(d,{children:I("payments.headers.transaction","Transaction ID")}),e.jsx(d,{children:I("payments.headers.actions","Actions")})]})}),e.jsx(p,{children:$?e.jsx(m,{children:e.jsx(u,{colSpan:7,className:"text-center py-4",children:I("common.loading","Loading...")})}):0===V.length?e.jsx(m,{children:e.jsxs(u,{colSpan:7,className:"text-center py-5",children:[e.jsx(c,{icon:j,size:"3xl",className:"text-muted mb-3"}),e.jsx("p",{className:"mb-0",children:I("payments.empty.title","No payments found")}),e.jsx("small",{className:"text-muted",children:I("payments.empty.subtitle","Payments will appear here when created")})]})}):V.map(a=>e.jsxs(m,{style:{cursor:"pointer"},onClick:()=>G(a),children:[e.jsx(u,{className:"sticky-col",children:new Date(a.createdAt).toLocaleDateString()}),e.jsx(u,{children:W(a)}),e.jsxs(u,{children:["#",a.orderId]}),e.jsx(u,{children:new Intl.NumberFormat("en-US",{style:"currency",currency:a.currency||"USD"}).format(a.amount)}),e.jsx(u,{children:e.jsxs("div",{className:"d-flex flex-column gap-1",children:[e.jsx(y,{color:q(a.status),shape:"rounded-pill",className:"align-self-start",children:Y(a.status)}),"completed"===a.status&&a.paidAt&&e.jsxs("small",{className:"text-muted",style:{fontSize:11},children:[I("payments.appliedOn","Applied on")," ",new Date(a.paidAt).toLocaleDateString()]})]})}),e.jsx(u,{className:"text-muted",children:a.transactionId||I("common.na")}),e.jsxs(u,{children:["pending"===a.status&&e.jsx(o,{color:"primary",size:"sm",onClick:e=>{e.stopPropagation(),M(`/payments/${a.id}/pay`)},children:I("payments.actions.makePayment","Make Payment")}),"admin"===E?.role?.toLowerCase()&&"completed"!==a.status&&e.jsx(o,{color:"success",size:"sm",className:"ms-2",onClick:async e=>{e.stopPropagation();const t=`\n                              <p>${I("payments.apply.confirmText","This will mark the payment as completed.")}</p>\n                              <div class="mt-3">\n                                <label for="paymentMethod" class="form-label">${I("payments.apply.methodLabel","Payment Method")}:</label>\n                                <select id="paymentMethod" class="form-select">\n                                  <option value="">${I("payments.apply.selectMethodPlaceholder","Select payment method")}</option>\n                                  <option value="cash">${I("paymentReceipt.paymentMethod.cash","Cash")}</option>\n                                  <option value="debit_card">${I("paymentReceipt.paymentMethod.debitCard","Debit Card")}</option>\n                                  <option value="credit_card">${I("paymentReceipt.paymentMethod.creditCard","Credit Card")}</option>\n                                  <option value="check">${I("paymentReceipt.paymentMethod.check","Check")}</option>\n                                  <option value="other">${I("paymentReceipt.paymentMethod.other","Other")}</option>\n                                </select>\n                              </div>\n                              <div class="mt-2" id="checkNumberDiv" style="display: none;">\n                                <label for="checkNumber" class="form-label">${I("payments.apply.checkNumberLabel","Check Number")}:</label>\n                                <input type="text" id="checkNumber" class="form-control" placeholder="${I("payments.apply.checkNumberPlaceholder","Enter check number")}">\n                              </div>`,{value:n}=await x.fire({title:I("payments.apply.confirmTitle","Apply Payment?"),html:t,icon:"question",showCancelButton:!0,confirmButtonText:I("payments.apply.confirmYes","Yes, apply it"),cancelButtonText:I("common.cancel","Cancel"),preConfirm:()=>{const e=document.getElementById("paymentMethod").value,a=document.getElementById("checkNumber").value;return e?"check"!==e||a.trim()?"check"===e?`check #${a}`:e:(x.showValidationMessage(I("payments.apply.validation.checkNumber","Please enter a check number")),!1):(x.showValidationMessage(I("payments.apply.validation.selectMethod","Please select a payment method")),!1)},didOpen:()=>{const e=document.getElementById("paymentMethod"),a=document.getElementById("checkNumberDiv");e.addEventListener("change",()=>{"check"===e.value?a.style.display="block":a.style.display="none"})}});if(n)try{await D(w({id:a.id,paymentMethod:n})).unwrap(),x.fire(I("common.success","Success"),I("payments.apply.success","Payment applied"),"success")}catch(s){x.fire(I("common.error","Error"),s.message||I("payments.apply.error","Failed to apply"),"error")}},children:I("payments.apply.button","Apply")})]})]},a.id))})]})})}),e.jsx("div",{className:"u-mobile",children:$?e.jsx("div",{className:"text-center py-4",children:I("common.loading","Loading...")}):0===V.length?e.jsxs("div",{className:"text-center py-5",children:[e.jsx(c,{icon:j,size:"3xl",className:"text-muted mb-3"}),e.jsx("p",{className:"mb-0",children:I("payments.empty.title","No payments found")}),e.jsx("small",{className:"text-muted",children:I("payments.empty.subtitle","Payments will appear here when created")})]}):e.jsx("div",{className:"stack gap-2",children:V.map(a=>e.jsxs("article",{className:"card card--compact",role:"button",onClick:()=>G(a),"aria-label":I("payments.openDetails","Open payment details"),children:[e.jsxs("div",{className:"card__head",children:[e.jsx("div",{className:"card__title",children:W(a)}),e.jsx(y,{color:q(a.status),shape:"rounded-pill",children:Y(a.status)})]}),e.jsxs("div",{className:"card__meta",children:[e.jsx("span",{children:new Date(a.createdAt).toLocaleDateString()}),e.jsx("span",{children:new Intl.NumberFormat("en-US",{style:"currency",currency:a.currency||"USD"}).format(a.amount)}),e.jsx("span",{children:I("payments.mobile.orderNumber","Order #{{id}}",{id:a.orderId})})]}),a.transactionId&&e.jsxs("div",{className:"card__content text-muted",children:[I("payments.headers.transaction","Transaction ID"),": ",a.transactionId]}),"pending"===a.status&&e.jsx("div",{className:"card__actions",children:e.jsx(o,{color:"primary",size:"sm",onClick:e=>{e.stopPropagation(),M(`/payments/${a.id}/pay`)},children:I("payments.actions.makePayment","Make Payment")})})]},a.id))})}),!$&&V.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx(f,{currentPage:L.currentPage,totalPages:L.totalPages,onPageChange:U,itemsPerPage:L.itemsPerPage})})]})});export{_ as default};
