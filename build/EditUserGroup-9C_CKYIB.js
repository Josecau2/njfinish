import{j as e}from"./date-vendor-D9pAgX5F.js";import{u as s,i as r,r as t}from"./react-vendor-DF7UJAlN.js";import{h as a,e as i,u as o,H as n,U as d,V as l,I as c,b as m,d as u,W as p,X as x,J as h,a7 as g}from"./ui-vendor-DjmSPU99.js";import{u as f,a as j}from"./redux-vendor-BzdbewH4.js";import{d as b,P as y,l as N}from"./DefaultLayout-BUcG_pV2.js";import{u as v,b as w,a as k}from"./index-DW-yAxzW.js";import{S as G}from"./utils-vendor-Nl-sF5xe.js";import{c as C,a as z}from"./cil-user-follow-B22R2zcO.js";import{c as B}from"./cil-arrow-left-D66Kb3Zq.js";import{c as S}from"./cil-save-CHBg7z_U.js";import"./form-vendor-CKNVq0c_.js";import"./icons-vendor-D82TZqJV.js";const R=({title:s,icon:r,children:t,className:a="",customization:i={}})=>e.jsx(m,{className:`border-0 shadow-sm mb-2 mb-md-4 ${a}`,children:e.jsxs(u,{className:"p-3 p-md-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-2 me-md-3",style:{width:"32px",height:"32px",backgroundColor:`${i.headerBg||"#667eea"}20`,color:i.headerBg||"#667eea"},children:e.jsx(o,{icon:r,size:"sm"})}),e.jsx("h6",{className:"mb-0 fw-semibold text-dark small",children:s})]}),t]})}),$=({label:s,name:r,type:t="text",required:a=!1,icon:i=null,placeholder:n="",value:d,onChange:l,isInvalid:m,feedback:u,...f})=>e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{htmlFor:r,className:"fw-medium text-dark mb-2 small",children:[s,a&&e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsxs(p,{children:[i&&e.jsx(x,{className:"d-none d-md-flex",style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)",border:"1px solid #e3e6f0",borderRight:"none"},children:e.jsx(o,{icon:i,size:"sm",style:{color:"#6c757d"}})}),e.jsx(h,{id:r,name:r,type:t,value:d,onChange:l,invalid:m,placeholder:n,style:{border:"1px solid "+(m?"#dc3545":"#e3e6f0"),borderRadius:i?"0 8px 8px 0":"8px",fontSize:"14px",padding:"12px 16px",transition:"all 0.3s ease",borderLeft:i&&window.innerWidth>=768?"none":"1px solid #e3e6f0"},...f})]}),u&&e.jsx(g,{invalid:!0,children:u})]}),O={name:"",group_type:"standard",modules:{dashboard:!1,proposals:!1,customers:!1,resources:!1}},D=()=>{const{t:p}=v();f();const x=s(),{id:h}=r(),g=b(h),[D,_]=t.useState(O),H=t.useRef(O),[A,I]=t.useState({}),[q,F]=t.useState(!1),[J,P]=t.useState(!0),W=j(e=>e.customization);t.useEffect(()=>{g&&(async()=>{try{const e=await k.get(`/api/usersgroups/${g}`);if(e.data.user){const s={name:e.data.user.name||"",group_type:e.data.user.group_type||"standard",modules:e.data.user.modules||O.modules};_(s),H.current=s}}catch(e){G.fire(p("common.error"),p("settings.userGroups.edit.loadFailedOne"),"error"),x("/settings/users")}finally{P(!1)}})()},[g,x]);const E=e=>{const{name:s,value:r,type:t,checked:a}=e.target;_(e=>({...e,[s]:"checkbox"===t?a:r})),A[s]&&I(e=>({...e,[s]:""}))};return J?e.jsx(a,{fluid:!0,className:"p-1 p-md-2 m-0 m-md-2",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:p("common.loading")})}),e.jsx("p",{className:"mt-3 text-muted",children:p("settings.userGroups.edit.loadingOne")})]})})}):e.jsxs(a,{fluid:!0,className:"p-1 p-md-2 m-0 m-md-2 user-group-edit",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:[e.jsx("style",{children:"\n                            .user-group-edit .form-select, .user-group-edit .form-control { min-height: 44px; }\n                            .user-group-edit .btn { min-height: 44px; }\n                            @media (max-width: 576px) {\n                                .user-group-edit .form-check.form-switch { padding: .25rem 0; }\n                            }\n                        "}),e.jsx(y,{title:p("settings.userGroups.edit.title"),subtitle:p("settings.userGroups.edit.subtitle"),icon:C,rightContent:e.jsxs(i,{color:"light",className:"shadow-sm px-3 px-md-4 fw-semibold w-100 w-md-auto",size:"sm",onClick:()=>x("/settings/users"),style:{borderRadius:"25px",border:"none",transition:"all 0.3s ease"},children:[e.jsx(o,{icon:B,className:"me-2"}),p("common.back")]})}),e.jsxs(n,{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return D.name.trim()||(e.name=p("settings.userGroups.form.validation.nameRequired")),I(e),0===Object.keys(e).length})()){F(!0);try{const e=await k.put(`/api/usersgroups/${g}`,D);200===e.data.status&&(G.fire(p("common.success")+"!",e.data.message||p("settings.userGroups.alerts.updated"),"success"),x("/settings/users"))}catch(s){G.fire(p("common.error"),s.message||p("settings.userGroups.alerts.genericError"),"error")}finally{F(!1)}}},children:[e.jsx(R,{title:p("settings.userGroups.form.titles.groupInfo"),icon:z,customization:W,children:e.jsxs(d,{children:[e.jsx(l,{xs:12,md:8,lg:6,children:e.jsx($,{label:p("settings.userGroups.form.labels.name"),name:"name",required:!0,icon:z,placeholder:p("settings.userGroups.form.placeholders.name"),value:D.name,onChange:E,isInvalid:!!A.name,feedback:A.name})}),e.jsx(l,{xs:12,md:4,lg:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(c,{className:"fw-medium text-dark mb-2 small",children:[p("settings.userGroups.form.labels.type"),e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsxs("select",{name:"group_type",value:D.group_type,onChange:E,className:"form-select",style:{border:"1px solid #e3e6f0",borderRadius:"8px",fontSize:"14px",padding:"12px 16px"},children:[e.jsx("option",{value:"standard",children:p("settings.userGroups.types.standard")}),e.jsx("option",{value:"contractor",children:p("settings.userGroups.types.contractor")})]})]})})]})}),"contractor"===D.group_type&&e.jsxs(R,{title:p("settings.userGroups.form.titles.modulePermissions"),icon:N,customization:W,children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"d-flex align-items-start p-3 rounded-3",style:{backgroundColor:"#e7f3ff",border:"1px solid #b3d7ff"},children:[e.jsx("div",{className:"rounded-circle d-flex align-items-center justify-content-center me-3 flex-shrink-0",style:{width:"32px",height:"32px",backgroundColor:W.headerBg||"#667eea",color:w(W.headerBg||"#667eea")},children:e.jsx(o,{icon:N,size:"sm"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark small mb-1",children:p("settings.userGroups.moduleAccess.title")}),e.jsx("div",{className:"text-muted",style:{fontSize:"12px",lineHeight:"1.4"},children:p("settings.userGroups.moduleAccess.description")})]})]})}),e.jsx(d,{children:Object.entries(D.modules).map(([s,r])=>e.jsxs(l,{xs:12,sm:6,md:3,className:"mb-3",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`module-${s}`,name:`modules.${s}`,checked:r,onChange:e=>{_(r=>({...r,modules:{...r.modules,[s]:e.target.checked}}))},style:{width:"3rem",height:"1.5rem"}}),e.jsx("label",{className:"form-check-label fw-medium",htmlFor:`module-${s}`,children:s.charAt(0).toUpperCase()+s.slice(1)})]}),e.jsxs("small",{className:"text-muted d-block mt-1",children:["dashboard"===s&&p("settings.userGroups.moduleDescriptions.dashboard"),"proposals"===s&&p("settings.userGroups.moduleDescriptions.proposals"),"customers"===s&&p("settings.userGroups.moduleDescriptions.customers"),"resources"===s&&p("settings.userGroups.moduleDescriptions.resources")]})]},s))})]}),e.jsx(m,{className:"border-0 shadow-sm",children:e.jsx(u,{className:"p-3 p-md-4",children:e.jsxs("div",{className:"d-flex flex-column flex-md-row gap-2 gap-md-3 justify-content-end",children:[e.jsxs(i,{type:"button",color:"light",size:"md",className:"px-3 px-md-4 fw-semibold order-2 order-md-1",onClick:()=>{JSON.stringify(D)!==JSON.stringify(H.current)?G.fire({title:p("common.confirm"),text:p("settings.userGroups.alerts.leaveWarning"),icon:"warning",showCancelButton:!0,confirmButtonText:p("settings.userGroups.alerts.leaveAnyway"),cancelButtonText:p("settings.userGroups.alerts.stayOnPage"),confirmButtonColor:"#d33",cancelButtonColor:"#6c757d"}).then(e=>{e.isConfirmed&&x("/settings/users")}):x("/settings/users")},style:{borderRadius:"25px",border:"1px solid #e3e6f0",transition:"all 0.3s ease"},children:[e.jsx(o,{icon:B,className:"me-2"}),p("common.cancel")]}),e.jsxs(i,{type:"submit",color:"primary",size:"md",disabled:q,className:"px-4 px-md-5 fw-semibold order-1 order-md-2",style:{borderRadius:"25px",border:"none",background:W.headerBg||"#667eea",color:w(W.headerBg||"#667eea"),transition:"all 0.3s ease"},children:[e.jsx(o,{icon:S,className:"me-2"}),p(q?"settings.userGroups.edit.updating":"settings.userGroups.edit.update")]})]})})})]})]})};export{D as default};
