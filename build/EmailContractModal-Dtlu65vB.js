import{a as e,u as t}from"./index-DW-yAxzW.js";import{j as n}from"./date-vendor-D9pAgX5F.js";import{r as a}from"./react-vendor-DF7UJAlN.js";import{i as s,e as o,u as r,l as i,J as l,C as d,U as c,V as m,b as p,d as u,v as h,f as g,g as x,aa as f,a8 as b,I as y,m as v,a6 as C,j as $,k as w}from"./ui-vendor-DjmSPU99.js";import{S as j}from"./utils-vendor-Nl-sF5xe.js";import{P as N,e as S}from"./DefaultLayout-BUcG_pV2.js";import{c as F}from"./cil-arrow-left-D66Kb3Zq.js";import{c as q}from"./cil-magnifying-glass-CDkY_4k-.js";import{a as D}from"./redux-vendor-BzdbewH4.js";import{u as k,S as I,h as R,k as P,j as z}from"./form-vendor-CKNVq0c_.js";import{C as T}from"./editor-vendor-BVtsSqVx.js";import{C as E}from"./ckeditor-CpNaeZUl.js";var M=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='408 432 376 432 376 464 112 464 112 136 144 136 144 104 80 104 80 496 408 496 408 432' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M176,16V400H496V153.373L358.627,16ZM464,368H208V48H312V200H464Zm0-200H344V48h1.372L464,166.627Z' class='ci-primary'/>"],A=["512 512","<rect width='264' height='32' x='208' y='80' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M40,96a64,64,0,1,0,64-64A64.072,64.072,0,0,0,40,96Zm64-32A32,32,0,1,1,72,96,32.036,32.036,0,0,1,104,64Z' class='ci-primary'/><rect width='264' height='32' x='208' y='240' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M104,320a64,64,0,1,0-64-64A64.072,64.072,0,0,0,104,320Zm0-96a32,32,0,1,1-32,32A32.036,32.036,0,0,1,104,224Z' class='ci-primary'/><rect width='264' height='32' x='208' y='400' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M104,480a64,64,0,1,0-64-64A64.072,64.072,0,0,0,104,480Zm0-96a32,32,0,1,1-32,32A32.036,32.036,0,0,1,104,384Z' class='ci-primary'/>"],L=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M256,144a64,64,0,1,0-64-64A64.072,64.072,0,0,0,256,144Zm0-96a32,32,0,1,1-32,32A32.036,32.036,0,0,1,256,48Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M256,368a64,64,0,1,0,64,64A64.072,64.072,0,0,0,256,368Zm0,96a32,32,0,1,1,32-32A32.036,32.036,0,0,1,256,464Z' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M256,192a64,64,0,1,0,64,64A64.072,64.072,0,0,0,256,192Zm0,96a32,32,0,1,1,32-32A32.036,32.036,0,0,1,256,288Z' class='ci-primary'/>"];const V=async(t,n)=>{try{const a=t.map(e=>({id:e.catalogDataId||e.id,name:e.name||e.description,code:e.code,hingeSide:e.hingeSide,exposedSide:e.exposedSide})),s=await e.post("/api/sub-types/validate-requirements",{items:a,manufacturerId:n});return{isValid:s.data.isValid,missingRequirements:s.data.missingRequirements||[]}}catch(a){return{isValid:!0,missingRequirements:[]}}},B=(e,t)=>{const n=(e=>e&&0!==e.length?`The following items have missing requirements:\n\n${e.map(e=>`â€¢ ${e.itemName||"Unknown Item"} ${e.itemCode?`(${e.itemCode})`:""}: ${e.requirement||"selection"} selection required`).join("\n")}\n\nPlease complete all required selections before accepting the quote.`:"")(e);return t.fire({title:"Missing Required Selections",text:n,icon:"warning",confirmButtonText:"OK",confirmButtonColor:"#d33"})},U=async(t,n)=>{try{if(!Array.isArray(t)||0===t.length||!n)return{requiresHinge:!1,requiresExposed:!1,itemRequirements:{}};const a=t.map(e=>({id:e.catalogDataId||e.id,name:e.name||e.description,code:e.code,hingeSide:e.hingeSide,exposedSide:e.exposedSide})),s=await e.post("/api/sub-types/validate-requirements",{items:a,manufacturerId:n});let o=!1,r=!1;if(s.data.missingRequirements&&(o=s.data.missingRequirements.some(e=>"hinge side"===e.requirement),r=s.data.missingRequirements.some(e=>"exposed side"===e.requirement)),s.data.allRequirements&&(o=o||s.data.allRequirements.some(e=>"hinge side"===e.requirement),r=r||s.data.allRequirements.some(e=>"exposed side"===e.requirement)),!s.data.allRequirements&&(s.data.missingRequirements||s.data.validRequirements)){const e=[...s.data.missingRequirements||[],...s.data.validRequirements||[]];o=o||e.some(e=>"hinge side"===e.requirement),r=r||e.some(e=>"exposed side"===e.requirement)}const i={};return s.data.missingRequirements&&s.data.missingRequirements.forEach(e=>{const t=e.itemIndex;void 0!==t&&(i[t]||(i[t]={}),"hinge side"===e.requirement&&(i[t].requiresHinge=!0),"exposed side"===e.requirement&&(i[t].requiresExposed=!0))}),{requiresHinge:o,requiresExposed:r,itemRequirements:i}}catch(a){return{requiresHinge:!1,requiresExposed:!1,itemRequirements:{}}}},O=({visible:b,onClose:y,onApplyModification:v,selectedItemIndex:C,catalogItemId:$})=>{const[w,D]=a.useState(!1),{t:k}=t(),[I,R]=a.useState(""),[P,z]=a.useState([]),[T,E]=a.useState("categories"),[M,A]=a.useState(null),[L,V]=a.useState(null),[B,U]=a.useState({quantity:1,selectedOptions:{},uploadedFiles:[]});a.useEffect(()=>{b&&$&&((async()=>{D(!0);try{if(!$)return void z([]);const t=await e.get(`/api/global-mods/item/${$}`),n=t.data?.assignments||[],a=new Map;n.forEach(e=>{const t=e.template;if(!t)return;const n=e.category?.name||k("common.none","None"),s=e.category?.id||"uncategorized";a.has(s)||a.set(s,{id:s,name:n,templates:[]}),a.get(s).templates.push({...t,assignmentId:e.id,overridePrice:e.overridePrice,effectivePrice:e.overridePrice??t.defaultPrice,scope:e.scope})}),z(Array.from(a.values()))}catch(t){j.fire(k("common.error","Error"),k("proposals.toast.errorGeneric","An error occurred"),"error"),z([])}finally{D(!1)}})(),E("categories"),A(null),V(null),R(""),U({quantity:1,selectedOptions:{},uploadedFiles:[]}))},[b,$]);const O=P.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())||(e.templates||[]).some(e=>e.name.toLowerCase().includes(I.toLowerCase()))),H=M?.templates?.filter(e=>e.name.toLowerCase().includes(I.toLowerCase()))||[];return n.jsxs(s,{visible:b,onClose:y,size:"lg",scrollable:!0,children:[n.jsx(N,{title:k("modificationBrowser.title"),mobileLayout:"inline",rightContent:n.jsxs("div",{className:"d-flex align-items-center gap-2",children:["categories"!==T&&n.jsxs(o,{color:"primary",size:"sm",onClick:()=>{"details"===T?(E("templates"),V(null)):"templates"===T&&(E("categories"),A(null)),R("")},className:"me-2","aria-label":k("modificationBrowser.buttons.back"),title:k("modificationBrowser.buttons.back"),style:{minHeight:"44px"},children:[n.jsx(r,{icon:F,className:"me-1"}),n.jsx("span",{children:k("modificationBrowser.buttons.back")})]}),n.jsx(o,{color:"light",size:"sm",onClick:y,"aria-label":k("modificationBrowser.buttons.close"),title:k("modificationBrowser.buttons.close"),style:{minHeight:"44px"},children:n.jsx(r,{icon:S})})]})}),n.jsxs(i,{className:"p-2",children:[n.jsx("div",{className:"mb-2",children:n.jsxs(g,{className:"mb-0 small",children:[n.jsx(x,{active:"categories"===T,style:{cursor:"pointer",color:"categories"===T?"#084298":"#6c757d"},onClick:()=>"categories"!==T&&E("categories"),children:"All"}),M&&n.jsx(x,{active:"templates"===T,style:{cursor:"pointer",color:"templates"===T?"#084298":"#6c757d"},onClick:()=>"details"===T&&E("templates"),children:M.name}),L&&n.jsx(x,{active:!0,style:{color:"#084298"},children:L.name})]})}),n.jsxs("div",{className:"position-relative mb-3",children:[n.jsx(r,{icon:q,className:"position-absolute",style:{left:"12px",top:"50%",transform:"translateY(-50%)",color:"#6c757d"}}),n.jsx(l,{placeholder:k("modificationBrowser.search.placeholder"),"aria-label":k("modificationBrowser.search.placeholder"),value:I,onChange:e=>R(e.target.value),style:{paddingLeft:"40px"}})]}),w?n.jsxs("div",{className:"text-center py-5",children:[n.jsx(d,{color:"primary"}),n.jsx("p",{className:"mt-2 text-muted",children:k("modificationBrowser.loading")})]}):0===P.length?n.jsx("div",{className:"text-center py-5",children:n.jsxs("div",{className:"text-muted",children:[n.jsx(r,{icon:q,size:"4xl",className:"mb-3"}),n.jsx("h5",{children:k("modificationBrowser.empty.title")}),n.jsx("p",{children:k("modificationBrowser.empty.subtitle")}),n.jsx("p",{className:"small",children:k("modificationBrowser.empty.hint")})]})}):n.jsxs(n.Fragment,{children:["categories"===T&&n.jsx(c,{className:"g-3",children:O.map(e=>n.jsx(m,{sm:6,md:4,lg:3,className:"mb-3",children:n.jsx(p,{className:"h-100 border-0 shadow-sm",style:{cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>(e=>{A(e),E("templates"),R("")})(e),children:n.jsxs(u,{className:"d-flex flex-column p-3",children:[e.image&&n.jsx("div",{className:"mb-2 text-center",children:n.jsx("img",{src:`https://app.nj.contractors/uploads/images/${e.image}`,alt:e.name,style:{width:"100%",maxHeight:100,objectFit:"cover",borderRadius:6,border:"1px solid #e9ecef"},onError:e=>{e.currentTarget.src="/images/nologo.png"}})}),n.jsx("h6",{className:"card-title mb-1 fs-6",children:e.name}),n.jsxs("p",{className:"text-muted small mb-2",children:[e.templates?.length||0," "," modification",1!==(e.templates?.length||0)?"s":""]}),n.jsx("div",{className:"mt-auto",children:n.jsx(h,{color:"primary",className:"px-2 py-1 small",children:k("modificationBrowser.category.browse")})})]})})},e.id))}),"templates"===T&&n.jsx(c,{className:"g-3",children:H.map(e=>n.jsx(m,{sm:6,md:4,lg:3,className:"mb-3",children:n.jsx(p,{className:"h-100 border-0 shadow-sm",style:{cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>(e=>{V(e),E("details"),R("");const t=e.fieldsConfig||{},n={},a=t.qtyRange&&!1!==t.qtyRange.enabled?t.qtyRange.min:1;t.sliders&&Object.keys(t.sliders).forEach(e=>{const a=t.sliders[e];!1!==a.enabled&&(n[e]=a.min||0)}),t.sideSelector&&!1!==t.sideSelector.enabled&&t.sideSelector.options&&t.sideSelector.options.length>0&&(n.sideSelector=t.sideSelector.options[0]),U(e=>({...e,quantity:a,selectedOptions:n,uploadedFiles:[]}))})(e),children:n.jsxs(u,{className:"d-flex flex-column p-3",children:[(e.sampleImage||e.fieldsConfig?.modSampleImage?.enabled)&&n.jsx("div",{className:"mb-2 text-center",style:{height:"120px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",borderRadius:6,border:"1px solid #e9ecef"},children:n.jsx("img",{src:e.sampleImage?`https://app.nj.contractors/uploads/images/${e.sampleImage}`:"/images/nologo.png",alt:e.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:4},onError:e=>{e.currentTarget.src="/images/nologo.png"}})}),n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-1",children:[n.jsx("h6",{className:"card-title mb-0 fs-6",children:e.name}),n.jsx(h,{color:e.isReady?"success":"warning",className:"small",children:e.isReady?k("modificationBrowser.template.status.ready"):k("modificationBrowser.template.status.draft")})]}),e.descriptions?.customer&&n.jsx("p",{className:"text-muted small mb-2 text-truncate",children:e.descriptions.customer}),e.effectivePrice&&n.jsxs("p",{className:"mb-2 small",children:[n.jsxs("strong",{children:["$",Number(e.effectivePrice).toFixed(2)]}),e.overridePrice&&n.jsx("small",{className:"text-muted ms-1",children:k("modificationBrowser.template.price.overrideShort")})]}),n.jsx("div",{className:"mt-auto",children:n.jsx(h,{color:"primary",className:"px-2 py-1 small",children:k("modificationBrowser.template.configure")})})]})})},e.id))}),"details"===T&&L&&n.jsx("div",{children:n.jsx(p,{className:"border-0 shadow-sm",children:n.jsxs(u,{className:"p-3",children:[n.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"mb-1",children:L.name}),n.jsx("p",{className:"text-muted mb-2",children:L.descriptions?.customer})]}),n.jsxs("div",{className:"text-end",children:[L.effectivePrice&&n.jsxs("h4",{className:"mb-0",children:["$",Number(L.effectivePrice).toFixed(2)]}),L.overridePrice&&n.jsx("small",{className:"text-muted",children:k("modificationBrowser.template.price.overrideLabel")}),n.jsx(h,{color:L.isReady?"success":"warning",className:"ms-2",children:L.isReady?k("modificationBrowser.template.status.ready"):k("modificationBrowser.template.status.draft")})]})]}),(L.sampleImage||L.fieldsConfig?.modSampleImage?.enabled)&&n.jsx("div",{className:"mb-3",style:{height:"220px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",borderRadius:8,border:"1px solid #e9ecef"},children:n.jsx("img",{src:L.sampleImage?`https://app.nj.contractors/uploads/images/${L.sampleImage}`:"/images/nologo.png",alt:L.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:6},onError:e=>{e.currentTarget.src="/images/nologo.png"}})}),n.jsx("div",{className:"alert alert-warning mb-3 py-2",role:"alert",children:n.jsxs("small",{children:[n.jsx("strong",{children:k("modificationBrowser.leadTime.noticeTitle")})," ",k("modificationBrowser.leadTime.noticeText",{days:8})]})}),(()=>{if(!L?.fieldsConfig)return n.jsx("div",{className:"alert alert-info",children:n.jsx("small",{children:k("proposalUI.custom.noOptions","This modification template has no configurable options.")})});const e=L.fieldsConfig,{selectedOptions:t}=B,a=e=>{const t=Number(e);if(Number.isNaN(t))return`${e}"`;const n=Math.floor(t),a=t-n,s=Math.round(8*a);let o=[],r=n,i={0:"",1:"1/8",2:"1/4",3:"3/8",4:"1/2",5:"5/8",6:"3/4",7:"7/8",8:""}[s];8===s&&(r=n+1,i=""),r>0&&o.push(String(r)),i&&o.push(i);return`${o.length?o.join(" "):"0"}"`};return n.jsxs("div",{className:"modification-config mt-4",children:[e.sliders&&Object.keys(e.sliders).map(s=>{const o=e.sliders[s];if(!(!1!==o.enabled))return null;const r=t[s]||o.min,i=`slider-${s}`;return n.jsxs("div",{className:"mb-4",children:[n.jsxs("label",{className:"form-label text-capitalize",htmlFor:i,children:[k("proposalUI.custom.choose","Choose")," ",s,": ",n.jsx("strong",{children:a(r)})]}),n.jsx(f,{id:i,min:o.min,max:o.max,step:o.step||1,value:r,onChange:e=>U(t=>({...t,selectedOptions:{...t.selectedOptions,[s]:Number(e.target.value)}})),className:"mb-2"}),n.jsxs("div",{className:"d-flex justify-content-between text-muted small",children:[n.jsx("span",{children:a(o.min)}),n.jsx("span",{children:a(o.max)})]})]},s)}),e.sideSelector&&!1!==e.sideSelector.enabled&&n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label fw-bold",children:"Side Selection"}),n.jsx("div",{className:"d-flex gap-2",children:e.sideSelector.options.map(e=>{const a=t.sideSelector===e,s="L"===e?"Left":"R"===e?"Right":e;return n.jsx("button",{type:"button",className:`btn ${a?"btn-primary":"btn-outline-primary"} px-4 py-2 fw-semibold`,style:{minWidth:"80px",border:a?"2px solid #0d6efd":"2px solid #6c757d",backgroundColor:a?"#0d6efd":"#ffffff",color:a?"#ffffff":"#495057",fontWeight:"600"},onClick:()=>U(t=>({...t,selectedOptions:{...t.selectedOptions,sideSelector:e}})),children:s},e)})})]}),e.qtyRange&&!1!==e.qtyRange.enabled&&n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label",children:"Quantity"}),n.jsx(l,{type:"number",min:e.qtyRange.min,max:e.qtyRange.max,value:B.quantity,onChange:t=>U(n=>({...n,quantity:Math.max(e.qtyRange.min,Math.min(e.qtyRange.max,Number(t.target.value)))})),"aria-label":"Quantity"})]}),e.notes&&!1!==e.notes.enabled&&n.jsxs("div",{className:"mb-4",children:[n.jsx("label",{className:"form-label",children:"Notes"}),n.jsx("div",{className:"form-control-plaintext border rounded p-2 bg-light text-danger",children:e.notes.placeholder||"No additional notes configured for this modification."})]}),e.customerUpload&&!1!==e.customerUpload.enabled&&n.jsxs("div",{className:"mb-4",children:[n.jsxs("label",{className:"form-label",children:[e.customerUpload.title||"File Upload",e.customerUpload.required&&n.jsx("span",{className:"text-danger",children:" *"})]}),n.jsx(l,{type:"file",multiple:!0,onChange:e=>U(t=>({...t,uploadedFiles:Array.from(e.target.files)})),"aria-label":"Upload files for modification"})]})]})})(),(!L.fieldsConfig?.qtyRange||!1===L.fieldsConfig.qtyRange.enabled)&&n.jsxs("div",{className:"mb-3",children:[n.jsx("label",{className:"form-label",children:k("modificationBrowser.qty.label")}),n.jsx(l,{type:"number",min:1,value:B.quantity,onChange:e=>U(t=>({...t,quantity:Math.max(1,Number(e.target.value))})),style:{width:"100px"}})]}),n.jsx("div",{className:"d-flex justify-content-end gap-2 mt-3",children:n.jsx(o,{color:"primary",onClick:async()=>{if(!L)return;const t=L.fieldsConfig||{};if(t.customerUpload&&!1!==t.customerUpload.enabled&&t.customerUpload.required&&(!B.uploadedFiles||0===B.uploadedFiles.length))return void j.fire(k("common.warning","Warning"),k("proposalUI.custom.validation.missingFile","This modification requires a file upload. Please attach at least one file."),"warning");let n=[];try{if(Array.isArray(B.uploadedFiles)&&B.uploadedFiles.length>0){n=(await Promise.all(B.uploadedFiles.map(async t=>{const n=new FormData;n.append("file",t);const{data:a}=await e.post("/api/resources/files",n,{headers:{"Content-Type":"multipart/form-data"}}),s=a?.data||a;return s?{id:s.id,url:s.url||`/api/resources/files/download/${s.id}`,name:s.original_name||s.name||t.name,mimeType:s.mime_type||t.type||"",size:s.file_size||t.size}:null}))).filter(Boolean)}}catch(s){return void j.fire(k("common.error","Error"),k("proposalUI.custom.validation.uploadFailed","Could not upload one or more files. Please try again."),"error")}const a={templateId:L.id,templateName:L.name,categoryName:M?.name||"",quantity:B.quantity,note:L.fieldsConfig?.notes?.placeholder||"",selectedOptions:B.selectedOptions,price:L.effectivePrice||L.defaultPrice||0,taxable:!0,scope:L.scope,assignmentId:L.assignmentId,attachments:n};try{await v(C,a),j.fire(k("common.success","Success"),k("proposalUI.custom.applied","Modification applied successfully!"),"success"),y()}catch(o){j.fire(k("common.error","Error"),k("proposalUI.custom.applyFailed","Failed to apply modification"),"error")}},disabled:!L,style:{minHeight:"44px"},children:k("modificationBrowser.actions.addModification")})})]})})})]})]})]})},H=()=>{try{const e="true"===localStorage.getItem("showroomMode");return{mode:e,multiplier:parseFloat(localStorage.getItem("showroomMultiplier"))||1}}catch(e){return{mode:!1,multiplier:1}}},W=()=>H().mode,Z=()=>H().multiplier,G=e=>{const t=t=>{e(t.detail)};return window.addEventListener("showroomSettingsChanged",t),()=>{window.removeEventListener("showroomSettingsChanged",t)}},_=({show:r,onClose:l,formData:d})=>{const{t:c,i18n:m}=t(),p=e=>{switch(e){case"L":return c("common.short.left",{defaultValue:"L"});case"R":return c("common.short.right",{defaultValue:"R"});case"B":return c("common.short.both",{defaultValue:"B"});default:return e}};D(e=>e.selectedVersion.data);const u=D(e=>e.selectVersionNew.data),[h,g]=a.useState(null),[x,f]=a.useState(null),[C,$]=a.useState(!1),[w,j]=a.useState(null),[S,F]=a.useState(!1),[q,R]=a.useState(""),P=a.useRef(null),z=a.useRef(null),[T,E]=a.useState(1),[M,A]=a.useState(0),[L,V]=a.useState(20),[B,U]=a.useState("xl"),O=()=>{const e=window.innerWidth||document.documentElement.clientWidth||0;return e<576?"sm":e<768?"lg":"xl"},H=()=>{try{const e=P.current,t=z.current;if(!e||!t)return;const n=O();n!==B&&U(n);const a=window.innerWidth||document.documentElement.clientWidth||0,s=Math.max(12,Math.min(32,Math.round(.04*a)));s!==L&&V(s);const o=window.getComputedStyle(e),r=parseFloat(o.paddingLeft||"0"),i=parseFloat(o.paddingRight||"0"),l=(e.clientWidth||0)-r-i;if(!l||l<=0)return;let d=l/794;a<576?(d=Math.min(d,.8),d=Math.max(d,.4)):a<768?(d=Math.min(d,.9),d=Math.max(d,.5)):a<1200?(d=Math.min(d,1),d=Math.max(d,.6)):(d=Math.min(d,1.2),d=Math.max(d,.7)),E(d);const c=t.scrollHeight||t.offsetHeight||0;A(c)}catch(e){}};a.useEffect(()=>{if(!S)return;const e=()=>H();return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[S,q]),a.useEffect(()=>{const e=()=>{const e=O();U(e)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{if(!S||!z.current)return;const e=new MutationObserver(()=>H());return e.observe(z.current,{childList:!0,subtree:!0}),()=>e.disconnect()},[S,z.current]);const G=(()=>{try{return JSON.parse(localStorage.getItem("user"))}catch(e){return null}})(),_=!!(G?.group&&"contractor"===G.group.group_type||G?.role&&"contractor"===String(G.role).toLowerCase());a.useEffect(()=>{r&&(async()=>{try{const t=await e.get("/api/settings/customization/pdf");j(t.data||{})}catch(t){}})()},[r]),a.useEffect(()=>{if(!r)return;const t=d?.manufacturersData?.[0];t?.manufacturer&&t?.selectedStyle&&((async(t,n)=>{try{const a=await e.get(`/api/manufacturers/${t}/styles-meta`),s=(a.data?.styles||[]).find(e=>e.id===n);g(s||null)}catch(a){}})(t.manufacturer,t.selectedStyle),(async t=>{try{const n=await e.get(`/api/manufacturers/${t}`);f(n.data||null)}catch(n){}})(t.manufacturer))},[r,d?.manufacturersData?.[0]?.manufacturer,d?.manufacturersData?.[0]?.selectedStyle]);const{companyName:K,companyPhone:Q,companyEmail:Y,companyAddress:J,companyWebsite:X,headerBgColor:ee="#000000",headerLogo:te,pdfFooter:ne,headerTxtColor:ae="#FFFFFF"}=w||{},se=d?.description||c("proposalDoc.defaultProjectDescription",{defaultValue:"Kitchen Project"}),oe=((new Date).toLocaleDateString(m.language||"en-US"),d?.manufacturersData?.[0]?.summary||{}),re=W()?Z():1,ie=d?.manufacturersData?.[0]?.items?.length?{cabinets:(oe.cabinets||0)*re,assemblyFee:(oe.assemblyFee||0)*re,modifications:(oe.modificationsCost||0)*re,styleTotal:(oe.styleTotal||0)*re,total:(oe.total||0)*re,tax:(oe.taxAmount||0)*re,grandTotal:(oe.grandTotal||0)*re}:{cabinets:0,assemblyFee:0,modifications:0,styleTotal:0,total:0,tax:0,grandTotal:0},le=(d?.manufacturersData?.[0]?.items||[]).map(e=>({qty:e.qty||0,code:e.code||"",item:e.description?`${e.code} - ${e.description}`:e.code||"",assembled:e.isRowAssembled?c("common.yes"):c("common.no"),hingeSide:e.hingeSide||c("common.na"),exposedSide:e.exposedSide||c("common.na"),price:(parseFloat(e.price)||0)*re,assemblyCost:e.includeAssemblyFee?(parseFloat(e.assemblyFee)||0)*re:0,total:e.includeAssemblyFee?(parseFloat(e.total)||0)*re:(parseFloat(e.price)||0)*re,modifications:e.modifications||{}})),de=e=>{const t=te?`https://app.nj.contractors${te}`:null,n=d?.customerName||d?.customer?.name||"",a=d?.designerData?.name||"",s=(d?.date?new Date(d.date):new Date).toLocaleDateString(m.language||"en-US"),o=d?.manufacturersData?.[0]||{};let r="";o?.manufacturerData?.name?r=o.manufacturerData.name:o?.name?r=o.name:o?.manufacturer?.name?r=o.manufacturer.name:x?.name?r=x.name:d?.manufacturerData?.name?r=d.manufacturerData.name:u?.manufacturerData?.name&&(r=u.manufacturerData.name);let i="";o?.styleName?i=o.styleName:o?.selectedStyleData?.style?i=o.selectedStyleData.style:h?.style?i=h.style:o?.styleData?.style&&(i=o.styleData.style);const l=e.selectedColumns;return l.map(e=>`<th>${"no"===e?c("proposalColumns.no"):"qty"===e?c("proposalColumns.qty"):"item"===e?c("proposalColumns.item"):"assembled"===e?c("proposalColumns.assembled"):"hingeSide"===e?c("proposalColumns.hingeSide"):"exposedSide"===e?c("proposalColumns.exposedSide"):"price"===e?c("proposalColumns.price"):"assemblyCost"===e?c("proposalColumns.assemblyCost"):"total"===e?c("proposalColumns.total"):e}</th>`).join(""),le.map((e,t)=>`<tr>${l.map(n=>{switch(n){case"no":return`<td>${t+1}</td>`;case"item":return`<td>${e.item}</td>`;case"qty":return`<td>${e.qty}</td>`;case"assembled":return`<td>${e.assembled}</td>`;case"hingeSide":return`<td>${p(e.hingeSide)}</td>`;case"exposedSide":return`<td>${p(e.exposedSide)}</td>`;case"price":return`<td>$${e.price.toFixed(2)}</td>`;case"assemblyCost":return`<td>$${e.assemblyCost.toFixed(2)}</td>`;case"total":return`<td>$${e.total.toFixed(2)}</td>`;default:return"<td></td>"}}).join("")}</tr>`).join(""),`\n\n    <!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>${c("proposalDoc.title")}</title>\n    <style>\n        @page {\n            margin: 20mm;\n            size: A4;\n        }\n\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            font-size: 12px;\n            line-height: 1.4;\n            color: #333;\n            margin: 0;\n            padding: 0;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: 30px;\n            padding: 2rem;\n            background-color: ${ee};\n            color: ${ae};\n            min-height: 120px;\n            overflow: hidden;\n        }\n\n        .header-left {\n            flex: 0 0 auto;\n            max-width: 50%;\n        }\n\n        .header-right {\n            flex: 0 0 auto;\n            max-width: 45%;\n            text-align: right;\n            word-wrap: break-word;\n        }\n\n        .logo {\n            max-width: 200px;\n            max-height: 80px;\n            object-fit: contain;\n            background: rgba(255,255,255,0.1);\n            padding: 0.5rem;\n            border-radius: 8px;\n        }\n\n        .company-name {\n            font-size: 1.8rem;\n            font-weight: bold;\n            color: ${ae};\n            margin: 0;\n            word-wrap: break-word;\n        }\n\n        .company-info {\n            text-align: right;\n            line-height: 1.4;\n            color: ${ae};\n            font-size: 0.9rem;\n            word-wrap: break-word;\n            overflow-wrap: break-word;\n        }\n\n        .company-info div {\n            margin-bottom: 3px;\n            word-wrap: break-word;\n        }\n\n        .content-wrapper {\n            padding: 2rem;\n        }\n\n        .greeting {\n            font-size: 1rem;\n            margin-bottom: 1.5rem;\n            color: #333;\n            line-height: 1.6;\n        }\n\n        .description {\n            font-size: 1rem;\n            margin-bottom: 1.5rem;\n            color: #333;\n            line-height: 1.6;\n        }\n\n        .summary-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 2rem;\n            border: 1px solid #dee2e6;\n        }\n\n        .summary-table th {\n            background-color: #f8f9fa;\n            padding: 0.75rem;\n            border: 1px solid #dee2e6;\n            font-weight: 600;\n            text-align: left;\n        }\n\n        .summary-table td {\n            padding: 0.75rem;\n            border: 1px solid #dee2e6;\n        }\n\n        .section-header {\n            font-size: 1.5rem;\n            font-weight: 600;\n            margin: 2rem 0 1.5rem 0;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            color: #2563eb;\n        }\n\n        .items-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 1.5rem;\n            border: 1px solid #dee2e6;\n        }\n\n        .items-table th {\n            background-color: #f8f9fa;\n            padding: 0.75rem;\n            border: 1px solid #dee2e6;\n            font-weight: 600;\n            text-align: left;\n            font-size: 11px;\n        }\n\n        .items-table td {\n            padding: 0.75rem;\n            border: 1px solid #dee2e6;\n            font-size: 11px;\n        }\n\n        .items-table tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n\n        .category-row {\n            background-color: #f8f9fa !important;\n            font-weight: bold;\n            font-style: italic;\n        }\n\n        .text-right {\n            text-align: right;\n        }\n\n        .text-left {\n            text-align: left;\n        }\n\n        .price-summary {\n            background-color: #f8f9fa;\n            border: 1px solid #dee2e6;\n            border-radius: 8px;\n            padding: 1.5rem;\n            margin-top: 1.5rem;\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            font-size: 1rem;\n        }\n\n        .price-summary table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n\n        .price-summary td {\n            padding: 0.5rem 0;\n        }\n\n        .price-summary .text-left {\n            text-align: left;\n            color: #212529;\n            font-weight: 500;\n        }\n\n        .price-summary .text-right {\n            text-align: right;\n            color: #212529;\n            font-weight: 500;\n        }\n\n        .price-summary .total-row {\n            font-weight: bold;\n            border-top: 1px solid #dee2e6;\n            padding-top: 0.5rem;\n        }\n\n        .price-summary .grand-total {\n            font-weight: bold;\n            font-size: 1.2rem;\n            color: #1a1a1a;\n            padding-top: 0.5rem;\n            border-top: 2px solid #495057;\n            margin-top: 0.5rem;\n        }\n\n        .style-info {\n            background-color: #e8f4fd;\n            border: 1px solid #b3d7ff;\n            border-radius: 8px;\n            padding: 1rem;\n            margin-bottom: 2rem;\n            font-size: 1rem;\n        }\n\n        .style-info h4 {\n            color: #2563eb;\n            margin: 0 0 0.5rem 0;\n            font-size: 1.1rem;\n            font-weight: 600;\n        }\n\n        .style-details {\n            display: flex;\n            gap: 2rem;\n            flex-wrap: wrap;\n        }\n\n        .style-detail-item {\n            flex: 1;\n            min-width: 200px;\n        }\n\n        .style-detail-label {\n            font-weight: 600;\n            color: #495057;\n            margin-bottom: 0.25rem;\n            font-size: 0.875rem;\n        }\n\n        .style-detail-value {\n            font-size: 1rem;\n            color: #212529;\n            font-weight: 500;\n        }\n\n        .style-detail-item {\n            display: flex;\n            flex-direction: column;\n            gap: 0.25rem;\n        }\n\n        .style-detail-label {\n            font-weight: 600;\n            color: #374151;\n            font-size: 0.9rem;\n        }\n\n        .main-footer-div {\n            margin-top: 1.5rem;\n            padding: 1.5rem;\n            background-color: #f8f9fa;\n            color: #6c757d;\n            font-size: 0.9rem;\n            line-height: 1.6;\n            border-top: 1px solid #dee2e6;\n            white-space: pre-line;\n            border-radius: 8px;\n        }\n\n        @media print {\n            body {\n                -webkit-print-color-adjust: exact;\n                print-color-adjust: exact;\n            }\n\n            .page-break {\n                page-break-before: always;\n            }\n        }\n    </style>\n</head>\n<body>\n    \x3c!-- Header Section --\x3e\n    <div class="header">\n        <div class="header-left">\n            ${t?`<img src="${t}" alt="${c("proposalDoc.altCompanyLogo")}" class="logo">`:`<div class="company-name">${K||c("proposalDoc.fallbackCompanyName")}</div>`}\n        </div>\n        <div class="header-right">\n            <div class="company-info">\n                ${K?`<div><strong>${K}</strong></div>`:""}\n                ${Q?`<div>${Q}</div>`:""}\n                ${Y?`<div>${Y}</div>`:""}\n                ${X?`<div>${X}</div>`:""}\n                ${J?`<div style="white-space: pre-line; font-style: italic; margin-top: 0.5rem;">${J}</div>`:""}\n            </div>\n        </div>\n    </div>\n\n    \x3c!-- Content Wrapper --\x3e\n    <div class="content-wrapper">\n        \x3c!-- Greeting --\x3e\n        <div class="greeting">\n        ${c("proposalDoc.greeting",{name:n})}\n        </div>\n\n        <div class="description">\n        ${c("proposalDoc.descriptionIntro")}\n        </div>\n\n        \x3c!-- Proposal Summary (matches customization preview) --\x3e\n        <table class="summary-table">\n            <thead>\n                <tr>\n                    <th>${c("proposals.headers.description")}</th>\n                    <th>${c("proposals.headers.designer")}</th>\n                    <th>${c("proposals.headers.customer")}</th>\n                    <th>${c("proposals.headers.date")}</th>\n                </tr>\n            </thead>\n            <tbody>\n                <tr>\n                    <td>${se}</td>\n                    <td>${a||c("common.na")}</td>\n                    <td>${n||c("common.na")}</td>\n                    <td>${s}</td>\n                </tr>\n            </tbody>\n        </table>\n\n        \x3c!-- Style and Manufacturer Information --\x3e\n        ${i||r?`\n        <div class="style-info">\n            <h4>${c("proposalDoc.styleInformation","Style Information")}</h4>\n            <div class="style-details">\n                ${r?`\n                <div class="style-detail-item">\n                    <div class="style-detail-label">${c("proposalDoc.manufacturer","Manufacturer")}:</div>\n                    <div class="style-detail-value">${r}</div>\n                </div>\n                `:""}\n                ${i?`\n                <div class="style-detail-item">\n                    <div class="style-detail-label">${c("proposalDoc.styleName","Style")}:</div>\n                    <div class="style-detail-value">${i}</div>\n                </div>\n                `:""}\n            </div>\n        </div>\n        `:""}\n\n        ${le&&le.length>0?`\n        \x3c!-- Proposal Items Section --\x3e\n        <div class="section-header">${c("proposalDoc.sections.proposalItems")}</div>\n        <table class="items-table">\n            <thead>\n                <tr style="background-color: #f8f9fa;">\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem;">${c("proposalColumns.no")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem;">${c("proposalColumns.qty")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem;">${c("proposalColumns.item")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem;">${c("proposalColumns.assembled")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem;">${c("proposalColumns.hingeSide")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem;">${c("proposalColumns.exposedSide")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">${c("proposalColumns.price")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">${c("proposalColumns.assemblyCost")}</th>\n                    <th style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">${c("proposalColumns.total")}</th>\n                </tr>\n            </thead>\n            <tbody>\n                \x3c!-- Category Row --\x3e\n                <tr class="category-row">\n                    <td colspan="9" style="padding: 0.75rem; background-color: #f8f9fa; font-style: italic;"><strong>${c("proposalColumns.items")}</strong></td>\n                </tr>\n                \x3c!-- Dynamically inserted rows --\x3e\n                ${le.map((e,t)=>`\n                        <tr>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${t+1}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${e.qty}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${e.code||""}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${e.assembled}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${p(e.hingeSide)}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${p(e.exposedSide)}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">$${parseFloat(e.price).toFixed(2)}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">$${e.includeAssemblyFee?parseFloat(e.assemblyFee).toFixed(2):"0.00"}</td>\n                            <td style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">$${parseFloat(e.total).toFixed(2)}</td>\n                        </tr>\n                        `+(e.modifications&&e.modifications.length>0?`\n                            <tr>\n                                <td colspan="9" style="padding: 0.75rem; background-color: #f9f9f9; font-style: italic;"><strong>${c("proposalDoc.modifications")}</strong></td>\n                            </tr>\n                            ${e.modifications.map((e,t)=>{const n=(parseFloat(e.price)||0)*(e.qty||0);return`\n                                        <tr>\n                                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">-</td>\n                                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${e.qty||""}</td>\n                                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;">${e.name||""}</td>\n                                            <td colspan="3" style="border: 1px solid #dee2e6; padding: 0.75rem;"></td>\n                                            <td style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">$${(parseFloat(e.price)||0).toFixed(2)}</td>\n                                            <td style="border: 1px solid #dee2e6; padding: 0.75rem;"></td>\n                                            <td style="border: 1px solid #dee2e6; padding: 0.75rem; text-align: right;">$${n.toFixed(2)}</td>\n                                        </tr>\n                                    `}).join("")}\n                            `:"")).join("")}\n            </tbody>\n        </table>\n        \x3c!-- Price Summary --\x3e\n        <div class="price-summary">\n            <table>\n                <tr>\n                    <td class="text-left"><strong>${c("proposalDoc.priceSummary.cabinets")}</strong></td>\n                    <td class="text-right"><strong>$${ie.cabinets.toFixed(2)}</strong></td>\n                </tr>\n                <tr>\n                    <td class="text-left"><strong>${c("proposalDoc.priceSummary.assembly")}</strong></td>\n                    <td class="text-right"><strong>$${ie.assemblyFee.toFixed(2)}</strong></td>\n                </tr>\n                <tr>\n                    <td class="text-left"><strong>${c("proposalDoc.priceSummary.modifications")}</strong></td>\n                    <td class="text-right"><strong>$${ie.modifications.toFixed(2)}</strong></td>\n                </tr>\n                <tr class="total-row">\n                    <td class="text-left"><strong>${c("proposalDoc.priceSummary.styleTotal")}</strong></td>\n                    <td class="text-right"><strong>$${ie.styleTotal.toFixed(2)}</strong></td>\n                </tr>\n                <tr>\n                    <td class="text-left"><strong>${c("proposalDoc.priceSummary.total")}</strong></td>\n                    <td class="text-right"><strong>$${ie.total.toFixed(2)}</strong></td>\n                </tr>\n                <tr class="total-row">\n                    <td class="text-left"><strong>${c("proposalDoc.priceSummary.tax")}</strong></td>\n                    <td class="text-right"><strong>$${ie.tax.toFixed(2)}</strong></td>\n                </tr>\n                <tr class="grand-total">\n                    <td class="text-left">${c("proposalDoc.priceSummary.grandTotal")}</td>\n                    <td class="text-right">$${ie.grandTotal.toFixed(2)}</td>\n                </tr>\n            </table>\n        </div>\n        `:""}\n\n        ${d?.selectedCatalog?.length>0?`\n        \x3c!-- Catalog Items --\x3e\n        <div class="section-header">${c("proposalDoc.sections.catalogItems")}</div>\n        <table class="items-table">\n            <thead>\n                <tr>\n                    <th>${c("proposalDoc.catalog.itemName")}</th>\n                    <th>${c("proposalDoc.catalog.quantity")}</th>\n                    <th>${c("proposalDoc.catalog.unitPrice")}</th>\n                    <th>${c("proposalDoc.catalog.total")}</th>\n                </tr>\n            </thead>\n            <tbody>\n                ${d.selectedCatalog.map(e=>`\n                <tr>\n                    <td>${e.itemName||""}</td>\n                    <td>${e.quantity||0}</td>\n                    <td>$${e.unitPrice||0}</td>\n                    <td>$${(e.unitPrice*e.quantity).toFixed(2)}</td>\n                </tr>\n                `).join("")}\n            </tbody>\n        </table>\n        `:""}\n\n        \x3c!-- Footer --\x3e\n        ${ne?`<div class="main-footer-div">${ne}</div>`:""}\n    </div>\n</body>\n</html>\n\n        `},ce=async t=>{try{const n=de(t);$(!0);const a=await e.post("/api/generate-pdf",{html:n,options:{format:"A4",margin:{top:"20mm",right:"20mm",bottom:"20mm",left:"20mm"}}},{responseType:"blob"}),s=new Blob([a.data],{type:"application/pdf"}),o=window.URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download="quote.pdf",document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}catch(n){}finally{$(!1)}},me=k({initialValues:{showProposalItems:!0,showGroupItems:!0,selectedVersions:[],selectedColumns:["no","qty","item","assembled","hingeSide","exposedSide","price","assemblyCost","total"]},onSubmit:(e,{setSubmitting:t})=>{ce(e),t(!1)}});a.useEffect(()=>{if(S){const e=de(me.values);R(e)}},[me.values.selectedColumns,me.values.showProposalItems,me.values.showGroupItems,S,d]);const pe=d?.manufacturersData?.map(e=>({value:e.versionName,label:e.versionName}))||[],ue=[{value:"no",label:c("proposalColumns.no")},{value:"qty",label:c("proposalColumns.qty"),isFixed:!0},{value:"item",label:c("proposalColumns.item")},{value:"assembled",label:c("proposalColumns.assembled")},{value:"hingeSide",label:c("proposalColumns.hingeSide")},{value:"exposedSide",label:c("proposalColumns.exposedSide")},{value:"price",label:c("proposalColumns.price"),isFixed:!0},{value:"assemblyCost",label:c("proposalColumns.assemblyCost")},{value:"total",label:c("proposalColumns.total")}];return n.jsxs(n.Fragment,{children:[n.jsxs(s,{visible:r,onClose:l,size:"lg",alignment:"center",scrollable:!0,children:[n.jsx(N,{title:c("proposalCommon.printTitle"),onClose:l}),n.jsxs("form",{onSubmit:me.handleSubmit,children:[n.jsxs(i,{className:"pt-0",children:[n.jsx("div",{className:"mb-4 p-3 bg-light rounded",children:n.jsxs("div",{className:"d-flex gap-4",children:[n.jsx("div",{className:"d-flex align-items-center",children:n.jsx(b,{id:"showProposalItems",label:n.jsx("span",{className:"fw-medium",children:c("proposalCommon.showProposalItems")}),checked:me.values.showProposalItems,onChange:e=>{me.handleChange(e),S&&setTimeout(()=>{const e=de(me.values);R(e)},0)},className:"me-2"})}),n.jsx("div",{className:"d-flex align-items-center",children:n.jsx(b,{id:"showGroupItems",label:n.jsx("span",{className:"fw-medium",children:c("proposalCommon.showGroupItems")}),checked:me.values.showGroupItems,onChange:e=>{me.handleChange(e),S&&setTimeout(()=>{const e=de(me.values);R(e)},0)},className:"me-2"})})]})}),!_&&n.jsxs("div",{className:"mb-4",children:[n.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:n.jsx(y,{htmlFor:"selectedVersions",className:"fw-medium",children:c("proposalCommon.selectVersion")})}),n.jsx(I,{id:"selectedVersions",name:"selectedVersions",options:pe,isMulti:!0,value:pe.filter(e=>me.values.selectedVersions.includes(e.value)),onChange:e=>{me.setFieldValue("selectedVersions",e?e.map(e=>e.value):[])},className:"basic-multi-select",classNamePrefix:"select",placeholder:c("proposalCommon.selectVersionsPlaceholder")})]}),n.jsxs("div",{className:"mb-3",children:[n.jsx("div",{className:"d-flex justify-content-between align-items-center mb-2",children:n.jsx(y,{htmlFor:"selectedColumns",className:"fw-medium",children:c("proposalCommon.selectColumns")})}),n.jsx(I,{id:"selectedColumns",name:"selectedColumns",options:ue,isMulti:!0,value:ue.filter(e=>me.values.selectedColumns.includes(e.value)),onChange:e=>{const t=ue.filter(e=>e.isFixed).map(e=>e.value),n=e?[...t,...e.map(e=>e.value)]:t,a=[...new Set(n)];if(me.setFieldValue("selectedColumns",a),S){const e={...me.values,selectedColumns:a},t=de(e);R(t)}},classNamePrefix:"select",placeholder:c("proposalCommon.selectColumnsPlaceholder")})]})]}),n.jsxs(v,{className:"border-top-0 pt-0",children:[n.jsx(o,{color:"secondary",onClick:l,variant:"outline",className:"px-4",children:c("common.cancel")}),n.jsxs(o,{color:"info",onClick:()=>(e=>{const t=de(e);R(t),F(!0)})(me.values),variant:"outline",className:"px-4",children:[n.jsx("i",{className:"cil-magnifying-glass me-2"}),c("proposalCommon.preview","Preview")]}),n.jsxs(o,{color:"success",onClick:()=>(e=>{try{const t=de(e),n=window.open("","_blank");if(n)n.document.write(t),n.document.close(),n.onload=()=>{n.print(),n.close()};else{const e=document.createElement("iframe");e.style.position="absolute",e.style.left="-9999px",e.style.width="1px",e.style.height="1px",document.body.appendChild(e),e.contentDocument.open(),e.contentDocument.write(t),e.contentDocument.close(),e.onload=()=>{e.contentWindow.print(),setTimeout(()=>{document.body.removeChild(e)},1e3)}}}catch(t){}})(me.values),variant:"outline",className:"px-4",children:[n.jsx("i",{className:"cil-print me-2"}),c("proposalCommon.print","Print")]}),n.jsxs(o,{color:"primary",type:"submit",className:"px-4",disabled:C,children:[n.jsx("i",{className:"cil-cloud-download me-2"}),c(C?"proposalCommon.downloading":"proposalCommon.downloadPdf")]})]})]})]}),n.jsxs(s,{visible:S,onClose:()=>F(!1),size:B,alignment:"center",scrollable:!0,"data-testid":"quote-preview",children:[n.jsx(N,{title:c("proposalCommon.previewTitle","Quote Preview"),onClose:()=>F(!1)}),n.jsx(i,{style:{padding:0},className:"quote-preview-content",children:n.jsx("div",{ref:P,style:{maxHeight:window.innerWidth<768?"calc(100vh - 120px)":window.innerWidth<992?"75vh":"80vh",overflow:"auto",background:"#f8f9fa",padding:L,height:window.innerWidth<768?"calc(100vh - 120px)":"auto"},children:n.jsx("div",{style:{width:Math.floor(794*T),height:Math.round((M||0)*T),position:"relative",margin:"0 auto"},children:n.jsx("div",{ref:z,style:{width:794,transform:`scale(${T})`,transformOrigin:"top left",position:"absolute",left:0,top:0,background:"white",boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},dangerouslySetInnerHTML:{__html:q}})})})}),n.jsxs(v,{children:[n.jsx(o,{color:"secondary",onClick:()=>F(!1),variant:"outline",children:c("common.close")}),n.jsxs(o,{color:"primary",onClick:()=>{F(!1),ce(me.values)},disabled:C,children:[n.jsx("i",{className:"cil-cloud-download me-2"}),c(C?"proposalCommon.downloading":"proposalCommon.downloadPdf")]})]})]})]})},K=({show:r,onClose:c,formData:m,onSend:p})=>{const{t:u,i18n:h}=t(),g=e=>{switch(e){case"L":return u("common.short.left",{defaultValue:"L"});case"R":return u("common.short.right",{defaultValue:"R"});case"B":return u("common.short.both",{defaultValue:"B"});default:return e}};D(e=>e.selectedVersion.data),D(e=>e.selectVersionNew.data);const[x,f]=a.useState(!1),[$,w]=a.useState(null);a.useEffect(()=>{(async()=>{try{const t=await e.get("/api/settings/customization/pdf");w(t.data||{})}catch(t){}})()},[]);const{companyName:j,companyPhone:S,companyEmail:F,companyAddress:q,companyWebsite:M,headerColor:A="#5a2a2a",headerLogo:L,pdfFooter:V,headerTxtColor:B}=$||{},U={description:m?.description||u("proposalDoc.defaultProjectDescription",{defaultValue:"Kitchen Project"}),customer:m?.customerName||"",date:(new Date).toLocaleDateString(h.language||"en-US")},O=m?.manufacturersData?.[0]?.summary||{},H=m?.manufacturersData?.[0]?.items?.length?{cabinets:O.cabinets||0,assemblyFee:O.assemblyFee||0,modifications:O.modificationsCost||0,styleTotal:O.styleTotal||0,total:O.total||0,tax:O.taxAmount||0,grandTotal:O.grandTotal||0}:{cabinets:0,assemblyFee:0,modifications:0,styleTotal:0,total:0,tax:0,grandTotal:0},W=(m?.manufacturersData?.[0]?.items||[]).map(e=>({qty:e.qty||0,code:e.code||"",assembled:e.isRowAssembled?u("common.yes"):u("common.no"),hingeSide:e.hingeSide||u("common.na"),exposedSide:e.exposedSide||u("common.na"),price:parseFloat(e.price)||0,assemblyCost:e.includeAssemblyFee&&parseFloat(e.assemblyFee)||0,total:e.includeAssemblyFee?parseFloat(e.total)||0:parseFloat(e.price)||0,modifications:e.modifications||{}})),Z=m?.manufacturersData?.map(e=>({label:e.versionName,value:e.versionName}))||[];u("proposalColumns.no"),u("proposalColumns.qty"),u("proposalColumns.item"),u("proposalColumns.assembled"),u("proposalColumns.hingeSide"),u("proposalColumns.exposedSide"),u("proposalColumns.price"),u("proposalColumns.assemblyCost"),u("proposalColumns.total");const G=k({initialValues:{email:m?.customerEmail||"",body:"",versions:[],sendCopy:!0,updateCustomerEmail:!1,selectedColumns:["no","qty","item","assembled","hingeSide","exposedSide","price","assemblyCost","total"]},enableReinitialize:!0,validationSchema:R({email:z().email(u("proposalCommon.validation.invalidEmail")).required(u("proposalCommon.validation.emailRequired")),body:z().required(u("proposalCommon.validation.bodyRequired")),versions:P().min(1,u("proposalCommon.validation.selectAtLeastOneVersion")),selectedColumns:P().min(1,u("proposalCommon.validation.selectAtLeastOneColumn"))}),onSubmit:async t=>{try{f(!0);const n=(e=>{const t=L?`https://app.nj.contractors${L}`:null,n=e.selectedColumns;return n.map(e=>`<th>${"no"===e?u("proposalColumns.no"):"qty"===e?u("proposalColumns.qty"):"item"===e?u("proposalColumns.item"):"assembled"===e?u("proposalColumns.assembled"):"hingeSide"===e?u("proposalColumns.hingeSide"):"exposedSide"===e?u("proposalColumns.exposedSide"):"price"===e?u("proposalColumns.price"):"assemblyCost"===e?u("proposalColumns.assemblyCost"):"total"===e?u("proposalColumns.total"):e}</th>`).join(""),W.map((e,t)=>`<tr>${n.map(n=>{switch(n){case"no":return`<td>${t+1}</td>`;case"qty":return`<td>${e.qty}</td>`;case"item":return`<td>${e.item}</td>`;case"assembled":return`<td>${e.assembled}</td>`;case"hingeSide":return`<td>${g(e.hingeSide)}</td>`;case"exposedSide":return`<td>${g(e.exposedSide)}</td>`;case"price":return`<td>$${e.price.toFixed(2)}</td>`;case"assemblyCost":return`<td>$${e.assemblyCost.toFixed(2)}</td>`;case"total":return`<td>$${e.total.toFixed(2)}</td>`;default:return"<td></td>"}}).join("")}</tr>`).join(""),`\n\n        <!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>${u("proposalDoc.title")}</title>\n    <style>\n        @page {\n            margin: 20mm;\n            size: A4;\n        }\n\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: 'Arial', sans-serif;\n            font-size: 12px;\n            line-height: 1.4;\n            color: #333;\n        }\n\n        .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: 30px;\n            padding: 20px;\n            border-bottom: 2px solid ${A}; /* Default header color */\n            background-color: ${A}; /* Default header color */\n        }\n\n        .logo {\n            max-width: 120px;\n            max-height: 80px;\n        }\n\n        .company-name {\n            font-size: 24px;\n            font-weight: bold;\n            color: white;\n        }\n\n        .company-info {\n            text-align: right;\n            line-height: 1.6;\n            color: ${B};\n        }\n\n        .company-info div {\n            margin-bottom: 2px;\n        }\n\n        .greeting {\n            font-size: 14px;\n            margin-bottom: 15px;\n            color: #333;\n        }\n\n        .description {\n            font-size: 12px;\n            margin-bottom: 25px;\n            color: #666;\n        }\n\n        .summary-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 30px;\n        }\n\n        .summary-table th {\n            background-color: #f8f9fa;\n            padding: 12px;\n            border: 1px solid #dee2e6;\n            font-weight: bold;\n            text-align: left;\n        }\n\n        .summary-table td {\n            padding: 12px;\n            border: 1px solid #dee2e6;\n        }\n\n        .section-header {\n            font-size: 16px;\n            font-weight: bold;\n            margin: 25px 0 15px 0;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n        }\n\n        .items-table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-bottom: 20px;\n        }\n\n        .items-table th {\n            background-color: #f8f9fa;\n            padding: 10px 8px;\n            border: 1px solid #dee2e6;\n            font-weight: bold;\n            text-align: left;\n            font-size: 11px;\n        }\n\n        .items-table td {\n            padding: 8px;\n            border: 1px solid #dee2e6;\n            font-size: 10px;\n        }\n\n        .items-table tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n\n        .category-row {\n            background-color: #e6e6e6 !important;\n            font-weight: bold;\n        }\n\n        .text-right {\n            text-align: right;\n        }\n\n        .text-left {\n            text-align: left;\n        }\n\n        .main-footer-div {\n            margin-top: 50px;\n            text-align: center;\n            color: #666;\n            font-size: 10px;\n        }\n\n        .price-summary {\n            background-color: #f8f9fa;\n            border: 1px solid #dee2e6;\n            border-radius: 0.5rem;\n            padding: 1rem;\n            margin-top: 1rem;\n            font-family: 'Arial', sans-serif;\n            font-size: 0.95rem;\n        }\n\n        .price-summary table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n\n        .price-summary td {\n            padding: 0.25rem 0;\n        }\n\n        .price-summary .text-left {\n            text-align: left;\n            color: #212529;\n            font-weight: 500;\n        }\n\n        .price-summary .text-right {\n            text-align: right;\n            color: #212529;\n            font-weight: 500;\n        }\n\n        .price-summary .total-row {\n            font-weight: bold;\n            border-bottom: 1px solid #ced4da;\n            padding-top: 0.25rem;\n        }\n\n        .price-summary .grand-total {\n            font-weight: bold;\n            font-size: 1.05rem;\n            color: #1a1a1a;\n            padding-top: 0.75rem;\n        }\n\n        @media print {\n            body {\n                -webkit-print-color-adjust: exact;\n                print-color-adjust: exact;\n            }\n\n            .page-break {\n                page-break-before: always;\n            }\n        }\n    </style>\n</head>\n<body>\n    \x3c!-- Header Section --\x3e\n    <div class="header">\n        <div>\n            ${t?`<img src="${t}" alt="${u("proposalDoc.altCompanyLogo")}" class="logo">`:`<div class="company-name">${j||u("proposalDoc.fallbackCompanyName")}</div>`}\n        </div>\n        <div class="company-info">\n            <div><strong>${j||""}</strong></div>\n            <div>${S||""}</div>\n            <div>${F||""}</div>\n            <div>${M||""}</div>\n            <div>${q||""}</div>\n        </div>\n    </div>\n\n    \x3c!-- Greeting --\x3e\n    <div class="greeting">\n    ${u("proposalDoc.greeting",{name:U.customer})}\n    </div>\n\n    <div class="description">\n    ${u("proposalDoc.descriptionIntro")}\n    </div>\n\n    \x3c!-- Proposal Summary --\x3e\n    <table class="summary-table">\n        <thead>\n            <tr>\n                <th>${u("proposalDoc.summary.description")}</th>\n                \x3c!--  <th>Customer</th>--\x3e\n                <th>${u("proposalDoc.summary.date")}</th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr>\n                <td>${U.description}</td>\n                \x3c!--  <td>${U.customer}</td> --\x3e\n                <td>${U.date}</td>\n            </tr>\n        </tbody>\n    </table>\n\n    ${W&&W.length>0?`\n    \x3c!-- Proposal Items Section --\x3e\n    <div class="section-header">${u("proposalDoc.sections.proposalItems")}</div>\n    <table class="items-table">\n        <thead>\n            <tr style="background-color: #f0f0f0;">\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.no")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.qty")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.item")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.assembled")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.hingeSide")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.exposedSide")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.price")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.assemblyCost")}</th>\n                <th style="border: 1px solid #ccc; padding: 5px;">${u("proposalColumns.total")}</th>\n            </tr>\n        </thead>\n        <tbody>\n            \x3c!-- Category Row --\x3e\n            <tr class="category-row">\n                <td colspan="9" style="padding: 6px;"><strong>${u("proposalColumns.items")}</strong></td>\n            </tr>\n            \x3c!-- Dynamically inserted rows --\x3e\n            ${W.map((e,t)=>`\n                    <tr>\n                        <td style="border: 1px solid #ccc; padding: 5px;">${t+1}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">${e.qty}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">${e.code||""}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">${e.assembled}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">${e.hingeSide}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">${e.exposedSide}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">$${parseFloat(e.price).toFixed(2)}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">$${e.includeAssemblyFee?parseFloat(e.assemblyFee).toFixed(2):"0.00"}</td>\n                        <td style="border: 1px solid #ccc; padding: 5px;">$${parseFloat(e.total).toFixed(2)}</td>\n                    </tr>\n                    `+(e.modifications&&e.modifications.length>0?`\n                        <tr>\n                            <td colspan="9" style="padding: 5px;  background-color: #f9f9f9;"><strong>${u("proposalDoc.modifications")}</strong></td>\n                        </tr>\n                        ${e.modifications.map((e,t)=>{const n=(parseFloat(e.price)||0)*(e.qty||0);return`\n                                    <tr>\n                                        <td  padding: 5px;">-</td>\n                                        <td  padding: 5px;">${e.qty||""}</td>\n                                        <td  padding: 5px;">${e.name||""}</td>\n                                        <td colspan="3"  padding: 5px;"></td>\n                                        <td  padding: 5px;">$${(parseFloat(e.price)||0).toFixed(2)}</td>\n                                        <td  padding: 5px;"></td>\n                                        <td  padding: 5px;">$${n.toFixed(2)}</td>\n                                    </tr>\n                                `}).join("")}\n                        `:"")).join("")}\n        </tbody>\n    </table>\n    \x3c!-- Price Summary --\x3e\n    <div class="price-summary">\n        <table>\n            <tr>\n                <td class="text-left">${u("proposalDoc.priceSummary.cabinets")}</td>\n                <td class="text-right">$${H.cabinets.toFixed(2)}</td>\n            </tr>\n            <tr>\n                <td class="text-left">${u("proposalDoc.priceSummary.assembly")}</td>\n                <td class="text-right">$${H.assemblyFee.toFixed(2)}</td>\n            </tr>\n            <tr class="total-row">\n                <td class="text-left">${u("proposalDoc.priceSummary.modifications")}</td>\n                <td class="text-right">$${H.modifications.toFixed(2)}</td>\n            </tr>\n            <tr >\n                <td class="text-left">${u("proposalDoc.priceSummary.styleTotal")}</td>\n                <td class="text-right">$${H.styleTotal.toFixed(2)}</td>\n            </tr>\n            <tr >\n                <td class="text-left">${u("proposalDoc.priceSummary.total")}</td>\n                <td class="text-right">$${H.total.toFixed(2)}</td>\n            </tr>\n            <tr class="total-row">\n                <td class="text-left">${u("proposalDoc.priceSummary.tax")}</td>\n                <td class="text-right">$${H.tax.toFixed(2)}</td>\n            </tr>\n            <tr class="grand-total">\n                <td class="text-left">${u("proposalDoc.priceSummary.grandTotal")}</td>\n                <td class="text-right">$${H.grandTotal.toFixed(2)}</td>\n            </tr>\n        </table>\n    </div>\n    `:""}\n\n    ${m?.selectedCatalog?.length>0?`\n    \x3c!-- Catalog Items --\x3e\n    <div class="section-header">${u("proposalDoc.sections.catalogItems")}</div>\n    <table class="items-table">\n        <thead>\n            <tr>\n                <th>${u("proposalDoc.catalog.itemName")}</th>\n                <th>${u("proposalDoc.catalog.quantity")}</th>\n                <th>${u("proposalDoc.catalog.unitPrice")}</th>\n                <th>${u("proposalDoc.catalog.total")}</th>\n            </tr>\n        </thead>\n        <tbody>\n            ${m.selectedCatalog.map(e=>`\n            <tr>\n                <td>${e.itemName||""}</td>\n                <td>${e.quantity||0}</td>\n                <td>$${e.unitPrice||0}</td>\n                <td>$${(e.unitPrice*e.quantity).toFixed(2)}</td>\n            </tr>\n            `).join("")}\n        </tbody>\n    </table>\n    `:""}\n\n    \x3c!-- Footer --\x3e\n    <div class="main-footer-div">\n        ${V}\n    </div>\n</body>\n</html>\n\n        `})(t);await e.post("/api/proposals/send-email",{email:t.email,body:t.body,versions:t.versions.map(e=>e.value).join(", "),sendCopy:t.sendCopy,htmlContent:n}),f(!1),c(),p&&p()}catch(n){f(!1)}}});return n.jsxs(s,{visible:r,onClose:c,alignment:"center",size:"lg",scrollable:!0,children:[n.jsx(N,{title:u("proposalCommon.emailTitle"),onClose:c}),n.jsxs("form",{onSubmit:G.handleSubmit,children:[n.jsxs(i,{className:"px-4 pb-4",children:[n.jsxs("div",{className:"mb-4",children:[n.jsx(y,{htmlFor:"email",className:"fw-semibold",children:u("proposalCommon.emailAddress")}),n.jsx(l,{id:"email",type:"email",name:"email",placeholder:u("proposalCommon.emailPlaceholder"),value:G.values.email,onChange:G.handleChange,onBlur:G.handleBlur,disabled:x}),G.touched.email&&G.errors.email&&n.jsx("div",{className:"text-danger small mt-1",children:G.errors.email})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx(y,{htmlFor:"body",className:"fw-semibold",children:u("proposalCommon.emailBody")}),n.jsx("div",{className:"border rounded p-2 bg-body",children:n.jsx(T,{editor:E,data:G.values.body,disabled:x,onChange:(e,t)=>G.setFieldValue("body",t.getData()),onBlur:()=>G.setFieldTouched("body",!0)})}),G.touched.body&&G.errors.body&&n.jsx("div",{className:"text-danger small mt-1",children:G.errors.body})]}),n.jsxs("div",{className:"mb-4 d-flex align-items-center gap-2",children:[n.jsx(b,{id:"sendCopy",name:"sendCopy",className:"me-1",checked:G.values.sendCopy,onChange:G.handleChange,disabled:x,size:"md",style:{transform:"scale(1.5)"}}),n.jsx(y,{htmlFor:"sendCopy",className:"mb-0",children:u("proposalCommon.includeItems")})]}),n.jsxs("div",{className:"mb-4",children:[n.jsx(y,{className:"fw-semibold",children:u("proposalCommon.selectVersion")}),n.jsx(I,{isMulti:!0,name:"versions",options:Z,classNamePrefix:"react-select",value:G.values.versions,placeholder:u("proposalCommon.selectVersionsPlaceholder"),onChange:e=>G.setFieldValue("versions",e),onBlur:()=>G.setFieldTouched("versions",!0),isDisabled:x}),G.touched.versions&&G.errors.versions&&n.jsx("div",{className:"text-danger small mt-1",children:G.errors.versions})]}),n.jsxs("div",{className:"mb-0 d-flex justify-content-end align-items-center gap-2",children:[n.jsx(C,{type:"checkbox",id:"updateCustomerEmail",name:"updateCustomerEmail",checked:G.values.updateCustomerEmail,onChange:G.handleChange,disabled:x,style:{width:"20px",height:"20px"}}),n.jsx(y,{htmlFor:"updateCustomerEmail",className:"line-height-2 mb-0 fw-semibold",children:u("proposalCommon.updateCustomerEmail")})]})]}),n.jsxs(v,{className:"px-4 pb-4",children:[n.jsx(o,{color:"secondary",variant:"outline",onClick:c,disabled:x,children:u("common.cancel")}),n.jsx(o,{type:"submit",color:"primary",disabled:x,children:x?n.jsxs(n.Fragment,{children:[n.jsx(d,{size:"sm",className:"me-2"}),u("proposalCommon.sending")]}):u("proposalCommon.sendEmail")})]})]})]})},Q=({show:e,onClose:a})=>{const{t:r}=t();return n.jsxs(s,{visible:e,onClose:a,alignment:"center",size:"lg",scrollable:!0,children:[n.jsx("style",{children:"\n                            .email-contract-modal .btn { min-height: 44px; }\n                        "}),n.jsxs("div",{className:"email-contract-modal",children:[n.jsx($,{children:n.jsx(w,{children:r("contracts.sendTitle","Send contract")})}),n.jsx(i,{children:n.jsx("p",{className:"text-center",children:r("contracts.noContractsMsg","No contracts available for selection. Please go to contract settings to add one.")})}),n.jsx(v,{children:n.jsx(o,{color:"secondary",onClick:a,"aria-label":r("common.close","Close"),children:r("common.close","Close")})})]})]})};export{K as E,O as M,_ as P,M as a,G as b,U as c,A as d,L as e,Q as f,Z as g,W as i,B as s,V as v};
