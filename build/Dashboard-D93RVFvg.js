import{j as e}from"./date-vendor-D9pAgX5F.js";import{u as s,r as a}from"./react-vendor-DF7UJAlN.js";import{a as r,u as t}from"./redux-vendor-BzdbewH4.js";import{u as l,a as c,g as d,j as n,k as i}from"./index-DW-yAxzW.js";import{h as o,C as h,U as m,V as u,b as p,c as x,d as j,a as b,u as f,e as g,Y as N,Z as v,_ as y,v as w}from"./ui-vendor-DjmSPU99.js";import{c as k}from"./cil-description-MUzg6O3n.js";import{c as S,P}from"./DefaultLayout-BUcG_pV2.js";import"./form-vendor-CKNVq0c_.js";import"./utils-vendor-Nl-sF5xe.js";import"./icons-vendor-D82TZqJV.js";const q=()=>{const r=s(),{t:t}=l(),[d,n]=a.useState({proposals:0,customers:0}),[i,N]=a.useState(!0),[v,y]=a.useState(null),w=a.useMemo(()=>JSON.parse(localStorage.getItem("user")||"{}"),[]),P=w.group?.name||"Unknown Group",q=a.useMemo(()=>w.group?.id??w.group_id??w.groupId??w.group?.group_id??null,[w.group?.id,w.group_id,w.groupId,w.group?.group_id]),C=a.useMemo(()=>{const e=w.group?.modules;try{if(Array.isArray(e))return e;if("string"==typeof e&&e.trim()){const s=JSON.parse(e);return Array.isArray(s)?s:s&&"object"==typeof s?Object.entries(s).filter(([,e])=>!!e).map(([e])=>e):[]}return e&&"object"==typeof e?Object.entries(e).filter(([,e])=>!!e).map(([e])=>e):[]}catch(s){return[]}},[JSON.stringify(w.group?.modules)]);return a.useEffect(()=>{(async()=>{try{N(!0);let s=0,a=0;if(C.includes("proposals"))try{const e=(await c.get("/api/quotes")).data,a=Array.isArray(e)?e:e?.proposals||e?.data||e?.items||[];s=(q?a.filter(e=>(e?.owner_group_id??e?.ownerGroupId??e?.group_id??e?.groupId)===q):a).length}catch(e){}if(C.includes("customers"))try{const e=(await c.get("/api/customers")).data,s=Array.isArray(e)?e:e?.customers||e?.data||e?.items||[];a=(q?s.filter(e=>(e?.owner_group_id??e?.ownerGroupId??e?.group_id??e?.groupId)===q):s).length}catch(e){}n({proposals:s,customers:a})}catch(e){y(t("dashboard.loadError"))}finally{N(!1)}})()},[q]),i?e.jsx(o,{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsx(h,{})}):e.jsxs(o,{fluid:!0,children:[e.jsx("style",{children:"\n        /* Contractor dashboard mobile tweaks */\n        .contractor-dashboard .btn { min-height: 44px; }\n        .contractor-dashboard .quick-actions { flex-wrap: wrap; }\n        .contractor-dashboard .quick-actions .btn { flex: 1 1 48%; }\n        @media (max-width: 575.98px) {\n          .contractor-dashboard .card .fs-4 { font-size: 1.25rem; }\n        }\n      "}),e.jsx(m,{children:e.jsx(u,{xs:12,className:"contractor-dashboard",children:e.jsxs(p,{className:"mb-4",children:[e.jsxs(x,{children:[e.jsx("h4",{className:"mb-0",children:t("dashboard.welcome",{group:P})}),e.jsx("p",{className:"text-muted mb-0",children:t("dashboard.portal")})]}),e.jsxs(j,{children:[v&&e.jsx(b,{color:"danger",className:"mb-3",children:v}),e.jsxs(m,{children:[C.includes("proposals")&&e.jsx(u,{sm:6,lg:4,className:"mb-3",children:e.jsx(p,{className:"text-white bg-primary",children:e.jsxs(j,{className:"pb-0 d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fs-4 fw-semibold",children:d.proposals}),e.jsx("div",{children:t("nav.proposals")})]}),e.jsx("div",{className:"bg-body-secondary bg-opacity-25 rounded p-2",children:e.jsx(f,{icon:k,size:"lg"})})]})})}),C.includes("customers")&&e.jsx(u,{sm:6,lg:4,className:"mb-3",children:e.jsx(p,{className:"text-white bg-success",children:e.jsxs(j,{className:"pb-0 d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fs-4 fw-semibold",children:d.customers}),e.jsx("div",{children:t("nav.customers")})]}),e.jsx("div",{className:"bg-body-secondary bg-opacity-25 rounded p-2",children:e.jsx(f,{icon:S,size:"lg"})})]})})})]}),e.jsx(m,{children:e.jsx(u,{xs:12,children:e.jsxs(p,{children:[e.jsx(x,{children:e.jsx("h6",{className:"mb-0",children:t("dashboard.quickActions")})}),e.jsx(j,{children:e.jsxs("div",{className:"d-flex quick-actions gap-2",children:[C.includes("proposals")&&e.jsx(g,{color:"primary",variant:"outline","aria-label":t("dashboard.createProposal"),onClick:()=>r("/quotes/create"),children:t("dashboard.createProposal")}),C.includes("customers")&&e.jsx(g,{color:"success",variant:"outline","aria-label":t("nav.addCustomer"),onClick:()=>r("/customers/add"),children:t("nav.addCustomer")}),e.jsx(g,{color:"info",variant:"outline","aria-label":t("dashboard.viewProfile"),onClick:()=>r("/profile"),children:t("dashboard.viewProfile")})]})})]})})})]})]})})})]})},C=()=>{const x=a.useMemo(()=>JSON.parse(localStorage.getItem("user")||"{}"),[]);if(x.group&&"contractor"===x.group.group_type)return e.jsx(q,{});const{t:b}=l(),f=r(e=>e.dashboard.activeProposals),k=r(e=>e.dashboard.activeOrders),S=r(e=>e.dashboard.latestProposals),[C,I]=a.useState(0),[_,z]=a.useState(0),[A,D]=a.useState(null),[O,U]=a.useState([]),[E,L]=a.useState([]),J=s(),[M,B]=a.useState("quick-access"),G=t(),T=[];a.useEffect(()=>{let e=!1;return(async()=>{let s=d();if(!s)for(let e=0;e<6&&!s;e++)await new Promise(e=>setTimeout(e,25)),s=d();!e&&s&&(G(n()),G(i()))})(),()=>{e=!0}},[G]),a.useEffect(()=>{const e=setTimeout(()=>{d()&&(V(),F())},100);return()=>clearTimeout(e)},[]);const V=async()=>{try{const e=await c.get("/api/resources/links");e.data.success&&U(e.data.data)}catch(e){}},F=async()=>{try{const e=await c.get("/api/resources/files");e.data.success&&L(e.data.data)}catch(e){}};a.useEffect(()=>{let e=null;return f&&f>0&&(e=setInterval(()=>{I(s=>s<f?s+1:(clearInterval(e),s))},50)),()=>clearInterval(e)},[f]),a.useEffect(()=>{let e=null;return k&&k>0&&(e=setInterval(()=>{z(s=>s<k?s+1:(clearInterval(e),s))},50)),()=>clearInterval(e)},[k]);const H=e=>{switch(e){case"active":case"approved":return"success";case"pending":case"in-review":return"warning";case"draft":return"info";case"completed":return"primary";default:return"secondary"}},R=e=>{if(!e)return"";const s=e.toLowerCase().replace(/\s+/g,"");return b(`status.${{draft:"draft",sent:"sent",accepted:"accepted",rejected:"rejected",expired:"expired",proposaldone:"proposalDone",measurementscheduled:"measurementScheduled",measurementdone:"measurementDone",designdone:"designDone",followup1:"followUp1",followup2:"followUp2",followup3:"followUp3",proposalaccepted:"proposalAccepted",proposalrejected:"proposalRejected"}[s]||s}`,e)},Y=e=>{switch(e){case"pdf":default:return"📄";case"excel":return"📊";case"video":return"🎥";case"word":return"📝"}},Z=e=>{switch(e){case"external":default:return"🔗";case"internal":return"🏠";case"document":return"📚";case"help":return"❓"}};return e.jsxs(o,{fluid:!0,className:"dashboard-container",children:[e.jsx("style",{children:"\n        /* Dashboard scoped mobile tweaks */\n        .dashboard-container .btn { min-height: 44px; }\n        .dashboard-container .btn.btn-sm { min-height: 40px; }\n        .dashboard-container .dashboard-header-actions { flex-wrap: wrap; }\n        .dashboard-container .list-group-item { min-height: 44px; }\n        .dashboard-container .btn-view-all { min-height: 44px; }\n\n        @media (max-width: 575.98px) {\n          .dashboard-container .dashboard-header-actions { width: 100%; }\n          .dashboard-container .dashboard-header-actions .btn { flex: 1 1 48%; }\n          .dashboard-container .stat-card-number { font-size: 1.75rem; }\n        }\n      "}),e.jsx(P,{title:b("dashboard.title","Dashboard"),mobileLayout:"stack",rightContent:e.jsxs("div",{className:"dashboard-header-actions d-flex gap-2",children:[e.jsx(g,{color:"primary",className:"btn-gradient-cyan","aria-label":b("dashboard.newProposal")||"Create new proposal",onClick:()=>{J("/quotes/create")},children:b("dashboard.newProposal")}),e.jsx(g,{color:"success",className:"btn-gradient-green","aria-label":b("dashboard.quickProposal")||"Create quick proposal",onClick:()=>{J("/quotes/create?quick=yes")},children:b("dashboard.quickProposal")})]})}),e.jsxs(m,{className:"mb-4",children:[e.jsx(u,{lg:3,md:6,className:"mb-4",children:e.jsx(p,{className:"stat-card stat-card-proposals",children:e.jsxs(j,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"stat-card-icon",children:"📊"}),e.jsx("div",{children:e.jsx("h6",{className:"stat-card-title",children:b("dashboard.activeProposals")})})]}),e.jsx("h1",{className:"stat-card-number mt-3",children:C||e.jsx(h,{size:"sm"})})]})})}),e.jsx(u,{lg:3,md:6,className:"mb-4",children:e.jsx(p,{className:"stat-card stat-card-orders",children:e.jsxs(j,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"stat-card-icon",children:"📦"}),e.jsx("div",{children:e.jsx("h6",{className:"stat-card-title",children:b("dashboard.activeOrders")})})]}),e.jsx("h1",{className:"stat-card-number mt-3",children:_||e.jsx(h,{size:"sm"})})]})})}),e.jsx(u,{lg:6,className:"mb-4",children:e.jsx(p,{className:"dashboard-card",children:e.jsxs(j,{children:[e.jsxs(N,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"📈"}),b("dashboard.latestProductUpdates")]}),e.jsx(v,{flush:!0,children:T.length>0?T.map(s=>e.jsx(y,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.title}),e.jsx("small",{className:"text-muted",children:s.date})]}),e.jsx(w,{color:H(s.status),shape:"rounded-pill",children:R(s.status)})]})},s.id)):e.jsx("div",{className:"text-muted text-center py-5",children:b("dashboard.noProductUpdates")})})]})})})]}),e.jsxs(m,{children:[e.jsx(u,{lg:4,className:"mb-4",children:e.jsx(p,{className:"dashboard-card",children:e.jsxs(j,{children:[e.jsxs(N,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"🔗"}),b("dashboard.quickLinks")]}),e.jsx(v,{flush:!0,children:O.map(s=>e.jsx(y,{children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("span",{className:"me-3 fs-5",children:Z(s.type)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.title}),e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-decoration-none text-primary small",style:{wordBreak:"break-all"},children:s.url})]})]})},s.id))})]})})}),e.jsx(u,{lg:4,className:"mb-4",children:e.jsx(p,{className:"dashboard-card",children:e.jsxs(j,{children:[e.jsxs(N,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"📁"}),b("dashboard.recentFiles")]}),e.jsx(v,{flush:!0,children:E.map(s=>e.jsx(y,{style:{cursor:"pointer"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",children:Y(s.type)}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark small",style:{wordBreak:"break-all"},children:s.name}),e.jsxs("small",{className:"text-muted",children:[s.size," • ",s.date]})]})]})},s.id))})]})})}),e.jsx(u,{lg:4,className:"mb-4",children:e.jsx(p,{className:"dashboard-card",children:e.jsxs(j,{children:[e.jsxs(N,{children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"📝"}),b("dashboard.myLatestProposals")]}),e.jsx(v,{flush:!0,children:S.slice(0,5).map(s=>e.jsx(y,{style:{cursor:"pointer"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("div",{className:"fw-semibold text-dark small",style:{wordBreak:"break-all"},children:s.description||"No Description"}),e.jsx("small",{className:"text-muted",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx(w,{color:H(s.status),shape:"rounded-pill",className:"ms-2",children:R(s.status)})]})},s.id))}),e.jsx("div",{className:"text-center mt-3",children:e.jsx(g,{variant:"outline",color:"secondary",size:"sm",className:"btn-view-all",onClick:()=>{J("/quotes")},children:b("dashboard.viewAllProposals")})})]})})})]})]})};export{C as default};
