import{j as e}from"./date-vendor-D9pAgX5F.js";import{u as s,r}from"./react-vendor-DF7UJAlN.js";import{u as a,a as t}from"./redux-vendor-BzdbewH4.js";import{u as c,m as i,n as o}from"./index-DW-yAxzW.js";import{P as l,g as n,b as d}from"./DefaultLayout-BUcG_pV2.js";import{S as m}from"./utils-vendor-Nl-sF5xe.js";import{T as u}from"./icons-lucide-DddGqAYX.js";import{P as h}from"./PaginationComponent-B2yVAl0f.js";import{w as x}from"./withContractorScope-CFJqUjZ-.js";import{P as j}from"./PermissionGate-D8-c0sYS.js";import{F as p}from"./index-BmyYYes_.js";import{h as N,e as g,U as v,V as f,b,d as y,W as C,X as w,J as P,w as z,C as k,$ as S,a0 as T,a1 as A,a2 as L,a3 as E,a4 as M,v as D}from"./ui-vendor-DjmSPU99.js";import{P as B,S as F,U as G,M as I,a as O,b as Y,c as $}from"./icons-vendor-D82TZqJV.js";import"./form-vendor-CKNVq0c_.js";const H=x(({isContractor:x,contractorGroupId:H,contractorModules:R,contractorGroupName:U})=>{const{t:W}=c(),X=a(),_=t(e=>e.customers.list),J=t(e=>e.customers.loading),V=t(e=>e.customers.error),Z=t(e=>e.customers.totalPages),q=t(e=>e.customers.total),K=s(),[Q,ee]=r.useState(""),[se,re]=r.useState({key:null,direction:"asc"}),[ae,te]=r.useState(10),[ce,ie]=r.useState(1);r.useEffect(()=>{X(i({page:ce,limit:ae,groupId:x?H:null}))},[X,ce,ae,x,H]);const oe=e=>{const s=[];e.address&&s.push(e.address),e.aptOrSuite&&s.push(e.aptOrSuite);const r=[];return e.city&&r.push(e.city),e.state&&r.push(e.state),e.zipCode&&r.push(e.zipCode),r.length>0&&s.push(r.join(", ")),s.length>0?s.join(", "):null},le=e=>{re(s=>{const r=s.key===e&&"asc"===s.direction?"desc":"asc";return{key:e,direction:r}})},ne=e=>{const s=`/${n(6)}/${n(8)}`+d("/customers/edit/:id",{id:e.id});K(s)},de=async e=>{if((await m.fire({title:W("customers.confirmTitle","Are you sure?"),text:W("customers.confirmText","This action cannot be undone!"),icon:"warning",showCancelButton:!0,confirmButtonText:W("customers.confirmYes","Yes, delete it!"),cancelButtonText:W("customers.confirmNo","No, cancel!"),reverseButtons:!0})).isConfirmed)try{await X(o(e)).unwrap(),await m.fire(W("customers.deleted","Deleted!"),W("customers.deletedMsg","The customer has been deleted."),"success");X(i({page:ce,limit:ae,groupId:x?H:null}))}catch(s){m.fire(W("common.error","Error!"),s.message||W("customers.deleteFailed","Failed to delete customer. Please try again."),"error")}else m.fire(W("customers.cancelled","Cancelled"),W("customers.notDeleted","The customer was not deleted."),"info")},me=r.useMemo(()=>{let e=_.filter(e=>e.name?.toLowerCase().includes(Q)||e.email?.toLowerCase().includes(Q));return se.key&&e.sort((e,s)=>{const r=e[se.key]?.toLowerCase?.()??"",a=s[se.key]?.toLowerCase?.()??"";return r<a?"asc"===se.direction?-1:1:r>a?"asc"===se.direction?1:-1:0}),e},[_,Q,se]),ue=e=>se.key!==e?"↕️":"asc"===se.direction?"↑":"↓";return e.jsxs(N,{fluid:!0,className:"dashboard-container",children:[e.jsx(l,{title:W("customers.header"),subtitle:W("customers.subtitle"),icon:p,children:e.jsx(j,{permission:"customers:create",children:e.jsxs(g,{color:"light",onClick:()=>{K("/customers/add")},children:[e.jsx(B,{size:16,className:"me-2","aria-hidden":"true"}),W("nav.addCustomer")]})})}),e.jsxs(v,{className:"mb-4 g-3",children:[e.jsx(f,{sm:6,md:3,children:e.jsx(b,{className:"stat-card-sm",style:{borderColor:"var(--cui-primary)"},children:e.jsxs(y,{children:[e.jsx("div",{className:"stat-number text-primary",children:q||0}),e.jsx("div",{className:"stat-label",children:W("customers.total")})]})})}),e.jsx(f,{sm:6,md:3,children:e.jsx(b,{className:"stat-card-sm",style:{borderColor:"var(--cui-success)"},children:e.jsxs(y,{children:[e.jsx("div",{className:"stat-number text-success",children:_.filter(e=>!e.deleted_at).length}),e.jsx("div",{className:"stat-label",children:W("customers.active")})]})})}),e.jsx(f,{sm:6,md:3,children:e.jsx(b,{className:"stat-card-sm",style:{borderColor:"var(--cui-warning)"},children:e.jsxs(y,{children:[e.jsx("div",{className:"stat-number text-warning",children:_.filter(e=>e.email).length}),e.jsx("div",{className:"stat-label",children:W("customers.withEmail")})]})})}),e.jsx(f,{sm:6,md:3,children:e.jsx(b,{className:"stat-card-sm",style:{borderColor:"var(--cui-danger)"},children:e.jsxs(y,{children:[e.jsx("div",{className:"stat-number text-danger",children:me.length}),e.jsx("div",{className:"stat-label",children:W("customers.filtered")})]})})})]}),e.jsx(b,{className:"filter-card",children:e.jsx(y,{children:e.jsxs(v,{className:"align-items-center g-3",children:[e.jsx(f,{md:6,children:e.jsxs(C,{children:[e.jsx(w,{"aria-hidden":"true",children:e.jsx(F,{size:16})}),e.jsx(P,{placeholder:W("customers.searchPlaceholder"),"aria-label":W("customers.searchAriaLabel","Search customers"),value:Q,onChange:e=>ee(e.target.value.toLowerCase())})]})}),e.jsx(f,{md:3,children:e.jsxs(z,{value:ae,onChange:e=>te(Number(e.target.value)),children:[e.jsxs("option",{value:5,children:["5 ",W("customers.perPage","per page")]}),e.jsxs("option",{value:10,children:["10 ",W("customers.perPage","per page")]}),e.jsxs("option",{value:25,children:["25 ",W("customers.perPage","per page")]}),e.jsxs("option",{value:50,children:["50 ",W("customers.perPage","per page")]})]})}),e.jsx(f,{md:3,className:"text-end",children:e.jsxs("small",{className:"text-muted",children:[W("customers.showing","Showing")," ",me.length," ",W("customers.of","of")," ",q," ",W("customers.customersLower","customers"),x&&e.jsxs("div",{className:"text-primary small",children:["(",U,")"]})]})})]})})}),J&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(k,{color:"primary"}),e.jsx("p",{className:"mt-3 text-muted",children:W("customers.loading","Loading customers...")})]}),V&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsxs("strong",{children:[W("common.error","Error"),":"]})," ",V]}),!J&&!V&&e.jsx("div",{className:"table-wrap desktop-only",children:e.jsx(b,{className:"data-table-card",children:e.jsxs(S,{hover:!0,className:"table-modern",children:[e.jsx(T,{children:e.jsxs(A,{children:[e.jsx(L,{children:W("customers.location","Location")}),e.jsxs(L,{onClick:()=>le("name"),style:{cursor:"pointer"},children:[e.jsx(G,{size:16,className:"me-2","aria-hidden":"true"}),W("customers.name","Name")," ",ue("name")]}),e.jsxs(L,{onClick:()=>le("email"),style:{cursor:"pointer"},children:[e.jsx(I,{size:16,className:"me-2","aria-hidden":"true"}),W("customers.email","Email")," ",ue("email")]}),e.jsx(L,{children:W("customers.phone","Phone")}),e.jsx(L,{children:W("customers.address","Address")}),e.jsx(L,{children:W("customers.proposalsHeader","Proposals")}),e.jsx(L,{children:W("customers.ordersHeader","Orders")}),e.jsx(L,{className:"text-center",children:W("customers.actions","Actions")})]})}),e.jsx(E,{children:0===me?.length?e.jsx(A,{children:e.jsxs(M,{colSpan:"8",className:"text-center py-5",children:[e.jsx(F,{size:48,className:"text-muted mb-3","aria-hidden":"true"}),e.jsx("p",{className:"mb-0",children:W("customers.noResults")}),e.jsx("small",{className:"text-muted",children:W("customers.tryAdjusting")})]})}):me?.map(s=>e.jsxs(A,{children:[e.jsx(M,{children:e.jsx(D,{color:"secondary",shape:"rounded-pill",children:W("customers.main","Main")})}),e.jsx(M,{className:"fw-medium",children:s.name||"N/A"}),e.jsx(M,{className:"text-muted",children:s.email||"N/A"}),e.jsx(M,{className:"text-muted",children:s.mobile||s.homePhone||"No phone"}),e.jsx(M,{className:"text-muted",children:oe(s)||"No address"}),e.jsx(M,{children:e.jsx(D,{color:"info",shape:"rounded-pill",children:W("customers.proposalsCount",{count:s.proposalCount||0})})}),e.jsx(M,{children:e.jsx(D,{color:"success",shape:"rounded-pill",children:W("customers.ordersCount",{count:0})})}),e.jsx(M,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx(j,{action:"update",resource:"customer",item:s,children:e.jsx(g,{color:"primary",variant:"outline",className:"icon-btn",onClick:()=>ne(s),title:W("customers.editTooltip","Edit customer"),"aria-label":W("customers.editTooltip","Edit customer"),children:e.jsx(O,{size:16,"aria-hidden":"true"})})}),e.jsx(j,{action:"delete",resource:"customer",item:s,children:e.jsx(g,{color:"danger",variant:"outline",className:"icon-btn",onClick:()=>de(s.id),title:W("customers.deleteTooltip","Delete customer"),"aria-label":W("customers.deleteTooltip","Delete customer"),children:e.jsx(u,{size:16,"aria-hidden":"true"})})})]})})]},s.id))})]})})}),!J&&!V&&e.jsx("div",{className:"mobile-card-view mobile-only",children:0===me?.length?e.jsx(b,{children:e.jsxs(y,{className:"text-center py-5",children:[e.jsx(F,{size:48,className:"text-muted mb-3","aria-hidden":"true"}),e.jsx("p",{className:"mb-0",children:W("customers.noResults")}),e.jsx("small",{className:"text-muted",children:W("customers.tryAdjusting")})]})}):me?.map(s=>e.jsx(b,{children:e.jsxs(y,{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-start",children:e.jsxs("div",{children:[e.jsx("div",{className:"customer-name",children:s.name||"N/A"}),e.jsx(D,{color:"secondary",shape:"rounded-pill",className:"mt-1",children:W("customers.main","Main")})]})}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"contact-info",children:[e.jsx(I,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:s.email||"N/A"})]}),e.jsxs("div",{className:"contact-info",children:[e.jsx(Y,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:s.mobile||s.homePhone||"No phone"})]}),e.jsxs("div",{className:"contact-info",children:[e.jsx($,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:oe(s)||"No address"})]})]}),e.jsxs("div",{className:"stats-pills",children:[e.jsx(D,{color:"info",shape:"rounded-pill",children:W("customers.proposalsCount",{count:s.proposalCount||0})}),e.jsx(D,{color:"success",shape:"rounded-pill",children:W("customers.ordersCount",{count:0})})]}),e.jsxs("div",{className:"actions",children:[e.jsx(j,{action:"update",resource:"customer",item:s,children:e.jsxs(g,{color:"primary",variant:"outline",size:"sm",onClick:()=>ne(s),className:"flex-grow-1",children:[e.jsx(O,{size:16,className:"me-1","aria-hidden":"true"}),W("common.edit")]})}),e.jsx(j,{action:"delete",resource:"customer",item:s,children:e.jsxs(g,{color:"danger",variant:"outline",size:"sm",onClick:()=>de(s.id),className:"flex-grow-1",children:[e.jsx(u,{size:16,className:"me-1","aria-hidden":"true"}),W("common.delete")]})})]})]})},s.id))}),!J&&!V&&Z>1&&e.jsx(b,{className:"data-table-card mt-4",children:e.jsx(y,{children:e.jsx(h,{currentPage:ce,totalPages:Z,onPageChange:e=>{ie(e)},itemsPerPage:ae})})})]})},"customers");export{H as default};
