import{j as e,D as s}from"./date-vendor-D9pAgX5F.js";import{r as t,R as a,i as r,u as i}from"./react-vendor-DF7UJAlN.js";import{c as n,a as l,u as o}from"./redux-vendor-BzdbewH4.js";import{P as c,l as d,B as m,k as u,m as p,d as x,h}from"./DefaultLayout-BUcG_pV2.js";import{u as f,b,a as g,E as y,A as j,C as N,D as v}from"./index-DW-yAxzW.js";import{C as S}from"./react-select-creatable.esm-Ljx4lJgZ.js";import{h as w,j as C,F as D}from"./form-vendor-CKNVq0c_.js";import{a as k,c as A,i as $,g as M,b as F,d as I,M as E,e as q,P as R,E as z,f as W,s as T,v as U}from"./EmailContractModal-Dtlu65vB.js";import{i as V,l as B,W as O,J as P,a6 as L,u as H,$ as G,a0 as _,a1 as J,a2 as Q,a3 as Y,a4 as K,a8 as X,h as Z,H as ee,U as se,V as te,I as ae,v as re,o as ie,p as ne,r as le,t as oe,a9 as ce,R as de,B as me,E as ue,a as pe,e as xe,j as he,k as fe,m as be}from"./ui-vendor-DjmSPU99.js";import{h as ge,b as ye,f as je,g as Ne,e as ve}from"./index-BmyYYes_.js";import{S as Se}from"./utils-vendor-Nl-sF5xe.js";import{c as we}from"./cil-trash-CBbKHhHb.js";import{c as Ce}from"./cil-home-DjIzczOB.js";import{c as De,a as ke}from"./cil-chevron-right-DSvcss7_.js";import{w as Ae}from"./withContractorScope-CFJqUjZ-.js";import{c as $e}from"./cil-pencil-m516yCOw.js";import"./icons-vendor-D82TZqJV.js";import"./cil-arrow-left-D66Kb3Zq.js";import"./cil-magnifying-glass-CDkY_4k-.js";import"./editor-vendor-BVtsSqVx.js";import"./ckeditor-CpNaeZUl.js";const Me=n({name:"selectVersionNew",initialState:{data:null},reducers:{setSelectVersionNewEdit(e,s){e.data=s.payload},clearSelectVersionNewEdit(e){e.data=null}}}),{setSelectVersionNewEdit:Fe,clearSelectVersionNewEdit:Ie}=Me.actions,Ee=["L","R","-"],qe=["L","R","B","-"],Re=(e,s)=>s?Re(s,e%s):e,ze=(e,s=16)=>{if(null==e||isNaN(e))return"";const t=e<0?"-":"";let a=Math.abs(Number(e)),r=Math.floor(a),i=a-r,n=Math.round(i*s);if(n===s&&(r+=1,n=0),0===n)return`${t}${r}`;const l=Re(n,s);return`${t}${r?r+" ":""}${n/l}/${s/l}`},We=e=>{if(!e||"object"!=typeof e)return"";const s=[],t=Object.entries(e).filter(([e,s])=>"number"==typeof s&&isFinite(s));if(1===t.length){const[,e]=t[0],a=ze(e);a&&s.push(`${a}"`)}else t.length>1&&t.forEach(([e,t])=>{const a=ze(t);var r;a&&s.push(`${r=e,r?String(r).replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim():""} ${a}"`)});return"string"==typeof e.sideSelector&&e.sideSelector&&s.push(`Side: ${(e=>{switch(e){case"L":return"Left";case"R":return"Right";case"B":return"Both";default:return e}})(e.sideSelector)}`),s.join(" â€¢ ")},Te=({catalogData:s,handleCatalogSelect:r,addOnTop:i,setAddOnTop:n,handleCopy:o,groupEnabled:u,setGroupEnabled:p,searchTerm:x,setSearchTerm:h,updateQty:y,handleOpenModificationModal:j,handleDelete:N,setModificationsMap:v,modificationsMap:S,handleDeleteModification:w,formatPrice:C,selectVersion:D,isAssembled:$,selectedStyleData:M,toggleRowAssembly:F,updateHingeSide:I,updateExposedSide:E,readOnly:q=!1})=>{const{t:R}=f(),z=l(e=>e.customization).headerBg||"#667eea",W=b(z),[T,U]=t.useState(""),[X,Z]=t.useState(!1),ee=t.useRef(null),[se,te]=t.useState([]),[ae,re]=t.useState(!1),[ie,ne]=t.useState(null),[le,oe]=t.useState({requiresHinge:!1,requiresExposed:!1,itemRequirements:{}}),ce="https://app.nj.contractors",de=e=>{switch(e){case"L":return R("common.short.left",{defaultValue:"L"});case"R":return R("common.short.right",{defaultValue:"R"});case"B":return R("common.short.both",{defaultValue:"B"});default:return e}},me=t.useMemo(()=>{const e=Array.isArray(s)?s.filter(e=>Array.isArray(e.styleVariants)&&e.styleVariants.length>0&&e.style===M?.style):[],t=(T||"").toLowerCase().trim();return t?e.filter(e=>e.code&&String(e.code).toLowerCase().includes(t)||e.description&&String(e.description).toLowerCase().includes(t)).slice(0,20):[]},[s,M?.style,T]);t.useEffect(()=>{const e=D?.manufacturerData?.id;if(!e)return void te([]);let s=!1;return(async()=>{try{const t=await g.get(`/api/manufacturers/${e}/types-meta`),a=Array.isArray(t?.data)?t.data:[];s||te(a)}catch(t){s||te([])}})(),()=>{s=!0}},[D?.manufacturerData?.id]),t.useEffect(()=>{(async()=>{const e=D?.manufacturerData?.id,s=D?.items||[];if(e&&Array.isArray(s)&&0!==s.length)try{const t=await A(s,e);oe(t)}catch(t){oe({requiresHinge:!1,requiresExposed:!1,itemRequirements:{}})}else oe({requiresHinge:!1,requiresExposed:!1,itemRequirements:{}})})()},[D?.manufacturerData?.id,D?.items]);const ue=t.useMemo(()=>{const e=new Map;return(se||[]).forEach(s=>{s?.type&&e.set(String(s.type),s)}),e},[se]),pe=t.useMemo(()=>{const e=new Map;return(se||[]).forEach(s=>{s?.code&&s?.type&&e.set(String(s.code),String(s.type))}),e},[se]),xe=e=>{if(e)return e.type||pe.get(String(e.code||""))},he=e=>{if(!e)return!1;const s=ue.get(String(e));return s&&(s.image||(s.longDescription||s.description||"").trim())},fe=e=>{const s=ue.get(String(e));s&&(ne(s),re(!0))},be=e=>{e&&(r({target:{value:`${e.code} -- ${e.description}`}}),U(""),Z(!1))};return t.useEffect(()=>{const e=e=>{const s=ee.current;s&&(s.contains(e.target)||Z(!1))};if(X)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[X]),e.jsxs("div",{className:"mt-5 mb-5",children:[e.jsxs(V,{visible:ae,onClose:()=>re(!1),size:"xl",className:"specs-modal",alignment:"center",style:{"--bs-modal-width":"960px","--cui-modal-width":"960px"},backdrop:!0,keyboard:!0,children:[e.jsx(c,{title:ie?.type||"Type Specifications",onClose:()=>re(!1)}),e.jsxs(B,{className:"p-3 p-md-4",children:[ie?e.jsxs("div",{className:"d-flex flex-column flex-md-row gap-4",children:[e.jsx("div",{className:"text-center text-md-start border rounded p-3 bg-light",style:{width:"100%",maxWidth:"520px",margin:"0 auto"},children:e.jsx("img",{src:ie.image?`${ce}/uploads/types/${ie.image}`:"/images/nologo.png",alt:ie.type,className:"img-fluid",style:{maxWidth:"100%",height:"auto",maxHeight:"455px",objectFit:"contain",background:"#ffffff",borderRadius:"6px",border:"1px solid #dee2e6"},onError:e=>{ie.image&&!e.target.dataset.fallbackTried?(e.target.dataset.fallbackTried="1",e.target.src=`${ce}/uploads/manufacturer_catalogs/${ie.image}`):e.target.src="/images/nologo.png"}})}),e.jsxs("div",{className:"flex-grow-1 border rounded p-3 bg-light",style:{minWidth:0},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"badge text-bg-secondary me-2",children:R("Type")}),e.jsx("strong",{style:{fontSize:"1.1rem"},children:ie.type})]}),ie.code&&e.jsxs("div",{className:"mb-2 border-bottom pb-2",children:[e.jsx("span",{className:"text-muted fw-medium",children:"Code:"})," ",e.jsx("strong",{children:ie.code})]}),ie.name&&e.jsxs("div",{className:"mb-2 border-bottom pb-2",children:[e.jsx("span",{className:"text-muted fw-medium",children:"Name:"})," ",e.jsx("strong",{children:ie.name})]}),ie.shortName&&e.jsxs("div",{className:"mb-3 border-bottom pb-2",children:[e.jsx("span",{className:"text-muted fw-medium",children:"Short:"})," ",e.jsx("strong",{children:ie.shortName})]}),e.jsxs("div",{className:"mt-3",style:{whiteSpace:"pre-wrap",lineHeight:"1.6",fontSize:"0.95rem"},children:[e.jsx("strong",{className:"text-muted d-block mb-2",children:"Description:"}),ie.longDescription||ie.description||R("No description available for this type.")]})]})]}):e.jsx("div",{className:"text-muted text-center p-4 border rounded bg-light",children:R("No type information available.")}),e.jsx("div",{className:"d-block d-md-none mt-4 text-center",children:e.jsx("button",{type:"button",className:"btn btn-dark btn-lg shadow-sm",onClick:()=>re(!1),style:{minWidth:"140px",borderRadius:"8px",fontWeight:"500"},children:"Close"})})]})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-3 align-items-center justify-content-between mb-4 catalog-controls-mobile",children:[!q&&e.jsxs("div",{className:"position-relative flex-grow-1",style:{minWidth:"200px",maxWidth:"600px"},ref:ee,children:[e.jsx(O,{children:e.jsx(P,{placeholder:R("proposalUI.enterPartCode"),value:T,onChange:e=>{U(e.target.value),Z(!0)},onFocus:()=>Z(!0),onKeyDown:e=>{"Enter"===e.key&&me[0]&&(e.preventDefault(),be(me[0])),"Escape"===e.key&&Z(!1)}})}),X&&me.length>0&&e.jsx("div",{className:"dropdown-menu show w-100",style:{maxHeight:"260px",overflowY:"auto"},children:me.map(s=>e.jsxs("div",{className:"dropdown-item-wrapper d-flex justify-content-between align-items-center",style:{padding:"0.25rem"},children:[e.jsxs("button",{type:"button",className:"dropdown-item text-wrap flex-grow-1 border-0 bg-transparent text-start",onMouseDown:e=>e.preventDefault(),onClick:()=>be(s),style:{padding:"0.25rem 0.75rem"},children:[e.jsx("strong",{children:s.code})," â€” ",s.description]}),he(xe(s))&&e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-info ms-2",style:{fontSize:"0.65rem",padding:"0.1rem 0.3rem",flexShrink:0},onClick:e=>{e.stopPropagation(),fe(xe(s))},title:`View ${xe(s)} specifications`,children:"Specs"})]},s.id))})]}),e.jsx("div",{className:"d-flex flex-wrap align-items-center gap-3 flex-shrink-0",children:!q&&e.jsxs(e.Fragment,{children:[e.jsx(L,{label:e.jsx("span",{style:{fontSize:"1rem"},children:R("proposalUI.addOnTop")}),checked:i,onChange:e=>n(e.target.checked),style:{transform:"scale(1.1)"}}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(H,{icon:k,style:{cursor:"pointer"},onClick:o}),e.jsx("span",{style:{fontWeight:"bold",fontSize:"1rem"},children:R("proposalUI.copy")})]}),e.jsx(L,{label:e.jsx("span",{style:{fontSize:"1rem"},children:R("proposalUI.group")}),checked:u,onChange:e=>p(e.target.checked),style:{transform:"scale(1.1)"}})]})}),!q&&e.jsx("div",{className:"flex-shrink-0",style:{minWidth:"200px",maxWidth:"240px",width:"100%"},children:e.jsx(O,{children:e.jsx(P,{placeholder:R("proposalUI.findInCart"),value:x,onChange:e=>h(e.target.value)})})})]}),e.jsx("div",{className:"table-responsive table-responsive-md desktop-only",children:e.jsxs(G,{children:[e.jsx(_,{children:e.jsxs(J,{children:[e.jsx(Q,{children:R("proposalColumns.no")}),e.jsx(Q,{children:R("proposalColumns.qty")}),e.jsx(Q,{children:R("proposalColumns.item")}),le.requiresHinge&&e.jsx(Q,{style:{backgroundColor:"#ffebee",color:"#c62828",fontWeight:"bold"},children:R("proposalColumns.hingeSide")}),le.requiresExposed&&e.jsx(Q,{style:{backgroundColor:"#ffebee",color:"#c62828",fontWeight:"bold"},children:R("proposalColumns.exposedSide")}),e.jsx(Q,{children:R("proposalColumns.price")}),e.jsx(Q,{children:R("proposalColumns.assemblyCost")}),e.jsx(Q,{children:R("proposalColumns.modifications",{defaultValue:"Modifications"})}),e.jsx(Q,{children:R("proposalColumns.total")}),e.jsx(Q,{children:R("proposals.headers.actions")})]})}),e.jsx(Y,{children:D?.items?.map((s,t)=>{const r=!!$,i=Number(s.qty||1),n=(r?Number(s.assemblyFee||0):0)*i,l=Array.isArray(s.modifications)?s.modifications.reduce((e,s)=>e+Number(s.price||0)*Number(s.qty||1),0):0,o=Number(s.price||0)*i+n+l,c=s.unavailable?{color:"#b00020",textDecoration:"line-through"}:void 0;return e.jsxs(a.Fragment,{children:[e.jsxs(J,{className:s.unavailable?"table-danger":"",style:{backgroundColor:s.unavailable?void 0:t%2==0?"#fbfdff":"#ffffff",borderBottom:"2px solid #e6ebf1",...0===t?{borderTop:"2px solid #e6ebf1"}:{}},children:[e.jsx(K,{style:{width:"56px"},children:e.jsx("span",{className:"shadow-sm",style:{display:"inline-flex",alignItems:"center",justifyContent:"center",minWidth:"36px",height:"28px",padding:"0 10px",borderRadius:"9999px",backgroundColor:z,color:W,fontWeight:700,fontSize:"0.95rem",letterSpacing:"0.2px"},title:`Row ${t+1}`,children:t+1})}),e.jsx(K,{children:e.jsx(P,{type:"number",min:"1",value:s.qty,onChange:e=>y(t,parseInt(e.target.value)),style:{width:"70px",textAlign:"center"},disabled:q})}),e.jsx(K,{style:c,children:e.jsxs("div",{className:"d-flex align-items-center gap-2",style:{minWidth:0},children:[e.jsxs("div",{className:"d-flex align-items-baseline gap-2 flex-wrap",style:{minWidth:0},children:[e.jsx("strong",{children:s.code}),s?.description?e.jsxs("span",{className:"text-muted text-truncate",style:{maxWidth:"420px",display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:s.description,children:["â€” ",s.description]}):null]}),he(xe(s))&&e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-info",style:{fontSize:"0.7rem",padding:"0.15rem 0.4rem"},onClick:()=>fe(xe(s)),title:`View ${xe(s)} specifications`,children:"Specs"})]})}),le.requiresHinge&&e.jsx(K,{style:{backgroundColor:!le.itemRequirements[t]?.requiresHinge||s.hingeSide&&"-"!==s.hingeSide?"transparent":"#ffebee"},children:r?e.jsxs("div",{children:[le.itemRequirements[t]?.requiresHinge&&(!s.hingeSide||"-"===s.hingeSide)&&e.jsx("div",{className:"text-danger mb-1",style:{fontSize:"0.75rem",fontWeight:"bold"},children:R("validation.selectHingeSide",{defaultValue:"Select hinge side"})}),e.jsx("div",{className:"d-flex gap-1",children:Ee.map(a=>e.jsx("button",{type:"button",className:"btn btn-sm "+(s.hingeSide===a?"btn-primary":"btn-outline-secondary"),style:{...s.hingeSide===a?{background:z,color:W,border:`1px solid ${z}`}:{},...q?{pointerEvents:"none",opacity:.6}:{}},onClick:()=>!q&&I(t,a),disabled:q,children:de(a)},a))})]}):R("common.na")}),le.requiresExposed&&e.jsx(K,{style:{backgroundColor:!le.itemRequirements[t]?.requiresExposed||s.exposedSide&&"-"!==s.exposedSide?"transparent":"#ffebee"},children:r?e.jsxs("div",{children:[le.itemRequirements[t]?.requiresExposed&&(!s.exposedSide||"-"===s.exposedSide)&&e.jsx("div",{className:"text-danger mb-1",style:{fontSize:"0.75rem",fontWeight:"bold"},children:R("validation.selectExposedSide",{defaultValue:"Select exposed finished side"})}),e.jsx("div",{className:"d-flex gap-1",children:qe.map(a=>e.jsx("button",{type:"button",className:"btn btn-sm "+(s.exposedSide===a?"btn-primary":"btn-outline-secondary"),style:{...s.exposedSide===a?{background:z,color:W,border:`1px solid ${z}`}:{},...q?{pointerEvents:"none",opacity:.6}:{}},onClick:()=>!q&&E(t,a),disabled:q,children:de(a)},a))})]}):R("common.na")}),e.jsx(K,{style:c,children:C(s.unavailable?0:s.price)}),e.jsx(K,{children:r?e.jsx("span",{style:c,children:C(s.unavailable?0:n)}):e.jsx("span",{className:"text-muted",children:C(0)})}),e.jsx(K,{children:C(l)}),e.jsx(K,{style:c,children:C(s.unavailable?0:o)}),e.jsx(K,{children:e.jsx("div",{className:"d-flex align-items-center",children:!q&&e.jsxs(e.Fragment,{children:[e.jsx(H,{icon:d,style:{cursor:"pointer",color:"black",marginRight:"16px"},onClick:()=>j(t,s.id)}),e.jsx(H,{icon:we,style:{cursor:"pointer",color:"red"},onClick:()=>N(t)})]})})})]}),Array.isArray(s.modifications)&&s.modifications.length>0&&(()=>{const r=s.modifications.reduce((e,s)=>{const t=s.categoryName||"Other";return e[t]=e[t]||[],e[t].push(s),e},{}),i=Object.keys(r);return e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"modification-header",children:e.jsxs(K,{colSpan:10,style:{backgroundColor:z,color:W,padding:"8px 16px",paddingLeft:"56px",fontSize:"0.9rem",borderTop:`2px solid ${z}`,borderLeft:`6px solid ${z}`,borderTopLeftRadius:"6px",borderTopRightRadius:"6px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,0.05)"},children:[e.jsx(m,{className:"me-2",style:{fontSize:"14px",color:W}}),e.jsx("span",{className:"fw-bold",children:R("proposalDoc.modifications")})]})}),i.map((n,l)=>e.jsxs(a.Fragment,{children:[e.jsx(J,{className:"modification-category",style:{backgroundColor:"#f1f3f5"},children:e.jsxs(K,{colSpan:10,className:"fw-semibold text-secondary",style:{paddingLeft:"72px",fontSize:"0.85rem",borderLeft:`6px solid ${z}`,borderBottom:"1px solid #dee2e6"},children:["ðŸ“‚ ",n]})}),r[n].map((o,c)=>{const d=l===i.length-1&&c===r[n].length-1;return e.jsxs(a.Fragment,{children:[e.jsxs(J,{className:"modification-item",style:{backgroundColor:"#fcfcfd",borderLeft:`6px solid ${z}`,fontSize:"0.9rem",borderBottom:d?`2px solid ${z}`:"1px solid #e9ecef"},children:[e.jsx(K,{style:{paddingLeft:"88px",color:"#6c757d"},children:"â†³"}),e.jsx(K,{style:{fontWeight:"500"},children:o.qty}),e.jsx(K,{colSpan:3,style:{paddingLeft:"8px"},children:e.jsxs("div",{className:"d-flex align-items-center flex-wrap gap-2",children:[e.jsx("span",{className:"shadow-sm",style:{display:"inline-flex",alignItems:"center",padding:"2px 10px",borderRadius:"9999px",backgroundColor:"#f3f5f7",border:`1px solid ${z}`,color:"#212529",fontWeight:600,lineHeight:1.2},children:o.name||R("proposalUI.mod.unnamed")}),(()=>{const s=We(o?.selectedOptions);return s?e.jsx("span",{className:"text-muted",style:{fontSize:"0.8rem",padding:"2px 8px",borderRadius:"6px",background:"#f8f9fa",border:"1px dashed #ced4da"},children:s}):null})()]})}),e.jsx(K,{className:"fw-medium text-success",children:C(o.price||0)}),e.jsx(K,{style:{color:"#6c757d"},children:"-"}),e.jsx(K,{}),e.jsx(K,{className:"fw-semibold text-success",children:C((o.price||0)*(o.qty||1))}),e.jsx(K,{style:{textAlign:"center"},children:!q&&e.jsx(H,{icon:we,style:{cursor:"pointer",color:"#dc3545",fontSize:"14px"},onClick:()=>w(t,s.modifications.findIndex(e=>e===o)),title:"Remove modification"})})]}),d&&e.jsx(J,{children:e.jsx(K,{colSpan:10,style:{padding:0},children:e.jsx("div",{style:{height:"10px",borderBottom:"1px dashed #cfd4da"}})})})]},`mod-${t}-${n}-${c}`)})]},`modgrp-${t}-${n}`))]})})()]},t)})})]})}),e.jsx("div",{className:"mobile-card-view mobile-only",children:D?.items?.map((s,t)=>{const r=!!$,i=Number(s.qty||1),n=(r?Number(s.assemblyFee||0):0)*i,l=Array.isArray(s.modifications)?s.modifications.reduce((e,s)=>e+Number(s.price||0)*Number(s.qty||1),0):0,o=Number(s.price||0)*i+n+l,c=s.unavailable?{color:"#b00020",textDecoration:"line-through"}:void 0;return e.jsxs(a.Fragment,{children:[e.jsxs("div",{className:"item-card-mobile",style:{border:"2px solid #e6ebf1",borderRadius:"8px",backgroundColor:t%2==0?"#fbfdff":"#ffffff",marginBottom:"12px"},children:[e.jsxs("div",{className:"item-header",children:[e.jsx("div",{className:"item-number",children:t+1}),!q&&e.jsxs("div",{className:"item-actions",children:[e.jsx(H,{icon:d,style:{cursor:"pointer",color:"var(--cui-primary)",fontSize:"1.2rem"},onClick:()=>j(t,s.id)}),e.jsx(H,{icon:we,style:{cursor:"pointer",color:"var(--cui-danger)",fontSize:"1.2rem"},onClick:()=>N(t)})]})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:R("proposalColumns.item")}),e.jsxs("div",{className:"d-flex align-items-center gap-2 flex-wrap",style:{minWidth:0},children:[e.jsx("span",{className:"item-value item-code",style:c,children:e.jsx("strong",{children:s.code})}),s?.description?e.jsxs("span",{className:"text-muted text-truncate",style:{maxWidth:"220px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:s.description,children:["â€” ",s.description]}):null,he(xe(s))&&e.jsx("button",{type:"button",className:"btn btn-sm btn-outline-info",style:{fontSize:"0.7rem",padding:"0.15rem 0.4rem"},onClick:()=>fe(xe(s)),title:`View ${xe(s)} specifications`,children:"Specs"})]})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:R("proposalColumns.qty")}),e.jsx("input",{type:"number",min:"1",value:s.qty,onChange:e=>y(t,parseInt(e.target.value)),className:"qty-input-mobile",disabled:q})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:R("proposalColumns.price")}),e.jsx("span",{className:"item-value",style:c,children:C(s.unavailable?0:s.price)})]}),r&&e.jsxs(e.Fragment,{children:[le.requiresHinge&&e.jsxs("div",{className:"item-detail-row",style:{backgroundColor:!le.itemRequirements[t]?.requiresHinge||s.hingeSide&&"-"!==s.hingeSide?"transparent":"#ffebee",padding:"0.5rem",borderRadius:"4px"},children:[e.jsx("span",{className:"item-label",children:R("proposalColumns.hingeSide")}),le.itemRequirements[t]?.requiresHinge&&(!s.hingeSide||"-"===s.hingeSide)&&e.jsx("div",{className:"text-danger mb-2",style:{fontSize:"0.75rem",fontWeight:"bold"},children:R("validation.selectHingeSide",{defaultValue:"Select hinge side"})}),e.jsx("div",{className:"btn-group-mobile",children:Ee.map(a=>e.jsx("button",{type:"button",className:"btn "+(s.hingeSide===a?"btn-primary":"btn-outline-secondary"),style:s.hingeSide===a?{background:z,color:W,border:`1px solid ${z}`}:{},onClick:()=>!q&&I(t,a),disabled:q,children:de(a)},a))})]}),le.requiresExposed&&e.jsxs("div",{className:"item-detail-row",style:{backgroundColor:!le.itemRequirements[t]?.requiresExposed||s.exposedSide&&"-"!==s.exposedSide?"transparent":"#ffebee",padding:"0.5rem",borderRadius:"4px"},children:[e.jsx("span",{className:"item-label",children:R("proposalColumns.exposedSide")}),le.itemRequirements[t]?.requiresExposed&&(!s.exposedSide||"-"===s.exposedSide)&&e.jsx("div",{className:"text-danger mb-2",style:{fontSize:"0.75rem",fontWeight:"bold"},children:R("validation.selectExposedSide",{defaultValue:"Select exposed finished side"})}),e.jsx("div",{className:"btn-group-mobile",children:qe.map(a=>e.jsx("button",{type:"button",className:"btn "+(s.exposedSide===a?"btn-primary":"btn-outline-secondary"),style:s.exposedSide===a?{background:z,color:W,border:`1px solid ${z}`}:{},onClick:()=>!q&&E(t,a),disabled:q,children:de(a)},a))})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:R("proposalColumns.assemblyCost")}),e.jsx("span",{className:"item-value",style:c,children:C(s.unavailable?0:n)})]})]}),e.jsxs("div",{className:"item-detail-row",children:[e.jsx("span",{className:"item-label",children:R("proposalColumns.modifications",{defaultValue:"Modifications"})}),e.jsx("span",{className:"item-value",children:C(l)})]}),e.jsx("div",{className:"total-highlight",children:e.jsxs("strong",{style:c,children:[R("proposalColumns.total"),": ",C(s.unavailable?0:o)]})})]}),Array.isArray(s.modifications)&&s.modifications.length>0&&s.modifications.map((s,a)=>e.jsxs("div",{style:{background:z,color:W,border:`1px solid ${z}`,borderRadius:"6px",padding:"0.75rem",marginTop:"0.75rem",marginBottom:"1.5rem",marginLeft:"auto",marginRight:"auto",maxWidth:"90%",position:"relative",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[e.jsx("div",{style:{position:"absolute",top:"-8px",left:"12px",background:W,color:z,borderRadius:"50%",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:"bold",border:`2px solid ${z}`},children:t+1}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.75rem",fontWeight:"600",color:W,textTransform:"uppercase",letterSpacing:"0.5px"},children:R("proposalDoc.modifications")}),!q&&e.jsx(H,{icon:we,style:{cursor:"pointer",color:"var(--cui-danger)"},onClick:()=>w(t,a)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem",marginBottom:"0.25rem"},children:[e.jsx("span",{children:s.name||R("proposalUI.mod.unnamed")}),(()=>{const t=We(s?.selectedOptions);return t?e.jsxs("span",{style:{opacity:.7},children:[" â€” ",t]}):null})(),e.jsxs("span",{children:["Qty: ",s.qty]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"0.875rem",marginBottom:"0"},children:[e.jsxs("span",{children:[R("proposalColumns.price"),": ",C(s.price||0)]}),e.jsx("span",{children:e.jsxs("strong",{children:[R("proposalColumns.total"),": ",C((s.price||0)*(s.qty||1))]})})]})]},`mobile-mod-${t}-${a}`))]},`mobile-${t}`)})})]})},Ue=({selectVersion:s,selectedVersion:a,formData:r,setFormData:i,setSelectedVersion:n,readOnly:c=!1})=>{const{t:m}=f(),x="https://app.nj.contractors",h=o(),[b,N]=t.useState(null),[v,S]=t.useState([]),[w,C]=t.useState(!1),[D,k]=t.useState([]),[A,q]=t.useState(!1),[R,z]=t.useState(!1),[W,T]=t.useState(""),[U,V]=t.useState(!1),[B,O]=t.useState(!1),[P,G]=t.useState(""),[_,J]=t.useState(""),[Q,Y]=t.useState(!0),[K,Z]=t.useState([]),[ee,se]=t.useState(!1),[te,ae]=t.useState(null),[re,ie]=t.useState(null),[ne,le]=t.useState("existing"),[oe,ce]=t.useState(1),[de,me]=t.useState(""),[ue,pe]=t.useState(""),[xe,he]=t.useState(1),[fe,be]=t.useState(""),[ge,ye]=t.useState(""),[je,Ne]=t.useState(!0),[ve,Se]=t.useState(!1),[we,Ae]=t.useState(""),[$e,Me]=t.useState({}),[Ie,Ee]=t.useState(!0),[qe,Re]=t.useState(0),[ze,We]=t.useState(1),[Ue,Ve]=t.useState(1),[Be,Oe]=t.useState(1),[Pe,Le]=t.useState(!1),[He,Ge]=t.useState(!1),[_e,Je]=t.useState(!1),[Qe,Ye]=t.useState(!1),[Ke,Xe]=t.useState(0),[Ze,es]=t.useState(4),[ss,ts]=t.useState(!1),{taxes:as,loading:rs}=l(e=>e.taxes),is=t.useRef(!1),[ns,ls]=t.useState(""),[os,cs]=t.useState(0),ds=l(e=>e.auth?.user);l(e=>e.customization);const ms=u(ds),us=c&&!ms,ps=t.useRef(new Map),xs=t.useRef({}),hs=r?.manufacturersData?.[0]?.manufacturer,fs=t.useMemo(()=>Array.isArray(D)?D.filter(e=>e.selectVersion===s?.versionName):[],[D,s?.versionName]),bs=t.useMemo(()=>fs,[fs]),[gs,ys]=t.useState([]),[js,Ns]=t.useState(!0),[vs,Ss]=t.useState(""),[ws,Cs]=t.useState(""),Ds=t.useCallback(e=>{if(!Array.isArray(e)||0===e.length)return;const a=new Map;e.forEach(e=>{e.code&&e.type&&a.set(String(e.code).trim(),e.type)});const l=Array.isArray(r?.manufacturersData)?[...r.manufacturersData]:[],o=l.findIndex(e=>e.versionName===s?.versionName);if(-1===o)return;const c=Array.isArray(l[o].items)?l[o].items:[];let d=!1;const m=c.map(e=>{if(e?.type)return e;const s=a.get(String(e?.code||"").trim());return s?(d=!0,{...e,type:s}):e});d&&(k(m),n&&s&&t.startTransition(()=>{n({...s,items:m})}),i(e=>{const t=Array.isArray(e?.manufacturersData)?[...e.manufacturersData]:[],a=t.findIndex(e=>e.versionName===s?.versionName);return-1===a?e:(t[a]={...t[a],items:m},{...e,manufacturersData:t})}))},[r,s,i,n]);t.useEffect(()=>{const e=()=>{window.innerWidth<=767?es(2):window.innerWidth<=992?es(4):window.innerWidth<=1200?es(5):es(6)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),t.useEffect(()=>{Xe(0)},[v]);const ks=()=>Ke<v.length-Ze,As=()=>Ke>0;t.useMemo(()=>`${bs.map(e=>`${e.code}:${e.qty}:${JSON.stringify(e.modifications||[])}`).join("|")}#${K.map(e=>`${e.name}:${e.price}:${e.taxable}`).join("|")}#${`${ze}:${Ue}:${qe}:${Ie}:${Pe}:${Be}`}`,[bs,K,ze,Ue,qe,Ie,Pe,Be]);const $s=t.useCallback(e=>{const s=r?.manufacturersData?.[0]?.manufacturer;if(!s||!e)return bs.length>0;const t=`${s}:${e}`,a=ps.current.get(t);if(!a||0===a.length)return bs.length>0;const i=new Map(a.map(e=>[String(e.code).trim(),e]));return bs.some(e=>i.has(String(e.code).trim()))},[bs,r?.manufacturersData]);t.useEffect(()=>{if(r&&Array.isArray(r.manufacturersData)&&r.manufacturersData.length>0){const e=r.manufacturersData,a=s?.versionName?e.findIndex(e=>e.versionName===s.versionName):0,l=((-1!==a?e[a]?.items:e[0]?.items)||[]).map(e=>({...e,selectVersion:e.selectVersion||s?.versionName||"",includeAssemblyFee:void 0===e.includeAssemblyFee||e.includeAssemblyFee,isRowAssembled:void 0===e.isRowAssembled||e.isRowAssembled}));k(l),i(e=>{const t=Array.isArray(e?.manufacturersData)?[...e.manufacturersData]:[],a=s?.versionName?t.findIndex(e=>e.versionName===s.versionName):-1;return-1!==a?t[a]={...t[a],items:l}:t.length>0&&(t[0]={...t[0],items:l}),{...e,manufacturersData:t}}),n&&s&&t.startTransition(()=>{n({...s,items:l})})}else k([])},[]),t.useEffect(()=>{if(r&&Array.isArray(r.manufacturersData)&&r.manufacturersData.length>0){const e=r.manufacturersData.find(e=>e.versionName===s?.versionName);if(e&&Array.isArray(e.customItems)){const s=e.customItems;JSON.stringify(s)===JSON.stringify(K)||Z(s)}if(e&&Array.isArray(e.items)){const s=e.items.map(e=>void 0!==e.comparisonPriceFallback&&void 0!==e.comparisonAssemblyUnitFallback?e:{...e,comparisonPriceFallback:Number(e.price||0),comparisonAssemblyUnitFallback:e?.includeAssemblyFee?Number(e?.assemblyFee||0):0});k(s)}}},[s?.versionName]),l(e=>e.selectVersionNew?.data);const Ms=l(e=>e.selectVersionNew?.data?.versionName||null);t.useEffect(()=>{const e=s?.versionName||null;e&&Ms!==e&&h(Fe(s))},[s?.versionName]),t.useEffect(()=>{(async()=>{try{const e=await g.get("/api/user/multiplier");e.data&&e.data.multiplier&&We(Number(e.data.multiplier))}catch(e){}finally{Ge(!0)}})()},[]),t.useEffect(()=>{Le($()),Oe(M());return F(({mode:e,multiplier:s})=>{Le(e),Oe(s)})},[]),t.useEffect(()=>{ms||!0===Q||Y(!0)},[ms]),t.useEffect(()=>{ms||!0===je||Ne(!0)},[ms]),t.useEffect(()=>{if(!He||!_e)return;if(0===D.length)return;if(!D.some(e=>{const s=e.appliedMultiplier||e.appliedUserGroupMultiplier||1,t=e.appliedManufacturerMultiplier||1,a=e.appliedShowroomMultiplier||1,r=e.originalPrice||(s>0||t>0?Number(e.price)/(t*s*a):Number(e.price)),i=Pe?Be:1,n=Number(r)*Number(Ue||1)*Number(ze||1)*i,l=Math.abs(Number(e.price)-n)>.01,o=Math.abs(s-Number(ze||1))>.001||Math.abs(t-Number(Ue||1))>.001||Math.abs(a-i)>.001;return l||o}))return void Ye(!0);const e=D.map(e=>{const s=e.appliedMultiplier||e.appliedUserGroupMultiplier||1,t=e.appliedManufacturerMultiplier||1,a=e.appliedShowroomMultiplier||1,r=e.originalPrice||(s>0||t>0?Number(e.price)/(t*s*a):Number(e.price)),i=Pe?Be:1,n=Number(r)*Number(Ue||1)*Number(ze||1)*i,l=e?.includeAssemblyFee?Number(e?.assemblyFee||0):0,o=Pe?l*Be:l,c=Number(e?.qty||1);return{...e,originalPrice:Number(r),appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(ze||1),appliedShowroomMultiplier:i,appliedMultiplier:Number(ze||1),price:n,assemblyFee:o,total:c*n+o*c}});k(e),h(y(e)),i(t=>{const a=Array.isArray(t?.manufacturersData)?[...t.manufacturersData]:[],r=s?.versionName?a.findIndex(e=>e.versionName===s.versionName):-1;return-1!==r&&(a[r]={...a[r],items:e}),{...t,manufacturersData:a}}),n&&s&&n({...s,items:e}),Ye(!0)},[He,_e,ze,Ue,Pe,Be,D,h,s?.versionName,n,i]),t.useEffect(()=>{if(!He||!_e)return;if(0===D.length)return;const e=D.map(e=>{const s=e.appliedMultiplier||e.appliedUserGroupMultiplier||1,t=e.appliedManufacturerMultiplier||1,a=Number(e.price)||0,r=null!=e.originalPrice?Number(e.originalPrice):s>0||t>0?a/(t*s):a,i=Number(ze||1),n=Number(Ue||1);if(Math.abs(s-i)<=.001&&Math.abs(t-n)<=.001)return e;const l=Number(r)*n*i,o=e?.includeAssemblyFee?Number(e?.assemblyFee||0):0,c=Number(e?.qty||1);return{...e,originalPrice:Number(r),appliedManufacturerMultiplier:n,appliedUserGroupMultiplier:i,appliedMultiplier:i,price:l,total:c*l+o*c}});e.some((e,s)=>Math.abs(Number(e.price)-Number(D[s]?.price||0))>.001||Number(e.appliedManufacturerMultiplier||1)!==Number(D[s]?.appliedManufacturerMultiplier||1)||Number(e.appliedUserGroupMultiplier||1)!==Number(D[s]?.appliedUserGroupMultiplier||1))&&(k(e),h(y(e)),i(t=>{const a=Array.isArray(t?.manufacturersData)?[...t.manufacturersData]:[],r=s?.versionName?a.findIndex(e=>e.versionName===s.versionName):-1;return-1!==r&&(a[r]={...a[r],items:e}),{...t,manufacturersData:a}}),n&&s&&n({...s,items:e})),Ye(!0)},[He,_e,ze,Ue,D,h,s?.versionName,n,i]);const Fs=as.find(e=>e.isDefault),Is=parseFloat(Fs?.value||"0"),Es=fs.reduce((e,s)=>{if(!s.modifications)return e;return e+s.modifications.reduce((e,s)=>e+parseFloat(s.price||0)*parseFloat(s.qty||1),0)},0),qs=t.useCallback(()=>{try{const e=fs.reduce((e,s)=>e+s.price*s.qty,0),a=K.reduce((e,s)=>e+s.price*ze,0),r=Pe?a*Be:a,l=Pe?Es*Be:Es,o=Ie?fs.reduce((e,s)=>e+(s?.includeAssemblyFee?Number(s?.assemblyFee||0):0)*Number(s?.qty||1),0):0,c=Number(s?.manufacturerData?.deliveryFee||0),d=fs.length>0?c:0,m=e+o+r+l,u=K?.reduce((e,s)=>e+s.price,0)+fs.reduce((e,s)=>e+Number(s.price||0)*Number(s.qty||1),0),p=m*qe/100,x=m-p,h=x+d,f=h*Is/100,b=h+f,g={cabinets:parseFloat((Number(u)||0).toFixed(2)),assemblyFee:parseFloat((Number(o)||0).toFixed(2)),modificationsCost:parseFloat((Number(l)||0).toFixed(2)),deliveryFee:parseFloat((Number(d)||0).toFixed(2)),styleTotal:parseFloat((Number(m)||0).toFixed(2)),discountPercent:Number(qe)||0,discountAmount:parseFloat((Number(p)||0).toFixed(2)),total:parseFloat((Number(x)||0).toFixed(2)),taxRate:Number(Is)||0,taxAmount:parseFloat((Number(f)||0).toFixed(2)),grandTotal:parseFloat((Number(b)||0).toFixed(2))},y=s?.versionName||"__default__",j=xs.current[y],N=JSON.stringify(g);if(j===N)return;i(e=>{const t=Array.isArray(e?.manufacturersData)?e.manufacturersData:[],a=t.map(e=>{if(e.versionName===s?.versionName){const t=K.filter(e=>e.selectVersion===s?.versionName),a=fs;return{...e,selectedStyle:s?.selectedStyle,items:a,customItems:t,summary:g}}return e});return JSON.stringify(t)===JSON.stringify(a)?e:(xs.current[y]=N,{...e,manufacturersData:a})}),n&&s&&t.startTransition(()=>{n({...s,summary:g})})}catch(e){}},[fs,K,Es,Ie,qe,Is,s?.versionName,s?.selectedStyle,ze]);t.useEffect(()=>{qs()},[qs]),t.useEffect(()=>{h(j())},[h]),t.useEffect(()=>{(async()=>{if(hs)try{const e=await g.get(`/api/manufacturers/${hs}/styles-meta`);if(void 0!==e?.data?.manufacturerCostMultiplier&&Ve(Number(e.data.manufacturerCostMultiplier||1)),e?.data?.styles&&Array.isArray(e.data.styles)){const s=e.data.styles.filter(e=>String(e?.style||"").trim().length>0);S(s)}else if(Array.isArray(e?.data)){const s=e.data.filter(e=>String(e?.style||"").trim().length>0);S(s)}else S([])}catch(e){}finally{Je(!0)}})()},[hs]),t.useEffect(()=>{const e=s?.selectedStyle;let t=!1;if(!hs||!e)return void C(!1);const a=`${hs}:${e}`;if(!ps.current.has(a))return(async()=>{try{if(is.current)return;const s=await g.get(`/api/manufacturers/${hs}/styles/${e}/items`,{params:{includeDetails:"1",limit:1e3}});if(t)return;const r=s?.data?.catalogData||[];ps.current.set(a,r),Ds(r)}catch(s){const e=s?.response?.status;if(401===e||403===e)return void(is.current=!0)}finally{t||C(!0)}})(),()=>{t=!0};C(!0)},[hs,s?.selectedStyle]),t.useEffect(()=>{(async()=>{if(hs){Ns(!0);try{if(is.current)return;const e=(await g.get(`/api/manufacturers/${hs}/styleswithcatalog`)).data||[];JSON.stringify(e)===JSON.stringify(gs)||ys(e)}catch(e){const s=e?.response?.status;if(401===s||403===s)return void(is.current=!0)}finally{Ns(!1)}}})()},[hs]),t.useEffect(()=>{if(s?.selectedStyle&&v.length>0){const e=v.find(e=>e.id===s.selectedStyle)||null;JSON.stringify(e)===JSON.stringify(b)||N(e)}},[s?.selectedStyle,v]);const Rs=e=>{Z(s=>s.filter((s,t)=>t!==e))},zs=(e,a)=>{if("number"!=typeof e)return;const r=`row_${e}`;if(Me(e=>({...e,[r]:a})),k(s=>{const t=Array.isArray(s)?[...s]:[];return e>=0&&e<t.length&&(t[e]={...t[e],modifications:a}),t}),i(t=>{const r=Array.isArray(t?.manufacturersData)?[...t.manufacturersData]:[],i=r.findIndex(e=>e.versionName===s?.versionName);if(-1!==i){const s=Array.isArray(r[i].items)?[...r[i].items]:[];e>=0&&e<s.length&&(s[e]={...s[e],modifications:a}),r[i]={...r[i],items:s}}return{...t,manufacturersData:r}}),n&&s?.items){const r=[...s.items];e>=0&&e<r.length&&(r[e]={...r[e],modifications:a},t.startTransition(()=>{n({...s,items:r})}))}},Ws=async e=>{try{if(e){const s=await g.get(`/api/manufacturers/catalogs/modificationsItems/${e}`);Ss(s.data)}}catch(s){}},Ts=async e=>{const a={...r},l=a.manufacturersData.findIndex(e=>e.versionName===s.versionName);if(-1!==l){a.manufacturersData[l].selectedStyle=e,i(a);const c={...s,selectedStyle:e};n(c);const d=v.find(s=>s.id===e);N(d||null);const m=d?.style,u=s?.versionName,p=Array.isArray(D)?D.filter(e=>e.selectVersion===u):[];let x=gs.filter(e=>e.style===m);if(!x.length)try{const s=r?.manufacturersData?.[0]?.manufacturer;if(s&&e){const t=await g.get(`/api/manufacturers/${s}/styles/${e}/items`,{params:{includeDetails:"1",limit:2e3}});x=(t?.data?.catalogData||[]).filter(e=>e.style===m)}}catch(o){}let f=0;const b=p.map(e=>{const s=x.find(s=>s.code===e.code);if(!s)return f+=1,Number(e.qty||1),{...e,unavailable:!0,originalPrice:0,price:0,appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(ze||1),assemblyFee:0,includeAssemblyFee:!1,isRowAssembled:!1,total:0,comparisonPriceFallback:e.comparisonPriceFallback??Number(e.price||0),comparisonAssemblyUnitFallback:e.comparisonAssemblyUnitFallback??(e?.includeAssemblyFee?Number(e?.assemblyFee||0):0)};const t=Number(s.price)||0,a=t*Number(Ue||1)*Number(ze||1),r=parseFloat(s?.styleVariantsAssemblyCost?.price)||0,i=Ie,n=Number(e.qty||1),l=i?r:0;return{...e,unavailable:!1,originalPrice:t,appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(ze||1),appliedMultiplier:Number(ze||1),price:a,assemblyFee:r,includeAssemblyFee:i,isRowAssembled:i,total:n*a+l*n,comparisonPriceFallback:e.comparisonPriceFallback??a,comparisonAssemblyUnitFallback:e.comparisonAssemblyUnitFallback??l}});cs(f);const j=[...Array.isArray(D)?D.filter(e=>e.selectVersion!==u):[],...b];t.startTransition(()=>{k(j),h(y(j))}),i(e=>{const s=Array.isArray(e?.manufacturersData)?[...e.manufacturersData]:[],t=u?s.findIndex(e=>e.versionName===u):-1;return-1!==t&&(s[t]={...s[t],items:b}),{...e,manufacturersData:s}}),n&&s&&n({...s,items:b})}};return e.jsxs("div",{className:"item-selection-edit",children:[!Qe&&e.jsx("div",{className:"alert alert-info my-3",role:"status",children:"Applying your pricing... Please wait."}),b&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"d-flex gap-5 mb-4 flex-wrap style-selection-mobile",style:{alignItems:"stretch"},children:[e.jsxs("div",{className:"current-style-section",style:{minWidth:"250px",flex:"0 0 auto"},children:[e.jsx("h5",{className:"mb-3",children:m("proposalUI.currentStyle")}),e.jsxs("div",{className:"current-style-content d-flex gap-4 align-items-start",children:[e.jsx("div",{className:"current-style-image",style:{width:"100px",flexShrink:0},children:e.jsx("img",{src:b.styleVariants?.[0]?.image?`${x}/uploads/images/${b.styleVariants[0].image}`:"/images/nologo.png",alt:"Selected Style",style:{width:"100%",height:"240px",objectFit:"contain",borderRadius:"10px",backgroundColor:"#f8f9fa"},onError:e=>{const s=b.styleVariants?.[0]?.image;s&&!e.target.dataset.fallbackTried?(e.target.dataset.fallbackTried="1",e.target.src=`${x}/uploads/manufacturer_catalogs/${s}`):e.target.src="/images/nologo.png"}})}),e.jsxs("div",{className:"current-style-info d-flex flex-column",style:{gap:"1.5rem",flex:1},children:[e.jsxs("div",{className:"d-flex align-items-center",style:{fontSize:"1rem"},children:[e.jsx(H,{icon:Ce,className:"me-2 text-primary",style:{width:"20px",height:"20px"}}),e.jsx("h5",{className:"mb-0",children:s?.manufacturerData?.name})]}),e.jsxs("div",{className:"d-flex align-items-center text-muted",style:{fontSize:"1rem"},children:[e.jsx(H,{icon:p,className:"me-2 text-secondary",style:{width:"20px",height:"20px"}}),e.jsx("h5",{className:"mb-0",children:b.style})]}),e.jsxs("div",{className:"d-flex align-items-center",style:{fontSize:"1.1rem"},children:[e.jsx(H,{icon:d,className:"me-2 text-success",style:{width:"20px",height:"20px"}}),e.jsx("span",{className:"me-2",children:m("proposalColumns.assembled")}),e.jsx(X,{size:"md",shape:"pill",checked:Ie,onChange:e=>{c||Ee(e.target.checked)},disabled:c})]})]})]})]}),!us&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"style-separator",style:{width:"1px",backgroundColor:"#ccc",marginInline:"16px"}}),e.jsxs("div",{className:"other-styles-section",style:{flex:1},children:[os>0&&e.jsxs("div",{className:"alert alert-warning py-2 px-3 mb-3",role:"alert",children:[os," item",1!==os?"s":""," not available in this style. They remain listed in red with $0 and wonâ€™t affect totals."]}),e.jsxs("div",{className:"other-styles-header d-flex justify-content-between align-items-center mb-3",style:{flexWrap:"nowrap"},children:[e.jsx("h5",{className:"mb-0",children:m("proposalUI.otherStyles")}),e.jsxs("div",{className:"d-flex align-items-center gap-2 flex-nowrap",children:[e.jsx("button",{type:"button",className:"btn btn-sm "+(ss?"btn-primary":"btn-outline-primary"),onClick:()=>ts(!ss),style:{padding:"0.25rem 0.75rem",minHeight:44,minWidth:44},disabled:c,"aria-pressed":ss,"aria-label":m(ss?"proposalUI.expandImages":"proposalUI.compactView"),children:ss?e.jsxs(e.Fragment,{children:[e.jsx(H,{icon:I,size:"sm",className:"me-1"}),e.jsx("span",{className:"d-none d-sm-inline",children:m("proposalUI.expandImages")}),e.jsx("span",{className:"d-sm-none",children:"ðŸ“‹"})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{icon:I,size:"sm",className:"me-1"}),e.jsx("span",{className:"d-none d-sm-inline",children:m("proposalUI.compactView")}),e.jsx("span",{className:"d-sm-none",children:"ðŸ–¼ï¸"})]})}),v.length>Ze&&!ss&&e.jsxs("div",{className:"btn-group btn-group-sm d-md-none",role:"group","aria-label":"Style navigation",style:{display:"inline-flex",whiteSpace:"nowrap"},children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm "+(As()?"":"disabled"),onClick:e=>{e&&e.preventDefault(),Xe(e=>Math.max(e-1,0))},disabled:!As()||c,style:{padding:"0.25rem 0.4rem",minHeight:44,minWidth:44},"aria-label":"Previous styles",children:e.jsx(H,{icon:De,size:"sm"})}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary btn-sm "+(ks()?"":"disabled"),onClick:e=>{e&&e.preventDefault();const s=Math.max(0,v.length-Ze);Xe(e=>Math.min(e+1,s))},disabled:!ks()||c,style:{padding:"0.25rem 0.4rem",minHeight:44,minWidth:44},"aria-label":"Next styles",children:e.jsx(H,{icon:ke,size:"sm"})})]})]})]}),e.jsx("div",{className:"other-styles-carousel-container "+(ss?"collapsed-view":""),children:js?e.jsx("div",{className:"py-4 text-muted",children:m("proposalUI.loadingStyles")}):0===v.length?e.jsx("div",{className:"py-4 text-muted",children:m("proposalUI.noStyles")}):e.jsx("div",{className:"styles-carousel-container",children:0===bs.length?e.jsx("div",{className:"py-4 text-center text-muted",style:{fontSize:"0.9rem"},children:m("proposalUI.styleComparison.selectItemsMessage")}):ss?e.jsx("div",{className:"styles-compact-list",children:v.map((s,t)=>{const a=s.id===b?.id,r=bs.length>0&&!$s(s.id);return e.jsx("div",{className:`compact-style-item ${a?"current-style":""} styleCard`,"aria-disabled":r,onClick:()=>!c&&Ts(s.id),style:{cursor:c?"default":"pointer"},children:e.jsxs("div",{className:"style-info",children:[e.jsx("span",{className:"style-name",children:s.style}),a&&e.jsx("span",{className:"current-style-indicator",children:m("proposalUI.styleComparison.currentStyle","Current Style")})]})},`compact-style-${s.id}-${t}`)})}):e.jsx("div",{className:"styles-carousel-track",style:{display:"flex",gap:"1rem",transform:`translateX(-${Ke*(100/Ze)}%)`,transition:"transform 0.3s ease-in-out",width:v.length>Ze?100*Math.ceil(v.length/Ze)+"%":"100%"},children:v.map((s,t)=>{const a=s.styleVariants?.[0],r=bs.length>0&&!$s(s.id);return e.jsxs("div",{className:"style-carousel-item text-center styleCard","aria-disabled":r,style:{cursor:c?"default":"pointer",transition:"transform 0.2s ease",flexShrink:0},onClick:()=>!c&&Ts(s.id),onMouseEnter:e=>{c||(e.currentTarget.style.transform="scale(1.02)")},onMouseLeave:e=>{c||(e.currentTarget.style.transform="scale(1)")},children:[e.jsx("img",{src:a?.image?`${x}/uploads/images/${a.image}`:"/images/nologo.png",alt:a?.shortName||s.style,style:{width:"100%",height:"220px",objectFit:"contain",borderRadius:"10px",backgroundColor:"#f8f9fa",borderWidth:s.id===b?.id?"3px":"1px",borderStyle:"solid",borderColor:s.id===b?.id?"#1a73e8":"#e9ecef"},onError:e=>{a?.image&&!e.target.dataset.fallbackTried?(e.target.dataset.fallbackTried="1",e.target.src=`${x}/uploads/manufacturer_catalogs/${a.image}`):e.target.src="/images/nologo.png"}}),e.jsxs("div",{className:"mt-2 p-2 rounded",style:{backgroundColor:s.id===b?.id?"#d0e6ff":"#ffffff",borderWidth:s.id===b?.id?"2px":"1px",borderStyle:"solid",borderColor:s.id===b?.id?"#1a73e8":"#ced4da",fontWeight:s.id===b?.id?"600":"normal"},children:[e.jsx("div",{style:{fontSize:"0.875rem",marginBottom:"0.25rem"},children:s.style}),s.id===b?.id&&e.jsx("div",{style:{fontSize:"0.75rem",color:"#1a73e8",marginBottom:"0.25rem"},children:m("proposalUI.styleComparison.currentStyle","Current Style")})]})]},`style-${s.id}-${t}`)})})})})]})]})]})}),e.jsx("hr",{}),Qe&&e.jsx(Te,{catalogData:gs,handleCatalogSelect:e=>{const t=e.target.value,a=gs.find(e=>`${e.code} -- ${e.description}`===t);if(a){const e=Number(a.price)||0,t=e*Number(Ue||1)*Number(ze||1),r=a?.styleVariantsAssemblyCost;let n=0;if(r){const e=parseFloat(r.price||0),s=r.type;n="flat"===s||"fixed"===s?e:"percentage"===s?t*e/100:e}const l=Ie,o=t+(l?n:0),c={id:a.id,code:a.code,description:a.description,type:a.type,qty:1,originalPrice:e,appliedManufacturerMultiplier:Number(Ue||1),appliedUserGroupMultiplier:Number(ze||1),appliedMultiplier:Number(ze||1),price:t,assemblyFee:n,includeAssemblyFee:l,isRowAssembled:Ie,total:o,selectVersion:s?.versionName};i(e=>{const t=Array.isArray(e.manufacturersData)?[...e.manufacturersData]:[],a=t.findIndex(e=>e.versionName===s.versionName),r=-1!==a&&Array.isArray(t[a].items)?t[a].items:[],i=A?[c,...r]:[...r,c];return-1!==a&&(t[a]={...t[a],items:i}),k(i),h(y(i)),{...e,manufacturersData:t}})}},addOnTop:A,setAddOnTop:c?()=>{}:q,handleCopy:()=>{const e=D.map(e=>`${e.code} x${e.qty}`).join("\n");e?(O(!1),navigator.clipboard.writeText(e)):O(!0),V(!0),setTimeout(()=>V(!1),2e3)},groupEnabled:R,setGroupEnabled:c?()=>{}:z,searchTerm:W,setSearchTerm:c?()=>{}:T,updateQty:c?()=>{}:(e,t)=>{t<1||i(a=>{const r=Array.isArray(a.manufacturersData)?[...a.manufacturersData]:[],i=r.findIndex(e=>e.versionName===s.versionName);if(-1!==i){const a=(Array.isArray(r[i].items)?[...r[i].items]:[]).map((s,a)=>{if(a!==e)return s;const r=s.includeAssemblyFee?Number(s.assemblyFee||0):0;return{...s,qty:t,total:t*Number(s.price||0)+r*t}});r[i]={...r[i],items:a},k(a),h(y(a)),n&&s&&n({...s,items:a})}return{...a,manufacturersData:r}})},handleOpenModificationModal:c?()=>{}:(e,s)=>{ae(e),ie(`row_${e}`),se(!0),Cs(s),Ws(s)},handleDelete:c?()=>{}:e=>{if(s&&s.items){const t=s.items.filter((s,t)=>t!==e);i(e=>{const a=Array.isArray(e.manufacturersData)?[...e.manufacturersData]:[],r=a.findIndex(e=>e.versionName===s.versionName);-1!==r&&(a[r]={...a[r],items:t});return{...e,manufacturersData:a}}),h(Fe(t))}k(s=>s.filter((s,t)=>t!==e))},setModificationsMap:Me,modificationsMap:$e,handleDeleteModification:c?()=>{}:(e,s)=>{const t=[...$e[`row_${e}`]||[]];t.splice(s,1),zs(e,t)},formatPrice:e=>{const s=Number(e);return isNaN(s)?"$0.00":`$${s.toFixed(2)}`},selectVersion:s,isAssembled:Ie,selectedStyleData:b,toggleRowAssembly:c?()=>{}:(e,a)=>{const r=[...D],l=r[e],o=a?Number(l.assemblyFee||0):0,c=Number(l.qty||1),d=a?"N/A"===l.hingeSide?"":l.hingeSide:"N/A",m=a?"N/A"===l.exposedSide?"":l.exposedSide:"N/A";r[e]={...l,includeAssemblyFee:a,isRowAssembled:a,hingeSide:d,exposedSide:m,total:c*Number(l.price||0)+o*c},t.startTransition(()=>{k(r),h(y(r))}),i(e=>{const t=Array.isArray(e?.manufacturersData)?[...e.manufacturersData]:[],a=s?.versionName?t.findIndex(e=>e.versionName===s.versionName):-1;return-1!==a&&(t[a]={...t[a],items:r}),{...e,manufacturersData:t}}),n&&s&&n({...s,items:r})},updateHingeSide:c?()=>{}:(e,a)=>{if(k(s=>{const r=s.map((s,t)=>t===e?{...s,hingeSide:a}:s);return t.startTransition(()=>h(y(r))),r}),i(t=>{const r=Array.isArray(t?.manufacturersData)?[...t.manufacturersData]:[],i=r.findIndex(e=>e.versionName===s?.versionName);if(-1!==i){const s=Array.isArray(r[i].items)?[...r[i].items]:[];e>=0&&e<s.length&&(s[e]={...s[e],hingeSide:a}),r[i]={...r[i],items:s}}return{...t,manufacturersData:r}}),n&&s?.items){const r=[...s.items];e>=0&&e<r.length&&(r[e]={...r[e],hingeSide:a}),t.startTransition(()=>{n({...s,items:r})})}},updateExposedSide:c?()=>{}:(e,a)=>{if(k(s=>{const r=s.map((s,t)=>t===e?{...s,exposedSide:a}:s);return t.startTransition(()=>h(y(r))),r}),i(t=>{const r=Array.isArray(t?.manufacturersData)?[...t.manufacturersData]:[],i=r.findIndex(e=>e.versionName===s?.versionName);if(-1!==i){const s=Array.isArray(r[i].items)?[...r[i].items]:[];e>=0&&e<s.length&&(s[e]={...s[e],exposedSide:a}),r[i]={...r[i],items:s}}return{...t,manufacturersData:r}}),n&&s?.items){const r=[...s.items];e>=0&&e<r.length&&(r[e]={...r[e],exposedSide:a}),t.startTransition(()=>{n({...s,items:r})})}},readOnly:c}),U&&e.jsx("div",{className:"position-fixed bottom-10 start-50 translate-middle-x p-3",style:{zIndex:9999},children:e.jsx("div",{className:"toast show align-items-center text-white bg-success border-0",children:e.jsxs("div",{className:"d-flex",children:[e.jsx("div",{className:"toast-body",children:m(B?"proposalUI.toast.copyEmpty":"proposalUI.toast.copySuccess")}),e.jsx("button",{type:"button",className:"btn-close btn-close-white me-2 m-auto",onClick:()=>V(!1)})]})})}),!c&&ms&&e.jsxs("div",{className:"mt-5 p-0",style:{maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2",style:{rowGap:"0.75rem"},children:[e.jsx("h6",{className:"mb-0 w-100 w-md-auto",children:m("proposalUI.custom.title")}),e.jsx("input",{type:"text",placeholder:m("proposalUI.custom.itemName"),value:P,onChange:e=>{G(e.target.value),ns&&ls("")},className:"form-control",style:{flex:1,minWidth:"200px",maxWidth:"100%"}}),e.jsx("input",{type:"number",placeholder:m("proposalUI.custom.price"),value:_,onChange:e=>{J(e.target.value),ns&&ls("")},className:"form-control",style:{width:"90px",minWidth:"70px"},min:"0",step:"0.01"}),e.jsx("div",{className:"form-check d-flex align-items-center",children:e.jsx(L,{checked:Q,onChange:e=>{ms&&Y(e.target.checked)},disabled:!ms,style:{transform:"scale(1.4)"},label:e.jsx("span",{style:{fontSize:"1.1rem",marginLeft:"0.5rem"},children:m("proposalUI.custom.taxable")})})}),e.jsx("button",{className:"btn btn-primary",style:{minWidth:"80px"},onClick:()=>{if(!P||!_)return void ls("Please enter both item name and price.");const e={name:P,price:parseFloat(_),taxable:!ms||Q,selectVersion:s?.versionName};Z(s=>[...s,e]),G(""),J(""),Y(!0)},children:m("proposalUI.custom.add")})]}),ns&&e.jsx("div",{style:{color:"red",marginTop:"0.25rem",marginBottom:"1rem"},children:ns}),e.jsx("div",{className:"table-responsive d-none d-md-block",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:m("proposalUI.custom.table.index")}),e.jsx("th",{children:m("proposalUI.custom.table.itemName")}),e.jsx("th",{children:m("proposalUI.custom.table.price")}),e.jsx("th",{children:m("proposalUI.custom.table.taxable")}),e.jsx("th",{children:m("proposalUI.custom.table.actions")})]})}),e.jsx("tbody",{children:K?.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:s.name}),e.jsxs("td",{children:["$",(Number(s.price)||0).toFixed(2)]}),e.jsx("td",{children:s.taxable?m("common.yes"):m("common.no")}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-danger text-white",onClick:()=>Rs(t),disabled:c,title:c?m("proposals.lockedTooltip"):void 0,children:m("proposalUI.custom.delete")})})]},t))})]})}),e.jsxs("div",{className:"d-block d-md-none",children:[K&&K.length>0&&e.jsxs("div",{className:"row fw-bold text-muted mb-2 px-2",style:{fontSize:"0.85rem"},children:[e.jsx("div",{className:"col-1",children:"#"}),e.jsx("div",{className:"col-4",children:m("proposalUI.custom.table.itemName")}),e.jsx("div",{className:"col-3",children:m("proposalUI.custom.table.price")}),e.jsx("div",{className:"col-2",children:m("proposalUI.custom.table.taxable")}),e.jsx("div",{className:"col-2",children:m("proposalUI.custom.table.actions")})]}),K?.map((s,t)=>e.jsxs("div",{className:"row mb-2 py-2 border-bottom align-items-center",children:[e.jsx("div",{className:"col-1 text-center",children:t+1}),e.jsx("div",{className:"col-4",style:{fontSize:"0.9rem"},children:s.name}),e.jsxs("div",{className:"col-3",style:{fontSize:"0.9rem"},children:["$",(Number(s.price)||0).toFixed(2)]}),e.jsx("div",{className:"col-2 text-center",style:{fontSize:"0.9rem"},children:s.taxable?m("common.yes"):m("common.no")}),e.jsx("div",{className:"col-2",children:e.jsx("button",{className:"btn btn-sm btn-danger text-white",onClick:()=>Rs(t),disabled:c,title:c?m("proposals.lockedTooltip"):void 0,style:{fontSize:"0.75rem",padding:"0.2rem 0.4rem"},children:m("proposalUI.custom.delete")})})]},t)),(!K||0===K.length)&&e.jsx("div",{className:"text-muted text-center py-3",style:{fontSize:"0.9rem"},children:"No custom items added yet"})]})]}),Qe&&e.jsx("div",{className:"mt-5 mb-5 d-flex justify-content-center",children:e.jsx("table",{className:"table shadow-lg",style:{maxWidth:"500px"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("proposalDoc.priceSummary.cabinets")}),e.jsxs("td",{className:"text-center fw-medium",children:["$",s?.summary?.cabinets||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("proposalDoc.priceSummary.assembly")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.assemblyFee||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("proposalDoc.priceSummary.modifications")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.modificationsCost||"0"]})]}),e.jsxs("tr",{className:"table-secondary",children:[e.jsx("th",{children:m("proposalDoc.priceSummary.styleTotal")}),e.jsxs("td",{className:"text-center fw-semibold",children:["$",s?.summary?.styleTotal||"0"]})]}),ms&&e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("proposalUI.summary.discountPct")}),e.jsx("td",{className:"text-center",children:e.jsx("input",{type:"number",min:"0",max:"100",value:s?.summary?.discountPercent||"0",onChange:e=>{const s=Math.max(0,Math.min(100,parseFloat(e.target.value)||0));Re(s)},style:{border:"none",outline:"none",background:"transparent",width:"60px",textAlign:"right",fontWeight:"500"}})})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("proposalDoc.priceSummary.total")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.total||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("settings.manufacturers.edit.deliveryFee")}),e.jsxs("td",{className:"text-center",children:["$",fs.length>0&&s?.summary?.deliveryFee||"0"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("proposalUI.summary.taxRate")}),e.jsxs("td",{className:"text-center",children:[s?.summary?.taxRate||"0","%"]})]}),e.jsxs("tr",{children:[e.jsx("th",{className:"bg-light",children:m("proposalDoc.priceSummary.tax")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.taxAmount||"0"]})]}),e.jsxs("tr",{className:"table-success fw-bold",children:[e.jsx("th",{children:m("proposalDoc.priceSummary.grandTotal")}),e.jsxs("td",{className:"text-center",children:["$",s?.summary?.grandTotal||"0"]})]})]})})}),e.jsx(E,{visible:ee,onClose:()=>se(!1),onApplyModification:(e,s)=>{const t="number"==typeof e?e:te,a=[...$e[`row_${t}`]||[],{type:"existing",modificationId:s.templateId,qty:s.quantity||1,note:s.note||"",name:s.templateName||"",price:s.price||0,categoryName:s.categoryName||void 0,fieldsConfig:s.fieldsConfig||{},selectedOptions:s.selectedOptions||{},attachments:Array.isArray(s.attachments)?s.attachments:[],assignmentId:s.assignmentId}];zs(t,a),se(!1)},selectedItemIndex:te,catalogItemId:ws})]})},Ve=()=>e.jsxs("div",{style:Be.container,role:"status","aria-live":"polite","aria-busy":"true",children:[e.jsx("div",{style:Be.spinner,"aria-hidden":"true"}),e.jsx("p",{style:Be.text,children:"Loadingâ€¦"})]}),Be={container:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh"},spinner:{width:"40px",height:"40px",border:"5px solid #f3f3f3",borderTop:"5px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite"},text:{marginTop:8,fontSize:14,color:"#6c757d"}},Oe=[{label:"Draft",value:"Draft"},{label:"Follow up 1",value:"Follow up 1"},{label:"Follow up 2",value:"Follow up 2"},{label:"Follow up 3",value:"Follow up 3"},{label:"Measurement Scheduled",value:"Measurement Scheduled"},{label:"Measurement done",value:"Measurement done"},{label:"Design done",value:"Design done"},{label:"Quote done",value:"Proposal done"},{label:"Quote accepted",value:"Proposal accepted"},{label:"Quote rejected",value:"Proposal rejected"}],Pe=Ae(({isContractor:a,contractorGroupId:n,contractorModules:d,contractorGroupName:m})=>{const u=e.jsx("style",{children:"\n      .edit-proposal-page .btn { min-height: 44px; }\n      /* Horizontal scroll guards for long badge rows */\n      .edit-proposal-page .proposal-version-badges { display: flex; gap: .5rem; overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: .25rem; }\n      .edit-proposal-page .proposal-version-badge { min-height: 44px; align-items: center; }\n      /* Sticky bottom action bar on small screens */\n      @media (max-width: 576px) {\n        .edit-proposal-page .proposal-actions { position: sticky; bottom: 0; left: 0; right: 0; z-index: 1020; background: rgba(255,255,255,.96); backdrop-filter: saturate(140%) blur(8px); border-top: 1px solid #e5e7eb; padding: .5rem env(safe-area-inset-right) calc(.5rem + env(safe-area-inset-bottom)) env(safe-area-inset-left); margin: 0 -1rem; }\n        .edit-proposal-page .proposal-actions .mobile-form-btn { flex: 1 1 auto; }\n      }\n    "}),{id:p}=r(),b=x(p),y=i(),j=o(),A=l(e=>e.manufacturers.byId),[$,M]=t.useState(null),[F,E]=t.useState(!0),[O,L]=t.useState("item"),[G,_]=t.useState(!1),[J,Q]=t.useState(!1),[Y,K]=t.useState(null),[X,Ce]=t.useState(null),[De,ke]=t.useState(""),[Ae,Me]=t.useState(null),[Ie,Ee]=t.useState(null),[qe,Re]=t.useState(!1),[ze,We]=t.useState(!1),[Te,Be]=t.useState(!1),[Pe,Le]=t.useState(null),[He,Ge]=t.useState([]),_e=JSON.parse(localStorage.getItem("user")),Je=t.useRef(!1),{t:Qe}=f(),Ye=h(_e,"admin:users"),Ke=_e?.group&&"contractor"===_e.group.group_type,Xe=!(!_e?.role||"admin"!==String(_e.role).toLowerCase()),Ze=w().shape({description:C().required("Description is required"),...Ye&&{designer:C().required("Designer is required")}}),es=()=>ts?.manufacturersData||[],ss={manufacturersData:[],designer:"",description:"",date:null,designDate:null,measurementDate:null,status:"Draft",files:[],customerName:""},[ts,as]=t.useState(ss),[rs,is]=t.useState(!1),ns="Proposal accepted"===ts?.status||"accepted"===ts?.status,ls=!!ts?.is_locked,os=ls||ns&&!Xe,cs=e=>{is(!0),as(e)};t.useEffect(()=>{},[ts]),t.useEffect(()=>{g.get(`/api/quotes/proposalByID/${b}`).then(e=>{let s=e.data.manufacturersData;if("string"==typeof s)try{s=JSON.parse(s)}catch(a){s=[]}Array.isArray(s)||(s=[]);const t={...e.data,manufacturersData:s};M(t),as(t||ss),is(!1),E(!1)}).catch(e=>{E(!1)})},[b]),t.useEffect(()=>{Ye&&(async()=>{try{const e=(await g.get("/api/designers")).data.users.map(e=>({value:e.id,label:e.name}));Ge(e)}catch(e){}})()},[Ye]),t.useEffect(()=>{$&&!rs&&as($)},[$,rs]),t.useEffect(()=>{const e=es();e.length>0&&e.forEach(e=>{e.manufacturer&&!A[e.manufacturer]&&j(N({id:e.manufacturer,includeCatalog:!1}))})},[ts?.manufacturersData,j,A]),t.useEffect(()=>{const e=es();if(0===e.length)return;const s=e.map(e=>({...e,manufacturerData:A[e.manufacturer]}));s.length>0&&null===Ae&&!Je.current&&(Me(0),Ee(s[0]),Je.current=!0,j(Fe(s[0])))},[ts.manufacturersData,A,Ae,j]),t.useEffect(()=>{Ie&&j(Fe(Ie))},[Ie,j]);const ds=e=>{as(s=>({...s,...e}))},ms=es().map(e=>({...e,manufacturerData:A[e.manufacturer]})),us=ms[Ae]||null,ps=()=>fs({...ts},"update"),xs=async()=>{try{const e=Ie?.manufacturerData?.id||Ie?.manufacturer||ts?.manufacturerId||ts?.manufacturersData?.[Ae]?.manufacturer;if(Ie?.items&&Ie.items.length>0&&e){const s=await U(Ie.items,e);if(!s.isValid)return void(await T(s.missingRequirements,Se))}(await Se.fire({title:Qe("proposals.confirm.submitTitle","Confirm Quote Submission"),html:`\n          <div style="text-align:left">\n            <p>${Qe("proposals.confirm.submitText","Once you submit this quote, it will be sent to production and cannot be changed.")}</p>\n            <p>${Qe("proposals.confirm.submitWarning","By continuing, you confirm that all details are correct and you accept the Terms & Conditions.")}</p>\n          </div>\n        `,icon:"warning",showCancelButton:!0,confirmButtonText:Qe("proposals.confirm.submitConfirm","Accept and Submit"),cancelButtonText:Qe("proposals.confirm.goBack","Go Back"),reverseButtons:!0,focusCancel:!0})).isConfirmed&&fs({...ts,status:"Proposal accepted",is_locked:!0},"accept")}catch(e){}},hs=()=>fs({...ts,status:"Proposal rejected"},"reject"),fs=async(e,s="update")=>{try{if(ls)return void Se.fire(Qe("common.warning","Warning"),Qe("proposals.lockedStatus.description"),"warning");if(!Xe&&ns&&"update"!==s)return void Se.fire(Qe("common.warning","Warning"),Qe("proposals.lockedStatus.description"),"info");const t={action:s,formData:e},a=await j(v(t));if(!0===a.payload?.success)Se.fire(Qe("common.success","Success"),Qe("proposals.toast.successSend","Quote saved successfully"),"success"),y("/quotes");else{const e=a.payload?.message||a.error?.message||"",t=a.payload?.missingRequirements;if(t&&Array.isArray(t)&&t.length>0)return void(await T(t,Se));if("accept"===s&&"string"==typeof e&&/(missing|required selections|is missing)/i.test(e))return void(await Se.fire({icon:"warning",title:Qe("proposals.errors.cannotAccept","Cannot accept quote"),text:e,confirmButtonText:"OK",confirmButtonColor:"#d33"}));/locked/i.test(e)?Se.fire(Qe("common.warning","Warning"),Qe("proposals.lockedStatus.description"),"warning"):Se.fire(Qe("common.error","Error"),e||Qe("proposals.toast.errorGeneric"),"error")}}catch(t){const e=t?.response?.status,s=t?.response?.data?.message||t?.message||Qe("proposals.toast.errorGeneric");if(403===e&&/locked/i.test(s))Se.fire(Qe("common.warning","Warning"),Qe("proposals.lockedStatus.description"),"warning");else if(400===e){const e=t?.response?.data?.missingRequirements;e&&Array.isArray(e)&&e.length>0?await T(e,Se):/(missing|required selections|is missing)/i.test(s)?Se.fire(Qe("proposals.errors.cannotAccept","Cannot accept quote"),s,"warning"):Se.fire(Qe("common.error","Error"),s,"error")}else Se.fire(Qe("common.error","Error"),s,"error")}};return F?e.jsx(Ve,{}):e.jsxs(Z,{fluid:!0,className:"dashboard-container edit-proposal-page",style:{backgroundColor:"#f8fafc",minHeight:"100vh"},children:[u,e.jsx(c,{title:Qe("proposals.edit.title","Edit Quote"),icon:ge,badges:[...ns?[{text:Qe("proposals.lockedStatus.title"),variant:"success"}]:[],...ls?[{text:"Locked",variant:"dark"}]:[]],rightContent:e.jsxs("div",{className:"d-flex gap-2 flex-wrap justify-content-center justify-content-sm-end",children:[e.jsxs(xe,{className:"shadow-sm px-4 fw-semibold d-flex align-items-center mobile-action-btn",style:{backgroundColor:"print"===Pe?"#218838":"#28a745",color:"#fff",borderRadius:"8px",borderWidth:0,borderStyle:"none",transition:"all 0.3s ease"},onMouseEnter:()=>Le("print"),onMouseLeave:()=>Le(null),onClick:()=>Re(!0),children:[e.jsx(je,{className:"me-2"}),Qe("proposals.create.actions.print")]}),!Ke&&e.jsxs(e.Fragment,{children:[e.jsxs(xe,{className:"shadow-sm px-4 fw-semibold d-flex align-items-center mobile-action-btn",style:{backgroundColor:"email"===Pe?"#138496":"#17a2b8",color:"#fff",borderRadius:"8px",borderWidth:0,borderStyle:"none",transition:"all 0.3s ease"},onMouseEnter:()=>Le("email"),onMouseLeave:()=>Le(null),onClick:()=>We(!0),children:[e.jsx(Ne,{className:"me-2"}),Qe("proposals.create.actions.email")]}),e.jsxs(xe,{className:"shadow-sm px-4 fw-semibold d-flex align-items-center mobile-action-btn",style:{backgroundColor:"contract"===Pe?"#e0a800":"#ffc107",color:"#212529",borderRadius:"8px",borderWidth:0,borderStyle:"none",transition:"all 0.3s ease"},onMouseEnter:()=>Le("contract"),onMouseLeave:()=>Le(null),onClick:()=>Be(!0),children:[e.jsx(ve,{className:"me-2"}),Qe("proposals.create.actions.contract")]})]})]})}),e.jsx("div",{className:"mb-4",children:e.jsx(D,{initialValues:$||ss,enableReinitialize:!0,validationSchema:Ze,onSubmit:e=>{fs({...ts,...e},"update")},children:({values:r,errors:i,touched:n,handleChange:l,handleBlur:o,handleSubmit:c,setFieldValue:d,setValues:m})=>(t.useEffect(()=>{try{const e=JSON.stringify(r);e!==JSON.stringify(ts)&&m(ts)}catch(e){}},[ts]),e.jsxs(ee,{onSubmit:c,className:"proposal-summary-form",children:[e.jsx("div",{className:"card border-0 shadow-sm mb-4",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs(se,{className:"g-3",children:[Ye&&e.jsxs(te,{xs:12,sm:6,lg:4,children:[e.jsx(ae,{htmlFor:"designer",children:"Designer *"}),e.jsx(S,{isClearable:!0,id:"designer",name:"designer",options:He,value:He.find(e=>e.value===r.designer)||null,onChange:e=>{d("designer",e?.value||"")},onBlur:o}),i.designer&&n.designer&&e.jsx("div",{className:"text-danger small mt-1",children:i.designer})]}),e.jsxs(te,{xs:12,sm:6,lg:4,children:[e.jsx(ae,{htmlFor:"description",children:"Description *"}),e.jsx(P,{type:"text",id:"description",name:"description",value:r.description,onChange:l,onBlur:o,placeholder:"Description"}),i.description&&n.description&&e.jsx("div",{className:"text-danger small mt-1",children:i.description})]}),e.jsxs(te,{xs:12,sm:6,lg:4,children:[e.jsx(ae,{htmlFor:"status",children:"Status"}),e.jsx(S,{isClearable:!0,options:Oe,value:Oe.find(e=>e.value===(r.status||"Draft")),onChange:e=>{d("status",e?.value||"Draft")},onBlur:o,inputId:"status"})]}),e.jsx(te,{xs:12,md:6,lg:4,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ae,{htmlFor:"date",children:"Date"}),e.jsx(s,{id:"date",selected:r.date?new Date(r.date):new Date,onChange:e=>d("date",e),className:"form-control",dateFormat:"MM/dd/yyyy",wrapperClassName:"w-100",placeholderText:"Date"}),e.jsx(ye,{style:{position:"absolute",top:"70%",right:"12px",transform:"translateY(-50%)",color:"#6c757d",pointerEvents:"none"}})]})}),e.jsx(te,{xs:12,md:6,lg:4,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ae,{htmlFor:"designDate",children:"Design Date"}),e.jsx(s,{id:"designDate",selected:r.designDate?new Date(r.designDate):null,onChange:e=>d("designDate",e),className:"form-control",dateFormat:"MM/dd/yyyy",wrapperClassName:"w-100",placeholderText:"Design Date"}),e.jsx(ye,{style:{position:"absolute",top:"70%",right:"12px",transform:"translateY(-50%)",color:"#6c757d",pointerEvents:"none"}})]})}),e.jsx(te,{xs:12,md:6,lg:4,children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(ae,{htmlFor:"measurementDate",children:"Measurement Date"}),e.jsx(s,{id:"measurementDate",selected:r.measurementDate?new Date(r.measurementDate):null,onChange:e=>d("measurementDate",e),className:"form-control",dateFormat:"MM/dd/yyyy",wrapperClassName:"w-100",placeholderText:"Measurement Date"}),e.jsx(ye,{style:{position:"absolute",top:"70%",right:"12px",transform:"translateY(-50%)",color:"#6c757d",pointerEvents:"none"}})]})})]})})}),!Ke&&e.jsx("div",{className:"proposal-version-badges",children:ms.map((s,t)=>{const r=t===Ae;return e.jsxs(re,{className:"proposal-version-badge p-3 d-flex",style:{fontSize:"0.8rem",cursor:"pointer",justifyContent:"space-between",backgroundColor:r?"#084298":"#d0e7ff",color:r?"#d0e7ff":"#084298",boxShadow:r?"0 0 8px 2px rgba(8, 66, 152, 0.6)":"0 1px 3px rgba(0, 0, 0, 0.1)",borderRadius:"8px",transition:"all 0.3s ease"},onClick:()=>{},role:"button",tabIndex:0,"aria-pressed":r,"aria-label":`Select version ${s.versionName}${r?" (current)":""}`,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||e.preventDefault()},children:[e.jsxs("div",{children:[!Ke&&e.jsx("strong",{style:{display:"block"},children:s.versionName}),e.jsxs("small",{style:{fontSize:"0.7rem",color:r?"#a9c7ff":"#4a6fa5"},children:["$ ",s.manufacturerData?.costMultiplier||"N/A"]})]}),!Ke&&e.jsxs(ie,{onClick:e=>e.stopPropagation(),children:[e.jsx(ne,{color:"transparent",size:"sm",style:{padding:"0 4px",color:r?"#d0e7ff":"#084298",backgroundColor:"transparent",borderWidth:0,borderStyle:"none",outline:"none",boxShadow:"none",transition:"all 0.2s ease"},"aria-label":`Version actions for ${s.versionName}`,children:e.jsx(H,{icon:q})}),e.jsxs(le,{style:{minWidth:"120px",borderWidth:"1px",borderStyle:"solid",borderColor:"#e0e0e0",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",borderRadius:"4px",padding:"4px 0"},children:[e.jsxs(oe,{onClick:()=>(e=>{a||(K(e),ke(ms[e].versionName),_(!0))})(t),style:{padding:"6px 12px",fontSize:"0.875rem",color:"#333",transition:"all 0.2s ease"},children:[e.jsx(H,{icon:$e,className:"me-2"})," Edit"]}),e.jsxs(oe,{onClick:()=>(e=>{a||(Ce(e),Q(!0))})(t),style:{padding:"6px 12px",fontSize:"0.875rem",color:"#dc3545",transition:"all 0.2s ease"},children:[e.jsx(H,{icon:we,className:"me-2"})," Delete"]}),e.jsxs(oe,{onClick:()=>(e=>{if(a)return;const s=es();if(!s[e])return;const t={...s[e]};t.versionName=`Copy of ${t.versionName}`,ds({manufacturersData:[...ts.manufacturersData,t]})})(t),style:{padding:"6px 12px",fontSize:"0.875rem",color:"#333",transition:"all 0.2s ease"},children:[e.jsx(H,{icon:k,className:"me-2"})," Duplicate"]})]})]})]},t)})}),e.jsx("hr",{}),e.jsx(ce,{children:e.jsx(de,{variant:"tabs",className:"quote-tabs border-0",children:e.jsx(me,{children:e.jsx(ue,{active:"item"===O,onClick:()=>{L("item")},style:{cursor:"pointer",borderWidth:0,borderStyle:"none",padding:"10px 20px",fontWeight:600,color:"item"===O?"#084298":"#6c757d",backgroundColor:"item"===O?"rgba(8, 66, 152, 0.1)":"transparent",borderBottom:"item"===O?"3px solid #084298":"none",transition:"all 0.3s ease",borderRadius:"4px 4px 0 0",marginRight:"4px"},children:e.jsxs("span",{className:"d-flex align-items-center",children:[e.jsx(H,{icon:I,className:"me-2"}),"Items"]})})})})}),"item"===O&&e.jsx("div",{className:"tab-content mt-4",children:e.jsx(Ue,{selectedVersion:Ie,formData:ts,setFormData:cs,setSelectedVersion:Ee,selectVersion:us,readOnly:os})}),e.jsx("div",{className:"proposal-actions",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center flex-wrap gap-3",children:os?e.jsx("div",{className:"w-100",children:e.jsxs(pe,{color:"success",className:"text-center",children:[e.jsxs("h5",{className:"alert-heading mb-3",children:[e.jsx(ge,{className:"me-2"}),Qe("proposals.lockedStatus.title")]}),e.jsx("p",{className:"mb-2",children:Qe("proposals.lockedStatus.description")}),e.jsx("small",{className:"text-muted",children:Qe("proposals.lockedStatus.processingNote")})]})}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{color:"secondary",variant:"outline",onClick:ps,className:"btn mobile-form-btn",children:"Save"}),e.jsx(xe,{color:"success",onClick:xs,className:"btn mobile-form-btn",disabled:ns,title:ns?"Already accepted":void 0,children:"Accept and Order"}),e.jsx(xe,{color:"danger",variant:"outline",onClick:hs,className:"btn mobile-form-btn",children:"Reject and Archive"})]})})})]}))})}),e.jsx(R,{show:qe,onClose:()=>Re(!1),formData:ts}),e.jsx(z,{show:ze,onClose:()=>We(!1),formData:ts}),e.jsx(W,{show:Te,onClose:()=>Be(!1)}),e.jsxs(V,{visible:G,onClose:()=>_(!1),alignment:"center",backdrop:"static",className:"modal-lg",children:[e.jsx(he,{closeButton:!0,children:e.jsx(fe,{children:"Edit Version Name"})}),e.jsx(B,{children:e.jsx(P,{className:"mb-3",value:De,onChange:e=>ke(e.target.value),placeholder:"Version Name"})}),e.jsxs(be,{children:[e.jsx(xe,{color:"secondary",onClick:()=>_(!1),children:"Cancel"}),e.jsx(xe,{color:"primary",onClick:()=>{if(es().find((e,s)=>e.versionName===De&&s!==Y))return void Se.fire({icon:"error",title:"Duplicate Version Name",text:`Manufacturer Version "${De}" already exists.`});const e=[...es()];e[Y]&&(e[Y].versionName=De,ds({manufacturersData:e})),_(!1)},children:"Save"})]})]}),e.jsxs(V,{visible:J,onClose:()=>Q(!1),alignment:"center",backdrop:"static",className:"modal-sm",children:[e.jsx(he,{closeButton:!0,children:e.jsx(fe,{children:"Confirm Delete"})}),e.jsx(B,{children:"Are you sure you want to delete this version?"}),e.jsxs(be,{children:[e.jsx(xe,{color:"secondary",onClick:()=>Q(!1),children:"Cancel"}),e.jsx(xe,{color:"danger",onClick:()=>{if(a)return;const e=es().filter((e,s)=>s!==X);ds({manufacturersData:e}),X===Ae?(Me(null),Ee(null)):X<Ae&&Me(Ae-1),Q(!1)},children:"Delete"})]})]})]})},"proposals");export{Pe as default};
