@use './tokens';
@use './mixins';

/* Cascade layers keep overrides predictable */
@layer base, components, utilities;

@layer base {
  html, body { font-family: Inter, Roboto, system-ui, -apple-system, Segoe UI, Oxygen, Ubuntu, Cantarell, sans-serif; }
  body { background: var(--surface-muted); font-size: var(--fs-body); }

  /* Native controls pick up brand color (progressive) */
  input[type="checkbox"], input[type="radio"] { accent-color: var(--cui-primary); }
}

@layer components {
  /* 1) Sticky toolbars (filters + search) */
  .toolbar { @include mixins.sticky-top(15); @include mixins.safe-area(.5rem);
    display:grid; gap:var(--sp-2); grid-template-columns:1fr auto;
    padding:var(--sp-2); border-bottom:1px solid rgba(0,0,0,.06);
    backdrop-filter:saturate(140%) blur(6px);
  }
  .toolbar .search { height:44px; border:1px solid #e5e7eb; border-radius:var(--radius); padding:0 var(--sp-3); background:#f7f8fb; }

  /* 2) Compact cards (quotes, customers, products) */
  .card--compact { background:var(--surface); border-radius:var(--radius); box-shadow:var(--elev-1);
    padding:var(--sp-3); display:grid; gap:var(--sp-2);
  }
  .card__head{ display:grid; grid-template-columns:1fr auto; align-items:center; }
  .card__title{ font-size:var(--fs-title); margin:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .status-pill{ font:600 var(--fs-sub)/1 inherit; padding:.25rem .5rem; border-radius:999px; background:#eef1ff; color:#3a49b6; }
  .card__meta{ display:flex; flex-wrap:wrap; gap:.375rem .5rem; color:var(--muted); font-size:var(--fs-sub); }
  .clamp-2{ @include mixins.clamp-lines(2); }  /* or use `line-clamp:2` where supported */

  /* 3) Icon buttons */
  .icon-btn{ @include mixins.touch-target(44px); display:grid; place-items:center;
    border:1px solid #e5e7eb; border-radius:10px; background:#fff; transition:transform .08s ease, box-shadow .12s ease;
  }
  .icon-btn:hover{ transform:translateY(-1px); box-shadow:0 2px 4px rgba(0,0,0,.08); }
  .icon-btn:focus-visible{ outline:3px solid color-mix(in oklch, var(--brand) 45%, transparent); outline-offset:2px; }

  /* 4) Segmented controls (hinge/exposed side, filters) */
  .segmented{ display:inline-grid; grid-auto-flow:column; gap:.375rem; }
  .segmented input{ position:absolute; opacity:0; pointer-events:none; }
  .segmented label{ @include mixins.touch-target(44px); display:grid; place-items:center; padding:0 var(--sp-3);
    border:1px solid #e5e7eb; border-radius:10px; background:#fff; transition:box-shadow .12s ease, transform .12s ease;
  }
  .segmented label:has(input:checked){
    background: color-mix(in oklch, var(--brand) 12%, white);
    border-color: color-mix(in oklch, var(--brand) 40%, #e5e7eb);
    box-shadow:0 0 0 2px color-mix(in oklch, var(--brand) 30%, transparent);
    font-weight:600;
  }

  /* 5) Modern tables (sticky head + optional sticky first column) */
  .table-modern{ width:100%; border-collapse:separate; border-spacing:0; background:var(--surface); border-radius:var(--radius); box-shadow:var(--elev-1); }
  .table-modern th,.table-modern td{ padding:.625rem .75rem; vertical-align:middle; }
  .table-modern thead th{ position:sticky; top:0; z-index:2; background:var(--surface); border-bottom:1px solid #e5e7eb; }
  .table-modern .sticky-col{ position:sticky; left:0; z-index:3; background:var(--surface); box-shadow:1px 0 0 rgba(0,0,0,.06) inset; }

  /* 6) Totals panel */
  .summary-panel{ width:clamp(260px, 42vw, 360px); background:rgba(255,255,255,.7);
    backdrop-filter:saturate(140%) blur(8px); border:1px solid rgba(0,0,0,.06); border-radius:var(--radius); box-shadow:var(--elev-1);
  }
  .summary-panel .row{ display:flex; justify-content:space-between; padding:.625rem .75rem; border-bottom:1px solid #eef0f3; }
  .summary-panel .grand{ background: color-mix(in oklch, #22c55e 18%, white); font-weight:700; }

  @media (max-width:576px){
    .table-modern th,.table-modern td{ padding:.5rem .625rem; }
  }
}

@layer utilities {
  .content-vis{ content-visibility:auto; }  /* great for long lists */
  .toolbar--sticky{ @include mixins.sticky-top(15); }
}
